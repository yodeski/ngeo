!function(e){function t(t){for(var o,i,s=t[0],l=t[1],u=t[2],d=0,f=[];d<s.length;d++)i=s[d],n[i]&&f.push(n[i][0]),n[i]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(h&&h(t);f.length;)f.shift()();return a.push.apply(a,u||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],o=!0,s=1;s<r.length;s++){var l=r[s];0!==n[l]&&(o=!1)}o&&(a.splice(t--,1),e=i(i.s=r[0]))}return e}var o={},n={20:0},a=[];function i(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=o,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var h=l;a.push([583,0]),r()}({583:function(e,t,r){r(71),r(72),e.exports=r(584)},584:function(e,t,r){"use strict";r.r(t);r(585);var o=r(1),n=r(212),a=r(175),i=r(24),s=r(151),l=r(171),u={};u.module=angular.module("gmfapp",["gettext",n.a.module.name,a.a.module.name,i.a.module.name]),u.module.value("gmfTreeUrl","https://geomapfish-demo-dc.camptocamp.com/2.4/themes?version=2&background=background"),u.module.value("gmfLayersUrl","https://geomapfish-demo-dc.camptocamp.com/2.4/layers/"),u.module.constant("defaultTheme","Demo"),u.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js"),u.MainController=function(e,t,r,n,a){var i=this;this.http_=e,this.q_=t,this.gmfThemes_=n,this.gmfXSDAttributes_=a,this.urls=[{name:"oeedit app. (hosted)",url:"apps/oeedit/"},{name:"oeedit app. (dev)",url:"../apps/oeedit/"},{name:"example",url:"objectediting.html"}],this.viewerUrlDev_="../apps/oeview/",this.viewerUrlHosted_="apps/oeview/",this.selectedUrl=this.urls[0],this.gmfServers_,this.gmfServer_,this.gmfLayerNodes=[],this.selectedGmfLayerNode=null,this.featuresCache_={},this.features=null,this.selectedFeature=null,this.geomTypeCache_={},this.selectedGeomType=void 0,r.$watch(function(){return i.selectedGmfLayerNode},function(e,t){i.selectedFeature=null,e&&(i.getFeatures_(e).then(i.handleGetFeatures_.bind(i,e)),i.getGeometryType_(e).then(i.handleGetGeometryType_.bind(i,e)))}),this.themeName="ObjectEditing",this.gmfThemes_.loadThemes(),this.gmfThemes_.getOgcServersObject().then(function(e){i.gmfServers_=e,i.gmfThemes_.getThemesObject().then(function(e){if(e){var t,r,n;for(t=0,r=e.length;t<r;t++)if(e[t].name===i.themeName){n=e[t];break}if(n){var a=n.children[0];o.a.assert(a.ogcServer);var s=i.gmfServers_[a.ogcServer];if(s&&!0===s.wfsSupport&&s.urlWfs){i.gmfServer_=s;var l=[];for(t=0,r=a.children.length;t<r;t++)a.children[t].metadata.identifierAttributeField&&l.push(a.children[t]);i.gmfLayerNodes=l,i.selectedGmfLayerNode=i.gmfLayerNodes[1]}}}})})},u.MainController.$inject=["$http","$q","$scope","gmfThemes","gmfXSDAttributes"],u.MainController.prototype.runEditor=function(){var e=this.selectedGeomType,t=this.selectedFeature,r=this.selectedGmfLayerNode.id,n=this.selectedGmfLayerNode.metadata.identifierAttributeField;o.a.assert(void 0!==n);var i=t.get(n),s={};s[a.a.Param.GEOM_TYPE]=e,s[a.a.Param.ID]=i,s[a.a.Param.LAYER]=r,s[a.a.Param.THEME]=this.themeName,s[a.a.Param.PROPERTY]=n;var l=u.MainController.appendParams(this.selectedUrl.url,s);window.open(l)},u.MainController.prototype.runViewerDev=function(){this.runViewer_(this.viewerUrlDev_)},u.MainController.prototype.runViewerHosted=function(){this.runViewer_(this.viewerUrlHosted_)},u.MainController.prototype.runViewer_=function(e){var t=this.selectedGmfLayerNode,r=t.id,n=t.name,a=t.metadata.identifierAttributeField;o.a.assert(void 0!==a);for(var i=[],s=this.featuresCache_[r],l=0,h=s.length;l<h;l++)i.push(s[l].get(a));var d={};d.wfs_layer=n,d["wfs_"+a]=i.join(",");var f=u.MainController.appendParams(e,d);window.open(f)},u.MainController.prototype.getFeatures_=function(e){return this.getFeaturesDeferred_=this.q_.defer(),this.getFeaturesFromCache_(e)?this.getFeaturesDeferred_.resolve():this.issueGetFeatures_(e),this.getFeaturesDeferred_.promise},u.MainController.prototype.issueGetFeatures_=function(e){var t=this,r=e.id,o=u.MainController.appendParams(this.gmfServer_.urlWfs,{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.1.0",TYPENAME:e.layers});this.http_.get(o).then(function(e){var o=(new s.a).readFeatures(e.data);t.featuresCache_[r]=o,t.getFeaturesDeferred_.resolve()})},u.MainController.prototype.handleGetFeatures_=function(e){var t=this.getFeaturesFromCache_(e);this.features=t,this.selectedFeature=this.features[0]},u.MainController.prototype.getFeaturesFromCache_=function(e){var t=e.id;return this.featuresCache_[t]||null},u.MainController.prototype.getGeometryType_=function(e){return this.getGeometryTypeDeferred_=this.q_.defer(),this.getGeometryTypeFromCache_(e)?this.getGeometryTypeDeferred_.resolve():this.issueGetAttributesRequest_(e),this.getGeometryTypeDeferred_.promise},u.MainController.prototype.issueGetAttributesRequest_=function(e){this.gmfXSDAttributes_.getAttributes(e.id).then(function(e,t){var r=l.a.getGeometryAttribute(t);r&&r.geomType&&(this.geomTypeCache_[e.id]=r.geomType,this.getGeometryTypeDeferred_.resolve())}.bind(this,e))},u.MainController.prototype.handleGetGeometryType_=function(e){var t=this.getGeometryTypeFromCache_(e);this.selectedGeomType=t},u.MainController.prototype.getGeometryTypeFromCache_=function(e){var t=e.id;return this.geomTypeCache_[t]},u.MainController.appendParams=function(e,t){var r=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&r.push(e+"="+encodeURIComponent(t[e]))});var o=r.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+o},u.module.controller("MainController",u.MainController),t.default=u},585:function(e,t){}});
//# sourceMappingURL=objecteditinghub.450c5c.js.map