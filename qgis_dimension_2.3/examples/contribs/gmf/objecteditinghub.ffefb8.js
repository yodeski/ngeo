!function(e){function t(t){for(var o,n,s=t[0],l=t[1],u=t[2],d=0,p=[];d<s.length;d++)n=s[d],a[n]&&p.push(a[n][0]),a[n]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(h&&h(t);p.length;)p.shift()();return i.push.apply(i,u||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],o=!0,s=1;s<r.length;s++){var l=r[s];0!==a[l]&&(o=!1)}o&&(i.splice(t--,1),e=n(n.s=r[0]))}return e}var o={},a={11:0},i=[];function n(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=o,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var h=l;i.push([420,0]),r()}({419:function(e,t,r){"use strict";r.r(t);r(553);var o=r(1),a=r(185),i=r(147),n=r(19),s=r(218),l=r(146),u={};u.module=angular.module("gmfapp",["gettext",a.a.module.name,i.a.module.name,n.a.module.name]),u.module.value("gmfTreeUrl","https://geomapfish-demo.camptocamp.com/2.3/wsgi/themes?version=2&background=background"),u.module.value("gmfLayersUrl","https://geomapfish-demo.camptocamp.com/2.3/wsgi/layers/"),u.module.constant("defaultTheme","Demo"),u.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js"),u.MainController=function(e,t,r,a,i){var n=this;this.http_=e,this.q_=t,this.gmfThemes_=a,this.gmfXSDAttributes_=i,this.urls=[{name:"oeedit app. (hosted)",url:"apps/oeedit/"},{name:"oeedit app. (dev)",url:"../apps/oeedit/"},{name:"example",url:"objectediting.html"}],this.viewerUrlDev_="../apps/oeview/",this.viewerUrlHosted_="apps/oeview/",this.selectedUrl=this.urls[0],this.gmfServers_,this.gmfServer_,this.gmfLayerNodes=[],this.selectedGmfLayerNode=null,this.featuresCache_={},this.features=null,this.selectedFeature=null,this.geomTypeCache_={},this.selectedGeomType=void 0,r.$watch(function(){return n.selectedGmfLayerNode},function(e,t){n.selectedFeature=null,e&&(n.getFeatures_(e).then(n.handleGetFeatures_.bind(n,e)),n.getGeometryType_(e).then(n.handleGetGeometryType_.bind(n,e)))}),this.themeName="ObjectEditing",this.gmfThemes_.loadThemes(),this.gmfThemes_.getOgcServersObject().then(function(e){n.gmfServers_=e,n.gmfThemes_.getThemesObject().then(function(e){if(e){var t=void 0,r=void 0,a=void 0;for(t=0,r=e.length;t<r;t++)if(e[t].name===n.themeName){a=e[t];break}if(a){var i=a.children[0];o.a.assert(i.ogcServer);var s=n.gmfServers_[i.ogcServer];if(s&&!0===s.wfsSupport&&s.urlWfs){n.gmfServer_=s;var l=[];for(t=0,r=i.children.length;t<r;t++)i.children[t].metadata.identifierAttributeField&&l.push(i.children[t]);n.gmfLayerNodes=l,n.selectedGmfLayerNode=n.gmfLayerNodes[1]}}}})})},u.MainController.$inject=["$http","$q","$scope","gmfThemes","gmfXSDAttributes"],u.MainController.prototype.runEditor=function(){var e=this.selectedGeomType,t=this.selectedFeature,r=this.selectedGmfLayerNode.id,a=this.selectedGmfLayerNode.metadata.identifierAttributeField;o.a.assert(void 0!==a);var n=t.get(a),s={};s[i.a.Param.GEOM_TYPE]=e,s[i.a.Param.ID]=n,s[i.a.Param.LAYER]=r,s[i.a.Param.THEME]=this.themeName,s[i.a.Param.PROPERTY]=a;var l=u.MainController.appendParams(this.selectedUrl.url,s);window.open(l)},u.MainController.prototype.runViewerDev=function(){this.runViewer_(this.viewerUrlDev_)},u.MainController.prototype.runViewerHosted=function(){this.runViewer_(this.viewerUrlHosted_)},u.MainController.prototype.runViewer_=function(e){var t=this.selectedGmfLayerNode,r=t.id,a=t.name,i=t.metadata.identifierAttributeField;o.a.assert(void 0!==i);for(var n=[],s=this.featuresCache_[r],l=0,h=s.length;l<h;l++)n.push(s[l].get(i));var d={};d.wfs_layer=a,d["wfs_"+i]=n.join(",");var p=u.MainController.appendParams(e,d);window.open(p)},u.MainController.prototype.getFeatures_=function(e){return this.getFeaturesDeferred_=this.q_.defer(),this.getFeaturesFromCache_(e)?this.getFeaturesDeferred_.resolve():this.issueGetFeatures_(e),this.getFeaturesDeferred_.promise},u.MainController.prototype.issueGetFeatures_=function(e){var t=this,r=e.id,o=u.MainController.appendParams(this.gmfServer_.urlWfs,{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:"1.1.0",TYPENAME:e.layers});this.http_.get(o).then(function(e){var o=(new s.a).readFeatures(e.data);t.featuresCache_[r]=o,t.getFeaturesDeferred_.resolve()})},u.MainController.prototype.handleGetFeatures_=function(e){var t=this.getFeaturesFromCache_(e);this.features=t,this.selectedFeature=this.features[0]},u.MainController.prototype.getFeaturesFromCache_=function(e){var t=e.id;return this.featuresCache_[t]||null},u.MainController.prototype.getGeometryType_=function(e){return this.getGeometryTypeDeferred_=this.q_.defer(),this.getGeometryTypeFromCache_(e)?this.getGeometryTypeDeferred_.resolve():this.issueGetAttributesRequest_(e),this.getGeometryTypeDeferred_.promise},u.MainController.prototype.issueGetAttributesRequest_=function(e){this.gmfXSDAttributes_.getAttributes(e.id).then(function(e,t){var r=l.a.getGeometryAttribute(t);r&&r.geomType&&(this.geomTypeCache_[e.id]=r.geomType,this.getGeometryTypeDeferred_.resolve())}.bind(this,e))},u.MainController.prototype.handleGetGeometryType_=function(e){var t=this.getGeometryTypeFromCache_(e);this.selectedGeomType=t},u.MainController.prototype.getGeometryTypeFromCache_=function(e){var t=e.id;return this.geomTypeCache_[t]},u.MainController.appendParams=function(e,t){var r=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&r.push(e+"="+encodeURIComponent(t[e]))});var o=r.join("&");return(e=-1===(e=e.replace(/[?&]$/,"")).indexOf("?")?e+"?":e+"&")+o},u.module.controller("MainController",u.MainController),t.default=u},420:function(e,t,r){r(61),r(60),e.exports=r(419)},553:function(e,t){}});
//# sourceMappingURL=objecteditinghub.ffefb8.js.map