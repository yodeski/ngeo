!function(e){function t(t){for(var a,i,s=t[0],l=t[1],u=t[2],h=0,p=[];h<s.length;h++)i=s[h],n[i]&&p.push(n[i][0]),n[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(c&&c(t);p.length;)p.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],a=!0,s=1;s<r.length;s++){var l=r[s];0!==n[l]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var a={},n={1:0},o=[];function i(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=a,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;o.push([359,0]),r()}([,function(e,t,r){"use strict";var a={assert:function(e,t,r){return e},assertNumber:function(e,t,r){return e},assertString:function(e,t,r){return e},assertFunction:function(e,t,r){return e},assertObject:function(e,t,r){return e},assertArray:function(e,t,r){return e},assertBoolean:function(e,t,r){return e},assertElement:function(e,t,r){return e},assertInstanceof:function(e,t,r,a){return e},assertObjectPrototypeIsIntact:function(){}};t.a=a},,,,,,,,,,,,,,function(e,t,r){"use strict";t.a={CIRCLE:"Circle",LINE_STRING:"LineString",MULTI_LINE_STRING:"MultiLineString",MULTI_POINT:"MultiPoint",MULTI_POLYGON:"MultiPolygon",POINT:"Point",POLYGON:"Polygon",RECTANGLE:"Rectangle",TEXT:"Text"}},,function(e,t,r){"use strict";t.a={ANGLE:"a",COLOR:"c",IS_CIRCLE:"l",IS_RECTANGLE:"r",IS_TEXT:"t",NAME:"n",SHOW_LABEL:"b",OPACITY:"o",AZIMUT:"z",SHOW_MEASURE:"m",SIZE:"s",STROKE:"k"}},,,,,,,,,function(e,t,r){"use strict";t.a={BOOLEAN:"boolean",DATE:"date",DATETIME:"datetime",TIME:"time",GEOMETRY:"geometry",NUMBER:"number",SELECT:"select",TEXT:"text"}},,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(85),o=r(3),i=r(8),s=r(29),l=r(83),u=r(122),c=function(e,t,r,a,n,o){l.a.call(this),this.addBlankBackgroundLayer_=!0,void 0!==o.addBlankBackgroundLayer&&(this.addBlankBackgroundLayer_=o.addBlankBackgroundLayer),this.$q_=r,this.$http_=e,this.treeUrl_=void 0,t.has("gmfTreeUrl")&&(this.treeUrl_=t.get("gmfTreeUrl")),this.cacheVersion_="0",t.has("cacheVersion")&&(this.cacheVersion_=t.get("cacheVersion")),this.ngeoLocation_=null,t.has("ngeoLocation")&&(this.ngeoLocation_=t.get("ngeoLocation")),this.layerHelper_=a,this.gettextCatalog=n,this.deferred_=r.defer(),this.promise_=this.deferred_.promise,this.loaded=!1,this.bgLayerPromise_=null};c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"],c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"],o.d(c,l.a),c.findGroupByLayerNodeName=function(e,t){for(var r=0,a=e.length;r<a;r++)for(var n=e[r],o=0,i=n.children.length;o<i;o++){var s=n.children[o],l=[];if(c.getFlatNodes(s,l),c.findObjectByName(l,t))return s}return null},c.findGroupByName=function(e,t){for(var r=0,a=e.length;r<a;r++)for(var n=e[r],o=0,i=n.children.length;o<i;o++){var s=n.children[o],l=[];if(c.getFlatInternalNodes(s,l),c.findObjectByName(l,t))return s}return null},c.findObjectByName=function(e,t){return i.d(e,function(e){return e.name===t})},c.findThemeByName=function(e,t){return c.findObjectByName(e,t)},c.getFlatInternalNodes=function(e,t){var r=e.children;if(void 0!==r){t.push(e);for(var a=0;a<r.length;a++)c.getFlatInternalNodes(r[a],t)}},c.getFlatNodes=function(e,t){var r=void 0,a=e.children;if(void 0!==a)for(r=0;r<a.length;r++)c.getFlatNodes(a[r],t);else t.push(e)},c.prototype.getBgLayers=function(){var e=this,t=this.gettextCatalog;if(this.bgLayerPromise_)return this.bgLayerPromise_;var r=this.$q_,n=this.layerHelper_,i=function(e,t){t.set("label",e.name),t.set("metadata",e.metadata),t.set("dimensions",e.dimensions);var r=[];return function e(t,r){r.push(o.c(t)),(t.children||[]).forEach(function(t){e(t,r)})}(e,r),t.set("querySourceIds",r),t},l=function(e,t){if("WMTS"===t.type){var o=t;return a.a.assert(o.url,"Layer URL is required"),n.createWMTSLayerFromCapabilitites(o.url,o.layer||"",o.matrixSet,t.dimensions,o.metadata.customOpenLayersOptions).then(i.bind(null,t)).then(null,function(e){var t='Unable to build layer "'+o.layer+'" from WMTSCapabilities: '+o.url+"\n";return t+='OpenLayers error is "'+e.message,console.error(t),r.resolve(void 0)})}if("WMS"===t.type){var s=t;a.a.assert(s.ogcServer,"An OGC server is required");var l=e[s.ogcServer];return a.a.assert(l,"The OGC server was not found"),a.a.assert(l.url,"The server URL is required"),a.a.assert(l.imageType,"The server image type is required"),i(t,n.createBasicWMSLayer(l.url,s.layers||"",l.imageType,l.type,void 0,t.dimensions,l.credential?"use-credentials":"anonymous",s.metadata.customOpenLayersOptions))}a.a.fail("Unsupported type: "+t.type)},c=function(e){var t=e.background_layers.map(function(t){var a=t.type;return"WMTS"===a||"WMS"===a?l(e.ogcServers,t):t.children?function(e,t){var a=t.children.map(function(e){return e}).reverse().map(l.bind(null,e));return r.all(a).then(function(e){var r=void 0;e&&(e=e.filter(function(e){return e}),r=new s.b(e));var a=n.createBasicGroup(r);return i(t,a),a})}(e.ogcServers,t):void 0},this);return r.all(t)}.bind(this);return this.bgLayerPromise_=this.promise_.then(c).then(function(r){var a=[];return e.addBlankBackgroundLayer_&&(t.getString("blank"),a.push(new u.a({label:"blank",metadata:{thumbnail:""}}))),r.forEach(function(e){e&&a.push(e)}),a}),this.bgLayerPromise_},c.prototype.getThemeObject=function(e){return this.promise_.then(function(t){return c.findThemeByName(t.themes,e)})},c.prototype.getThemesObject=function(){return this.promise_.then(function(e){return e.themes})},c.prototype.getBackgroundLayersObject=function(){return a.a.assert(null!==this.promise_),this.promise_.then(function(e){return e.background_layers})},c.prototype.getOgcServersObject=function(){return a.a.assert(null!==this.promise_),this.promise_.then(function(e){return e.ogcServers})},c.prototype.hasEditableLayers=function(){return a.a.assert(null!==this.promise_),this.promise_.then(this.hasEditableLayers_.bind(this))},c.prototype.hasEditableLayers_=function(e){var t=this;return e.themes.some(function(e){return e.children.some(t.hasNodeEditableLayers_.bind(t))})},c.prototype.hasNodeEditableLayers_=function(e){if(e.editable)return!0;var t=!1,r=e.children;return r&&r.length&&(t=r.some(this.hasNodeEditableLayers_.bind(this))),t},c.getSnappingConfig=function(e){return e.metadata&&void 0!==e.metadata.snappingConfig?e.metadata.snappingConfig:null},c.getNodeMaxResolution=function(e){var t=e.metadata,r=e.maxResolutionHint;return void 0===r&&void 0!==t&&(r=t.maxResolution),r},c.getNodeMinResolution=function(e){var t=e.metadata,r=e.minResolutionHint;return void 0===r&&void 0!==t&&(r=t.minResolution),r},c.prototype.loadThemes=function(e){var t=this;a.a.assert(this.treeUrl_,"gmfTreeUrl should be defined."),this.loaded&&(this.deferred_=this.$q_.defer(),this.promise_=this.deferred_.promise,this.bgLayerPromise_=null,this.loaded=!1),this.$http_.get(this.treeUrl_,{params:void 0!==e?{role:e,cache_version:this.cacheVersion_}:{cache_version:this.cacheVersion_},cache:!1,withCredentials:!0}).then(function(e){if(0!=e.data.errors.length){var r="The themes contain some errors:\n"+e.data.errors.join("\n");console.error(r),null!==t.ngeoLocation_&&t.ngeoLocation_.hasParam("debug")&&window.alert(r)}t.deferred_.resolve(e.data),t.dispatchEvent("change"),t.loaded=!0},function(e){t.deferred_.reject(e)})},c.NodeType={MIXED_GROUP:"MixedGroup",NOT_MIXED_GROUP:"NotMixedGroup",WMTS:"WMTS",WMS:"WMS"},(c.module=angular.module("gmfThemes",[n.a.module.name])).value("gmfThemesOptions",{}),c.module.service("gmfThemes",c),t.a=c},function(e,t,r){"use strict";var a=r(1),n=r(2),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active_=!0===t.active,this.expression=void 0!==t.expression?t.expression:null,this.lowerBoundary_=void 0!==t.lowerBoundary?t.lowerBoundary:null,this.operator_=t.operator||null,this.upperBoundary_=void 0!==t.upperBoundary?t.upperBoundary:null,this.isCustom_=!1!==t.isCustom,this.name_=t.name,this.operators_=t.operators||null,this.propertyName_=t.propertyName,this.type_=a.a.assert(t.type),this.listenerKeys=[]}return e.prototype.getExpression=function(){return this.expression},e.prototype.setExpression=function(e){this.expression=e},e.prototype.reset=function(){null!==this.getExpression()&&this.setExpression(null),null!==this.lowerBoundary&&(this.lowerBoundary=null),null!==this.upperBoundary&&(this.upperBoundary=null)},e.prototype.destroy=function(){this.listenerKeys.forEach(n.e),this.listenerKeys.length=0},o(e,[{key:"active",get:function(){return this.active_},set:function(e){this.active_=e}},{key:"lowerBoundary",get:function(){return this.lowerBoundary_},set:function(e){this.lowerBoundary_=e}},{key:"operator",get:function(){return this.operator_},set:function(e){this.operator_=e}},{key:"upperBoundary",get:function(){return this.upperBoundary_},set:function(e){this.upperBoundary_=e}},{key:"isCustom",get:function(){return this.isCustom_}},{key:"name",get:function(){return this.name_}},{key:"operators",get:function(){return this.operators_}},{key:"propertyName",get:function(){return this.propertyName_}},{key:"type",get:function(){return this.type_}},{key:"value",get:function(){var t=null,r=this.getExpression(),a=this.lowerBoundary,n=this.operator,o=this.propertyName,i=this.upperBoundary;return n&&(n===e.OperatorType.BETWEEN||n===e.TemporalOperatorType.DURING?null!==a&&null!==i&&(t={operator:n,lowerBoundary:a,propertyName:o,upperBoundary:i}):null!==r&&(t={expression:r,operator:n,propertyName:o})),t}}]),e}();i.OperatorType={BETWEEN:"..",EQUAL_TO:"=",GREATER_THAN:">",GREATER_THAN_OR_EQUAL_TO:">=",LESSER_THAN:"<",LESSER_THAN_OR_EQUAL_TO:"<=",LIKE:"~",NOT_EQUAL_TO:"!="},i.SpatialOperatorType={CONTAINS:"contains",INTERSECTS:"intersects",WITHIN:"within"},i.TemporalOperatorType={BEGINS:"time_start",DURING:"time_during",ENDS:"time_end",EQUALS:"time_equal"},t.a=i},,,,function(e,t,r){"use strict";var a=r(1),n=r(150),o=r(125),i=r(26),s=r(276),l=r(170),u=r(213),c=r(445),h=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var p=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));n.dimensionsConfig_=r.dimensionsConfig||null,n.dimensionsFiltersConfig_=r.dimensionsFiltersConfig||null,n.filterCondition_=r.filterCondition||o.a.AND,n.filterRules_=r.filterRules||null,n.filtrable_=r.filtrable||null,n.copyable_=!0===r.copyable,n.dimensions_=r.dimensions||null,n.geometryName_=r.geometryName||t.DEFAULT_GEOMETRY_NAME_,n.ogcImageType_=r.ogcImageType||"image/png",n.ogcLayers_=r.ogcLayers||null,n.ogcServerType_=r.ogcServerType||t.ServerType.MAPSERVER,n.ogcType_=r.ogcType||t.Type.WMS,n.snappable_=!0===r.snappable,n.snappingToEdges_=!1!==r.snappingToEdges,n.snappingToVertice_=!1!==r.snappingToVertice,n.snappingTolerance_=void 0!==r.snappingTolerance?r.snappingTolerance:10,n.timeAttributeName_=r.timeAttributeName,n.timeLowerValue_=r.timeLowerValue,n.timeProperty_=void 0!==r.timeProperty?r.timeProperty:null,n.timeUpperValue_=r.timeUpperValue,n.wfsFeatureNS_=r.wfsFeatureNS||t.WFSFeatureNS[n.ogcServerType_],n.wfsFeaturePrefix_=r.wfsFeaturePrefix||t.WFSFeaturePrefix.FEATURE,n.wfsOutputFormat_=r.wfsOutputFormat||t.WFSOutputFormat.GML3,n.wfsUrl_=r.wfsUrl,n.wmsInfoFormat_=r.wmsInfoFormat||t.WMSInfoFormat.GML,n.wmsIsSingleTile_=!0===r.wmsIsSingleTile,n.wmsUrl_=r.wmsUrl,n.wmtsLayer_=r.wmtsLayer,n.wmtsUrl_=r.wmtsUrl;var i=[];if(n.queryable&&n.ogcLayers){var h=n.ogcLayers,p=Array.isArray(h),g=0;for(h=p?h:h[Symbol.iterator]();;){var d;if(p){if(g>=h.length)break;d=h[g++]}else{if((g=h.next()).done)break;d=g.value}var f=d;f.queryable&&i.push(f.name)}}var m=null;if(n.supportsWFS&&i.length){var y=void 0;n.wfsOutputFormat_===t.WFSOutputFormat.GML3?y=new l.a:n.wfsOutputFormat_===t.WFSOutputFormat.GML2&&(y=new s.a),a.a.assert(y),m=new u.a({featureNS:n.wfsFeatureNS,featureType:i,gmlFormat:y})}n.wfsFormat_=m;var v=null;return n.supportsWMS&&i.length&&n.wmsInfoFormat===t.WMSInfoFormat.GML&&(v=new c.a({layers:i})),n.wmsFormat_=v,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getAttributes=function(){return e.prototype.attributes},t.prototype.setAttributes=function(t){e.prototype.setAttributes.call(this,t),this.updateGeometryNameFromAttributes_()},t.prototype.combinableWithDataSourceForWFS=function(e){return this.combinableForWFS&&e.combinableForWFS&&this.supportsWFS&&e.supportsWFS&&this.queryable&&e.queryable&&this.wfsUrl===e.wfsUrl&&this.haveTheSameActiveDimensions(e)},t.prototype.combinableWithDataSourceForWMS=function(e){return this.combinableForWMS&&e.combinableForWMS&&this.supportsWMS&&e.supportsWMS&&this.queryable&&e.queryable&&this.wmsUrl===e.wmsUrl&&this.haveTheSameActiveDimensions(e)},t.prototype.isAnyOGCLayerInRange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!this.getInRangeOGCLayerNames(e,t).length},t.prototype.getInRangeOGCLayerNames=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[];if(this.ogcLayers){var a=this.ogcLayers,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i,l=s.maxResolution,u=s.minResolution;!((void 0===u||e>=u)&&(void 0===l||e<=l))||t&&!s.queryable||r.push(s.name)}}return r},t.prototype.getOGCLayerNames=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];if(this.ogcLayers){var r=this.ogcLayers,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;e&&!i.queryable||t.push(i.name)}}return t},t.prototype.getFiltrableOGCLayerName=function(){a.a.assert(this.filtrable);var e=this.getOGCLayerNames();return a.a.assert(1===e.length),e[0]},t.prototype.updateGeometryNameFromAttributes_=function(){var e=t.DEFAULT_GEOMETRY_NAME_;if(this.attributes){var r=this.attributes,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var s=o;if(s.type===i.a.GEOMETRY){e=s.name;break}}}this.geometryName_=e},t.prototype.haveTheSameActiveDimensions=function(e){var t=!0,r=this.activeDimensions,a=e.activeDimensions;for(var n in r)if(r[n]!==a[n]){t=!1;break}if(t)for(var o in a)if(a[o]!==r[o]){t=!1;break}return t},h(t,[{key:"dimensions",get:function(){return this.dimensions_}},{key:"dimensionsConfig",get:function(){return this.dimensionsConfig_},set:function(e){this.dimensionsConfig_=e}},{key:"dimensionsFiltersConfig",get:function(){return this.dimensionsFiltersConfig_},set:function(e){this.dimensionsFiltersConfig_=e}},{key:"filterCondition",get:function(){return this.filterCondition_},set:function(e){this.filterCondition_=e}},{key:"filterRules",get:function(){return this.filterRules_},set:function(e){this.filterRules_=e}},{key:"timeLowerValue",get:function(){return this.timeLowerValue_},set:function(e){this.timeLowerValue_=e}},{key:"timeRangeValue",get:function(){var e=null,t=this.timeLowerValue,r=this.timeUpperValue;return void 0!==t&&(e={end:r,start:t}),e},set:function(e){e?(this.timeUpperValue=e.end,this.timeLowerValue=e.start):(this.timeUpperValue=void 0,this.timeLowerValue=void 0)}},{key:"timeUpperValue",get:function(){return this.timeUpperValue_},set:function(e){this.timeUpperValue_=e}},{key:"copyable",get:function(){return this.copyable_}},{key:"filtrable",get:function(){return this.filtrable_},set:function(e){this.filtrable_=e}},{key:"geometryName",get:function(){return this.geometryName_}},{key:"ogcImageType",get:function(){return this.ogcImageType_}},{key:"ogcLayers",get:function(){return this.ogcLayers_}},{key:"ogcServerType",get:function(){return this.ogcServerType_}},{key:"ogcType",get:function(){return this.ogcType_}},{key:"snappable",get:function(){return this.snappable_}},{key:"snappingToEdges",get:function(){return this.snappingToEdges_}},{key:"snappingToVertice",get:function(){return this.snappingToVertice_}},{key:"snappingTolerance",get:function(){return this.snappingTolerance_}},{key:"timeAttributeName",get:function(){return this.timeAttributeName_}},{key:"timeProperty",get:function(){return this.timeProperty_}},{key:"wfsFeatureNS",get:function(){return this.wfsFeatureNS_}},{key:"wfsFeaturePrefix",get:function(){return this.wfsFeaturePrefix_}},{key:"wfsOutputFormat",get:function(){return this.wfsOutputFormat_}},{key:"wfsUrl",get:function(){return this.wfsUrl_}},{key:"wmsInfoFormat",get:function(){return this.wmsInfoFormat_}},{key:"wmsIsSingleTile",get:function(){return this.wmsIsSingleTile_}},{key:"wmsUrl",get:function(){return this.wmsUrl_}},{key:"wmtsLayer",get:function(){return this.wmtsLayer_}},{key:"wmtsUrl",get:function(){return this.wmtsUrl_}},{key:"activeDimensions",get:function(){var e={},t=this.dimensions_||{},r=this.dimensionsConfig||{};for(var a in r)null===r[a]?void 0!==t[a]&&null!==t[a]&&(e[a]=t[a]):e[a]=r[a];return e}},{key:"combinableForWFS",get:function(){return null===this.filterRules_&&null===this.timeRangeValue}},{key:"combinableForWMS",get:function(){return null===this.filterRules_&&null===this.timeRangeValue}},{key:"queryable",get:function(){var e=!1;if((this.supportsWMS||this.supportsWFS)&&this.ogcLayers){var t=this.ogcLayers,r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}if(!0===n.queryable){e=!0;break}}}return e}},{key:"supportsWFS",get:function(){return void 0!==this.wfsUrl}},{key:"supportsAttributes",get:function(){return null!==this.attributes||this.supportsWFS&&null!==this.ogcLayers&&1===this.ogcLayers.length&&!0===this.ogcLayers[0].queryable}},{key:"supportsWMS",get:function(){return void 0!==this.wmsUrl}},{key:"supportsWMTS",get:function(){return void 0!==this.wmtsUrl}},{key:"wfsFormat",get:function(){return this.wfsFormat_}},{key:"wmsFormat",get:function(){return this.wmsFormat_}}]),t}(n.a);p.guessServiceTypeByUrl=function(e){return/(wmts)/i.test(e)?p.Type.WMTS:p.Type.WMS},p.DEFAULT_GEOMETRY_NAME_="the_geom",p.ServerType={GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGISSERVER:"qgisserver"},p.Type={WMS:"WMS",WMTS:"WMTS"},p.WFSFeatureNS={geoserver:"http://www.opengis.net/gml/3.2",mapserver:"http://mapserver.gis.umn.edu/mapserver",qgisserver:"http://www.qgis.org/gml"},p.WFSFeaturePrefix={FEATURE:"feature"},p.WFSOutputFormat={GML2:"GML2",GML3:"GML3"},p.WMSInfoFormat={GML:"application/vnd.ogc.gml"},t.a=p},,,function(e,t,r){"use strict";var a={DATALAYERGROUP_NAME:"data",EXTERNALLAYERGROUP_NAME:"external",COORDINATES_LAYER_NAME:"gmfCoordinatesLayerName",PermalinkParam:{BG_LAYER:"baselayer_ref",EXTERNAL_DATASOURCES_NAMES:"eds_n",EXTERNAL_DATASOURCES_URLS:"eds_u",FEATURES:"rl_features",MAP_CROSSHAIR:"map_crosshair",MAP_TOOLTIP:"map_tooltip",MAP_X:"map_x",MAP_Y:"map_y",MAP_Z:"map_zoom",TREE_GROUPS:"tree_groups",WFS_LAYER:"wfs_layer",WFS_NGROUPS:"wfs_ngroups",WFS_SHOW_FEATURES:"wfs_showFeatures"}};t.a=a},,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(108),o=r(203),i=r(17),s=r(15),l=r(92),u=r(178),c=r(8),h=r(96),p=r(5),g=r(37),d=r(50),f=r(124),m=r(143),y=r(45),v=r(47),_=r(141),S=r(348),b=r(350),C=r(115),w=r(53),T=r(188),E=r(58),A=r(18),L=r(127),P=function(e,t){if(this.$filter_=t,this.decimals_=void 0,e.has("ngeoMeasureDecimals")&&(this.decimals_=e.get("ngeoMeasureDecimals")),this.precision_=void 0,e.has("ngeoMeasurePrecision")&&(this.precision_=e.get("ngeoMeasurePrecision")),this.numberFormat_=t("number"),this.unitPrefixFormat_=t("ngeoUnitPrefix"),this.ngeoNumberCoordinates_=t("ngeoNumberCoordinates"),this.pointFilterFn_=null,this.pointFilterArgs_=[],e.has("ngeoPointfilter")){var r=e.get("ngeoPointfilter").split(":"),n=r.shift(),o=this.$filter_(n);a.a.assertFunction(o),this.pointFilterFn_=o,this.pointFilterArgs_=r}else this.pointFilterFn_=null;this.projection_,this.download_=e.get("ngeoDownload")};P.$inject=["$injector","$filter"],P.$inject=["$injector","$filter"],P.prototype.setProjection=function(e){this.projection_=e},P.prototype.setStyle=function(e,t){var r=this.getStyle(e);t&&(this.supportsVertex_(e)&&r.push(this.getVertexStyle()),r.unshift(this.getHaloStyle_(e))),e.setStyle(r)},P.prototype.getStyle=function(e){var t=void 0;switch(this.getType(e)){case s.a.LINE_STRING:t=this.getLineStringStyle_(e);break;case s.a.POINT:t=this.getPointStyle_(e);break;case s.a.CIRCLE:case s.a.POLYGON:case s.a.RECTANGLE:t=this.getPolygonStyle_(e);break;case s.a.TEXT:t=this.getTextStyle_(e)}a.a.assert(t,"Style should be thruthy");return t.constructor===Array?t:[t]},P.prototype.getLineStringStyle_=function(e){var t=this.getStrokeProperty(e),r=this.getShowLabelProperty(e),a=this.getShowMeasureProperty(e),n=this.getRGBAColorProperty(e),o=[new A.c({stroke:new E.a({color:n,width:t})})],i=[];if(a&&i.push(this.getMeasure(e)),r&&i.push(this.getNameProperty(e)),r||a){var s=i.join("\n");o.push(new A.c({text:this.createTextStyle_({text:s})}))}return o},P.prototype.getPointStyle_=function(e){var t=this.getSizeProperty(e),r=this.getRGBAColorProperty(e),a=this.getShowLabelProperty(e),n=this.getShowMeasureProperty(e),o=[new A.c({image:new C.a({radius:t,fill:new w.a({color:r})})})],i=[];if(n&&i.push(this.getMeasure(e)),a&&i.push(this.getNameProperty(e)),a||n){var s=i.join("\n");o.push(new A.c({text:this.createTextStyle_({text:s,size:10,offsetY:-(t+5*i.length*1.3+4)})}))}return o},P.prototype.optNumber=function(e,t){var r=e.get(t);return void 0!==r?"string"==typeof r?+r:a.a.assertNumber(r):void 0},P.prototype.getNumber=function(e,t){var r=e.get(t);return"string"==typeof r?+r:a.a.assertNumber(r)},P.prototype.getPolygonStyle_=function(e){var t=this.getStrokeProperty(e),r=this.getOpacityProperty(e),a=this.getRGBAColorProperty(e),n=this.getShowLabelProperty(e),o=this.getShowMeasureProperty(e),s=a.slice();s[3]=r;var u=this.optNumber(e,i.a.AZIMUT),c=[new A.c({fill:new w.a({color:s}),stroke:new E.a({color:a,width:t})})];if(o||n)if(o&&void 0!==u){var h=this.getRadiusLine(e,u),p=l.a.getFormattedLength(h,this.projection_,this.precision_,this.unitPrefixFormat_);c.push(new A.c({geometry:h,fill:new w.a({color:s}),stroke:new E.a({color:a,width:t}),text:this.createTextStyle_({text:p,angle:(u%180+180)%180-90})})),c.push(new A.c({geometry:new y.a(h.getLastCoordinate()),text:this.createTextStyle_({text:this.numberFormat_(u,this.decimals_)+"°",size:10,offsetX:20*Math.cos((u-90)*Math.PI/180),offsetY:20*Math.sin((u-90)*Math.PI/180)})})),n&&c.push(new A.c({text:this.createTextStyle_({text:this.getNameProperty(e),offsetY:-8,exceedLength:!0})}))}else{var g=[];if(o&&g.push(this.getMeasure(e)),n&&g.push(this.getNameProperty(e)),n||o){var d=g.join("\n");c.push(new A.c({text:this.createTextStyle_({text:d,exceedLength:!0})}))}}return c},P.prototype.getTextStyle_=function(e){return new A.c({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),color:this.getRGBAColorProperty(e),width:this.getStrokeProperty(e)})})},P.prototype.createEditingStyles=function(e){var t=[255,255,255,1],r=[0,153,255,1],a=[],n=e.getGeometry();console.assert(n);var o=n.getType();return"Point"===o?a.push(new A.c({image:new C.a({radius:6,fill:new w.a({color:r}),stroke:new E.a({color:t,width:1.5})}),zIndex:1/0})):("LineString"===o?(a.push(new A.c({stroke:new E.a({color:t,width:5})})),a.push(new A.c({stroke:new E.a({color:r,width:3})}))):a.push(new A.c({stroke:new E.a({color:r,width:1.5}),fill:new w.a({color:[255,255,255,.5]})})),a.push(this.getVertexStyle(!0))),a},P.prototype.getVertexStyle=function(e){var t=void 0===e||e,r={image:new T.a({radius:6,points:4,angle:Math.PI/4,fill:new w.a({color:[255,255,255,.5]}),stroke:new E.a({color:[0,0,0,1]})})};return t&&(r.geometry=function(e){var t=e.getGeometry();if("Point"!=t.getType()){var r=void 0,a=[],n=[],o=void 0,i=void 0;if(t instanceof d.a?n=t.getCoordinates():t instanceof f.a?a=t.getCoordinates():t instanceof v.a?n=t.getCoordinates()[0]:t instanceof _.a&&(r=t.getCoordinates()),r)for(o=0,i=r.length;o<i;o++)a=a.concat(r[o]);for(o=0,i=a.length;o<i;o++)n=n.concat(a[o]);return n.length?new m.a(n):t}}),new A.c(r)},P.prototype.supportsVertex_=function(e){var t=[s.a.LINE_STRING,s.a.POLYGON,s.a.RECTANGLE],r=this.getType(e);return c.f(t,r)},P.prototype.getHaloStyle_=function(e){var t=void 0;switch(this.getType(e)){case s.a.POINT:var r=this.getSizeProperty(e);t=new A.c({image:new C.a({radius:r+3,fill:new w.a({color:[255,255,255,1]})})});break;case s.a.LINE_STRING:case s.a.CIRCLE:case s.a.POLYGON:case s.a.RECTANGLE:var n=this.getStrokeProperty(e);t=new A.c({stroke:new E.a({color:[255,255,255,1],width:n+6})});break;case s.a.TEXT:t=new A.c({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),width:9})})}return a.a.assert(t,"Style should be thruthy"),t},P.getFilteredFeatureValues=function(e){var t=e.getProperties();return delete t.boundedBy,delete t[e.getGeometryName()],delete t.ngeo_feature_type_,t},P.prototype.getAngleProperty=function(e){var t=+e.get(i.a.ANGLE);return a.a.assertNumber(t),t},P.prototype.getColorProperty=function(e){var t=a.a.assertString(e.get(i.a.COLOR));return a.a.assertString(t),t},P.prototype.getRGBAColorProperty=function(e){return h.c(this.getColorProperty(e))},P.prototype.getNameProperty=function(e){var t=a.a.assertString(e.get(i.a.NAME));return a.a.assertString(t),t},P.prototype.getOpacityProperty=function(e){return this.getNumber(e,i.a.OPACITY)},P.prototype.getShowMeasureProperty=function(e){var t=e.get(i.a.SHOW_MEASURE);return void 0===t?t=!1:"string"==typeof t&&(t="true"===t),a.a.assertBoolean(t)},P.prototype.getShowLabelProperty=function(e){var t=e.get(i.a.SHOW_LABEL);return void 0===t?t=!1:"string"==typeof t&&(t="true"===t),a.a.assertBoolean(t)},P.prototype.getSizeProperty=function(e){return this.getNumber(e,i.a.SIZE)},P.prototype.getStrokeProperty=function(e){return this.getNumber(e,i.a.STROKE)},P.prototype.export=function(e,t){switch(t){case P.FormatType.GPX:this.exportGPX(e);break;case P.FormatType.KML:this.exportKML(e)}},P.prototype.exportGPX=function(e){var t=new S.a;this.export_(e,t,"export.gpx","application/gpx+xml")},P.prototype.exportKML=function(e){var t=new b.a;this.export_(e,t,"export.kml","application/vnd.google-earth.kml+xml")},P.prototype.export_=function(e,t,r,a){var n=this,o=void 0!==a?a:"text/plain",i=[],s=void 0;e.forEach(function(e){s=new g.a(e.getProperties()),n.setStyle(s,!1),i.push(s)});var l=this.projection_?{dataProjection:"EPSG:4326",featureProjection:this.projection_}:{},u=t.writeFeatures(i,l);this.download_(u,r,o+";charset=utf-8")},P.prototype.createTextStyle_=function(e){if(e.angle){var t=(void 0!==e.angle?e.angle:0)*Math.PI/180;e.rotation=t,delete e.angle}return e.font=["normal",(e.size||10)+"pt","Arial"].join(" "),e.color&&(e.fill=new w.a({color:e.color||[0,0,0,1]}),delete e.color),e.stroke=new E.a({color:[255,255,255,1],width:e.width||3}),delete e.width,new L.a(e)},P.prototype.getMeasure=function(e){var t=e.getGeometry();a.a.assert(t,"Geometry should be truthy");var r="";if(t instanceof v.a)if(this.getType(e)===s.a.CIRCLE){var n=this.optNumber(e,i.a.AZIMUT);a.a.assertNumber(n);var o=this.getRadiusLine(e,n);r=u.a.getFormattedAzimutRadius(o,this.projection_,this.decimals_,this.precision_,this.unitPrefixFormat_,this.numberFormat_)}else r=l.a.getFormattedArea(t,this.projection_,this.precision_,this.unitPrefixFormat_);else if(t instanceof d.a)r=l.a.getFormattedLength(t,this.projection_,this.precision_,this.unitPrefixFormat_);else if(t instanceof y.a)if(null===this.pointFilterFn_)r=l.a.getFormattedPoint(t,this.decimals_,this.ngeoNumberCoordinates_);else{var c=t.getCoordinates(),h=this.pointFilterArgs_.slice(0);h.unshift(c),r=this.pointFilterFn_.apply(this,h)}return r},P.prototype.getType=function(e){var t=e.getGeometry();a.a.assert(t,"Geometry should be thruthy");var r=void 0;return t instanceof y.a?r=e.get(i.a.IS_TEXT)?s.a.TEXT:s.a.POINT:t instanceof m.a?r=s.a.MULTI_POINT:t instanceof v.a?r=e.get(i.a.IS_CIRCLE)?s.a.CIRCLE:e.get(i.a.IS_RECTANGLE)?s.a.RECTANGLE:s.a.POLYGON:t instanceof _.a?r=s.a.MULTI_POLYGON:t instanceof d.a?r=s.a.LINE_STRING:t instanceof f.a&&(r=s.a.MULTI_LINE_STRING),a.a.assert(r,"Type should be thruthy"),r},P.prototype.panMapToFeature=function(e,t,r){var n=void 0!==r?r:250,o=t.getSize();a.a.assertArray(o);var i=t.getView(),s=i.calculateExtent(o),l=e.getGeometry();if(!l.intersectsExtent(s)){var u=i.getCenter();a.a.assertArray(u);var c=void 0;c=l instanceof d.a?l.getCoordinateAt(.5):l instanceof v.a?l.getInteriorPoint().getCoordinates():l instanceof y.a?l.getCoordinates():p.x(l.getExtent()),i.animate({center:u,duration:n},{center:c,duration:n})}},P.prototype.getRadiusLine=function(e,t){var r=e.getGeometry(),a=r.getExtent(),n=(a[3]-a[1])/2,o=p.x(r.getExtent()),i=Math.cos((t-90)*Math.PI/180)*n,s=-Math.sin((t-90)*Math.PI/180)*n,l=[i+o[0],s+o[1]];return new d.a([o,l])},P.prototype.getNonSpatialProperties=function(e){var t=e.getGeometryName(),r={},a=e.getProperties();for(var n in a)n!==t&&(r[n]=a[n]);return r},P.prototype.clearNonSpatialProperties=function(e){var t=e.getGeometryName(),r=e.getProperties();for(var a in r)a!==t&&e.set(a,void 0)},P.FormatType={GPX:"GPX",KML:"KML"},(P.module=angular.module("ngeoFeatureHelper",[o.a.name,n.a.name])).service("ngeoFeatureHelper",P),t.a=P},,,,function(e,t,r){"use strict";t.a=function(e,t){this.getActive=function(){return e[t]},this.setActive=function(r){e[t]=r}}},,function(e,t,r){"use strict";var a=r(44),n=r(50),o=r(143),i=r(124),s=r(141),l=r(45),u=r(47),c={toMulti:function(e){var t=void 0;return e instanceof l.a?(t=new o.a([])).appendPoint(e):e instanceof n.a?(t=new i.a([])).appendLineString(e):e instanceof u.a?(t=new s.a([])).appendPolygon(e):t=e,t},isSafari:function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")},colorZeroPadding:function(e){return 1==e.length?"0"+e:e},rgbArrayToHex:function(e){var t=e[0],r=e[1],a=e[2];if(t!=(255&t)||r!=(255&r)||a!=(255&a))throw Error('"('+t+","+r+","+a+')" is not a valid RGB color');return"#"+c.colorZeroPadding(t.toString(16))+c.colorZeroPadding(r.toString(16))+c.colorZeroPadding(a.toString(16))},decodeQueryString:function(e){var t={};if(e){var r=e.substring(1).split("&"),a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o,s=i.indexOf("=");if(s>=0){var l=i.substring(0,s),u=i.substring(s+1);t[decodeURIComponent(l)]=decodeURIComponent(u)}else t[i]=""}}return t},encodeQueryString:function(e){var t=[];for(var r in e){var a=e[r];t.push(encodeURIComponent(r)+"="+encodeURIComponent(a))}return t.join("&")},deleteCondition:function(e){return a.f(e)&&a.j(e)}};t.a=c},,,function(e,t,r){"use strict";var a=function(){};a.prototype.showMessage=function(e){},a.prototype.show=function(e){this.getMessageObjects(e).forEach(this.showMessage,this)},a.prototype.error=function(e){this.show(this.getMessageObjects(e,a.Type.ERROR))},a.prototype.info=function(e){this.show(this.getMessageObjects(e,a.Type.INFORMATION))},a.prototype.success=function(e){this.show(this.getMessageObjects(e,a.Type.SUCCESS))},a.prototype.warn=function(e){this.show(this.getMessageObjects(e,a.Type.WARNING))},a.prototype.getMessageObjects=function(e,t){var r=[],n=null,o=a.Type.INFORMATION;return"string"==typeof e?r.push({msg:e,type:void 0!==t?t:o}):Array.isArray(e)?e.forEach(function(a){"string"==typeof e?n={msg:a,type:void 0!==t?t:o}:(n=a,void 0!==t&&(n.type=t)),r.push(n)},this):(n=e,void 0!==t&&(n.type=t),void 0===n.type&&(n.type=o),r.push(n)),r},a.Type={ERROR:"error",INFORMATION:"information",SUCCESS:"success",WARNING:"warning"},t.a=a},,,function(e,t,r){"use strict";var a=r(3),n=r(46),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.a.call(this,e),this.detail=t};a.d(o,n.a),t.a=o},,,,,,function(e,t,r){"use strict";var a=r(1),n=r(26),o=r(34),i=r(2),s=r(37),l=r(167),u=r(97),c=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var h=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.type=n.a.GEOMETRY;var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r)),o=r.featureProperties||{};return a.feature_=new s.a(o),a.format_=new l.a,a.updatingExpression_=!1,a.updatingGeometry_=!1,a.geometryChangeListenerKey_=null,a.listenerKeys.push(i.a(a.feature_,"change:"+a.feature.getGeometryName(),a.handleFeatureGeometryChange_,a)),a.setGeometryFromExpression_(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.setExpression=function(t){this.updatingExpression_=!0,e.prototype.setExpression.call(this,t),this.updatingGeometry_||this.setGeometryFromExpression_(),this.registerGeometryChange_(),this.updatingExpression_=!1},t.prototype.handleFeatureGeometryChange_=function(){if(!this.updatingExpression_){this.updatingGeometry_=!0;var e=this.feature_.getGeometry();this.expression=e?this.format_.writeGeometry(e):null,this.registerGeometryChange_(),this.updatingGeometry_=!1}},t.prototype.handleGeometryChange_=function(e){var t=a.a.assertInstanceof(e.target,u.a);this.updatingGeometry_=!0,this.expression=this.format_.writeGeometry(t),this.updatingGeometry_=!1},t.prototype.setGeometryFromExpression_=function(){var e=null;if(this.expression){var t=a.a.assertString(this.expression);e=this.format_.readGeometry(t)}this.geometry=e},t.prototype.registerGeometryChange_=function(){null!==this.geometryChangeListenerKey_&&(i.e(this.geometryChangeListenerKey_),this.geometryChangeListenerKey_=null);var e=this.feature_.getGeometry();e&&(this.geometryChangeListenerKey_=i.a(e,"change",this.handleGeometryChange_,this))},c(t,[{key:"feature",get:function(){return this.feature_}},{key:"geometry",get:function(){return this.feature_.getGeometry()||null},set:function(e){this.feature_.setGeometry(e)}}]),t}(o.a);t.a=h},,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(180),o=r(3),i=r(102),s=r(10),l=r(93),u=r(18),c=function(){this.featureUidToGroupIndex_={},this.groups_=[],this.source_=new l.b({useSpatialIndex:!1}),this.layer_=new i.a({source:this.source_,style:this.styleFunction_.bind(this),updateWhileAnimating:!0,updateWhileInteracting:!0})};c.prototype.addFeature=function(e,t){a.a.assert(t>=0),a.a.assert(t<this.groups_.length);var r=o.c(e).toString();this.featureUidToGroupIndex_[r]=t,this.groups_[t].features[r]=e,this.source_.addFeature(e)},c.prototype.removeFeature=function(e,t){a.a.assert(t>=0),a.a.assert(t<this.groups_.length);var r=o.c(e).toString();delete this.featureUidToGroupIndex_[r],delete this.groups_[t].features[r],this.source_.removeFeature(e)},c.prototype.clear=function(e){a.a.assert(e>=0),a.a.assert(e<this.groups_.length);var t=this.groups_[e];for(var r in t.features)this.removeFeature(t.features[r],e);a.a.assert(s.d(t.features))},c.prototype.getLayer=function(){return this.layer_},c.prototype.getFeatureOverlay=function(){var e=this.groups_.length;return this.groups_.push({styleFunction:u.a,features:{}}),new n.a(this,e)},c.prototype.init=function(e){this.layer_.setMap(e)},c.prototype.setStyle=function(e,t){a.a.assert(t>=0),a.a.assert(t<this.groups_.length),this.groups_[t].styleFunction=null===e?u.c.defaultFunction:Object(u.d)(e)},c.prototype.styleFunction_=function(e,t){var r=o.c(e).toString();a.a.assert(r in this.featureUidToGroupIndex_);var n=this.featureUidToGroupIndex_[r];return this.groups_[n].styleFunction(e,t)},(c.module=angular.module("ngeoFeatureOverlayMgr",[n.a.module.name])).service("ngeoFeatureOverlayMgr",c),t.a=c},function(e,t,r){"use strict";var a=r(1),n=r(8),o=r(344),i=r(103),s=r(131),l=r(122),u=r(10),c=r(154),h=r(215),p=r(168),g=r(148),d=function(e,t,r){this.$q_=e,this.$http_=t,this.tilesPreloadingLimit_=r};d.$inject=["$q","$http","ngeoTilesPreloadingLimit"],d.$inject=["$q","$http","ngeoTilesPreloadingLimit"],d.GROUP_KEY="groupName",d.REFRESH_PARAM="random",d.prototype.createBasicWMSLayer=function(e,t,r,a,n,o,i,l){var u={FORMAT:r,LAYERS:t},h=void 0;n&&(u.TIME=n),a&&(u.SERVERTYPE=a,h=a.replace("qgisserver","qgis"));var p=Object.assign({},l,{url:e,params:u,serverType:h,crossOrigin:i}),g=new c.a(p);return o&&g.updateParams(o),new s.a({source:g})},d.prototype.createBasicWMSLayerFromDataSource=function(e,t){var r=e.wmsUrl;a.a.assert(r);var n=e.getOGCLayerNames().join(","),o=e.ogcServerType,i=e.ogcImageType,s=this.createBasicWMSLayer(r,n,i,o,void 0,void 0,t);return s.setVisible(e.visible),s.set("querySourceIds",[e.id]),s},d.prototype.createWMTSLayerFromCapabilitites=function(e,t,r,a,i){var s=new o.a,c=new l.a({preload:this.tilesPreloadingLimit_}),h=this.$q_;return this.$http_.get(e,{cache:!0}).then(function(o){var l=void 0;if(o.data&&(l=s.read(o.data)),l){var g=Object.assign({},i,Object(p.b)(l,{matrixSet:r,crossOrigin:"anonymous",layer:t})),d=new p.a(g);a&&!u.d(a)&&d.updateDimensions(a),c.setSource(d);var f=l.Contents.Layer,m=n.d(f,function(e,r,a){return e.Identifier==t});return c.set("capabilitiesStyles",m.Style),h.resolve(c)}return h.reject("Failed to get WMTS capabilities from "+e)})},d.prototype.createWMTSLayerFromCapabilititesObj=function(e,t,r){var n=Object(p.b)(e,{crossOrigin:"anonymous",layer:t.Identifier});a.a.assert(n);var o=new p.a(n);return r&&!u.d(r)&&o.updateDimensions(r),new l.a({capabilitiesStyles:t.Style,preload:1/0,source:o})},d.prototype.createBasicGroup=function(e){var t=new i.a;return e&&t.setLayers(e),t},d.prototype.getGroupFromMap=function(e,t){var r=void 0;return e.getLayerGroup().getLayers().getArray().some(function(e){return e.get(d.GROUP_KEY)===t&&(r=e,!0)}),r||((r=this.createBasicGroup()).set(d.GROUP_KEY,t),e.addLayer(r)),r},d.prototype.getFlatLayers=function(e){if(e instanceof i.a){var t=e.getLayers().getArray();if(!t.some(function(e){return e instanceof i.a}))return t.slice()}return this.getFlatLayers_(e,[],void 0)},d.prototype.getFlatLayers_=function(e,t,r){var a=this,n=e.getOpacity();(void 0!==r?r*=n:r=n,e instanceof i.a)?e.getLayers().forEach(function(e){a.getFlatLayers_(e,t,r)}):t.indexOf(e)<0&&(e.set("inheritedOpacity",r,!0),t.push(e));return t},d.prototype.getLayerByName=function(e,t){var r=this,a=null;return t.some(function(t){if(t instanceof i.a){var n=t.getLayers().getArray();a=r.getLayerByName(e,n)}else t.get("layerNodeName")===e&&(a=t);return!!a}),a},d.prototype.getWMTSLegendURL=function(e){var t=void 0,r=e.get("capabilitiesStyles");if(void 0!==r){var a=r[0].legendURL;void 0!==a&&(t=a[0].href)}return t},d.prototype.getWMSLegendURL=function(e,t,r,a,n,o,i,s,l,u,c){if(e){var h={FORMAT:"image/png",TRANSPARENT:!0,SERVICE:"WMS",VERSION:"1.1.1",REQUEST:"GetLegendGraphic",LAYER:t};return void 0!==r&&(h.SCALE=r),void 0!==a&&(h.RULE=a,void 0!==n&&(h.WIDTH=n),void 0!==o&&(h.HEIGHT=o)),"qgis"==i&&(void 0!=s&&(h.DPI=s),void 0!=l&&void 0!=u&&void 0!=r&&void 0!=s&&void 0==a&&(h.BBOX=l.join(","),h.SRS=u,h.WIDTH=Math.round((l[2]-l[0])/r*39.37*s),h.HEIGHT=Math.round((l[3]-l[1])/r*39.37*s))),c&&Object.assign(h,c),g.a(e,h)}},d.prototype.isLayerVisible=function(e,t){if(!e.getVisible())return!1;var r=t.getView().getResolution();return r>e.getMinResolution()&&r<e.getMaxResolution()},d.prototype.refreshWMSLayer=function(e){var t=e.getSource();a.a.assert(t instanceof c.a||t instanceof h.a);var r=t,n=r.getParams();n[d.REFRESH_PARAM]=Math.random(),r.updateParams(n)},d.prototype.setZIndexToFirstLevelChildren=function(e,t){e instanceof i.a&&e.getLayers().forEach(function(e){return e.setZIndex(t)})},d.prototype.updateWMSLayerState=function(e,t,r){if(t.length<=0)e.setVisible(!1);else{e.setVisible(!0);var a=e.getSource();r?a.updateParams({LAYERS:t,TIME:r}):a.updateParams({LAYERS:t})}},d.prototype.getQuerySourceIds=function(e){return e.get("querySourceIds")},d.module=angular.module("ngeoLayerHelper",[]).service("ngeoLayerHelper",d).value("ngeoTilesPreloadingLimit",1/0),t.a=d},,function(e,t,r){"use strict";var a=r(1),n=r(112),o=r(3),i=r(2),s=r(103),l=r(98),u=function(e,t,r){var u=this,c=void 0===r.ngeoLayertreeNotroot;this.isRoot=c;var h=r.ngeoLayertree;this.rootScope_=t,this.properties={},this.state_="off",this.node,c?e.$watch(h,function(e,t){u.node=e}):(this.node=e.$eval(h),a.a.assert(void 0!==this.node));var p=r.ngeoLayertreeMap,g=e.$eval(p);a.a.assert(void 0!==g),this.parent=e.$parent.layertreeCtrl,this.children=[],this.parent&&this.parent.children.push(this),e.$on("$destroy",function(){if(u.parent){var e=u.parent.children.indexOf(u);a.a.assert(e>=0),u.parent.children.splice(e,1)}}),this.uid=o.c(this),this.depth=c?0:this.parent.depth+1,e.uid=this.uid,e.depth=this.depth,this.map=g;var d=r.ngeoLayertreeNodelayer;if(void 0===d){var f=r.ngeoLayertreeNodelayerexpr,m=e.$eval(f);a.a.assertString(m),d=m}if(a.a.assert(void 0!==d),this.nodelayerExpr=d,this.layer=null,!c){var y=e.$eval(d,{treeCtrl:this})||null;y&&(a.a.assert(y instanceof l.a||y instanceof s.a),this.layer=y)}this.dataSource_=null,this.layer&&(n.a.layerLoading(this.layer,e),n.a.layer(this.layer),i.a(this.layer,"change:opacity",function(){u.rootScope_.$broadcast("ngeo-layertree-opacity",u)}));var v=r.ngeoLayertreeListeners;if(void 0===v){var _=r.ngeoLayertreeListenersexpr;v=e.$eval(_)}void 0!==v&&a.a.assertString(v),this.listenersExpr=v,v&&e.$eval(v,{treeScope:e,treeCtrl:this}),e.layertreeCtrl=this};u.$inject=["$scope","$rootScope","$attrs"],u.$inject=["$scope","$rootScope","$attrs"],u.prototype.getState=function(){return this.state_},u.prototype.setState=function(e,t){var r=this;if(e!==this.state_){this.setStateInternal_(e),this.parent&&this.parent.refreshState();var a=this.isRoot?this.children:[u.getFirstParentTree(this)];(void 0===t||t)&&a.forEach(function(e){r.rootScope_.$broadcast("ngeo-layertree-state",r,e)})}},u.prototype.setStateInternal_=function(e){var t=this;this.state_="on"===e?"on":"off",this.children.forEach(function(e){e.setStateInternal_(t.state_)})},u.prototype.refreshState=function(){var e=this.getCalculateState();this.state_!==e&&(this.state_=e,this.parent&&this.parent.refreshState())},u.prototype.getCalculateState=function(){if(void 0===this.node.children)return this.state_;var e=void 0,t=void 0;return this.children.some(function(r){if(e=r.getCalculateState(),t&&t!==e)return e="indeterminate";t=e}),e},u.prototype.getSetActive=function(e){var t=this.layer,r=this.map;if(t)return void 0===e?r.getLayers().getArray().indexOf(t)>=0:void(e?r.addLayer(t):r.removeLayer(t))},u.prototype.getDataSource=function(){return this.dataSource_},u.prototype.setDataSource=function(e){this.dataSource_=e},u.getFirstParentTree=function(e){for(var t=e;!t.parent.isRoot;)t=t.parent;return t},u.VisitorDecision={STOP:"STOP",SKIP:"SKIP",DESCEND:"DESCEND"},u.prototype.traverseDepthFirst=function(e){switch(e(this)||u.VisitorDecision.DESCEND){case u.VisitorDecision.STOP:return!0;case u.VisitorDecision.SKIP:return!1;case u.VisitorDecision.DESCEND:for(var t=0;t<this.children.length;++t){if(this.children[t].traverseDepthFirst(e))return!0}return!1;default:a.a.fail("Unhandled case")}},(u.module=angular.module("ngeoLayertreeController",[])).controller("ngeoLayertreeController",u),t.a=u},,,,,function(e,t,r){"use strict";var a=r(1),n=r(68),o=r(3),i=r(55),s=r(12),l=r(126),u=r(239),c=r(2),h=r(42),p=r(102),g=r(93),d=r(53),f=r(58),m=r(18),y=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h.a.call(this,{handleEvent:e.handleEvent_}),this.helpTooltipElement_=null,this.helpTooltipOverlay_=null,this.measureTooltipElement_=null,this.measureTooltipOverlay_=null,this.measureTooltipOverlayCoord_=null,this.sketchFeature=null,this.continueMsg=null,this.decimals=t.decimals,this.precision=t.precision,this.displayHelpTooltip_=void 0===t.displayHelpTooltip||t.displayHelpTooltip,this.startMsg,void 0!==t.startMsg?this.startMsg=t.startMsg:(this.startMsg=document.createElement("span"),this.startMsg.textContent="Click to start drawing."),this.changeEventKey_=null,this.postcomposeEventKey_=null;var r=void 0!==t.style?t.style:[new m.c({fill:new d.a({color:"rgba(255, 255, 255, 0.2)"})}),new m.c({stroke:new f.a({color:"white",width:5})}),new m.c({stroke:new f.a({color:"#ffcc33",width:3})})];this.vectorLayer_=new p.a({source:new g.b,style:r}),this.drawInteraction_=this.createDrawInteraction(t.sketchStyle,this.vectorLayer_.getSource()),this.shouldHandleDrawInteractionActiveChange_=!0,c.a(this.drawInteraction_,"change:active",this.handleDrawInteractionActiveChange_,this),c.a(this.drawInteraction_,"drawstart",this.onDrawStart_,this),c.a(this.drawInteraction_,"drawend",this.onDrawEnd_,this),c.a(this,"change:active",this.updateState_,this)};o.d(y,h.a),y.getFormattedArea=function(e,t,r,a){var n=e.clone().transform(t,"EPSG:4326");return a(Math.abs(u.a(n,{projection:"EPSG:4326"})),"m²","square",r)},y.getFormattedCircleArea=function(e,t,r){return r(Math.PI*Math.pow(e.getRadius(),2),"m²","square",t)},y.getFormattedLength=function(e,t,r,a){for(var n=0,o=e.getCoordinates(),i=0,l=o.length-1;i<l;++i){var c=s.k(o[i],t,"EPSG:4326"),h=s.k(o[i+1],t,"EPSG:4326");n+=u.b(c,h)}return a(n,"m","unit",r)},y.getFormattedPoint=function(e,t,r,a){return r(e.getCoordinates(),t,a)},y.handleEvent_=function(e){if("pointermove"!=e.type||e.dragging)return!0;var t=null===this.sketchFeature?this.startMsg:this.continueMsg;return this.displayHelpTooltip_&&(i.d(this.helpTooltipElement_),this.helpTooltipElement_.appendChild(t),this.helpTooltipOverlay_.setPosition(e.coordinate)),!0},y.prototype.getDrawInteraction=function(){return this.drawInteraction_},y.prototype.createDrawInteraction=function(e,t){},y.prototype.setMap=function(e){h.a.prototype.setMap.call(this,e),this.vectorLayer_.setMap(e);var t=this.drawInteraction_.getMap();null!==t&&t.removeInteraction(this.drawInteraction_),null!==e&&e.addInteraction(this.drawInteraction_)},y.prototype.onDrawStart_=function(e){var t=this;this.sketchFeature=e.feature||e.detail.feature,this.vectorLayer_.getSource().clear(!0),this.createMeasureTooltip_();var r=this.sketchFeature.getGeometry();a.a.assert(void 0!==r),this.changeEventKey_=c.a(r,"change",function(){t.handleMeasure(function(e,r){null!==r&&(t.measureTooltipElement_.innerHTML=e,t.measureTooltipOverlayCoord_=r)})}),this.postcomposeEventKey_=c.a(this.getMap(),"postcompose",function(){t.measureTooltipOverlay_.setPosition(t.measureTooltipOverlayCoord_)})},y.prototype.onDrawEnd_=function(e){this.measureTooltipElement_.classList.add("ngeo-tooltip-static"),this.measureTooltipOverlay_.setOffset([0,-7]);var t=new n.a("measureend",{feature:this.sketchFeature});this.dispatchEvent(t),this.sketchFeature=null,this.unlistenerEvent_()},y.prototype.unlistenerEvent_=function(){null!==this.changeEventKey_&&null!==this.postcomposeEventKey_&&(c.e(this.changeEventKey_),c.e(this.postcomposeEventKey_),this.changeEventKey_=null,this.postcomposeEventKey_=null)},y.prototype.createHelpTooltip_=function(){this.removeHelpTooltip_(),this.displayHelpTooltip_&&(this.helpTooltipElement_=document.createElement("div"),this.helpTooltipElement_.classList.add("tooltip"),this.helpTooltipOverlay_=new l.a({element:this.helpTooltipElement_,offset:[15,0],positioning:"center-left"}),this.getMap().addOverlay(this.helpTooltipOverlay_))},y.prototype.removeHelpTooltip_=function(){this.displayHelpTooltip_&&(this.getMap().removeOverlay(this.helpTooltipOverlay_),null!==this.helpTooltipElement_&&this.helpTooltipElement_.parentNode.removeChild(this.helpTooltipElement_),this.helpTooltipElement_=null,this.helpTooltipOverlay_=null)},y.prototype.createMeasureTooltip_=function(){this.removeMeasureTooltip_(),this.measureTooltipElement_=document.createElement("div"),this.measureTooltipElement_.classList.add("tooltip"),this.measureTooltipElement_.classList.add("ngeo-tooltip-measure"),this.measureTooltipOverlay_=new l.a({element:this.measureTooltipElement_,offset:[0,-15],positioning:"bottom-center",stopEvent:!1}),this.getMap().addOverlay(this.measureTooltipOverlay_)},y.prototype.removeMeasureTooltip_=function(){null!==this.measureTooltipElement_&&(this.measureTooltipElement_.parentNode.removeChild(this.measureTooltipElement_),this.measureTooltipElement_=null,this.measureTooltipOverlay_=null,this.measureTooltipOverlayCoord_=null)},y.prototype.updateState_=function(){var e=this.getActive();this.shouldHandleDrawInteractionActiveChange_=!1,this.drawInteraction_.setActive(e),this.shouldHandleDrawInteractionActiveChange_=!0,this.getMap()&&(e?this.measureTooltipOverlay_||(this.createMeasureTooltip_(),this.createHelpTooltip_()):(this.vectorLayer_.getSource().clear(!0),this.getMap().removeOverlay(this.measureTooltipOverlay_),this.removeMeasureTooltip_(),this.removeHelpTooltip_(),this.unlistenerEvent_()))},y.prototype.handleMeasure=function(e){},y.prototype.getTooltipElement=function(){return this.measureTooltipElement_},y.prototype.handleDrawInteractionActiveChange_=function(){this.shouldHandleDrawInteractionActiveChange_&&this.setActive(this.drawInteraction_.getActive())},t.a=y},,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(195),o=r(137),i=r(194),s=r(10);var l=function(){function e(t,r,a,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{};this.dataSources_=r.collection,this.ngeoDataSourcesHelper_=a,this.ngeoQuerent_=n,this.result_=o,this.limit_=void 0!==i.limit?i.limit:50,this.queryCountFirst_=void 0!==i.queryCountFirst&&i.queryCountFirst,this.tolerancePx_=void 0!==i.tolerance?i.tolerance:3,this.dataSourceNames_={}}return e.$inject=["$injector","ngeoDataSources","ngeoDataSourcesHelper","ngeoQuerent","ngeoQueryResult"],e.prototype.issue=function(e){this.clear();var t=void 0;void 0===e.dataSources&&void 0===e.queryableDataSources&&(t=this.ngeoQuerent_.getQueryableDataSources(this.dataSources_.getArray(),e.map));var r=void 0!==e.limit?e.limit:this.limit_;s.a(e,{queryableDataSources:t,limit:r,tolerancePx:this.tolerancePx_,wfsCount:this.queryCountFirst_}),this.result_.pending=!0,this.ngeoQuerent_.issue(e).then(this.handleResult_.bind(this))},e.prototype.clear=function(){this.result_.total=0;var e=this.result_.sources,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;n.features.length=0,n.pending=!1,n.queried=!1,n.tooManyResults=!1,n.totalFeatureCount=void 0}this.result_.sources.length=0,this.result_.pending=!1},e.prototype.handleResult_=function(e){var t=this,r=0,n=function(n){var o=Number(n),i=t.ngeoDataSourcesHelper_.getDataSource(o),s=i.name;a.a.assert(i);var l=e[o],u=l.features,c=l.limit,h=!0===l.tooManyFeatures,p=l.totalFeatureCount,g={};for(var d in u.forEach(function(e){var t=a.a.assertString(e.get("ngeo_feature_type_"));if(g[t]||(g[t]=[]),i.attributes&&i.attributes.length){var r=e.getProperties(),n={};i.attributes.forEach(function(t){t.alias?(n[t.alias]=r[t.name],e.unset(t.name,!0)):n[t.name]=r[t.name]}),e.setProperties(n,!0)}g[t].push(e)}),g){s=d||s;var f=g[d];t.result_.sources.push({features:f,id:o,label:s,limit:c,pending:!1,queried:!0,tooManyResults:h,totalFeatureCount:p}),r+=u.length}};for(var o in e)n(o);this.result_.total=r,this.result_.pending=!1},e}();l.module=angular.module("ngeoMapQuerent",[o.a.module.name,i.a.module.name,n.a.module.name]),l.module.service("ngeoMapQuerent",l),l.module.value("ngeoQueryResult",{sources:[],total:0,pending:!1}),t.a=l},function(e,t,r){"use strict";(function(e){var a=r(41),n=r(33),o=r(1),i=r(87),s=r(65),l=r(207),u=r(161),c=r(8),h=r(2),p=r(10),g=function(e,t,r,a,n,o,i){this.$timeout_=e,this.$injector_=t,this.gettextCatalog_=r,this.layerHelper_=a,this.ngeoNotification_=n,this.gmfThemes_=o,this.root={children:[]},this.rootCtrl=null,this.numberOfGroupsToAddInThisDigestLoop=0,this.groupsToAddInThisDigestLoop_=[],this.promiseForGroupsToAddInThisDigestLoop_=null,this.ngeoStateManager_=i,this.ogcServers_=null,h.a(this.gmfThemes_,"change",this.handleThemesChange_,this)};g.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"],g.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"],g.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t}),this.rootCtrl&&this.rootCtrl.children&&this.gmfThemes_.getThemesObject().then(function(t){e.refreshFirstLevelGroups_(t)})},g.prototype.setFirstLevelGroups=function(e){return this.root.children.length=0,this.ngeoStateManager_.deleteParam(a.a.PermalinkParam.TREE_GROUPS),this.addFirstLevelGroups(e)},g.prototype.addFirstLevelGroups=function(e,t,r){var a=this,n=[];return e.slice().reverse().forEach(function(e){a.addFirstLevelGroup_(e)||n.push(e)}),n.length>0&&!r&&this.notifyCantAddGroups_(n),0===n.length},g.prototype.updateTreeGroupsState_=function(e){var t={};t[a.a.PermalinkParam.TREE_GROUPS]=e.map(function(e){return e.name}).join(","),this.ngeoStateManager_.updateState(t),this.$injector_.has("gmfPermalink")&&this.$injector_.get("gmfPermalink").cleanParams(e)},g.prototype.addFirstLevelGroup_=function(e){var t=this,r=!1,a=e.id;return this.root.children.some(function(e){if(a===e.id)return r=!0},this),this.groupsToAddInThisDigestLoop_.some(function(e){if(a===e.id)return r=!0},this),!r&&(this.groupsToAddInThisDigestLoop_.push(e),this.numberOfGroupsToAddInThisDigestLoop=0,null!==this.promiseForGroupsToAddInThisDigestLoop_&&this.$timeout_.cancel(this.promiseForGroupsToAddInThisDigestLoop_),this.promiseForGroupsToAddInThisDigestLoop_=this.$timeout_(function(){t.numberOfGroupsToAddInThisDigestLoop=t.groupsToAddInThisDigestLoop_.length,t.groupsToAddInThisDigestLoop_.forEach(function(e){t.root.children.unshift(e)}),t.updateTreeGroupsState_(t.root.children),t.groupsToAddInThisDigestLoop_.length=0,t.promiseForGroupsToAddInThisDigestLoop_=null}),!0)},g.prototype.addGroupByName=function(e,t){var r=this;this.gmfThemes_.getThemesObject().then(function(a){var o=n.a.findGroupByName(a,e);o&&r.addFirstLevelGroups([o],t,!1)})},g.prototype.addGroupByLayerName=function(e,t,r){var a=this;this.gmfThemes_.getThemesObject().then(function(o){var s=n.a.findGroupByLayerNodeName(o,e);if(s){var l=a.addFirstLevelGroups([s],t,r);a.$timeout_(function(){var t=a.getTreeCtrlByNodeId(s.id);if(t){var r=void 0;t.traverseDepthFirst(function(t){if(t.node.name===e)return r=t,i.a.VisitorDecision.STOP}),l&&t.setState("off"),r&&r.setState("on")}else console.warn("Tree controller not found, unable to add the group")})}})},g.prototype.removeGroup=function(e){var t=this.root.children,r=0,a=!1;t.some(function(t){if(t.name===e.name)return a=!0;r++}),a&&(t.splice(r,1),this.updateTreeGroupsState_(t))},g.prototype.removeAll=function(){for(;this.root.children.length;)this.removeGroup(this.root.children[0])},g.prototype.cloneGroupNode_=function(e,t){var r=p.a({},e);return this.toggleNodeCheck_(r,t),r},g.prototype.toggleNodeCheck_=function(e,t){var r=this;e.children&&e.children.forEach(function(e){e.children?r.toggleNodeCheck_(e,t):e.metadata&&(e.metadata.isChecked=c.f(t,e.name))})},g.prototype.notifyCantAddGroups_=function(e){var t=[],r=this.gettextCatalog_;e.forEach(function(e){t.push(r.getString(e.name))});var a=t.length<2?r.getString("group is already loaded."):r.getString("groups are already loaded.");this.ngeoNotification_.notify({msg:t.join(", ")+" "+a,type:s.a.Type.INFORMATION})},g.prototype.getTreeCtrlByNodeId=function(e){var t=null;return this.rootCtrl&&this.rootCtrl.traverseDepthFirst&&this.rootCtrl.traverseDepthFirst(function(r){if(r.node.id===e)return t=r,i.a.VisitorDecision.STOP}),t},g.prototype.getOgcServer=function(e){if(e.parent.node.mixed){var t=e.node;return o.a.assert(t.ogcServer),this.ogcServers_[t.ogcServer]}for(var r=e;!r.parent.isRoot;)r=r.parent;var a=r.node;return o.a.assert(a.ogcServer),this.ogcServers_[a.ogcServer]},g.prototype.refreshFirstLevelGroups_=function(e){var t=this,r={};this.rootCtrl.children.map(function(e){var a=e.node.name;r[a]=t.getFirstLevelGroupFullState_(e)});var a=[];this.root.children.map(function(o){var i=o.name,s=n.a.findGroupByName(e,i);if(s){var l=r[i];l&&t.setNodeMetadataFromFullState_(s,l),a.push(s)}}),this.setFirstLevelGroups(a),this.$timeout_(function(){t.updateTreeGroupsState_(t.root.children)})},g.prototype.getFirstLevelGroupFullState_=function(t){var r=this,a={};t.children.map(function(e){a[e.node.name]=r.getFirstLevelGroupFullState_(e)});var n=void 0,o=void 0,i=void 0;if(t.children.length>0){var s=e("#gmf-layertree-layer-group-"+t.uid);s&&(o=s.hasClass("in"))}else{n="on"===(n=t.getState())||"off"!==n&&void 0;var l=e("#gmf-layertree-node-"+t.uid+"-legend");l&&(i=l.is(":visible"))}return{children:a,isChecked:n,isExpanded:o,isLegendExpanded:i}},g.prototype.setNodeMetadataFromFullState_=function(e,t){var r=this;if(!t)return e;e.children&&e.children.map(function(e){r.setNodeMetadataFromFullState_(e,t.children[e.name])});var a=e.metadata;return a.isChecked=t.isChecked,a.isExpanded=t.isExpanded,a.isLegendExpanded=t.isLegendExpanded,e},(g.module=angular.module("gmfTreeManager",[n.a.module.name,i.a.module.name,l.a.module.name,u.a.module.name])).service("gmfTreeManager",g),t.a=g}).call(this,r(27))},function(e,t,r){"use strict";var a=r(1),n=r(166),o=r(3),i=function(e,t){this.$filter_=e,this.gettextCatalog_=t,n.a.call(this)};i.$inject=["$filter","gettextCatalog"],i.$inject=["$filter","gettextCatalog"],o.d(i,n.a),i.prototype.formatTimeValue=function(e,t,r,a){var n=new Date(e),o=a?"UTC":void 0,i="yyyy",s="yyyy-MM",l="yyyy-MM-dd";if(!r){var u=this.gettextCatalog_;i=u.getString("yyyy"),s=u.getString("M/yyyy"),l=u.getString("M/d/yyyy")}switch(t){case"year":return this.$filter_("date")(n,i,o);case"month":return this.$filter_("date")(n,s,o);case"day":return this.$filter_("date")(n,l,o);default:return n.toISOString().replace(/\.\d{3}/,"")}},i.prototype.formatWMSTimeParam=function(e,t,r){return a.a.assert(void 0!==e.resolution),"range"===e.mode?(a.a.assert(void 0!==t.end),this.formatTimeValue(t.start,e.resolution,!0,r)+"/"+this.formatTimeValue(t.end,e.resolution,!0,r)):this.formatTimeValue(t.start,e.resolution,!0,r)},(i.module=angular.module("ngeoWMSTime",[n.a.module.name])).service("ngeoWMSTime",i),t.a=i},function(e,t,r){"use strict";var a=r(19),n=r(132),o=angular.module("ngeoAngularFilters",[]);o.Scalify=function(e){var t=e("number"),r=function(e){var r=t(e,0);return r?"1 : "+r:""};return r.$stateful=!0,r},o.Scalify.$inject=["$filter"],o.filter("ngeoScalify",o.Scalify),o.Number=function(e){var t=e.NUMBER_FORMATS;return function(e,r){var a=t.GROUP_SEP,n=t.DECIMAL_SEP;if(void 0===r&&(r=3),e===1/0)return"∞";if(e===-1/0)return"-∞";if(0===e)return"0";var o=e<0;e=Math.abs(e);var i=r-Math.floor(Math.log(e)/Math.log(10))-1,s=Math.pow(10,i);e=Math.round(e*s);var l="",u=Math.floor(e/s);if(i>0){for(var c=""+e;c.length<i;)c="0"+c;for(l=c.substring(c.length-i);"0"===l[l.length-1];)l=l.substring(0,l.length-1)}for(var h=[],p=""+u;p.length>3;){var g=p.length-3;h.unshift(p.substring(g)),p=p.substring(0,g)}return h.unshift(p),(o?"-":"")+h.join(a)+(0===l.length?"":n+l)}},o.Number.$inject=["$locale"],o.filter("ngeoNumber",o.Number),o.UnitPrefix=function(e){var t=e("ngeoNumber"),r=["","k","M","G","T","P"],a=["","Ki","Mi","Gi","Ti","Pi"];return function(e,n,o,i){void 0===n&&(n="");var s=1e3,l=r;"square"===o?s=1e6:"binary"===o&&(s=1024,l=a);for(var u=0,c=l.length-1;e>=s&&u<c;)e/=s,u++;var h=l[u]+n,p=0==h.length?"":" ";return t(e,i)+p+h}},o.UnitPrefix.$inject=["$filter"],o.filter("ngeoUnitPrefix",o.UnitPrefix),o.NumberCoordinates=function(e){return function(t,r,a){var n=a||"{x} {y}",o=t[0],i=t[1],s=0|parseInt(r,10);return o=e("number")(o,s),i=e("number")(i,s),n.replace("{x}",o).replace("{y}",i)}},o.NumberCoordinates.$inject=["$filter"],o.filter("ngeoNumberCoordinates",o.NumberCoordinates),o.DMSCoordinates=function(){var e=function(e,t,r){var o=a.d(e+180,360)-180,i=Math.abs(3600*o),s=Math.floor(i/3600),l=Math.floor(i/60%60),u=i%60;return s+"° "+n.b(l,2)+"′ "+n.b(u,2,r)+"″ "+t.charAt(o<0?1:0)};return function(t,r,a){var n=0|parseInt(r,10),o=a||"{x} {y}",i=e(t[0],"EW",n),s=e(t[1],"NS",n);return o.replace("{x}",i).replace("{y}",s)}},o.filter("ngeoDMSCoordinates",o.DMSCoordinates),o.trustHtmlFilter=function(e){return function(t){return void 0!==t&&null!==t?e.trustAsHtml(""+t):e.trustAsHtml("&nbsp;")}},o.trustHtmlFilter.$inject=["$sce"],o.filter("ngeoTrustHtml",o.trustHtmlFilter),o.Duration=function(e){var t=Object.freeze({SECONDS:Symbol("seconds"),MINUTES:Symbol("minutes"),HOURS:Symbol("hours"),DAYS:Symbol("days")}),r=function(r,a){var n="";switch(a){case t.SECONDS:n=e.getPlural(r,"second","seconds");break;case t.MINUTES:n=e.getPlural(r,"minute","minutes");break;case t.HOURS:n=e.getPlural(r,"hour","hours");break;case t.DAYS:n=e.getPlural(r,"day","days")}return r+" "+n};return function(e){var a=void 0;if((e=Math.round(e))<60)return r(e,t.SECONDS);var n=e%60;return(e=Math.floor(e/60))<60?(a=r(e,t.MINUTES),n>0&&(a+=" "+r(n,t.SECONDS)),a):(n=e%60,(e=Math.floor(e/60))<24?(a=r(e,t.HOURS),n>0&&(a+=" "+r(n,t.MINUTES)),a):(n=e%24,e=Math.floor(e/24),a=r(e,t.DAYS),n>0&&(a+=" "+r(n,t.HOURS)),a))}},o.Duration.$inject=["gettextCatalog"],o.filter("ngeoDuration",o.Duration),t.a=o},,,,function(e,t,r){"use strict";var a=r(1),n=r(42),o=r(190),i=r(103),s=r(98),l=r(273),u=r(282),c={interaction:function(e){a.a.assertInstanceof(e,n.a),Object.defineProperty(e,"active",{get:function(){return e.getActive()},set:function(t){e.setActive(t)}})},layer:function(e){a.a.assertInstanceof(e,o.a),Object.defineProperty(e,"visible",{configurable:!0,get:function(){return e.getVisible()},set:function(t){e.setVisible(t)}}),Object.defineProperty(e,"opacity",{configurable:!0,get:function(){return e.getOpacity()},set:function(t){e.setOpacity(t)}})},layerLoading:function(e,t){var r=void 0,n=null,o=null,c=function e(t){var r=t.get("load_count");var a=t.get("parent_group");t.set("load_count",++r,!0);a&&e(a)},h=function e(t){var r=t.get("load_count");var a=t.get("parent_group");t.set("load_count",--r,!0);a&&e(a)};if(e.set("load_count",0,!0),e instanceof i.a&&e.getLayers().on("add",function(t){t.element.set("parent_group",e)}),e instanceof s.a){if(null===(r=e.getSource()))return;r instanceof u.b?(n=["tileloadstart"],o=["tileloadend","tileloaderror"]):r instanceof l.a?(n=["imageloadstart"],o=["imageloadend","imageloaderror"]):a.a.fail("unsupported source type"),r.on(n,function(){c(e),t.$applyAsync()}),r.on(o,function(){h(e),t.$applyAsync()})}Object.defineProperty(e,"loading",{configurable:!0,get:function(){return e.get("load_count")>0}})}};t.a=c},,,,,function(e,t,r){"use strict";var a=r(2),n=function(){this.listenerKeys_={}};n.prototype.addListenerKey=function(e,t){this.listenerKeys_[e]||this.initListenerKey_(e),this.listenerKeys_[e].push(t)},n.prototype.clearListenerKey=function(e){this.initListenerKey_(e)},n.prototype.initListenerKey_=function(e){this.listenerKeys_[e]?this.listenerKeys_[e].length&&(this.listenerKeys_[e].forEach(a.e),this.listenerKeys_[e].length=0):this.listenerKeys_[e]=[]},(n.module=angular.module("ngeoEventHelper",[])).service("ngeoEventHelper",n),t.a=n},,,,,,,,function(e,t,r){"use strict";t.a={AND:"&&",NOT:"!",OR:"||"}},,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(125),o=r(26),i=r(56),s=r(107),l=r(34);var u=function(e){function t(r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.type=r.type||o.a.DATE,function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(l.a),c=r(74),h=r(152);var p=function(e){function t(r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.operator=r.operator||l.a.OperatorType.LIKE,r.type=o.a.TEXT,function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(l.a),g=r(213),d=r(57),f=r(8),m=r(121);var y=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gettextCatalog_=t,this.ngeoFeatureHelper_=r,this.ngeoWMSTime_=a}return e.$inject=["gettextCatalog","ngeoFeatureHelper","ngeoWMSTime"],e.prototype.createRulesFromAttributes=function(e,t){var r=[],a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;r.push(this.createRuleFromAttribute(s,t))}return r},e.prototype.createRuleFromAttribute=function(e,t){var r=void 0,n=!0===t,i=this.gettextCatalog_.getString(e.name);switch(e.type){case o.a.DATE:case o.a.DATETIME:r=new u(n?{name:i,operator:l.a.TemporalOperatorType.EQUALS,operators:[l.a.TemporalOperatorType.EQUALS,l.a.TemporalOperatorType.BEGINS,l.a.TemporalOperatorType.ENDS],propertyName:e.name,type:e.type}:{name:i,operator:l.a.TemporalOperatorType.DURING,propertyName:e.name,type:e.type});break;case o.a.GEOMETRY:r=new c.a({name:i,operator:l.a.SpatialOperatorType.WITHIN,operators:[l.a.SpatialOperatorType.CONTAINS,l.a.SpatialOperatorType.INTERSECTS,l.a.SpatialOperatorType.WITHIN],propertyName:e.name,type:e.type});break;case o.a.NUMBER:r=n?new l.a({name:i,operator:l.a.OperatorType.EQUAL_TO,operators:[l.a.OperatorType.EQUAL_TO,l.a.OperatorType.GREATER_THAN,l.a.OperatorType.GREATER_THAN_OR_EQUAL_TO,l.a.OperatorType.LESSER_THAN,l.a.OperatorType.LESSER_THAN_OR_EQUAL_TO,l.a.OperatorType.NOT_EQUAL_TO],propertyName:e.name,type:o.a.NUMBER}):new l.a({name:i,operator:l.a.OperatorType.BETWEEN,propertyName:e.name,type:o.a.NUMBER});break;case o.a.SELECT:r=new h.a({choices:a.a.assert(e.choices),name:i,propertyName:e.name});break;default:r=new p(n?{name:i,operator:l.a.OperatorType.LIKE,operators:[l.a.OperatorType.LIKE,l.a.OperatorType.EQUAL_TO,l.a.OperatorType.NOT_EQUAL_TO],propertyName:e.name}:{name:i,operator:l.a.OperatorType.LIKE,propertyName:e.name})}return r},e.prototype.createRules=function(e){var t=[],r=e,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;t.push(this.createRule(i))}return t},e.prototype.createRule=function(e){var t=void 0;switch(e.type){case o.a.DATE:case o.a.DATETIME:t=new u(e);break;case o.a.GEOMETRY:t=new c.a(e);break;case o.a.SELECT:var r=e;a.a.assert(r.choices),t=new h.a(r);break;default:t=new p(e)}return t},e.prototype.cloneRule=function(e){var t=void 0,r=e.getExpression();null===r&&(r=void 0);var a={expression:r,isCustom:e.isCustom,lowerBoundary:null!==e.lowerBoundary?e.lowerBoundary:void 0,name:e.name,operator:null!==e.operator?e.operator:void 0,operators:e.operators?e.operators.slice(0):void 0,propertyName:e.propertyName,type:null!==e.type?e.type:void 0,upperBoundary:null!==e.upperBoundary?e.upperBoundary:void 0};return e instanceof u?t=new u(a):e instanceof c.a?(t=new c.a(a)).feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(e.feature)):e instanceof h.a?(a.choices=e.choices.slice(0),t=new h.a(a)):t=e instanceof p?new p(a):new l.a(a),t},e.prototype.extendRule=function(e,t){t.getExpression()!==e.getExpression()&&t.setExpression(e.getExpression()),t.lowerBoundary!==e.lowerBoundary&&(t.lowerBoundary=e.lowerBoundary),t.operator!==e.operator&&(t.operator=e.operator),t.upperBoundary!==e.upperBoundary&&(t.upperBoundary=e.upperBoundary),e instanceof c.a&&t instanceof c.a&&(this.ngeoFeatureHelper_.clearNonSpatialProperties(t.feature),t.feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(e.feature)))},e.prototype.serializeRules=function(e){var t=this;return e.map(function(e){return t.serializeRule(e)})},e.prototype.serializeRule=function(e){var t={name:e.name,propertyName:e.propertyName,type:e.type};return null!==e.expression&&(t.expression=e.expression),null!==e.lowerBoundary&&(t.lowerBoundary=e.lowerBoundary),null!==e.operator&&(t.operator=e.operator),null!==e.operators&&(t.operators=e.operators.slice(0)),null!==e.upperBoundary&&(t.upperBoundary=e.upperBoundary),e instanceof c.a&&(t.featureProperties=this.ngeoFeatureHelper_.getNonSpatialProperties(e.feature)),e instanceof h.a&&(t.choices=e.choices),t},e.prototype.createFilter=function(e){var t=e.dataSource,r=null;if(e.filter)r=e.filter;else{var a=e.filterRules||t.filterRules,o=[];if(a&&a.length){var i=a,s=Array.isArray(i),l=0;for(i=s?i:i[Symbol.iterator]();;){var u;if(s){if(l>=i.length)break;u=i[l++]}else{if((l=i.next()).done)break;u=l.value}var c=u,h=this.createFilterFromRule_(c,t,e.srsName);h&&o.push(h)}}var p=t.filterCondition;1===o.length?r=o[0]:o.length>=2&&(p===n.a.AND?r=d.and.apply(null,o):p!==n.a.OR&&p!==n.a.NOT||(r=d.or.apply(null,o))),r&&p===n.a.NOT&&(r=d.not(r))}if(e.incTime){var g=this.createTimeFilterFromDataSource_(t);g&&(r=r?d.and.apply(null,[r,g]):g)}if(e.incDimensions){var f=this.createDimensionsFilterFromDataSource_(t);f&&(r=r?d.and.apply(null,[r,f]):f)}return r},e.prototype.createFilterString=function(e){var t=null,r=this.createFilter(e);if(r){var a=Object(g.b)(r);t=(new XMLSerializer).serializeToString(a)}return t},e.prototype.createFilterFromRule_=function(e,t,r){var n=null,o=e.value;if(!o)return null;var i=o.expression,s=o.lowerBoundary,p=o.operator,g=o.propertyName,y=o.upperBoundary,v=l.a.OperatorType,_=l.a.SpatialOperatorType,S=l.a.TemporalOperatorType,b=[_.CONTAINS,_.INTERSECTS,_.WITHIN],C=[v.GREATER_THAN,v.GREATER_THAN_OR_EQUAL_TO,v.LESSER_THAN,v.LESSER_THAN_OR_EQUAL_TO];if(e instanceof u){var w=void 0,T=void 0;p===S.DURING?(w=Object(m.a)(s).format("YYYY-MM-DD"),T=Object(m.a)(y).format("YYYY-MM-DD")):p===S.EQUALS?(w=Object(m.a)(i).format("YYYY-MM-DD HH:mm:ss"),T=Object(m.a)(i).add(1,"days").subtract(1,"seconds").format("YYYY-MM-DD HH:mm:ss")):p===S.BEGINS?(w=Object(m.a)(i).format("YYYY-MM-DD"),T=Object(m.a)(i).add(30,"years").format("YYYY-MM-DD")):p===S.ENDS&&(w="1970-01-01",T=Object(m.a)(i).format("YYYY-MM-DD")),w&&T&&(n=d.during(g,w,T))}else if(e instanceof h.a){var E=e.selectedChoices;if(1===E.length)n=d.equalTo(g,E[0]);else if(E.length>=2){var A=[],L=E,P=Array.isArray(L),M=0;for(L=P?L:L[Symbol.iterator]();;){var F;if(P){if(M>=L.length)break;F=L[M++]}else{if((M=L.next()).done)break;F=M.value}var x=F;A.push(d.equalTo(g,x))}n=d.or.apply(null,A)}}else if(f.f(b,p)){var R=t.geometryName;a.a.assertInstanceof(e,c.a);var D=a.a.assert(e.geometry);p===_.CONTAINS?n=d.contains(R,D,r):p===_.INTERSECTS?n=d.intersects(R,D,r):p===_.WITHIN&&(n=d.within(R,D,r))}else if(f.f(C,p)){var k=a.a.assertNumber(i);p===v.GREATER_THAN?n=d.greaterThan(g,k):p===v.GREATER_THAN_OR_EQUAL_TO?n=d.greaterThanOrEqualTo(g,k):p===v.LESSER_THAN?n=d.lessThan(g,k):p===v.LESSER_THAN_OR_EQUAL_TO&&(n=d.lessThanOrEqualTo(g,k))}else if(p===v.BETWEEN)n=d.between(g,s,y);else if(p===v.EQUAL_TO)n=d.equalTo(g,i);else if(p===v.LIKE){var $=String(i).replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*");n=d.like(g,"*"+$+"*","*",".","!",!1)}else p===v.NOT_EQUAL_TO&&(n=d.notEqualTo(g,i));return n},e.prototype.createDimensionsFilterFromDataSource_=function(e){var t=e.dimensionsFiltersConfig,r=e.dimensions,a=[];for(var n in t){var o=t[n].value;null===o&&void 0!==r[n]&&null!==r[n]&&(o=r[n]),null!==o&&a.push(d.equalTo(t[n].field,o,!0))}return 1===a.length?a[0]:a.length>=2?d.and.apply(null,a):null},e.prototype.createTimeFilterFromDataSource_=function(e){var t=null,r=e.timeRangeValue,a=e.timeProperty,n=e.timeAttributeName;if(r&&a&&n)if(void 0!==r.end){var o=this.ngeoWMSTime_.formatWMSTimeParam(a,r).split("/");t=d.during(n,o[0],o[1])}else{var i=a.resolution||"seconds",s=this.ngeoWMSTime_.formatWMSTimeParam(a,r),l=void 0;switch(i){case"year":l=Object(m.a)(s).add(1,"years").subtract(1,"seconds");break;case"month":l=Object(m.a)(s).add(1,"months").subtract(1,"seconds");break;case"day":l=Object(m.a)(s).add(1,"days").subtract(1,"seconds")}if(l){var u=Object(m.a)(s).format("YYYY-MM-DD HH:mm:ss"),c=l.format("YYYY-MM-DD HH:mm:ss");t=d.during(n,u,c)}}return t},e}();y.module=angular.module("ngeoRuleHelper",[i.a.module.name,s.a.module.name]),y.module.service("ngeoRuleHelper",y);t.a=y},function(e,t,r){"use strict";var a=r(41),n=r(1),o=r(85),i=r(269),s=r(137),l=r(150),u=r(29),c=r(102),h=r(93),p=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var g=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return a.featuresCollection_=r.features||new u.b,a.source_=new h.b({features:a.featuresCollection_,wrapX:!1}),a.layer_=new c.a({source:a.source_}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),p(t,[{key:"features",get:function(){return this.featuresCollection_.getArray()}},{key:"featuresCollection",get:function(){return this.featuresCollection_}},{key:"layer",get:function(){return this.layer_}},{key:"extent",get:function(){return this.source_.getExtent()}}]),t}(l.a),d=r(183);var f=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r)),n=r.injector;return a.rootScope_=n.get("$rootScope"),a.unregister_={},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.addDataSource=function(t){e.prototype.addDataSource.call(this,t),n.a.assertInstanceof(t,g),this.registerDataSource_(t)},t.prototype.registerDataSource_=function(e){this.unregister_[e.id]=this.rootScope_.$watch(function(){return e.visible},this.handleDataSourceVisibleChange_.bind(this,e))},t.prototype.handleDataSourceVisibleChange_=function(e,t,r){void 0!==t&&e.layer.setVisible(t)},t.prototype.removeDataSource=function(t){e.prototype.removeDataSource.call(this,t),n.a.assertInstanceof(t,g),this.unregisterDataSource_(t)},t.prototype.unregisterDataSource_=function(e){this.unregister_[e.id](),delete this.unregister_[e.id]},t}(d.a),m=r(38),y=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var v=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return a.url_=r.url,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),y(t,[{key:"url",get:function(){return this.url_}}]),t}(d.a),_=r(8),S=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var b=function(e){function t(r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r)),o=r.injector;return n.layer_,n.ngeoLayerHelper_=a,n.rootScope_=o.get("$rootScope"),n.wmsDataSourceUnregister_={},n.init_(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init_=function(){n.a.assert(this.dataSources.length,"At least one data source is required.");var e=this.dataSources,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var o=a;n.a.assertInstanceof(o,m.a),this.registerDataSource_(o)}},t.prototype.destroy=function(){var t=this.dataSources,r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var o;if(r){if(a>=t.length)break;o=t[a++]}else{if((a=t.next()).done)break;o=a.value}var i=o;n.a.assertInstanceof(i,m.a),this.unregisterDataSource_(i)}e.prototype.destroy.call(this)},t.prototype.addDataSource=function(t){e.prototype.addDataSource.call(this,t),n.a.assertInstanceof(t,m.a),this.registerDataSource_(t)},t.prototype.registerDataSource_=function(e){var t=e.id;this.wmsDataSourceUnregister_[t]=this.rootScope_.$watch(function(){return e.visible},this.handleDataSourceVisibleChange_.bind(this)),this.layer_?(this.layer_.get("querySourceIds").push(t),this.updateLayer_()):this.layer_=this.ngeoLayerHelper_.createBasicWMSLayerFromDataSource(e)},t.prototype.handleDataSourceVisibleChange_=function(e,t){void 0!==e&&e!==t&&this.updateLayer_()},t.prototype.updateLayer_=function(){var e=this.layer,t=[],r=this.dataSources,a=Array.isArray(r),o=0;for(r=a?r:r[Symbol.iterator]();;){var i;if(a){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var s=i;n.a.assertInstanceof(s,m.a),s.visible&&(t=t.concat(s.getOGCLayerNames()))}this.ngeoLayerHelper_.updateWMSLayerState(e,t.join(","))},t.prototype.removeDataSource=function(t){e.prototype.removeDataSource.call(this,t),n.a.assertInstanceof(t,m.a),this.unregisterDataSource_(t)},t.prototype.unregisterDataSource_=function(e){var t=e.id,r=this.layer;(0,this.wmsDataSourceUnregister_[t])(),delete this.wmsDataSourceUnregister_[t],_.j(this.dataSources,e);var a=this.ngeoLayerHelper_.getQuerySourceIds(r);a&&_.j(a,t),this.dataSources.length&&this.updateLayer_()},S(t,[{key:"layer",get:function(){return this.layer_}}]),t}(v),C=r(3),w=r(5),T=r(2),E=r(348),A=r(350),L=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var P=function(){function e(t,r,a,n,o,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.injector_=r,this.q_=a,this.rootScope_=n,this.dataSources_=o.collection,this.ngeoFile_=i,this.ngeoLayerHelper_=s,this.extDataSources_={},this.files_={},this.map_=null,this.fileGroup_=new f({dataSources:[],injector:this.injector_,title:t.getString("Local files")}),this.wmsGroupsCollection_=new u.b,this.wmtsGroupsCollection_=new u.b,this.wmtsCache_={},T.a(this.dataSources_,"remove",this.handleDataSourcesRemove_,this)}return e.$inject=["gettextCatalog","$injector","$q","$rootScope","ngeoDataSources","ngeoFile","ngeoLayerHelper"],e.prototype.addWMSGroup_=function(e){this.wmsGroupsCollection.push(e)},e.prototype.removeWMSGroup_=function(e){this.wmsGroupsCollection.remove(e)},e.prototype.getWMSGroup=function(e){var t=null,r=this.wmsGroups,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(i.url===e){t=i;break}}return t},e.prototype.addWMTSGroup_=function(e){this.wmtsGroupsCollection.push(e)},e.prototype.removeWMTSGroup_=function(e){this.wmtsGroupsCollection.remove(e)},e.prototype.getWMTSGroup=function(e){var t=null,r=this.wmtsGroups,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(i.url===e){t=i;break}}return t},e.prototype.isExternalDataSource=function(e){return!!this.extDataSources_[e.id]},e.prototype.addLayer_=function(e){this.layerGroup.getLayers().push(e)},e.prototype.removeLayer_=function(e){this.layerGroup.getLayers().remove(e)},e.prototype.createAndAddDataSourceFromWMSCapability=function(t,r,a){var n=e.getId(t),o=r.Service,i=void 0;if(this.extDataSources_[n])i=this.extDataSources_[n];else{var s=r.Capability.Request,l=s.GetMap.Format,u=l.includes("image/png")?"image/png":l[0],c=s.GetFeatureInfo.Format.includes(m.a.WMSInfoFormat.GML)?m.a.WMSInfoFormat.GML:void 0,h=!0===t.queryable&&void 0!==c;i=new m.a({id:n,name:t.Title,ogcImageType:u,ogcLayers:[{name:t.Name,queryable:h}],ogcType:m.a.Type.WMS,visible:!0,wmsInfoFormat:c,wmsUrl:a}),this.extDataSources_[n]=i}var p=this.getWMSGroup(a);p?p.dataSources.includes(i)||(p.addDataSource(i),this.dataSources_.push(i)):(p=new b({dataSources:[i],injector:this.injector_,title:o.Title,url:a},this.ngeoLayerHelper_),this.addLayer_(p.layer),this.addWMSGroup_(p),this.dataSources_.push(i))},e.prototype.createAndAddDataSourceFromWMTSCapability=function(t,r,a){var o=e.getId(t);if(!this.wmtsCache_[o]){var i=void 0;if(this.extDataSources_[o])i=this.extDataSources_[o];else{var s=n.a.assertString(t.Title),l=n.a.assertString(t.Identifier);i=new m.a({id:o,name:s,ogcType:m.a.Type.WMTS,visible:!0,wmtsLayer:l,wmtsUrl:a}),this.extDataSources_[o]=i}var u=this.getWMTSGroup(a);u||(u=new v({dataSources:[],title:r.ServiceIdentification.Title,url:a}),this.addWMTSGroup_(u)),u.addDataSource(i);var c=this.ngeoLayerHelper_.createWMTSLayerFromCapabilititesObj(r,t);this.addLayer_(c),this.dataSources_.push(i),this.wmtsCache_[o]={layerObj:c,unregister:this.rootScope_.$watch(function(){return i.visible},this.handleWMTSDataSourceVisibleChange_.bind(this,c))}}},e.prototype.createAndAddDataSourceFromFile=function(e,t){var r=this;this.getFileDataSource_(e).then(function(e){var a=!0,n=r.fileGroup_;if(Object(w.H)(e.extent))a=!1;else{if(n.dataSources.includes(e))return;r.addLayer_(e.layer),n.addDataSource(e),r.map_.getView().fit(e.extent),r.dataSources_.push(e)}t&&t(a)},function(r){console.error("Failed to load file: "+e.name),t&&t(!1)})},e.prototype.getFileDataSource_=function(t){var r=this,a=this.q_.defer();if(this.files_[t.name])a.resolve(this.files_[t.name]);else{var n=this.ngeoFile_;n.read(t).then(function(o){var i=void 0,s={featureProjection:r.map_.getView().getProjection()};if(n.isKml(o)?i=(new A.a).readFeatures(o,s):n.isGpx(o)&&(i=(new E.a).readFeatures(o,s)),i){var l=e.getId(t),c=new g({features:new u.b(i),id:l,name:t.name,visible:!0});r.files_[t.name]=c,r.extDataSources_[l]=c,a.resolve(c)}else a.reject()})}return a.promise},e.prototype.handleWMTSDataSourceVisibleChange_=function(e,t,r){void 0!==t&&t!==r&&e.setVisible(t)},e.prototype.handleDataSourcesRemove_=function(e){var t=e.element;this.extDataSources_[t.id]===t&&(t instanceof g?this.removeFileDataSource_(t):t instanceof m.a&&this.removeOGCDataSource_(t))},e.prototype.removeFileDataSource_=function(e){this.removeLayer_(e.layer),this.fileGroup_.removeDataSource(e)},e.prototype.removeOGCDataSource_=function(e){if(e.ogcType===m.a.Type.WMS){var t=e.wmsUrl;n.a.assert(t);var r=this.getWMSGroup(t);r&&r.dataSources.includes(e)&&(r.removeDataSource(e),r.dataSources.length||(this.removeLayer_(r.layer),r.destroy(),this.removeWMSGroup_(r)))}else if(e.ogcType===m.a.Type.WMTS){var a=e.wmtsUrl;n.a.assert(a);var o=this.getWMTSGroup(a);if(o&&o.dataSources.includes(e)){o.removeDataSource(e);var i=e.id;this.removeLayer_(this.wmtsCache_[i].layerObj),this.wmtsCache_[i].unregister(),delete this.wmtsCache_[i],o.dataSources.length||(o.destroy(),this.removeWMTSGroup_(o))}}},L(e,[{key:"fileGroup",get:function(){return this.fileGroup_}},{key:"wmsGroups",get:function(){return this.wmsGroupsCollection_.getArray()}},{key:"wmsGroupsCollection",get:function(){return this.wmsGroupsCollection_}},{key:"wmtsGroups",get:function(){return this.wmtsGroupsCollection_.getArray()}},{key:"wmtsGroupsCollection",get:function(){return this.wmtsGroupsCollection_}},{key:"layerGroup",get:function(){var e=this.map_;return n.a.assert(e),this.ngeoLayerHelper_.getGroupFromMap(e,a.a.EXTERNALLAYERGROUP_NAME)}},{key:"map",set:function(e){this.map_=e}}]),e}();P.getId=function(e){return C.c(e)+1e6},P.module=angular.module("gmfExternalDataSourcesManager",[o.a.module.name,i.a.module.name,s.a.module.name]),P.module.service("gmfExternalDataSourcesManager",P);t.a=P},,function(e,t,r){"use strict";var a=r(1),n=r(150),o=r(29),i=r(2),s=r(291),l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collection_=new o.b,this.map_=null,this.listenerKeys_=[],i.a(this.collection_,"add",this.handleDataSourcesAdd_,this)}return e.prototype.bindMap_=function(e){var t=e.getView();this.listenerKeys_.push(i.a(t,"change:resolution",this.handleViewResolutionChange_,this));var r=t.getResolution();a.a.assertNumber(r),this.syncDataSourcesToResolution_(r)},e.prototype.unbindMap_=function(e){this.listenerKeys_.forEach(i.e),this.listenerKeys_=[]},e.prototype.handleViewResolutionChange_=function(e){var t=e.target;a.a.assertInstanceof(t,s.a);var r=t.getResolution();a.a.assertNumber(r),this.syncDataSourcesToResolution_(r)},e.prototype.syncDataSourcesToResolution_=function(e){var t=this;this.collection_.forEach(function(r){t.syncDataSourceToResolution_(r,e)})},e.prototype.syncDataSourceToResolution_=function(e,t){if(e.supportsDynamicInRange){var r=e.maxResolution,a=e.minResolution,n=(null===a||void 0===a||t>=a)&&(null===r||void 0===r||t<=r);e.inRange=n}},e.prototype.handleDataSourcesAdd_=function(e){var t=a.a.assertInstanceof(e.element,n.a);if(this.map_){var r=this.map_.getView().getResolution();a.a.assertNumber(r),this.syncDataSourceToResolution_(t,r)}},l(e,[{key:"map",set:function(e){this.map_!==e&&(this.map_&&this.unbindMap_(this.map_),this.map_=e,e&&this.bindMap_(e))}},{key:"collection",get:function(){return this.collection_}}]),e}();u.module=angular.module("ngeoDataSources",[]),u.module.service("ngeoDataSources",u),t.a=u},function(e,t,r){"use strict";var a=r(33),n=r(1),o=r(87),i=r(107),s=r(3),l=r(131),u=r(122),c=function(e,t,r,a){var n=this;this.layerHelper_=t,this.ngeoWMSTime_=r,this.ogcServersObject_,a.getOgcServersObject().then(function(e){n.ogcServersObject_=e}),e.$on("ngeo-layertree-state",function(e,t,r){n.sync_(e,r)})};c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"],c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"],c.prototype.createLayer=function(e,t,r,a){var n=null;return void 0!==e.node.children&&e.node.mixed?n=this.createGroup_(e,t,r,a):void 0===e.node.children&&e.parent.node.mixed?n=this.createLeafInAMixedGroup_(e,t):void 0===e.node.children?this.initGmfLayerInANotMixedGroup_(e,t):1!==e.depth||e.node.mixed||(n=this.createGroup_(e,t,r,a)),n&&e.node.metadata.opacity&&n.setOpacity(e.node.metadata.opacity),n},c.prototype.sync_=function(e,t){var r=this;t.traverseDepthFirst(function(e){e.layer&&!e.node.mixed&&r.updateLayerState_(e.layer,e)})},c.prototype.updateLayerState_=function(e,t){var r="on"===t.getState();if("WMTS"===t.node.type)e.setVisible(r);else if(t.node.mixed||1!==t.depth)n.a.assertInstanceof(e,l.a),e.setVisible(r);else{n.a.assertInstanceof(e,l.a);var a=[];t.traverseDepthFirst(function(e){void 0===e.node.children&&"on"===e.getState()&&a.push(e.node.layers)}),0===a.length&&e.setVisible(!1),e.getSource().updateParams({LAYERS:a.reverse().join(",")}),0!==a.length&&e.setVisible(!0)}},c.prototype.createGroup_=function(e,t,r,a){var n=e.node,o=null,i=e.parent.isRoot,s=!0;if(void 0!==n.metadata.printNativeAngle&&(s=n.metadata.printNativeAngle),i){o=this.createLayerFromGroup_(e,!!n.mixed);var l=0|a;r.getLayers().insertAt(l,o)}else{if(!this.isOneParentNotMixed_(e))o=this.createLayerFromGroup_(e,!0),c.getLayer(e.parent).getLayers().insertAt(0,o)}return o.set("printNativeAngle",s),o},c.prototype.createLayerFromGroup_=function(e,t){var r=this,a=void 0,o=e.node;if(t)a=this.layerHelper_.createBasicGroup();else{var i=this.getTimeParam_(e),s=this.ogcServersObject_[o.ogcServer||""];n.a.assert(s),n.a.assert(s.url),n.a.assert(s.type),n.a.assert(s.imageType),a=this.layerHelper_.createBasicWMSLayer(s.url,"",s.imageType,s.type,i,void 0,s.credential?"use-credentials":"anonymous");var l=!1;e.traverseDepthFirst(function(e){r.updateLayerReferences_(e.node,a),e.node.metadata.isChecked&&(e.setState("on",!1),r.updateLayerState_(a,e),l=!0)}),a.setVisible(l),a.set("layerNodeName",o.name)}return a},c.prototype.createLeafInAMixedGroup_=function(e,t){var r=e.node,a=void 0;if("WMTS"===r.type)a=this.createWMTSLayer_(r);else{var o=r,i=this.getTimeParam_(e),s=this.ogcServersObject_[o.ogcServer];n.a.assert(s),n.a.assert(s.url),n.a.assert(s.type),n.a.assert(o.layers),n.a.assert(s.imageType),a=this.layerHelper_.createBasicWMSLayer(s.url,o.layers,s.imageType,s.type,i,void 0,s.credential?"use-credentials":"anonymous")}a.set("layerNodeName",r.name),this.updateLayerReferences_(r,a);var l=!0===r.metadata.isChecked;return l&&e.setState("on",!1),a.setVisible(l),c.getLayer(e.parent).getLayers().insertAt(0,a),a},c.prototype.initGmfLayerInANotMixedGroup_=function(e,t){var r=e.node,a=this.getFirstLevelGroupCtrl_(e);n.a.assert(a);var o=a.layer;n.a.assertInstanceof(o,l.a),this.updateLayerReferences_(r,o),r.metadata.isChecked?(e.setState("on",!1),this.updateLayerState_(o,a)):e.parent.refreshState()},c.prototype.createWMTSLayer_=function(e){var t=new u.a;return n.a.assert(e.url),n.a.assert(e.layer),this.layerHelper_.createWMTSLayerFromCapabilitites(e.url,e.layer,e.matrixSet,e.dimensions).then(function(e){t.setSource(e.getSource()),t.set("capabilitiesStyles",e.get("capabilitiesStyles"))}),t},c.prototype.updateLayerReferences_=function(e,t){var r=s.c(e),a=t.get("querySourceIds")||[];if(a.push(r),t.set("querySourceIds",a),e.metadata.disclaimer){var n=t.get("disclaimers")||[];n.push(e.metadata.disclaimer),t.set("disclaimers",n)}},c.prototype.getTimeParam_=function(e){var t=void 0,r=void 0,a=e.node;if(a.time?t=a.time:a.children&&e.traverseDepthFirst(function(e){if(void 0===e.node.children&&e.node.time)return t=e.node.time,o.a.VisitorDecision.STOP}),t){var n=this.ngeoWMSTime_.getOptions(t).values;r=this.ngeoWMSTime_.formatWMSTimeParam(t,{start:n[0]||n,end:n[1]})}return r},c.prototype.isOneParentNotMixed_=function(e){var t=e.parent,r=!1;do{r=!1===t.node.mixed,t=t.parent}while(t.parent&&!r);return r},c.prototype.getFirstLevelGroupCtrl_=function(e){for(var t=e;!t.parent.isRoot;)t=t.parent;return t},c.getLayer=function(e){for(var t=e,r=null;!t.isRoot&&null===r;)t.layer&&(r=t.layer),t=t.parent;return r},(c.module=angular.module("gmfSyncLayertreeMap",[a.a.module.name,o.a.module.name,i.a.module.name])).service("gmfSyncLayertreeMap",c),t.a=c},,function(e,t,r){"use strict";(function(e){var a=r(248),n=r(197),o=r(247),i=r(138),s=r(1),l=r(208),u=(r(299),r(460),r(329)),c=r(327),h=r(62),p=r(182),g=r(15),d=r(199),f=r(198),m=r(85),y=r(201),v=r(206),_=r(160),S=r(112),b=r(117),C=r(56),w=r(60),T=r(159),E=r(3),A=r(8),L=r(29),P=r(2),M=r(5),F=r(37),x=r(167),R=r(289),D=r(131),k=r(122),$=r(53),O=r(18),I=r(127),N=angular.module("GmfEditingFeatureComponent",[a.a.module.name,n.a.module.name,o.a.module.name,u.a.name,c.a.name,m.a.module.name,v.a.name,_.a.name,b.a.module.name,C.a.module.name,T.a.module.name]);N.run(["$templateCache",function(e){e.put("gmf/editing/editFeatureComponent",r(373))}]),N.component_=function(){return{controller:"GmfEditfeatureController as efCtrl",scope:{dirty:"=gmfEditfeatureDirty",editableTreeCtrl:"=gmfEditfeatureEditabletreectrl",map:"<gmfEditfeatureMap",state:"=gmfEditfeatureState",tolerance:"<?gmfEditfeatureTolerance",vectorLayer:"<gmfEditfeatureVector"},bindToController:!0,templateUrl:"gmf/editing/editFeatureComponent"}},N.directive("gmfEditfeature",N.component_),N.Controller_=function(e,t,r,a,n,o,i,s,l,u,c,h){var p=this;this.dirty,this.editableTreeCtrl,this.map,this.state,this.tolerance,this.vectorLayer,this.element_=e,this.q_=t,this.scope_=r,this.timeout_=a,this.gettextCatalog_=n,this.gmfEditFeature_=o,this.gmfSnapping_=i,this.gmfXSDAttributes_=s,this.ngeoEventHelper_=l,this.ngeoFeatureHelper_=u,this.ngeoLayerHelper_=c,this.ngeoToolActivateMgr_=h,this.editableNode_,this.editableWMSLayer_,this.confirmDeferred_=null,this.unsavedModificationsModalShown=!1,this.pending=!1,this.active=!0,this.createActive=!1,this.createToolActivate=new w.a(this,"createActive"),this.mapSelectActive=!0,this.mapSelectToolActivate=new w.a(this,"mapSelectActive"),this.feature=null,this.scope_.$watch(function(){return p.feature},this.handleFeatureChange_.bind(this)),this.featureId=void 0,this.features,this.interactions_=new L.b,this.modify_,this.modifyToolActivate,this.menu_=new y.a({actions:[{cls:"fa fa-arrows",label:n.getString("Move"),name:"move"},{cls:"fa fa-rotate-right",label:n.getString("Rotate"),name:"rotate"}]}),this.translate_,this.rotate_,this.rotateToolActivate,this.translateToolActivate,this.listenerKeys_=[],this.attributes=null,this.geomType,this.showServerError=!1,this.serverErrorMessage=null,this.serverErrorType=null},N.Controller_.$inject=["$element","$q","$scope","$timeout","gettextCatalog","gmfEditFeature","gmfSnapping","gmfXSDAttributes","ngeoEventHelper","ngeoFeatureHelper","ngeoLayerHelper","ngeoToolActivateMgr"],N.Controller_.prototype.$onInit=function(){var t=this,r=this.gettextCatalog_.getCurrentLanguage();e.datetimepicker.setLocale(r),e.datetimepicker.setDateFormatter(new l.a),this.dirty=!0===this.dirty,this.editableNode_=this.editableTreeCtrl.node,this.features=this.vectorLayer.getSource().getFeaturesCollection(),this.tolerance=void 0!==this.tolerance?this.tolerance:10;var a=i.a.getLayer(this.editableTreeCtrl);s.a.assert(a instanceof D.a||a instanceof k.a),this.editableWMSLayer_=a,this.modify_=new R.a({deleteCondition:h.a.deleteCondition,features:this.features,style:this.ngeoFeatureHelper_.getVertexStyle(!1)}),this.interactions_.push(this.modify_),this.rotate_=new d.a({features:this.features,style:new O.c({text:new I.a({text:"",font:"normal 18px FontAwesome",fill:new $.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.rotate_),this.translate_=new f.a({features:this.features,style:new O.c({text:new I.a({text:"",font:"normal 18px FontAwesome",fill:new $.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.translate_),this.initializeInteractions_(),this.modifyToolActivate=new w.a(this.modify_,"active"),this.rotateToolActivate=new w.a(this.rotate_,"active"),this.translateToolActivate=new w.a(this.translate_,"active"),this.map.addOverlay(this.menu_),this.scope_.$watch(function(){return t.createActive},function(e,r){e&&t.gmfSnapping_.ensureSnapInteractionsOnTop()}),this.scope_.$on("$destroy",this.handleDestroy_.bind(this));var n=E.c(this);this.ngeoEventHelper_.addListenerKey(n,P.a(this.features,"add",this.handleFeatureAdd_,this)),this.scope_.$watch(function(){return t.mapSelectActive},this.handleMapSelectActiveChange_.bind(this)),this.scope_.$watch(function(){return t.state},function(e,r){var a=N.State;e===a.STOP_EDITING_PENDING?t.confirmCancel().then(function(){t.state=a.STOP_EDITING_EXECUTE}):e===a.DEACTIVATE_PENDING&&t.confirmCancel().then(function(){t.state=a.DEACTIVATE_EXECUTE})}),this.scope_.$watch(function(){return t.unsavedModificationsModalShown},function(e,r){r&&!e&&(t.state=N.State.IDLE)}),this.gmfXSDAttributes_.getAttributes(this.editableNode_.id).then(this.setAttributes_.bind(this)),this.toggle_(!0)},N.Controller_.prototype.save=function(){var e=this;s.a.assert(this.attributes);var t=this.feature.clone();t.setId(this.feature.getId());var r=this.featureId;this.pending=!0;var a=new l.a,n=this.attributes,o=Array.isArray(n),i=0;for(n=o?n:n[Symbol.iterator]();;){var u;if(o){if(i>=n.length)break;u=n[i++]}else{if((i=n.next()).done)break;u=i.value}var c=u;if(c.format)if(this.feature.get(c.name)){var h=this.feature.get(c.name);s.a.assertString(h);var p=a.parseDate(h,c.format),g="Y-m-d\\TH:i:s";"date"===c.type?g="Y-m-d":"time"===c.type?g="H:i:s":"datetime"===c.type&&p.setMinutes(p.getMinutes()+p.getTimezoneOffset()),t.set(c.name,a.formatDate(p,g))}else t.set(c.name,null)}(r?this.gmfEditFeature_.updateFeature(this.editableNode_.id,t):this.gmfEditFeature_.insertFeatures(this.editableNode_.id,[t])).then(function(t){e.dirty=!1,e.pending=!1,e.handleEditFeature_(t),e.gmfSnapping_.refresh()},function(t){e.showServerError=!0,e.pending=!1,e.serverErrorType="error type : "+t.data.error_type,e.serverErrorMessage="error message : "+t.data.message})},N.Controller_.prototype.cancel=function(){this.dirty=!1,this.feature=null,this.features.clear(),this.menu_.close(),this.unsavedModificationsModalShown=!1},N.Controller_.prototype.confirmCancel=function(){var e=this;return this.checkForModifications_().then(function(){e.cancel()})},N.Controller_.prototype.checkForModifications_=function(e){return this.confirmDeferred_=this.q_.defer(),this.feature&&this.dirty?(this.unsavedModificationsModalShown=!0,e&&this.scope_.$apply()):this.confirmDeferred_.resolve(),this.confirmDeferred_.promise},N.Controller_.prototype.continueWithoutSaving=function(){this.cancel(),this.confirmDeferred_.resolve()},N.Controller_.prototype.delete=function(){var e=this,t=this.gettextCatalog_.getString("Do you really want to delete the selected feature?");confirm(t)&&(this.pending=!0,this.gmfEditFeature_.deleteFeature(this.editableNode_.id,this.feature).then(function(t){e.dirty=!1,e.pending=!1,e.ngeoLayerHelper_.refreshWMSLayer(e.editableWMSLayer_),e.cancel()},function(t){e.showServerError=!0,e.pending=!1,e.serverErrorType="error type : "+t.data.error_type,e.serverErrorMessage="error message : "+t.data.message}))},N.Controller_.prototype.submit=function(){var e=this;this.timeout_(function(){e.element_.find('input[type="submit"]').click()},0)},N.Controller_.prototype.handleEditFeature_=function(e){var t=(new x.a).readFeatures(e.data);t.length&&(this.feature.setId(t[0].getId()),this.ngeoLayerHelper_.refreshWMSLayer(this.editableWMSLayer_)),this.confirmDeferred_&&this.confirmDeferred_.resolve()},N.Controller_.prototype.setAttributes_=function(e){this.attributes=e;var t=e,r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}var o=n;"date"==o.type?(o.format="Y-m-d",o.mask="9999-19-39"):"time"==o.type?(o.format="H:i",o.mask="29:59"):"datetime"==o.type&&(o.format="Y-m-d H:i",o.mask="9999-19-39 29:59")}var i=p.a.getGeometryAttribute(this.attributes);i&&i.geomType&&(this.geomType=i.geomType)},N.Controller_.prototype.handleFeatureAdd_=function(e){var t=this;this.feature=null,this.timeout_(function(){s.a.assert(t.attributes);var r=e.element;s.a.assertInstanceof(r,F.a);var a=new l.a,n=t.attributes,o=Array.isArray(n),i=0;for(n=o?n:n[Symbol.iterator]();;){var u;if(o){if(i>=n.length)break;u=n[i++]}else{if((i=n.next()).done)break;u=i.value}var c=u;if(c.format)if(r.get(c.name)){var h=void 0;if("datetime"===c.type)(h=new Date(r.get(c.name))).setMinutes(h.getMinutes()-h.getTimezoneOffset());else{var p="";"date"===c.type?p="Y-m-d":"time"===c.type&&(p="H:i:s");var g=r.get(c.name);s.a.assertString(g),h=a.parseDate(g,p)}r.set(c.name,a.formatDate(h,c.format))}else r.set(c.name,null)}t.feature=r,t.createActive=!1,r.getId()||(t.dirty=!0),t.scope_.$apply()},0)},N.Controller_.prototype.toggle_=function(e){var t=this.listenerKeys_,r=["create-",E.c(this)].join("-"),a=["other-",E.c(this)].join("-"),n=this.ngeoToolActivateMgr_;e?(t.push(P.a(this.menu_,"actionclick",this.handleMenuActionClick_,this)),t.push(P.a(this.translate_,"translateend",this.handleTranslateEnd_,this)),t.push(P.a(this.rotate_,"rotateend",this.handleRotateEnd_,this)),n.registerTool(r,this.createToolActivate,!1),n.registerTool(r,this.mapSelectToolActivate,!0),n.registerTool(a,this.createToolActivate,!1),n.registerTool(a,this.modifyToolActivate,!0),n.registerTool(a,this.translateToolActivate,!1),n.registerTool(a,this.rotateToolActivate,!1)):(t.forEach(P.e),t.length=0,n.unregisterTool(r,this.createToolActivate),n.unregisterTool(r,this.mapSelectToolActivate),n.unregisterTool(a,this.createToolActivate),n.unregisterTool(a,this.modifyToolActivate),n.unregisterTool(a,this.translateToolActivate),n.unregisterTool(a,this.rotateToolActivate),this.createActive=!1,this.cancel()),this.modify_.setActive(e),this.mapSelectActive=e,this.editableTreeCtrl.properties.editing=e},N.Controller_.prototype.handleMapSelectActiveChange_=function(e){var t=this.map.getViewport();s.a.assertElement(t),e?(P.a(this.map,"click",this.handleMapClick_,this),P.a(t,"contextmenu",this.handleMapContextMenu_,this)):(P.c(this.map,"click",this.handleMapClick_,this),P.c(t,"contextmenu",this.handleMapContextMenu_,this))},N.Controller_.prototype.handleMapClick_=function(e){var t=this,r=e.coordinate,a=e.pixel;this.map.forEachFeatureAtPixel(a,function(e){var r=!1;return A.f(t.features.getArray(),e)&&(r=e),r},{hitTolerance:5})||this.checkForModifications_(!0).then(function(){var e=t.map.getView().getResolution()*t.tolerance,a=M.c([r[0],r[1],r[0],r[1]],e);t.gmfEditFeature_.getFeaturesInExtent([t.editableNode_.id],a).then(t.handleGetFeatures_.bind(t)),t.cancel(),t.pending=!0})},N.Controller_.prototype.handleMapContextMenu_=function(e){var t=this,r=this.map.getEventPixel(e),a=this.map.getCoordinateFromPixel(r),n=this.map.forEachFeatureAtPixel(r,function(e){var r=!1;return A.f(t.features.getArray(),e)&&(r=e),r},{hitTolerance:7});if(n=n||null){var o=this.ngeoFeatureHelper_.getType(n);o!==g.a.POLYGON&&o!==g.a.MULTI_POLYGON&&o!==g.a.LINE_STRING&&o!==g.a.MULTI_LINE_STRING||this.menu_.open(a),e.preventDefault(),e.stopPropagation()}},N.Controller_.prototype.handleGetFeatures_=function(e){var t=this;this.pending=!1,this.timeout_(function(){if(e.length){var r=e[0];t.feature=r,t.features.push(r)}},0)},N.Controller_.prototype.initializeInteractions_=function(){this.interactions_.forEach(function(e){e.setActive(!1),S.a.interaction(e)})},N.Controller_.prototype.registerInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.addInteraction(t)})},N.Controller_.prototype.unregisterInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.removeInteraction(t)})},N.Controller_.prototype.handleFeatureChange_=function(e,t){var r=this,a=void 0;t&&(P.c(t,"propertychange",this.handleFeaturePropertyChange_,this),a=t.getGeometry(),s.a.assert(a),P.c(a,"change",this.handleFeatureGeometryChange_,this),this.unregisterInteractions_()),e?(this.featureId=e.getId(),P.a(e,"propertychange",this.handleFeaturePropertyChange_,this),a=e.getGeometry(),s.a.assert(a),P.a(a,"change",this.handleFeatureGeometryChange_,this),this.registerInteractions_(),this.gmfSnapping_.ensureSnapInteractionsOnTop(),this.featureId&&this.timeout_(function(){r.dirty=!1,r.scope_.$apply()},0)):this.featureId=void 0},N.Controller_.prototype.handleFeaturePropertyChange_=function(){this.dirty=!0},N.Controller_.prototype.handleFeatureGeometryChange_=function(){this.dirty=!0,this.scope_.$apply()},N.Controller_.prototype.handleMenuActionClick_=function(e){switch(e.detail.action){case"move":this.translate_.setActive(!0),this.scope_.$apply();break;case"rotate":this.rotate_.setActive(!0),this.scope_.$apply()}},N.Controller_.prototype.handleTranslateEnd_=function(e){this.translate_.setActive(!1),this.scope_.$apply()},N.Controller_.prototype.handleRotateEnd_=function(e){this.rotate_.setActive(!1),this.scope_.$apply()},N.Controller_.prototype.handleDestroy_=function(){this.features.clear(),this.handleFeatureChange_(null,this.feature),this.feature=null;var e=E.c(this);this.ngeoEventHelper_.clearListenerKey(e),this.toggle_(!1),this.handleMapSelectActiveChange_(!1),this.unregisterInteractions_()},N.controller("GmfEditfeatureController",N.Controller_),N.State={IDLE:"idle",DEACTIVATE_EXECUTE:"deactivate_execute",DEACTIVATE_PENDING:"deactivate_pending",STOP_EDITING_EXECUTE:"stop_editing_execute",STOP_EDITING_PENDING:"stop_editing_pending"},t.a=N}).call(this,r(27))},,,,,,,,,function(e,t,r){"use strict";var a=r(106),n=r(33),o=r(161),i=function(e,t,r,a,n){this.$rootScope_=e,this.gmfThemes_=t,this.modeFlush=r,this.gmfTreeManager_=a,this.ngeoStateManager_=n,this.themeName_=""};i.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"],i.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"],i.prototype.addTheme=function(e,t){this.modeFlush?(this.ngeoStateManager_.updateState({theme:e.name}),this.setThemeName(e.name),this.gmfTreeManager_.setFirstLevelGroups(e.children)):this.gmfTreeManager_.addFirstLevelGroups(e.children,!1,t)},i.prototype.getThemeName=function(){return this.themeName_},i.prototype.isLoading=function(){return!this.gmfThemes_.loaded},i.prototype.setThemeName=function(e,t){this.themeName_=e,t||this.$rootScope_.$emit(i.EventType.THEME_NAME_SET,e)},i.prototype.removeAll=function(){this.gmfTreeManager_.removeAll()},i.EventType={THEME_NAME_SET:"gmf-thememanager-theme_name_set"},(i.module=angular.module("gmfThemeManager",[a.a.module.name,n.a.module.name,o.a.module.name])).value("gmfTreeManagerModeFlush",!0),i.module.service("gmfThemeManager",i),t.a=i},function(e,t,r){"use strict";var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inRange_=!1!==t.inRange,this.visible_=!0===t.visible,this.attributes=t.attributes||null,this.id_=t.id,this.identifierAttribute_=t.identifierAttribute,this.maxResolution_=t.maxResolution,this.minResolution_=t.minResolution,this.name_=t.name}return e.prototype.getAttributes=function(){return this.attributes},e.prototype.setAttributes=function(e){this.attributes=e},a(e,[{key:"inRange",get:function(){return this.inRange_},set:function(e){this.inRange_=e}},{key:"visible",get:function(){return this.visible_},set:function(e){this.visible_=e}},{key:"id",get:function(){return this.id_}},{key:"identifierAttribute",get:function(){return this.identifierAttribute_}},{key:"maxResolution",get:function(){return this.maxResolution_}},{key:"minResolution",get:function(){return this.minResolution_}},{key:"name",get:function(){return this.name_}},{key:"queryable",get:function(){return!1}},{key:"supportsDynamicInRange",get:function(){return null!==this.maxResolution||null!==this.minResolution}}]),e}();t.a=n},,function(e,t,r){"use strict";var a=r(26),n=r(34),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var i=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.operator=n.a.OperatorType.EQUAL_TO,r.type=a.a.SELECT;var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return o.choices_=r.choices,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),o(t,[{key:"choices",get:function(){return this.choices_}},{key:"selectedChoices",get:function(){var e=void 0;this.expression?e=String(this.expression).split(","):e=[];return e}}]),t}(n.a);t.a=i},,,,,,function(e,t,r){"use strict";var a=angular.module("ngeoDebounce",[]);a.factory_=function(e){return function(t,r,a){var n=null;return function(){for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];var l=this;null!==n&&e.cancel(n),n=e(function(){n=null,t.apply(l,i)},r,a)}}},a.factory_.$inject=["$timeout"],a.factory("ngeoDebounce",a.factory_),t.a=a},function(e,t,r){"use strict";var a=r(1),n=function(e){this.groups_={},this.scope_=e};n.$inject=["$rootScope"],n.$inject=["$rootScope"],n.prototype.registerTool=function(e,t,r){var n=this,o=this.groups_[e];o||(o=this.groups_[e]=[]);var i=this.scope_.$watch(t.getActive,function(r,a){r!==a&&(r?n.deactivateTools_(e,t):n.activateDefault_(e))});if(o.push({tool:t,defaultTool:r||!1,unlisten:i}),a.a.ENABLE_ASSERTS){var s=0;o.forEach(function(e){e.defaultTool&&s++}),a.a.assert(s<=1,"more than one default tool in group "+e)}},n.prototype.unregisterTool=function(e,t){var r=this.groups_[e];if(r)for(var a=0;a<r.length;a++)if(r[a].tool==t){r[a].unlisten(),r.splice(a,1);break}},n.prototype.unregisterGroup=function(e){var t=this.groups_[e];if(t){for(var r=0;r<t.length;r++)t[r].unlisten();delete this.groups_[e]}},n.prototype.activateTool=function(e){e.setActive(!0)},n.prototype.deactivateTool=function(e){e.setActive(!1)},n.prototype.deactivateTools_=function(e,t){for(var r=this.groups_[e],a=0;a<r.length;a++)t!=r[a].tool&&r[a].tool.setActive(!1)},n.prototype.activateDefault_=function(e){for(var t=this.groups_[e],r=null,a=!1,n=0;n<t.length;n++)a=a||t[n].tool.getActive(),t[n].defaultTool&&(r=t[n].tool);a||null===r||r.setActive(!0)},(n.module=angular.module("ngeoToolActivateMgr",[])).service("ngeoToolActivateMgr",n),t.a=n},function(e,t,r){"use strict";var a=angular.module("ngeoBtnComponent",[]);a.btnGroupComponent_=function(e){return{restrict:"A",controller:"ngeoBtnGroupController",link:function(t,r,a,n){var o=e(a.ngeoBtnGroupActive).assign;o&&t.$watch(function(){return n.buttons_.some(function(e){return!0===e(t)})},function(e){o(t,e)})}}},a.btnGroupComponent_.$inject=["$parse"],a.directive("ngeoBtnGroup",a.btnGroupComponent_),a.BtnGroupController=function(e){this.buttons_=[],this.scope_=e},a.BtnGroupController.$inject=["$scope"],a.BtnGroupController.prototype.activate=function(e){var t=this;this.buttons_.forEach(function(r,a){a!=e&&r.assign(t.scope_,!1)})},a.BtnGroupController.prototype.addButton=function(e){return this.buttons_.push(e),this.buttons_.length-1},a.controller("ngeoBtnGroupController",a.BtnGroupController),a.btnComponent_=function(e){return{require:["?^ngeoBtnGroup","ngModel"],restrict:"A",link:function(t,r,a,n){var o=n[0],i=n[1],s=-1,l=e(a.ngModel),u=l.assign;void 0===l(t)&&u(t,!1),null!==o&&(s=o.addButton(l)),r.on("click",function(){t.$apply(function(){i.$setViewValue(!i.$viewValue),i.$render()})}),i.$render=function(){i.$viewValue&&null!==o&&o.activate(s),r.toggleClass("active",i.$viewValue)}}}},a.btnComponent_.$inject=["$parse"],a.directive("ngeoBtn",a.btnComponent_),t.a=a},function(e,t,r){"use strict";var a=r(1),n=r(202),o=function(e,t){var r=this;this.initialState={},this.ngeoLocation=e,this.usedKeyRegexp=t,this.useLocalStorage_,this.setUseLocalStorage(!1);var n=e.getParamKeys().filter(function(e){return"debug"!=e&&"no_redirect"!=e});if(0===n.length){if(this.useLocalStorage_){var o=function(e){a.a.assert(e),r.usedKeyRegexp.some(function(t){if(e.match(t)){var a=window.localStorage[e];return r.initialState[e]=void 0!==a||null!==a?a:"",!0}})};for(var i in window.localStorage)o(i)}}else n.forEach(function(e){r.usedKeyRegexp.some(function(t){if(e.match(t)){var a=r.ngeoLocation.getParam(e);if(void 0!==a)return r.initialState[e]=a,!0}})})};o.$inject=["ngeoLocation","ngeoUsedKeyRegexp"],o.$inject=["ngeoLocation","ngeoUsedKeyRegexp"],o.prototype.setUseLocalStorage=function(e){if(this.useLocalStorage_=e,this.useLocalStorage_)try{"localStorage"in window?(window.localStorage.test="",delete window.localStorage.test):this.useLocalStorage_=!1}catch(e){console.error(e),this.useLocalStorage_=!1}return this.useLocalStorage_},o.prototype.getInitialValue=function(e){return this.initialState[e]},o.prototype.getInitialStringValue=function(e){var t=this.initialState[e];if(void 0!==t)return t},o.prototype.getInitialNumberValue=function(e){var t=this.initialState[e];if(void 0!==t)return parseFloat(t)},o.prototype.getInitialBooleanValue=function(e){var t=this.initialState[e];if(void 0!==t)return"true"===t},o.prototype.updateState=function(e){if(this.ngeoLocation.updateParams(e),this.useLocalStorage_)for(var t in e){a.a.assert(t);var r=e[t];a.a.assert(void 0!==r),window.localStorage[t]=r}},o.prototype.deleteParam=function(e){this.ngeoLocation.deleteParam(e),this.useLocalStorage_&&delete window.localStorage[e]},(o.module=angular.module("ngeoStateManager",[n.a.module.name])).service("ngeoStateManager",o),o.module.value("ngeoUsedKeyRegexp",[new RegExp(".*")]),t.a=o},,function(e,t,r){"use strict";var a=r(18),n={getDefaultDrawStyleFunction:function(){var e=Object(a.b)();return function(t,r){return e[t.getGeometry().getType()]}},getDefaultModifyStyleFunction:function(){var e=Object(a.b)();return function(t,r){return e.Point}}};t.a=n},function(e,t,r){"use strict";(function(e){var a=r(68);var n=function(t){function r(e,a,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,t.call(this));return s.$http_=e,s.$rootScope_=n,s.baseUrl_=o.replace(/\/$/,""),s.user_=i,s.noReloadRole_=a.has("gmfAuthenticationNoReloadRole")?a.get("gmfAuthenticationNoReloadRole"):null,s.load_(),s}return r.$inject=["$http","$injector","$rootScope","authenticationBaseUrl","gmfUser"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,t),r.prototype.load_=function(){var e=this.baseUrl_+"/"+r.RouteSuffix.IS_LOGGED_IN;this.$http_.get(e,{withCredentials:!0}).then(this.handleLogin_.bind(this,!0))},r.prototype.changePassword=function(t,a,n){var o=this,i=this.baseUrl_+"/"+r.RouteSuffix.CHANGE_PASSWORD;return this.$http_.post(i,e.param({oldPassword:t,newPassword:a,confirmNewPassword:n}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(e){o.user_.is_password_changed=!0,o.$rootScope_.$digest()}.bind(this))},r.prototype.login=function(t,a){var n=this.baseUrl_+"/"+r.RouteSuffix.LOGIN;return this.$http_.post(n,e.param({login:t,password:a}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(this.handleLogin_.bind(this,!1))},r.prototype.logout=function(){var e=this,t=this.user_.role_name===this.noReloadRole_,a=this.baseUrl_+"/"+r.RouteSuffix.LOGOUT;return this.$http_.get(a,{withCredentials:!0}).then(function(){e.resetUser_(t)})},r.prototype.resetPassword=function(t){var a=this.baseUrl_+"/"+r.RouteSuffix.RESET_PASSWORD,n=function(e){return e.data}.bind(this);return this.$http_.post(a,e.param({login:t}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(n)},r.prototype.getFunctionalities=function(){return this.user_.functionalities},r.prototype.getRoleId=function(){return this.user_.role_id},r.prototype.handleLogin_=function(e,t){var r=t.data;if(this.setUser_(r,!e),e){var n=new a.a("ready",{user:this.user_});this.dispatchEvent(n)}return t},r.prototype.setUser_=function(e,t){for(var r in e)this.user_[r]=e[r];if(t&&void 0!==e.username){var n=new a.a("login",{user:this.user_});this.dispatchEvent(n)}},r.prototype.resetUser_=function(e){for(var t in e=e||!1,this.user_)this.user_[t]=null;var r=new a.a("logout",{user:this.user_});this.dispatchEvent(r),e||this.load_()},r}(r(83).a);n.RouteSuffix={CHANGE_PASSWORD:"loginchange",IS_LOGGED_IN:"loginuser",LOGIN:"login",LOGOUT:"logout",RESET_PASSWORD:"loginresetpassword"},n.module=angular.module("gmfAuthenticationService",[]),n.module.service("gmfAuthenticationService",n),n.module.value("gmfUser",{functionalities:null,is_password_changed:null,role_id:null,role_name:null,username:null}),t.a=n}).call(this,r(27))},,function(e,t,r){"use strict";var a=function(){};a.prototype.createDate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==e?new Date(e):t},a.prototype.getTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e?e.getTime():t},a.prototype.getOptions=function(e){var t=this.createDate(e.minValue),r=this.createDate(e.maxValue),a=this.createDate(e.minDefValue,t),n=this.createDate(e.maxDefValue,r),o="range"===e.mode?[this.getTime(a),this.getTime(n)]:this.getTime(a);return{minDate:this.getTime(t),maxDate:this.getTime(r),values:o}},a.prototype.getUTCDate=function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())},(a.module=angular.module("ngeoTime",[])).service("ngeoTime",a),t.a=a},,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(163),o=r(68),i=r(3),s=r(37),l=r(2),u=r(36),c=r(235),h=r(187),p=r(50),g=r(45),d=r(24),f=r(102),m=r(93),y=function e(t){d.b.call(this,{handleDownEvent:e.handleDownEvent_,handleEvent:e.handleEvent_,handleUpEvent:e.handleUpEvent_}),this.downPx_=null,this.source_=void 0!==t.source?t.source:null,this.started_=!1,this.sketchFeature_=null,this.sketchPoint_=null,this.squaredClickTolerance_=4,this.sketchLayer_=new f.a({source:new m.b({useSpatialIndex:!1,wrapX:!1}),style:t.style||n.a.getDefaultDrawStyleFunction()}),l.a(this,"change:active",this.updateState_,this)};i.d(y,d.b),y.handleDownEvent_=function(e){return this.downPx_=e.pixel,!0},y.handleUpEvent_=function(e){var t=this.downPx_,r=e.pixel,a=t[0]-r[0],n=t[1]-r[1],o=!0;return a*a+n*n<=this.squaredClickTolerance_&&(this.handlePointerMove_(e),this.started_?this.finishDrawing_():this.startDrawing_(e),o=!1),o},y.handleEvent_=function(e){var t=!0;return"pointermove"===e.type?t=this.handlePointerMove_(e):"dblclick"===e.type&&(t=!1),d.c.call(this,e)&&t},y.prototype.handlePointerMove_=function(e){return this.started_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e),!0},y.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();if(null===this.sketchPoint_)this.sketchPoint_=new s.a(new g.a(t)),this.updateSketchFeatures_();else{var r=this.sketchPoint_.getGeometry();a.a.assertInstanceof(r,g.a),r.setCoordinates(t)}},y.prototype.updateSketchFeatures_=function(){var e=[];null!==this.sketchFeature_&&e.push(this.sketchFeature_),null!==this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.sketchLayer_.getSource();t.clear(!0),t.addFeatures(e)},y.prototype.startDrawing_=function(e){var t=e.coordinate;this.started_=!0;var r=new p.a([t.slice(),t.slice()]),n=new c.a(t,0),i=new h.a([r,n]);a.a.assert(void 0!==i),this.sketchFeature_=new s.a,this.sketchFeature_.setGeometry(i),this.updateSketchFeatures_();var l=new o.a("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(l)},y.prototype.modifyDrawing_=function(e){var t=e.coordinate,r=a.a.assertInstanceof(this.sketchFeature_.getGeometry(),h.a).getGeometriesArray(),n=r[0];a.a.assertInstanceof(n,p.a);var o=n.getCoordinates(),i=this.sketchPoint_.getGeometry();a.a.assertInstanceof(i,g.a),i.setCoordinates(t);var s=o[o.length-1];s[0]=t[0],s[1]=t[1],a.a.assertInstanceof(n,p.a),n.setCoordinates(o),a.a.assertInstanceof(r[1],c.a).setRadius(n.getLength()),this.updateSketchFeatures_()},y.prototype.abortDrawing_=function(){this.started_=!1;var e=this.sketchFeature_;return null!==e&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLayer_.getSource().clear(!0)),e},y.prototype.shouldStopEvent=u.a,y.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();null!==e&&t||this.abortDrawing_(),this.sketchLayer_.setMap(t?e:null)},y.prototype.finishDrawing_=function(){var e=this.abortDrawing_();a.a.assert(null!==e),null!==this.source_&&this.source_.addFeature(e);var t=new o.a("drawend",{feature:this.sketchFeature_});this.dispatchEvent(t)},y.prototype.setMap=function(e){d.b.prototype.setMap.call(this,e),this.updateState_()};var v=y,_=r(92),S=r(192),b=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_.a.call(this,r),this.continueMsg,void 0!==r.continueMsg?this.continueMsg=r.continueMsg:(this.continueMsg=document.createElement("span"),this.continueMsg.textContent="Click to finish."),this.numberFormat=a.a.assert(t),this.unitPrefixFormat=a.a.assert(e)};i.d(b,_.a),b.prototype.createDrawInteraction=function(e,t){return new v({source:t,style:e})},b.prototype.handleMeasure=function(e){var t=a.a.assertInstanceof(this.sketchFeature.getGeometry(),h.a),r=a.a.assertInstanceof(t.getGeometries()[0],p.a);e(b.getFormattedAzimutRadius(r,a.a.assertInstanceof(this.getMap().getView().getProjection(),S.a),this.decimals,this.precision,this.unitPrefixFormat,this.numberFormat),r.getLastCoordinate())},b.getFormattedAzimutRadius=function(e,t,r,a,n,o){var i=b.getFormattedAzimut(e,r,o);return i+=", "+_.a.getFormattedLength(e,t,a,n)},b.getFormattedAzimut=function(e,t,r){return r(b.getAzimut(e),t)+"°"},b.getAzimut=function(e){var t=e.getCoordinates(),r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],n=Math.acos(a/Math.sqrt(r*r+a*a));return(r>0?1:-1)*n*180/Math.PI%360};t.a=b},function(e,t,r){"use strict";var a=r(1),n=(r(283),angular.module("ngeoPopup",["ngSanitize"]));n.value("ngeoPopupTemplateUrl",function(e,t){var r=t.ngeoPopupTemplateurl;return void 0!==r?r:"ngeo/message/popupcomponent"}),n.run(["$templateCache",function(e){e.put("ngeo/message/popupcomponent",r(427))}]),n.directive_=function(e){return{restrict:"A",templateUrl:e,link:function(e,t,r){t.addClass("popover"),e.close=function(e){e&&(e.stopPropagation(),e.preventDefault()),t.addClass("hidden")},e.$watch("open",function(e,r){t.css("display",e?"block":"none")})}}},n.directive_.$inject=["ngeoPopupTemplateUrl"],n.directive("ngeoPopup",n.directive_);var o=n,i=function(e,t,r,a){var n=this;this.scope=t.$new(!0),this.scope.$watch(function(){return n.scope.open},function(e){!e&&n.autoDestroy_&&n.timeout_(function(){n.destroy()})}),this.sce_=r,this.timeout_=a,this.element_=angular.element("<div ngeo-popup></div>"),this.autoDestroy_=!1,e(this.element_)(this.scope),angular.element(document.body).append(this.element_)};i.prototype.getOpen=function(){return this.scope.open},i.prototype.setOpen=function(e){this.scope.open=e},i.prototype.destroy=function(){this.scope.$destroy(),this.element_.remove()},i.prototype.setTitle=function(e){var t=this.sce_.trustAsHtml(e);this.scope.title=t},i.prototype.setContent=function(e,t){this.scope.content=t?this.sce_.trustAsHtml(e):e},i.prototype.setUrl=function(e){var t=this.sce_.trustAsHtml('<iframe src="'+e+'" width="100%" height="100%"></iframe>');this.setContent(t)},i.prototype.setWidth=function(e){this.element_.width(e)},i.prototype.setHeight=function(e){this.element_.height(e)},i.prototype.setSize=function(e,t){this.setWidth(e),this.setHeight(t)},i.prototype.setAutoDestroy=function(e){this.autoDestroy_=e},i.prototype.addClass=function(e){this.element_.addClass(e)},i.prototype.open=function(e){e.url?this.setUrl(e.url):e.content?this.setContent(e.content):a.a.fail('ngeo.message.Popup options requirest "url" or "content".'),void 0!==e.autoDestroy&&this.setAutoDestroy(e.autoDestroy),void 0!==e.cls&&this.addClass(e.cls),void 0!==e.height&&this.setHeight(e.height),void 0!==e.title&&this.setTitle(e.title),void 0!==e.width&&this.setWidth(e.width),this.setOpen(!0)},(i.Factory=function(e,t,r,a){return function(){return new i(e,t,r,a)}}).$inject=["$compile","$rootScope","$sce","$timeout"],(i.module=angular.module("ngeoCreatePopup",[o.name])).factory("ngeoCreatePopup",i.Factory);t.a=i},function(e,t,r){"use strict";var a=r(2),n=function(e,t){this.manager_=e,this.features_=null,this.index_=t};n.prototype.addFeature=function(e){this.manager_.addFeature(e,this.index_)},n.prototype.removeFeature=function(e){this.manager_.removeFeature(e,this.index_)},n.prototype.clear=function(){this.manager_.clear(this.index_)},n.prototype.setFeatures=function(e){var t=this;null!==this.features_&&(this.features_.clear(),a.c(this.features_,"add",this.handleFeatureAdd_,this),a.c(this.features_,"remove",this.handleFeatureRemove_,this)),null!==e&&(e.forEach(function(e){t.addFeature(e)}),a.a(e,"add",this.handleFeatureAdd_,this),a.a(e,"remove",this.handleFeatureRemove_,this)),this.features_=e},n.prototype.setStyle=function(e){this.manager_.setStyle(e,this.index_)},n.prototype.handleFeatureAdd_=function(e){var t=e.element;this.addFeature(t)},n.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature(t)},n.module=angular.module("ngeoFeatureOverlay",[]),t.a=n},,function(e,t,r){"use strict";var a=r(1),n=r(267),o=r(26),i=r(3),s=r(130),l=function(){s.a.call(this)};i.d(l,s.a),l.prototype.read=function(e){return s.a.prototype.read.call(this,e)},l.prototype.readFromDocument=function(e){a.a.assert(e.nodeType==Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},l.prototype.readFromNode=function(e){a.a.assert(e.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT"),a.a.assert("schema"==e.localName,"localName should be schema");var t=e.getElementsByTagName("element");t.length||(t=e.getElementsByTagName("xsd:element"));for(var r=[],n=void 0,o=0,i=t.length;o<i;o++)(n=this.readFromElementNode_(t[o]))&&r.push(n);return r},l.prototype.readFromElementNode_=function(e){var t=e.getAttribute("name");a.a.assertString(t,"name should be defined in element node.");var r=e.getAttribute("alias"),i=e.getAttribute("nillable"),s={name:t,alias:r,required:!(!0===i||"true"===i)},l=e.getAttribute("type");if(l)n.a.setGeometryType(s,l)||this.setAttributeByXsdType_(s,l);else{var u=e.getElementsByTagName("enumeration");if(u.length||(u=e.getElementsByTagName("xsd:enumeration")),u.length){s.type=o.a.SELECT;for(var c=[],h=0,p=u.length;h<p;h++)c.push(u[h].getAttribute("value"));s.choices=c}else{var g=e.getElementsByTagName("restriction");if(g.length||(g=e.getElementsByTagName("xsd:restriction")),g.length&&g[0]){var d=g[0];this.setAttributeByXsdType_(s,d.getAttribute("base"));var f=e.getElementsByTagName("maxLength");f.length||(f=e.getElementsByTagName("xsd:maxLength")),f.length&&f[0]&&(s.maxLength=Number(f[0].getAttribute("value")))}}}return s.type?(a.a.assert(s.type),s):null},l.prototype.setAttributeByXsdType_=function(e,t){"xsd:boolean"===t?e.type=o.a.BOOLEAN:"xsd:date"===t?e.type=o.a.DATE:"xsd:dateTime"===t?e.type=o.a.DATETIME:"xsd:time"===t?e.type=o.a.TIME:"xsd:decimal"===t||"xsd:double"===t?(e.type=o.a.NUMBER,e.numType=l.NumberType.FLOAT):"xsd:integer"===t?(e.type=o.a.NUMBER,e.numType=l.NumberType.INTEGER):"xsd:string"===t&&(e.type=o.a.TEXT)},l.getGeometryAttribute=function(e){for(var t=null,r=0,a=e.length;r<a;r++)if(e[r].type===o.a.GEOMETRY){t=e[r];break}return t},l.NumberType={FLOAT:"float",INTEGER:"integer"},t.a=l},function(e,t,r){"use strict";var a=r(1),n=r(29),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dataSourcesCollection_=new n.b(t.dataSources),this.title_=t.title}return e.prototype.destroy=function(){this.dataSourcesCollection_.clear()},e.prototype.getDataSourceState=function(t){return t.visible?e.VisibilityState.ON:e.VisibilityState.OFF},e.prototype.addDataSource=function(e){this.dataSourcesCollection_.push(e)},e.prototype.removeDataSource=function(e){this.dataSourcesCollection_.remove(e)},e.prototype.toggleVisibilityState=function(){var t=this.visibilityState!==e.VisibilityState.ON,r=this.dataSources,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;i.visible!==t&&(i.visible=t)}},o(e,[{key:"dataSources",get:function(){return this.dataSourcesCollection_.getArray()}},{key:"dataSourcesCollection",get:function(){return this.dataSourcesCollection_}},{key:"title",get:function(){return this.title_}},{key:"visibilityState",get:function(){var t=void 0,r=this.dataSources,n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var s=i;if(void 0===t)t=this.getDataSourceState(s);else this.getDataSourceState(s)!==t&&(t=e.VisibilityState.INDETERMINATE);if(t===e.VisibilityState.INDETERMINATE)break}return a.a.assertString(t),t}}]),e}();i.VisibilityState={INDETERMINATE:"indeterminate",OFF:"off",ON:"on"},t.a=i},,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(150),o=r(137),i=r(267),s=r(26),l=r(182);var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.prototype.read=function(e){return e.map(this.readFromComplexTypeElement_)},e.prototype.readFromComplexTypeElement_=function(e){var t={name:a.a.assertString(e.name),alias:"alias"in e?a.a.assertString(e.alias):null,required:"0"!=e.minOccurs},r=a.a.assertString(e.type);return i.a.setGeometryType(t,r)||("gml:TimeInstantType"===r||"dateTime"===r?t.type=s.a.DATETIME:"date"===r?t.type=s.a.DATE:"time"===r?t.type=s.a.TIME:"decimal"===r||"double"===r?(t.type=s.a.NUMBER,t.numType=l.a.NumberType.FLOAT):"integer"===r||"long"===r?(t.type=s.a.NUMBER,t.numType=l.a.NumberType.INTEGER):t.type="boolean"===r?s.a.BOOLEAN:s.a.TEXT),t},e}(),c=r(195),h=r(2),p=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var g=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.q_=t,this.collection_=r.collection,this.ngeoQuerent_=a,this.cache_={},h.a(this.collection_,"add",this.handleDataSourcesAdd_,this),h.a(this.collection_,"remove",this.handleDataSourcesRemove_,this)}return e.$inject=["$q","ngeoDataSources","ngeoQuerent"],e.prototype.getDataSource=function(e){return this.cache_[e]||null},e.prototype.getDataSourceAttributes=function(e){var t=this.q_.defer();return e.attributes?t.resolve(e.attributes):this.ngeoQuerent_.wfsDescribeFeatureType(e).then(function(r){var n=e.getOGCLayerNames()[0];a.a.assertString(n,"The data source should have only one ogcLayer.");var o=r.element,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var c=l;if(c.name===n){var h=r.complexType,p=Array.isArray(h),g=0;for(h=p?h:h[Symbol.iterator]();;){var d;if(p){if(g>=h.length)break;d=h[g++]}else{if((g=h.next()).done)break;d=g.value}var f=d;if(f.name==c.type){var m=f.complexContent,y=(new u).read(m);e.setAttributes(y),t.resolve(y);break}}}}}),t.promise},e.prototype.handleDataSourcesAdd_=function(e){var t=a.a.assertInstanceof(e.element,n.a);this.cache_[t.id]=t},e.prototype.handleDataSourcesRemove_=function(e){var t=a.a.assertInstanceof(e.element,n.a);delete this.cache_[t.id]},p(e,[{key:"collection",get:function(){return this.collection_}}]),e}();g.module=angular.module("ngeoDataSourcesHelper",[o.a.module.name,c.a.module.name]),g.module.service("ngeoDataSourcesHelper",g);t.a=g},function(e,t,r){"use strict";var a=r(1),n=r(38),o=r(134),i=r(107),s=r(213),l=r(3),u=r(130),c=r(0),h=function(){u.a.call(this)};l.d(h,u.a),h.prototype.read,h.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},h.prototype.readFromNode=function(e){var t={};return t=c.u(t,h.PARSERS_,e,[])},h.readElement_=function(e,t){for(var r={},a=0,n=e.attributes.length;a<n;a++){var o=e.attributes.item(a);r[o.name]=o.value}return 1===t.length&&(r.type=r.type.split(":").pop()),r},h.readComplexType_=function(e,t){var r=e.getAttribute("name"),a=c.u({name:r},h.COMPLEX_TYPE_PARSERS_,e,t);return a.complexContent=a.complexContent.extension.sequence.element,a},h.readComplexContent_=function(e,t){return c.u({},h.COMPLEX_CONTENT_PARSERS_,e,t)},h.readExtension_=function(e,t){return c.u({},h.EXTENSION_PARSERS_,e,t)},h.readSequence_=function(e,t){return c.u({},h.SEQUENCE_PARSERS_,e,t)},h.NAMESPACE_URIS_=[null,"http://www.w3.org/2001/XMLSchema"],h.PARSERS_=a.a.assert(c.r(h.NAMESPACE_URIS_,{element:c.m(h.readElement_),complexType:c.m(h.readComplexType_)})),h.COMPLEX_TYPE_PARSERS_=a.a.assert(c.r(h.NAMESPACE_URIS_,{complexContent:c.n(h.readComplexContent_)})),h.COMPLEX_CONTENT_PARSERS_=a.a.assert(c.r(h.NAMESPACE_URIS_,{extension:c.n(h.readExtension_)})),h.EXTENSION_PARSERS_=a.a.assert(c.r(h.NAMESPACE_URIS_,{sequence:c.n(h.readSequence_)})),h.SEQUENCE_PARSERS_=a.a.assert(c.r(h.NAMESPACE_URIS_,{element:c.m(h.readElement_)}));var p=h,g=r(444),d=r(344),f=r(10),m=r(148),y=r(5),v=r(154);var _=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.http_=t,this.q_=r,this.ngeoRuleHelper_=a,this.ngeoWMSTime_=n,this.requestCancelers_=[],this.wmsGetCapabilitiesPromises_={},this.wmtsGetCapabilitiesPromises_={}}return e.$inject=["$http","$q","ngeoRuleHelper","ngeoWMSTime"],e.prototype.issue=function(e){var t=[],r=e.map;this.cancelStillRunningRequests_();var n=void 0;if(e.queryableDataSources)n=e.queryableDataSources;else{var o=e.dataSources;a.a.assert(o,"DataSources should be set"),n=this.getQueryableDataSources(o,r)}var i=this.getCombinableWFSDataSources_(n.wfs);if(t.push(this.issueCombinedWFS_(i,e)),e.coordinate){var s=this.getCombinableWMSDataSources_(n.wms);t.push(this.issueCombinedWMS_(s,e))}return this.q_.all(t).then(this.handleCombinedQueryResult_.bind(this))},e.prototype.getQueryableDataSources=function(e,t){var r={wfs:[],wms:[]},o=a.a.assertNumber(t.getView().getResolution()),i=e,s=Array.isArray(i),l=0;for(i=s?i:i[Symbol.iterator]();;){var u;if(s){if(l>=i.length)break;u=i[l++]}else{if((l=i.next()).done)break;u=l.value}var c=u;this.isDataSourceQueryable_(c,o)&&(c instanceof n.a&&(c.supportsWFS?r.wfs.push(c):r.wms.push(c)))}return r},e.prototype.wfsDescribeFeatureType=function(e){a.a.assert(e.supportsAttributes,"The data source must support WFS, have a single OGCLayer that\n      is queryable in order to issue WFS DescribeFeatureType requests");var t=e.getOGCLayerNames(),r=m.a(a.a.assertString(e.wfsUrl),{REQUEST:"DescribeFeatureType",SERVICE:"WFS",VERSION:"2.0.0",TYPENAME:t});return this.http_.get(r).then(function(e){return(new p).read(e.data)})},e.prototype.wmsFindLayerCapability=function(e,t){var r=null,a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.Name===t){r=s;break}if(s.Layer&&(r=this.wmsFindLayerCapability(s.Layer,t)))break}return r},e.prototype.wmsGetCapabilities=function(e,t){var r=!1!==t,n=m.a(e,{REQUEST:"GetCapabilities",SERVICE:"WMS",VERSION:"1.3.0"}),o=void 0;return r&&this.wmsGetCapabilitiesPromises_[e]?r&&this.wmsGetCapabilitiesPromises_[e]&&(o=this.wmsGetCapabilitiesPromises_[e]):o=this.http_.get(n).then(function(e){return(new g.a).read(e.data)}),a.a.assert(o),r&&!this.wmsGetCapabilitiesPromises_[e]&&(this.wmsGetCapabilitiesPromises_[e]=o),o},e.prototype.wmtsFindLayerCapability=function(e,t){var r=null,a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.Identifier===t){r=s;break}}return r},e.prototype.wmtsGetCapabilities=function(e,t){var r=!1!==t,n=void 0;return r&&this.wmtsGetCapabilitiesPromises_[e]?r&&this.wmtsGetCapabilitiesPromises_[e]&&(n=this.wmtsGetCapabilitiesPromises_[e]):n=this.http_.get(e).then(function(e){return(new d.a).read(e.data)}),a.a.assert(n),r&&!this.wmtsGetCapabilitiesPromises_[e]&&(this.wmtsGetCapabilitiesPromises_[e]=n),n},e.prototype.handleCombinedQueryResult_=function(e){var t={},r=e,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;for(var s in i){var l=Number(s);t[l]=i[l]}}return t},e.prototype.handleQueryResult_=function(e,t,r,a){var o={},i=e,s=Array.isArray(i),l=0;for(i=s?i:i[Symbol.iterator]();;){var u;if(s){if(l>=i.length)break;u=i[l++]}else{if((l=i.next()).done)break;u=l.value}var c=u,h=void 0,p=void 0,g=void 0;"number"==typeof a?(h=[],p=!0,g=a):h=c instanceof n.a?this.readAndTypeFeatures_(c,a.data,r):[];var d=c.id;this.setUniqueIds_(h,c.id),o[d]={features:h,limit:t,tooManyFeatures:p,totalFeatureCount:g}}return o},e.prototype.readAndTypeFeatures_=function(e,t,r){var a=this,n=[],o=void 0,i=this.getSetOlFormatTypes_(e,r).slice();return i.forEach(function(i){a.getSetOlFormatTypes_(e,r,[i]),(o=r?e.wfsFormat.readFeatures(t):e.wmsFormat.readFeatures(t)).length>0&&o.forEach(function(e){e.set("ngeo_feature_type_",i),n.push(e)})}),this.getSetOlFormatTypes_(e,r,i),n},e.prototype.getSetOlFormatTypes_=function(e,t,r){var a=void 0;return t?(r&&e.wfsFormat.setFeatureType(r),a=e.wfsFormat.getFeatureType()):(r&&e.wmsFormat.setLayers(r),a=e.wmsFormat.getLayers()),a?Array.isArray(a)?a:[a]:[]},e.prototype.issueCombinedWFS_=function(e,t){var r=this,n=[],o=a.a.assertNumber(t.limit),i=t.map.getView(),l=a.a.assertNumber(i.getResolution()),u=i.getProjection().getCode(),c=!0===t.wfsCount,h=void 0,p=t.coordinate;if(p){var g=t.tolerancePx;a.a.assert(g);var d=g*l;h=y.c(y.m(p),d)}else h=t.extent;var m=new s.a,v=new XMLSerializer,_=function(e){var i=void 0,s=void 0,p=[],g=void 0,d={},y=e,_=Array.isArray(y),S=0;for(y=_?y:y[Symbol.iterator]();;){var b;if(_){if(S>=y.length)break;b=y[S++]}else{if((S=y.next()).done)break;b=S.value}var C=b;if(!i){s=C.wfsFeatureNS;var w=C.wfsFeaturePrefix,T=C.geometryName,E=C.wfsOutputFormat;i={bbox:h,featureNS:s,featurePrefix:w,geometryName:T,outputFormat:E,srsName:u},g=C.wfsUrl,f.a(d,C.activeDimensions)}p=p.concat(C.getInRangeOGCLayerNames(l,!0));var A=void 0;t.filter?A=r.ngeoRuleHelper_.createFilter({dataSource:C,filter:t.filter,incDimensions:!0,incTime:!0}):(C.filterRules&&C.filterRules.length||C.timeRangeValue||C.dimensionsFiltersConfig&&Object.keys(C.dimensionsFiltersConfig).length>0)&&(a.a.assert(1===e.length,"A data source having filterRules or timeRangeValue should issue\n            a single query, alone."),A=r.ngeoRuleHelper_.createFilter({dataSource:C,incDimensions:!0,incTime:!0,srsName:u})),A&&(i.filter=A)}a.a.assert(i),i.featureTypes=p,a.a.assert(g);var L=r.q_.defer();n.push(L.promise.then(r.handleQueryResult_.bind(r,e,o,!0)));var P=void 0;if(c){var M=f.a({resultType:"hits"},i),F=m.writeGetFeature(M),x=v.serializeToString(F),R=r.registerCanceler_();P=r.http_.post(g,x,{params:d,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:R.promise}).then(function(t){return e[0].wfsFormat.readFeatureCollectionMetadata(t.data).numberOfFeatures}.bind(r))}else P=r.q_.resolve();P.then(function(e){if(void 0===e||e<o){var t=f.a({maxFeatures:o},i),n=m.writeGetFeature(t),s=v.serializeToString(n);a.a.assertString(g);var l=r.registerCanceler_();r.http_.post(g,s,{params:d,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:l.promise}).then(function(e){L.resolve(e)})}else L.resolve(e)})},S=e,b=Array.isArray(S),C=0;for(S=b?S:S[Symbol.iterator]();;){var w;if(b){if(C>=S.length)break;w=S[C++]}else{if((C=S.next()).done)break;w=C.value}_(w)}return this.q_.all(n).then(this.handleCombinedQueryResult_.bind(this))},e.prototype.issueCombinedWMS_=function(e,t){var r=[],n=a.a.assertNumber(t.limit),o=t.map.getView(),i=a.a.assertNumber(o.getResolution()),s=o.getProjection().getCode(),l=t.coordinate;a.a.assert(l);var u=e,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}var g=p,d=void 0,m=[],y=void 0,_=!1,S={},b=null,C=null,w=g,T=Array.isArray(w),E=0;for(w=T?w:w[Symbol.iterator]();;){var A;if(T){if(E>=w.length)break;A=w[E++]}else{if((E=w.next()).done)break;A=E.value}var L=A;y||(y=L.wmsInfoFormat,d=L.wmsUrl),m=m.concat(L.getInRangeOGCLayerNames(i,!0)),_||(f.a(S,L.activeDimensions),_=!0),L.filterRules&&L.filterRules.length&&(a.a.assert(1===g.length),C=L.getFiltrableOGCLayerName(),b=this.ngeoRuleHelper_.createFilterString({dataSource:L,srsName:s})),null!==L.timeRangeValue&&L.timeProperty&&(a.a.assert(1===g.length),S.TIME=this.ngeoWMSTime_.formatWMSTimeParam(L.timeProperty,L.timeRangeValue))}if(S.LAYERS=m,S.QUERY_LAYERS=m,b&&C){var P=null;if(1===m.length)P=b;else{for(var M=[],F=0,x=m.length;F<x;F++)m[F]===C?M.push("("+b+")"):M.push("()");P=M.join("")}S.FILTER=P}a.a.assert(d);var R=new v.a({params:S,url:d}),D=a.a.assertString(R.getGetFeatureInfoUrl(l,i,s,{FEATURE_COUNT:n,INFO_FORMAT:y})),k=this.registerCanceler_();r.push(this.http_.get(D,{timeout:k.promise}).then(this.handleQueryResult_.bind(this,g,n,!1)))}return this.q_.all(r).then(this.handleCombinedQueryResult_.bind(this))},e.prototype.getCombinableWFSDataSources_=function(e){var t=[],r=[],a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.combinableForWFS){var l=!1,u=t,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}var g=p;s.combinableWithDataSourceForWFS(g[0])&&(g.push(s),l=!0)}l||t.push([s])}else r.push([s])}return t.concat(r)},e.prototype.getCombinableWMSDataSources_=function(e){var t=[],r=[],a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.combinableForWMS){var l=!1,u=t,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}var g=p;s.combinableWithDataSourceForWMS(g[0])&&(g.push(s),l=!0)}l||t.push([s])}else r.push([s])}return t.concat(r)},e.prototype.isDataSourceQueryable_=function(e,t){var r=e.visible&&e.inRange&&e.queryable;r&&e instanceof n.a&&(r=e.isAnyOGCLayerInRange(t,!0));return r},e.prototype.setUniqueIds_=function(e,t){e.forEach(function(e){if(void 0!==e.getId()){var r=t+"_"+e.getId();e.setId(r)}})},e.prototype.registerCanceler_=function(){var e=this.q_.defer();return this.requestCancelers_.push(e),e},e.prototype.cancelStillRunningRequests_=function(){var e=this.requestCancelers_,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}a.resolve()}this.requestCancelers_.length=0},e}();_.CombinedDataSources,_.module=angular.module("ngeoQuerent",[o.a.module.name,i.a.module.name]),_.module.service("ngeoQuerent",_);t.a=_},,function(e,t,r){"use strict";var a=r(106),n=r(33),o=r(1),i=r(87),s=r(3),l=r(2),u=r(29),c=r(213),h=r(336),p=function(e,t,r,a,n,o){this.http_=e,this.q_=t,this.rootScope_=r,this.timeout_=a,this.gmfThemes_=n,this.gmfTreeManager_=o,this.cache_={},this.listenerKeys_=[],this.map_=null,this.mapViewChangePromise_=null,this.ogcServers_=null};p.$inject=["$http","$q","$rootScope","$timeout","gmfThemes","gmfTreeManager"],p.$inject=["$http","$q","$rootScope","$timeout","gmfThemes","gmfTreeManager"],p.prototype.ensureSnapInteractionsOnTop=function(){var e=this.map_;o.a.assert(e);var t=void 0;for(var r in this.cache_)(t=this.cache_[+r]).active&&(o.a.assert(t.interaction),e.removeInteraction(t.interaction),e.addInteraction(t.interaction))},p.prototype.setMap=function(e){var t=this,r=this.listenerKeys_;this.map_&&(this.treeCtrlsUnregister_(),this.unregisterAllTreeCtrl_(),r.forEach(l.e),r.length=0),this.map_=e,e&&(this.treeCtrlsUnregister_=this.rootScope_.$watchCollection(function(){if(t.gmfTreeManager_.rootCtrl)return t.gmfTreeManager_.rootCtrl.children},function(e){t.timeout_(function(){e&&(t.unregisterAllTreeCtrl_(),t.gmfTreeManager_.rootCtrl.traverseDepthFirst(t.registerTreeCtrl_.bind(t)))},0)}),r.push(l.a(this.gmfThemes_,"change",this.handleThemesChange_,this),l.a(e,"moveend",this.handleMapMoveEnd_,this)))},p.prototype.handleThemesChange_=function(){var e=this;this.ogcServers_=null,this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t})},p.prototype.registerTreeCtrl_=function(e){var t=e.node;if(!t.children){t=e.node;var r=n.a.getSnappingConfig(t);if(r){var a=this.getWFSConfig_(e);if(a){var o=s.c(e),i=this.rootScope_.$watch(function(){return e.getState()},this.handleTreeCtrlStateChange_.bind(this,e));this.cache_[o]={active:!1,featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",features:new u.b,geometryName:"geom",interaction:null,maxFeatures:50,requestDeferred:null,snappingConfig:r,treeCtrl:e,wfsConfig:a,stateWatcherUnregister:i},this.handleTreeCtrlStateChange_(e,e.getState())}}}},p.prototype.unregisterAllTreeCtrl_=function(){for(var e in this.cache_){var t=this.cache_[+e];t&&(t.stateWatcherUnregister(),this.deactivateItem_(t),delete this.cache_[+e])}},p.prototype.getWFSConfig_=function(e){if(null===this.ogcServers_)return null;var t=e.node;if(t.type!==n.a.NodeType.WMS)return null;for(var r=t,a=[],s=0,l=r.childLayers.length;s<l;s++)r.childLayers[s].queryable&&a.push(r.childLayers[s].name);if(!a.length)return null;var u=void 0;e.parent.node.mixed?u=r.ogcServer:u=i.a.getFirstParentTree(e).node.ogcServer;if(!u)return null;var c=this.ogcServers_[u];if(!c.wfsSupport)return null;var h=c.urlWfs;return o.a.assert(h,"urlWfs should be defined."),{featureTypes:a.join(","),url:h}},p.prototype.handleTreeCtrlStateChange_=function(e,t){var r=s.c(e),a=this.cache_[r];"on"===t?this.activateItem_(a):this.deactivateItem_(a)},p.prototype.activateItem_=function(e){if(!e.active){var t=this.map_;o.a.assert(t);var r=new h.a({edge:e.snappingConfig.edge,features:e.features,pixelTolerance:e.snappingConfig.tolerance,vertex:e.snappingConfig.vertex});t.addInteraction(r),e.interaction=r,e.active=!0,this.loadItemFeatures_(e)}},p.prototype.deactivateItem_=function(e){if(e.active){var t=this.map_;o.a.assert(t);var r=e.interaction;t.removeInteraction(r),e.interaction=null,e.features.clear(),e.requestDeferred&&(e.requestDeferred.resolve(),e.requestDeferred=null),e.active=!1}},p.prototype.loadAllItems_=function(){this.mapViewChangePromise_=null;var e=void 0;for(var t in this.cache_)(e=this.cache_[+t]).active&&this.loadItemFeatures_(e)},p.prototype.refresh=function(){this.loadAllItems_()},p.prototype.loadItemFeatures_=function(e){e.requestDeferred&&e.requestDeferred.resolve();var t=this.map_;o.a.assert(t);var r=t.getView(),a=t.getSize();o.a.assert(a);var n=r.calculateExtent(a),i=r.getProjection().getCode(),s=e.wfsConfig.featureTypes.split(","),l={srsName:i,featureNS:e.featureNS,featurePrefix:e.featurePrefix,featureTypes:s,outputFormat:"GML3",bbox:n,geometryName:e.geometryName,maxFeatures:e.maxFeatures},u=new c.a,h=new XMLSerializer,p=u.writeGetFeature(l),g=h.serializeToString(p),d=e.wfsConfig.url;e.requestDeferred=this.q_.defer(),this.http_.post(d,g,{timeout:e.requestDeferred.promise}).then(function(t){e.requestDeferred=null,e.features.clear();var r=(new c.a).readFeatures(t.data);r&&e.features.extend(r)})},p.prototype.handleMapMoveEnd_=function(){this.mapViewChangePromise_&&this.timeout_.cancel(this.mapViewChangePromise_),this.mapViewChangePromise_=this.timeout_(this.loadAllItems_.bind(this),400)},(p.module=angular.module("gmfSnapping",[a.a.module.name,n.a.module.name,i.a.module.name])).service("gmfSnapping",p),t.a=p},function(e,t,r){"use strict";var a=r(1),n=r(3),o=r(5),i=r(37),s=r(2),l=r(97),u=r(50),c=r(45),h=r(47),p=r(233),g=r(102),d=r(93),f=function(e){this.listenerKeys_=[],this.featureListenerKeys_={},this.keyPressListenerKey_=null,this.myFeatures_=void 0!==e.features?e.features:null,this.vectorSource_=new d.b({useSpatialIndex:!1}),this.vectorLayer_=new g.a({source:this.vectorSource_,style:e.style,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.centerFeatures_={},p.a.call(this,e)};n.d(f,p.a),f.prototype.setActive=function(e){this.keyPressListenerKey_&&(s.e(this.keyPressListenerKey_),this.keyPressListenerKey_=null),p.a.prototype.setActive.call(this,e),e&&(this.keyPressListenerKey_=s.a(document,"keyup",this.handleKeyUp_,this)),this.setState_()},f.prototype.setMap=function(e){this.getMap()&&this.vectorLayer_.setMap(null),p.a.prototype.setMap.call(this,e),e&&this.vectorLayer_.setMap(e),this.setState_()},f.prototype.setState_=function(){var e=this,t=this.getMap(),r=this.getActive(),a=this.myFeatures_,n=this.listenerKeys_;if(t&&r&&a)a.forEach(function(t){return e.addFeature_(t)}),n.push(s.a(a,"add",this.handleFeaturesAdd_,this),s.a(a,"remove",this.handleFeaturesRemove_,this));else{if(t)t.getTargetElement().style.cursor="default";n.forEach(s.e),n.length=0,a.forEach(function(t){return e.removeFeature_(t)})}},f.prototype.handleFeaturesAdd_=function(e){var t=e.element;a.a.assertInstanceof(t,i.a,"feature should be an ol.Feature"),this.addFeature_(t)},f.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)},f.prototype.addFeature_=function(e){var t=n.c(e),r=e.getGeometry();a.a.assertInstanceof(r,l.a),this.featureListenerKeys_[t]=s.a(r,"change",this.handleGeometryChange_.bind(this,e),this);var o=this.getGeometryCenterPoint_(r),u=new i.a(o);this.centerFeatures_[t]=u,this.vectorSource_.addFeature(u)},f.prototype.removeFeature_=function(e){var t=n.c(e);this.featureListenerKeys_[t]&&(s.e(this.featureListenerKeys_[t]),delete this.featureListenerKeys_[t],this.vectorSource_.removeFeature(this.centerFeatures_[t]),delete this.centerFeatures_[t])},f.prototype.handleGeometryChange_=function(e,t){var r=t.target;a.a.assertInstanceof(r,l.a);var o=this.getGeometryCenterPoint_(r),i=n.c(e);this.centerFeatures_[i].setGeometry(o)},f.prototype.getGeometryCenterPoint_=function(e){var t=void 0,r=void 0;if(e instanceof h.a)r=e.getInteriorPoint();else if(e instanceof u.a)t=e.getCoordinateAt(.5);else{var n=e.getExtent();t=o.x(n)}return!r&&t&&(r=new c.a(t)),a.a.assert(r,"Point should be thruthy"),r},f.prototype.handleKeyUp_=function(e){27===e.keyCode&&this.setActive(!1)},t.a=f},function(e,t,r){"use strict";var a=r(1),n=r(163),o=r(68),i=r(3),s=r(5),l=r(37),u=r(2),c=r(24),h=r(97),p=r(45),g=r(50),d=r(47),f=r(102),m=r(93),y=function(e){a.a.assert(e.features),this.listenerKeys_=[],this.modified_=!1,this.keyPressListenerKey_=null,this.changingFeature_=!1,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.features_=e.features,this.feature_=null,this.coordinate_=null,this.centerCoordinate_=null,this.overlay_=new f.a({source:new m.b({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style||n.a.getDefaultModifyStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.centerFeatures_={},c.b.call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_})};i.d(y,c.b),y.prototype.setActive=function(e){var t=this;this.keyPressListenerKey_&&(u.e(this.keyPressListenerKey_),this.keyPressListenerKey_=null),c.b.prototype.setActive.call(this,e),e?(this.keyPressListenerKey_=u.a(document,"keyup",this.handleKeyUp_,this),this.features_.forEach(function(e){return t.addFeature_(e)}),this.listenerKeys_.push(u.a(this.features_,"add",this.handleFeatureAdd_,this),u.a(this.features_,"remove",this.handleFeatureRemove_,this))):(this.listenerKeys_.forEach(u.e),this.listenerKeys_.length=0,this.features_.forEach(function(e){return t.removeFeature_(e)}))},y.prototype.addFeature_=function(e){var t=e.getGeometry();a.a.assertInstanceof(t,h.a),e.set("angle",0);var r=i.c(e),n=new p.a(this.getCenterCoordinate_(t)),o=new l.a(n);this.centerFeatures_[r]=o,this.overlay_.getSource().addFeature(o)},y.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=!0;var t=new o.a("modifystart",{features:this.features_});this.dispatchEvent(t)}},y.prototype.removeFeature_=function(e){if(this.feature_=null,e){var t=i.c(e);this.centerFeatures_[t]&&(this.overlay_.getSource().removeFeature(this.centerFeatures_[t]),delete this.centerFeatures_[t])}},y.prototype.setMap=function(e){this.overlay_.setMap(e),c.b.prototype.setMap.call(this,e)},y.prototype.handleFeatureAdd_=function(e){var t=e.element;a.a.assertInstanceof(t,l.a,"feature should be an ol.Feature"),this.addFeature_(t)},y.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},y.prototype.handleDown_=function(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e},void 0);if(t){var r=!1;this.features_.forEach(function(e){i.c(e)==i.c(t)&&(r=!0)}),r||(t=null)}if(t){this.coordinate_=e.coordinate,this.feature_=t;var a=this.feature_.getGeometry();return void 0!==a&&(this.centerCoordinate_=this.getCenterCoordinate_(a)),!0}return!1},y.prototype.getCenterCoordinate_=function(e){var t=void 0;if(e instanceof g.a)t=e.getFlatMidpoint();else if(e instanceof d.a)t=e.getFlatInteriorPoint();else{var r=e.getExtent();t=s.x(r)}return t},y.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_.getGeometry(),r=this.coordinate_[0],a=this.coordinate_[1],n=this.centerCoordinate_[0],o=this.centerCoordinate_[1],i=r-n,s=a-o,l=e.coordinate[0]-n,u=e.coordinate[1]-o;this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1];var c=Math.atan2(u,l),h=Math.atan2(s,i)-c;t.rotate(-h,[n,o])},y.prototype.handleUp_=function(e){if(this.modified_){var t=new o.a("rotateend",{feature:this.feature_});this.dispatchEvent(t),this.modified_=!1,this.setActive(!1)}return!1},y.prototype.handleKeyUp_=function(e){27===e.keyCode&&this.setActive(!1)},t.a=y},function(e,t,r){"use strict";var a=r(29),n=angular.module("ngeoFeatures",[]);n.value("ngeoFeatures",new a.b),t.a=n},function(e,t,r){"use strict";(function(e){var a=r(1),n=r(68),o=r(3),i=r(2),s=r(126),l=r(100),u=function(t,r){var a=this,n=void 0!==r?r:{};n.positioning=l.a.TOP_LEFT,this.listenerKeys_=[],this.clickOutListenerKey_=null;var o=e("<div/>",{class:"panel panel-default"});if(this.autoClose_=void 0===t.autoClose||t.autoClose,t.title){var i=e("<div>",{class:"panel-heading"}).appendTo(o);e("<span>",{text:t.title}).appendTo(i)}var u=e("<div>",{class:"list-group"}).appendTo(o);this.actions_=[],t.actions.forEach(function(t){a.actions_.push(e("<button>",{class:"list-group-item","data-name":t.name,text:[" ",void 0!==t.label?t.label:t.name].join("")}).appendTo(u).prepend(e("<span>",{class:void 0!==t.cls?t.cls:""})))}),n.element=o[0],s.a.call(this,n)};o.d(u,s.a),u.prototype.setMap=function(e){var t=this;this.getMap()&&(this.listenerKeys_.forEach(i.e),this.listenerKeys_.length=0),s.a.prototype.setMap.call(this,e),e&&(this.actions_.forEach(function(e){var r=e.data();t.listenerKeys_.push(i.a(e[0],"click",t.handleActionClick_.bind(t,r.name)))}),this.listenerKeys_.push(i.a(e,"pointermove",this.handleMapPointerMove_,this)))},u.prototype.open=function(e){this.setPosition(e),this.autoClose_&&(this.clickOutListenerKey_=i.a(document.documentElement,"mousedown",this.handleClickOut_,this))},u.prototype.close=function(){this.setPosition(void 0),null!==this.clickOutListenerKey_&&i.e(this.clickOutListenerKey_)},u.prototype.handleActionClick_=function(e,t){this.dispatchEvent(new n.a("actionclick",{action:e})),this.autoClose_&&this.close(),t.stopPropagation()},u.prototype.handleClickOut_=function(t){var r=this.getElement();r&&0===e(t.target).closest(r).length&&this.close()},u.prototype.handleMapPointerMove_=function(e){var t=e.originalEvent.target;a.a.assertInstanceof(t,Element);var r=this.getElement();a.a.assertInstanceof(r,Element),r.contains(t)&&(e.coordinate=[1/0,1/0],e.pixel=[1/0,1/0])},t.a=u}).call(this,r(27))},function(e,t,r){"use strict";var a=r(1),n=r(62),o=function(e,t){this.history_=t,this.schema_=e.protocol.substring(0,e.protocol.length-1),this.domain_=e.hostname,this.port_=e.port?parseInt(e.port,10):void 0,this.path_=e.pathname,this.queryData_=n.a.decodeQueryString(e.search),this.fragment_=n.a.decodeQueryString(e.hash)};o.replaceState=function(e,t){try{e.replaceState(null,"",t)}catch(e){}},o.prototype.getPath=function(){return this.path_},o.prototype.getUriString=function(){var e=[];this.schema_&&e.push(this.schema_,":"),(this.domain_||"file"===this.schema_)&&(e.push("//"),e.push(this.domain_),void 0!==this.port_&&e.push(":",String(this.port_))),this.path_&&(this.domain_&&"/"!==this.path_.charAt(0)&&e.push("/"),e.push(this.path_));var t=n.a.encodeQueryString(this.queryData_);t.length>0&&e.push("?",t);var r=n.a.encodeQueryString(this.fragment_);return r.length>0&&e.push("#",r),e.join("")},o.prototype.hasParam=function(e){return e in this.queryData_},o.prototype.hasFragmentParam=function(e){return e in this.fragment_},o.prototype.getParam=function(e){return this.queryData_[e]},o.prototype.getFragmentParam=function(e){return this.fragment_[e]},o.prototype.getParamAsInt=function(e){var t=this.getParam(e);if(void 0!==t){a.a.assertString(t);var r=parseInt(t,10);return isNaN(r)?void 0:r}},o.prototype.getParamAsFloat=function(e){var t=this.getParam(e);if(void 0!==t){a.a.assertString(t);var r=parseFloat(t);return isNaN(r)?void 0:r}},o.prototype.getFragmentParamAsInt=function(e){var t=this.getFragmentParam(e);if(void 0!==t){a.a.assertString(t);var r=parseInt(t,10);return isNaN(r)?void 0:r}},o.prototype.getParamKeys=function(){var e=[];for(var t in this.queryData_)e.push(t);return e},o.prototype.getFragmentParamKeys=function(){var e=[];for(var t in this.fragment_)e.push(t);return e},o.prototype.getParamKeysWithPrefix=function(e){var t=[];for(var r in this.queryData_)0==r.indexOf(e)&&t.push(r);return t},o.prototype.getFragmentParamKeysWithPrefix=function(e){var t=[];for(var r in this.fragment_)0==r.indexOf(e)&&t.push(r);return t},o.prototype.updateParams=function(e){for(var t in e)this.queryData_[t]=e[t]},o.prototype.updateFragmentParams=function(e){for(var t in e)this.fragment_[t]=e[t]},o.prototype.deleteParam=function(e){delete this.queryData_[e]},o.prototype.deleteFragmentParam=function(e){delete this.fragment_[e]},o.prototype.refresh=function(){o.replaceState(this.history_,this.getUriString())},o.prototype.setPath=function(e){this.path_=e},(o.LocationFactory=function(e,t){var r=t.history,a=new o(t.location,t.history),n=a.getUriString();return e.$watch(function(){var t=a.getUriString();n!==t&&e.$evalAsync(function(){n=t,void 0!==r&&void 0!==r.replaceState&&o.replaceState(r,t),e.$broadcast("ngeoLocationChange")})}),a}).$inject=["$rootScope","$window"],(o.MockProvider=function(e){e.$get=function(){return{absUrl:function(){return""},hash:function(e){return void 0!==e?this:""},host:function(){return""},path:function(e){return void 0!==e?this:""},port:function(){return 0},protocol:function(){return""},replace:function(){},search:function(e,t){return void 0!==e?this:{}},url:function(e){return""}}}}).$inject=["$locationProvider"],(o.module=angular.module("ngeoLocation",[])).factory("ngeoLocation",o.LocationFactory),t.a=o},function(e,t,r){"use strict";var a=r(62),n=r(343),o=angular.module("ngeoDownload",[]);o.factory_=function(){return function(e,t,r){var o=void 0===r||a.a.isSafari()?"text/plain;charset=utf-8":r,i=new Blob([e],{type:o});Object(n.saveAs)(i,t)}},o.factory("ngeoDownload",o.factory_),t.a=o},,function(e,t,r){"use strict";var a={};a.module=angular.module("gmfDataSourceBeingFiltered",[]),a.module.value("gmfDataSourceBeingFiltered",{dataSource:null}),t.a=a},function(e,t,r){"use strict";r(308),r(435);var a=r(1);var n=angular.module("ngeoModal",[]);n.component_={template:'<div class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <ng-transclude></ng-transclude>\n      </div>\n    </div>\n  </div>',require:{ngModel:"ngModel"},transclude:!0,controller:"ngeoModalController",bindings:{resizable:"<ngeoModalResizable",closable:"<ngeoModalClosable"}},n.component("ngeoModal",n.component_),n.Controller_=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$element_=r,this.$scope_=t,this.modal_,this.closable,this.resizable,this.ngModel}return e.$inject=["$scope","$element"],e.prototype.$onInit=function(){var e=this;this.closable=!1!==this.closable,this.modal_=this.$element_.children(),this.closable||(this.modal_.attr("data-keyboard",!1),this.modal_.attr("data-backdrop","static")),this.resizable=!!this.resizable;var t=this.modal_.find(".modal-dialog");t.draggable(),this.resizable&&t.resizable(),this.ngModel.$render=function(){e.modal_.modal(e.ngModel.$viewValue?"show":"hide")},this.modal_.on("shown.bs.modal hidden.bs.modal",function(t){var r=t.type;a.a.assert("shown"==r||"hidden"==r),e.ngModel.$setViewValue("shown"==r)})},e.prototype.$onDestroy=function(){this.modal_.modal("hide"),this.modal_.modal("removeBackdrop");var e=this.modal_.find(".modal-dialog");e.draggable("destroy"),this.resizable&&e.resizable("destroy")},e}(),n.controller("ngeoModalController",n.Controller_),t.a=n},function(e,t,r){"use strict";r(309);var a=r(1),n=r(65),o=r(3),i=function(e){n.a.call(this),this.timeout_=e;var t=angular.element('<div class="ngeo-notification"></div>');angular.element(document.body).append(t),this.container_=t,this.cache_={}};i.$inject=["$timeout"],i.$inject=["$timeout"],o.d(i,n.a),i.DEFAULT_DELAY_=7e3,i.prototype.notify=function(e){this.show(e)},i.prototype.clear=function(){for(var e in this.cache_)this.clearMessageByCacheItem_(this.cache_[parseInt(e,10)])},i.prototype.showMessage=function(e){var t=this,r=e.type;a.a.assertString(r,"Type should be set.");var s=["alert","fade"];switch(r){case n.a.Type.ERROR:s.push("alert-danger");break;case n.a.Type.INFORMATION:s.push("alert-info");break;case n.a.Type.SUCCESS:s.push("alert-success");break;case n.a.Type.WARNING:s.push("alert-warning")}var l=angular.element('<div class="'+s.join(" ")+'"></div>');(e.target?angular.element(e.target):this.container_).append(l),l.html(e.msg).addClass("in");var u=void 0!==e.delay?e.delay:i.DEFAULT_DELAY_,c={el:l},h=o.c(l);c.promise=this.timeout_(function(){l.alert("close"),delete t.cache_[h]},u),this.cache_[h]=c},i.prototype.clearMessageByCacheItem_=function(e){var t=e.el,r=e.promise,a=o.c(t);t.alert("close"),this.timeout_.cancel(r),delete this.cache_[a]},(i.module=angular.module("ngeoNotification",[])).service("ngeoNotification",i),t.a=i},function(e,t,r){"use strict";var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase()===t.toLowerCase()},o=function e(t,r,a){var n=a||"0",o=t.toString();return o.length<r?e(n+o,r):o},i=function(e,t){for(var r=0;r<t.length;r++)if(t[r].toLowerCase()===e.toLowerCase())return r;return-1},s={dateSettings:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["AM","PM"],ordinal:function(e){var t=e%10,r={1:"st",2:"nd",3:"rd"};return 1!==Math.floor(e%100/10)&&r[t]?r[t]:"th"}},separators:/[ \-+\/\.T:@]/g,validParts:/[dDjlNSwzWFmMntLoYyaABgGhHisueTIOPZcrU]/g,intParts:/[djwNzmnyYhHgGis]/g,tzParts:/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,tzClip:/[^-+\dA-Z]/g},l=function(e){var t=function e(t){var r=void 0,n=void 0;for(t=t||{},r=1;r<arguments.length;r++)if(n=arguments[r])for(var o in n)n.hasOwnProperty(o)&&("object"===a(n[o])?e(t[o],n[o]):t[o]=n[o]);return t}(s,e);this.dateSettings=t.dateSettings,this.separators=t.separators,this.validParts=t.validParts,this.intParts=t.intParts,this.tzParts=t.tzParts,this.tzClip=t.tzClip};
/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014 - 2016
 * @version 1.3.4
 *
 * Date formatter utility library that allows formatting date/time variables or Date objects using PHP DateTime format.
 * @see http://php.net/manual/en/function.date.php
 *
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */l.prototype={constructor:l,getMonth:function(e){var t=void 0;return 0===(t=i(e,this.dateSettings.monthsShort)+1)&&(t=i(e,this.dateSettings.months)+1),t},parseDate:function(e,t){var r={date:null,year:null,month:null,day:null,hour:0,min:0,sec:0},o=this.dateSettings,i=void 0,s=!1,l=!1,u=void 0,c=void 0,h=void 0,p=void 0,g=void 0,d=void 0,f=void 0;if(!e)return null;if(e instanceof Date)return e;if("U"===t)return(i=parseInt(e))?new Date(1e3*i):e;switch(void 0===e?"undefined":a(e)){case"number":return new Date(e);case"string":break;default:return null}var m=t.match(this.validParts);if(!m||0===m.length)throw new Error("Invalid date format definition.");var y=e.replace(this.separators,"\0").split("\0");for(i=0;i<y.length;i++)switch(u=y[i],c=parseInt(u),m[i]){case"y":case"Y":if(!c)return null;d=u.length,r.year=2===d?parseInt((c<70?"20":"19")+u):c,s=!0;break;case"m":case"n":case"M":case"F":if(isNaN(c)){if(!((h=this.getMonth(u))>0))return null;r.month=h}else{if(!(c>=1&&c<=12))return null;r.month=c}s=!0;break;case"d":case"j":if(!(c>=1&&c<=31))return null;r.day=c,s=!0;break;case"g":case"h":if(f=y[p=m.indexOf("a")>-1?m.indexOf("a"):m.indexOf("A")>-1?m.indexOf("A"):-1],p>-1)g=n(f,o.meridiem[0])?0:n(f,o.meridiem[1])?12:-1,c>=1&&c<=12&&g>-1?r.hour=c+g-1:c>=0&&c<=23&&(r.hour=c);else{if(!(c>=0&&c<=23))return null;r.hour=c}l=!0;break;case"G":case"H":if(!(c>=0&&c<=23))return null;r.hour=c,l=!0;break;case"i":if(!(c>=0&&c<=59))return null;r.min=c,l=!0;break;case"s":if(!(c>=0&&c<=59))return null;r.sec=c,l=!0}if(!0===s&&r.year&&r.month&&r.day)r.date=new Date(r.year,r.month-1,r.day,r.hour,r.min,r.sec,0);else{if(!0!==l)return null;r.date=new Date(0,0,0,r.hour,r.min,r.sec,0)}return r.date},guessDate:function(e,t){if("string"!=typeof e)return e;var r=e.replace(this.separators,"\0").split("\0"),a=t.match(this.validParts),n=new Date,o=void 0,i=void 0,s=void 0,l=void 0,u=void 0,c=void 0;if(!/^[djmn]/g.test(a[0]))return e;for(i=0;i<r.length;i++){var h=2;if(l=r[i],u=parseInt(l.substr(0,2)),isNaN(u))return null;switch(i){case 0:"m"===a[0]||"n"===a[0]?n.setMonth(u-1):n.setDate(u);break;case 1:"m"===a[0]||"n"===a[0]?n.setDate(u):n.setMonth(u-1);break;case 2:if(c=n.getFullYear(),h=(o=l.length)<4?o:4,!(c=parseInt(o<4?c.toString().substr(0,4-o)+l:l.substr(0,4))))return null;n.setFullYear(c);break;case 3:n.setHours(u);break;case 4:n.setMinutes(u);break;case 5:n.setSeconds(u)}(s=l.substr(h)).length>0&&r.splice(i+1,0,s)}return n},parseFormat:function(e,t){var r=void 0,a=this,n=a.dateSettings,i=/\\?(.?)/gi,s=function(e,t){return r[e]?r[e]():t};return r={d:function(){return o(r.j(),2)},D:function(){return n.daysShort[r.w()]},j:function(){return t.getDate()},l:function(){return n.days[r.w()]},N:function(){return r.w()||7},w:function(){return t.getDay()},z:function(){var e=new Date(r.Y(),r.n()-1,r.j()),t=new Date(r.Y(),0,1);return Math.round((e-t)/864e5)},W:function(){var e=new Date(r.Y(),r.n()-1,r.j()-r.N()+3),t=new Date(e.getFullYear(),0,4);return o(1+Math.round((e-t)/864e5/7),2)},F:function(){return n.months[t.getMonth()]},m:function(){return o(r.n(),2)},M:function(){return n.monthsShort[t.getMonth()]},n:function(){return t.getMonth()+1},t:function(){return new Date(r.Y(),r.n(),0).getDate()},L:function(){var e=r.Y();return e%4==0&&e%100!=0||e%400==0?1:0},o:function(){var e=r.n(),t=r.W();return r.Y()+(12===e&&t<9?1:1===e&&t>9?-1:0)},Y:function(){return t.getFullYear()},y:function(){return r.Y().toString().slice(-2)},a:function(){return r.A().toLowerCase()},A:function(){var e=r.G()<12?0:1;return n.meridiem[e]},B:function(){var e=3600*t.getUTCHours(),r=60*t.getUTCMinutes(),a=t.getUTCSeconds();return o(Math.floor((e+r+a+3600)/86.4)%1e3,3)},g:function(){return r.G()%12||12},G:function(){return t.getHours()},h:function(){return o(r.g(),2)},H:function(){return o(r.G(),2)},i:function(){return o(t.getMinutes(),2)},s:function(){return o(t.getSeconds(),2)},u:function(){return o(1e3*t.getMilliseconds(),6)},e:function(){return/\((.*)\)/.exec(String(t))[1]||"Coordinated Universal Time"},I:function(){return new Date(r.Y(),0)-Date.UTC(r.Y(),0)!=new Date(r.Y(),6)-Date.UTC(r.Y(),6)?1:0},O:function(){var e=t.getTimezoneOffset(),r=Math.abs(e);return(e>0?"-":"+")+o(100*Math.floor(r/60)+r%60,4)},P:function(){var e=r.O();return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return(String(t).match(a.tzParts)||[""]).pop().replace(a.tzClip,"")||"UTC"},Z:function(){return 60*-t.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(i,s)},r:function(){return"D, d M Y H:i:s O".replace(i,s)},U:function(){return t.getTime()/1e3||0}},s(e,e)},formatDate:function(e,t){var r=void 0,a=void 0,n=void 0,o=void 0,i=void 0,s="";if("string"==typeof e&&!(e=this.parseDate(e,t)))return null;if(e instanceof Date){for(n=t.length,r=0;r<n;r++)"S"!==(i=t.charAt(r))&&"\\"!==i&&(r>0&&"\\"===t.charAt(r-1)?s+=i:(o=this.parseFormat(i,e),r!==n-1&&this.intParts.test(i)&&"S"===t.charAt(r+1)&&(a=parseInt(o)||0,o+=this.dateSettings.ordinal(a)),s+=o));return s}return""}},t.a=l},function(e,t,r){"use strict";(function(e){var r=function(e,t){this.$http_=e,this.gmfShortenerCreateUrl_=t};r.$inject=["$http","gmfShortenerCreateUrl"],r.$inject=["$http","gmfShortenerCreateUrl"],r.prototype.getShortUrl=function(e){var t={url:e};return this.gmfShortenerCreateUrl_?this.postShortUrl_(t):{data:{short_url:e},status:200}},r.prototype.sendShortUrl=function(e,t,r){var a={url:e,email:t};return r&&(a.message=r),this.postShortUrl_(a)},r.prototype.postShortUrl_=function(t){return this.$http_.post(this.gmfShortenerCreateUrl_,e.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},r.URL_MAX_LEN=2083,r.URL_PATH_MAX_LEN=2048,(r.module=angular.module("gmfShareService",[])).service("gmfShareService",r),t.a=r}).call(this,r(27))},function(e,t,r){"use strict";var a=r(71),n=r(19),o=function(){this.extentHalfHorizontalDistance_,this.extentHalfVerticalDistance_};o.INCHES_PER_METER_=39.37,o.DOTS_PER_INCH_=72,o.prototype.createPrintMaskPostcompose=function(e,t,r){var i=this;return function(s){var l=s.context,u=s.frameState,c=u.viewState.resolution,h=u.size[0]*u.pixelRatio,p=u.size[1]*u.pixelRatio,g=[h/2,p/2],d=e(),f=d[1]*a.b,m=d[0]*a.b,y=t(u),v=o.DOTS_PER_INCH_,_=o.INCHES_PER_METER_,S=m/v/_*y/c/2;i.extentHalfHorizontalDistance_=d[0]/v/_*y/2;var b=f/v/_*y/c/2;if(i.extentHalfVerticalDistance_=d[1]/v/_*y/2,l.beginPath(),l.moveTo(0,0),l.lineTo(h,0),l.lineTo(h,p),l.lineTo(0,p),l.lineTo(0,0),l.closePath(),r){var C=n.i(r());i.drawPrintZoneWithRotation_(l,g,S,b,C)}else i.drawPrintZone_(l,g,S,b);l.fillStyle="rgba(0, 5, 25, 0.5)",l.fill()}},o.prototype.drawPrintZone_=function(e,t,r,a){var n=t[0]-r,o=t[1]-a,i=t[0]+r,s=t[1]+a;e.moveTo(n,o),e.lineTo(n,s),e.lineTo(i,s),e.lineTo(i,o),e.lineTo(n,o),e.closePath()},o.prototype.drawPrintZoneWithRotation_=function(e,t,r,a,n){var o=Math.sqrt(Math.pow(r,2)+Math.pow(a,2)),i=Math.atan(a/r)-n,s=Math.atan(r/a)-n,l=t[0]-Math.cos(i)*o,u=t[1]+Math.sin(i)*o,c=t[0]+Math.sin(s)*o,h=t[1]+Math.cos(s)*o,p=t[0]+Math.cos(i)*o,g=t[1]-Math.sin(i)*o,d=t[0]-Math.sin(s)*o,f=t[1]-Math.cos(s)*o;e.moveTo(l,u),e.lineTo(c,h),e.lineTo(p,g),e.lineTo(d,f),e.lineTo(l,u),e.closePath()},o.prototype.getOptimalScale=function(e,t,r,a){for(var n=e[0]*t,i=e[1]*t,s=n*o.INCHES_PER_METER_*o.DOTS_PER_INCH_/r[0],l=i*o.INCHES_PER_METER_*o.DOTS_PER_INCH_/r[1],u=Math.min(s,l),c=-1,h=0,p=a.length;h<p;++h)u>a[h]&&(c=a[h]);return c},o.prototype.getOptimalResolution=function(e,t,r){var a=o.DOTS_PER_INCH_*o.INCHES_PER_METER_,n=t[0]*r/(a*e[0]),i=t[1]*r/(a*e[1]);return Math.max(n,i)},o.prototype.getBottomLeftCorner=function(e){return[e[0]-this.extentHalfHorizontalDistance_,e[1]-this.extentHalfVerticalDistance_]},o.prototype.getBottomRightCorner=function(e){return[e[0]+this.extentHalfHorizontalDistance_,e[1]-this.extentHalfVerticalDistance_]},o.prototype.getUpLeftCorner=function(e){return[e[0]-this.extentHalfHorizontalDistance_,e[1]+this.extentHalfVerticalDistance_]},o.prototype.getUpRightCorner=function(e){return[e[0]+this.extentHalfHorizontalDistance_,e[1]+this.extentHalfVerticalDistance_]},(o.module=angular.module("ngeoPrintUtils",[])).service("ngeoPrintUtils",o),t.a=o},,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(12),n=r(346),o=r(252),i=r(165),s=["+proj="+o.a,"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=600000","+y_0=200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");i.a.defs("EPSG:21781",s),n.a(i.a),a.f("EPSG:21781").setExtent([42e4,3e4,9e5,35e4]);t.a="EPSG:21781"},function(e,t,r){"use strict";var a=r(1),n=r(92),o=r(3),i=r(50),s=r(153),l=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.a.call(this,r),void 0!==r.continueMsg)this.continueMsg=r.continueMsg;else{this.continueMsg=document.createElement("span"),this.continueMsg.textContent=t.getString("Click to continue drawing the line.");var a=document.createElement("br");a.textContent=t.getString("Double-click or click last point to finish."),this.continueMsg.appendChild(a)}this.format=e};o.d(l,n.a),l.prototype.createDrawInteraction=function(e,t){return new s.a({type:"LineString",source:t,style:e})},l.prototype.handleMeasure=function(e){var t=a.a.assertInstanceof(this.sketchFeature.getGeometry(),i.a),r=this.getMap().getView().getProjection();a.a.assert(r),e(n.a.getFormattedLength(t,r,this.precision,this.format),t.getLastCoordinate())},t.a=l},function(e,t,r){"use strict";var a=r(1),n=r(92),o=r(3),i=r(47),s=r(153),l=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(n.a.call(this,r),this.continueMsg,void 0!==r.continueMsg)this.continueMsg=r.continueMsg;else{this.continueMsg=document.createElement("span"),this.continueMsg.textContent=t.getString("Click to continue drawing the polygon.");var a=document.createElement("br");a.textContent=t.getString("Double-click or click starting point to finish."),this.continueMsg.appendChild(a)}this.format=e};o.d(l,n.a),l.prototype.createDrawInteraction=function(e,t){return new s.a({type:"Polygon",source:t,style:e})},l.prototype.handleMeasure=function(e){var t=a.a.assertInstanceof(this.sketchFeature.getGeometry(),i.a),r=this.getMap().getView().getProjection();a.a.assert(r);var o=n.a.getFormattedArea(t,r,this.precision,this.format),s=null;t.getCoordinates()[0].length>3&&(s=t.getInteriorPoint().getCoordinates()),e(o,s)},t.a=l},,,,,function(e,t,r){"use strict";r(27),r(310),r(440),r(438);var a=r(164),n=r(65),o=r(207),i=r(206);var s=angular.module("gmfAuthentication",[a.a.module.name,o.a.module.name,i.a.name]);function l(e,t,r){return r(e,t)}s.gmfAuthenticationTemplateUrl_=function(e,t){var r=t.gmfAuthenticationTemplateurl;return void 0!==r?r:"gmf/authentication"},s.run(["$templateCache",function(e){e.put("gmf/authentication",r(434))}]),l.$inject=["$element","$attrs","gmfAuthenticationTemplateUrl"],s.component_={bindings:{allowPasswordReset:"<?gmfAuthenticationAllowPasswordReset",allowPasswordChange:"<?gmfAuthenticationAllowPasswordChange",passwordValidator:"<?gmfAuthenticationPasswordValidator",forcePasswordChange:"<?gmfAuthenticationForcePasswordChange"},controller:"GmfAuthenticationController",templateUrl:l},s.value("gmfAuthenticationTemplateUrl",s.gmfAuthenticationTemplateUrl_),s.component("gmfAuthentication",s.component_),s.AuthenticationController_=function(){function e(t,r,a,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$element_=t,this.gmfUser=n,this.gettextCatalog=r,this.gmfAuthenticationService_=a,this.notification_=o,this.allowPasswordReset,this.allowPasswordChange,this.passwordValidator=null,this.forcePasswordChange,this.changingPassword=!1,this.changePasswordModalShown=!1,this.resetPasswordModalShown=!1,this.error=!1,this.loginVal="",this.pwdVal="",this.oldPwdVal="",this.newPwdVal="",this.newPwdConfVal=""}return e.$inject=["$element","gettextCatalog","gmfAuthenticationService","gmfUser","ngeoNotification"],e.prototype.$onInit=function(){this.allowPasswordReset=!1!==this.allowPasswordReset,this.allowPasswordChange=!1!==this.allowPasswordChange,this.forcePasswordChange=!0===this.forcePasswordChange,this.forcePasswordChange&&(this.changingPassword=!0)},e.prototype.changePassword=function(){var e=this,t=this.gettextCatalog,r=this.oldPwdVal,a=this.newPwdVal,n=this.newPwdConfVal,o=[];if(""===r&&o.push(t.getString("The old password is required.")),""===a&&o.push(t.getString("The new password is required.")),""===n&&o.push(t.getString("The password confirmation is required.")),o.length)this.setError_(o);else if(r===a&&o.push(t.getString("The old and new passwords are the same.")),a!==n&&o.push(t.getString("The passwords don't match.")),this.passwordValidator&&(this.passwordValidator.isPasswordValid(r)||o.push(t.getString(this.passwordValidator.notValidMessage))),o.length)this.setError_(o);else{var i=t.getString("Incorrect old password.");this.gmfAuthenticationService_.changePassword(r,a,n).then(function(){e.changePasswordModalShown=!0,e.changePasswordReset()},this.setError_.bind(this,i))}},e.prototype.login=function(){var e=this.gettextCatalog,t=[];if(""===this.loginVal&&t.push(e.getString("The username is required.")),""===this.pwdVal&&t.push(e.getString("The password is required.")),t.length)this.setError_(t);else{var r=e.getString("Incorrect credentials or disabled account.");this.gmfAuthenticationService_.login(this.loginVal,this.pwdVal).then(this.resetError_.bind(this),this.setError_.bind(this,r))}},e.prototype.logout=function(){var e=this.gettextCatalog.getString("Could not log out.");this.gmfAuthenticationService_.logout().then(this.resetError_.bind(this),this.setError_.bind(this,e))},e.prototype.resetPassword=function(){var e=this.gettextCatalog;if(this.loginVal){var t=e.getString("An error occurred while resetting the password."),r=function(e){this.resetPasswordModalShown=!0,this.resetError_()}.bind(this);this.gmfAuthenticationService_.resetPassword(this.loginVal).then(r,this.setError_.bind(this,t))}else this.setError_(e.getString("Please, input a login..."))},e.prototype.changePasswordReset=function(){this.resetError_(),this.changingPassword=!1,this.oldPwdVal="",this.newPwdVal="",this.newPwdConfVal=""},e.prototype.userMustChangeItsPassword=function(){return!1===this.gmfUser.is_password_changed&&this.forcePasswordChange},e.prototype.setError_=function(e){this.error&&this.resetError_(),this.error=!0;var t=this.$element_.find(".gmf-authentication-error");Array.isArray(e)||(e=[e]),e.forEach(function(e){this.notification_.notify({msg:e,target:t,type:n.a.Type.ERROR})},this)},e.prototype.resetError_=function(){this.notification_.clear(),this.error=!1},e}(),s.controller("GmfAuthenticationController",s.AuthenticationController_);var u=s,c=angular.module("gmfAuthenticationModule",[u.name,a.a.module.name]),h=r(33),p=r(1),g=r(68),d=r(3),f=r(220),m=r(103),y=r(98),v=r(154),_=r(215),S=r(168),b=r(85),C=function(e){f.a.call(this),this.mapUids_={},this.ngeoLayerHelper_=e};C.$inject=["ngeoLayerHelper"],C.$inject=["ngeoLayerHelper"],d.d(C,f.a),C.prototype.get=function(e){return d.c(e).toString()in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME).getLayers().item(0):null},C.prototype.set=function(e,t){var r=d.c(e).toString(),a=this.get(e);null!==t&&(t.setZIndex(-200),this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,-200));var n=this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME);null!==a?(p.a.assert(r in this.mapUids_),null!==t?n.getLayers().setAt(0,t):(n.getLayers().removeAt(0),delete this.mapUids_[r])):null!==t&&(n.getLayers().insertAt(0,t),this.mapUids_[r]=!0);var o=new g.a("change",{current:t,previous:a});return this.dispatchEvent(o),a},C.prototype.getOpacityBgLayer=function(e){return d.c(e).toString()in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME).getLayers().item(1):null},C.prototype.setOpacityBgLayer=function(e,t){t.setOpacity(0),t.setVisible(!0),t.setZIndex(-100),this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,-100);var r=this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME);-1===r.getLayers().getArray().indexOf(t)&&r.getLayers().push(t)},C.prototype.updateDimensions=function(e,t){var r=this.get(e);if(r){var a=[r];r instanceof m.a&&(a=r.getLayers().getArray()),a.forEach(function(e){if(p.a.assertInstanceof(e,y.a),e){var r=!1,a={};for(var n in e.get("dimensions")){var o=t[n];void 0!==o&&(a[n]=o,r=!0)}if(r){var i=e.getSource();i instanceof S.a?(i.updateDimensions(a),i.refresh()):(i instanceof _.a||i instanceof v.a)&&(i.updateParams(a),i.refresh())}}})}},(C.module=angular.module("ngeoBackgroundLayerMgr",[b.a.module.name])).service("ngeoBackgroundLayerMgr",C),C.BACKGROUNDLAYERGROUP_NAME="background";var w=C,T=r(2),E=angular.module("gmfBackgroundlayerselector",[h.a.module.name,w.module.name]);function A(e,t,r){return r(e,t)}E.value("gmfBackgroundlayerselectorTemplateUrl",function(e,t){var r=t.gmfBackgroundlayerselectorTemplateurl;return void 0!==r?r:"gmf/backgroundlayerselector"}),E.run(["$templateCache",function(e){e.put("gmf/backgroundlayerselector",r(433))}]),A.$inject=["$element","$attrs","gmfBackgroundlayerselectorTemplateUrl"],E.component_={controller:"GmfBackgroundlayerselectorController as ctrl",bindings:{map:"=gmfBackgroundlayerselectorMap",opacityOptions:"=gmfBackgroundlayerOpacityOptions",select:"&?gmfBackgroundlayerselectorSelect"},templateUrl:A},E.component("gmfBackgroundlayerselector",E.component_),E.Controller_=function(e,t,r){var a=this;this.map,this.opacityOptions,this.select,this.bgLayer,this.bgLayers,this.opacityLayer,this.gmfThemes_=r,this.listenerKeys_=[],this.listenerKeys_.push(T.a(r,"change",this.handleThemesChange_,this)),this.backgroundLayerMgr_=t,this.listenerKeys_.push(T.a(this.backgroundLayerMgr_,"change",function(e){a.bgLayer=e.detail.current})),e.$on("$destroy",this.handleDestroy_.bind(this))},E.Controller_.$inject=["$scope","ngeoBackgroundLayerMgr","gmfThemes"],E.Controller_.prototype.$onInit=function(){this.handleThemesChange_()},E.Controller_.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getBgLayers().then(function(t){if(e.bgLayers=t,void 0!==e.opacityOptions){var r=t.find(function(t){return t.get("label")===e.opacityOptions});if(void 0!==r){e.setOpacityBgLayer(r),e.opacityLayer=r,e.bgLayers=e.bgLayers.slice();var a=e.bgLayers.findIndex(function(t){return t===e.opacityLayer});e.bgLayers.splice(a,1),e.bgLayers.push(r)}}})},E.Controller_.prototype.getSetBgLayerOpacity=function(e){return e&&this.opacityLayer.setOpacity(e),this.opacityLayer.getOpacity()},E.Controller_.prototype.setLayer=function(e,t){this.bgLayer=e,this.backgroundLayerMgr_.set(this.map,e),!t&&this.select&&this.select()},E.Controller_.prototype.setOpacityBgLayer=function(e){this.backgroundLayerMgr_.setOpacityBgLayer(this.map,e)},E.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(T.e),this.listenerKeys_.length=0},E.controller("GmfBackgroundlayerselectorController",E.Controller_);var L=E,P=r(205),M=r(135),F=r(268),x=r(194),R=r(26),D=r(8),k=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var $=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.q_=t,this.gmfEnumerateAttribute_=r,this.ngeoDataSourcesHelper_=a,this.collection_,this.cache_}return e.$inject=["$q","gmfEnumerateAttribute","ngeoDataSourcesHelper"],e.prototype.getDataSource=function(e){return this.ngeoDataSourcesHelper_.getDataSource(e)},e.prototype.prepareFiltrableDataSource=function(e){var t=this,r=this.q_.defer();return this.ngeoDataSourcesHelper_.getDataSourceAttributes(e).then(function(a){var n=(e.gmfLayer.metadata||{}).enumeratedAttributes;if(n&&n.length){var o=[],i=function(r){!D.f(n,r.name)||r.type===R.a.SELECT||r.choices&&r.choices.length||o.push(t.gmfEnumerateAttribute_.getAttributeValues(e,r.name).then(function(e){var t=e.map(function(e){return e.value});r.type=R.a.SELECT,r.choices=t}))},s=a,l=Array.isArray(s),u=0;for(s=l?s:s[Symbol.iterator]();;){var c;if(l){if(u>=s.length)break;c=s[u++]}else{if((u=s.next()).done)break;c=u.value}i(c)}return t.q_.all(o).then(r.resolve(e))}r.resolve(e)}),r.promise},k(e,[{key:"collection",get:function(){return this.ngeoDataSourcesHelper_.collection}}]),e}();$.module=angular.module("gmfDataSourcesHelper",[x.a.module.name,F.a.module.name]),$.module.service("gmfDataSourcesHelper",$);var O=$,I=r(38),N=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var G=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return a.gmfLayer_=r.gmfLayer,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),N(t,[{key:"gmfLayer",get:function(){return this.gmfLayer_}}]),t}(I.a);var U=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ngeoDataSourcesHelper_=t}return e.$inject=["ngeoDataSourcesHelper"],e.prototype.describe=function(e){"qgisserver"===e.ogcServerType&&e.wfsUrl_&&1==e.getOGCLayerNames().length&&!e.attributes&&this.ngeoDataSourcesHelper_.getDataSourceAttributes(e)},e}();U.module=angular.module("gmfDatasourceWFSAliases",[x.a.module.name]),U.module.service("gmfWFSAliases",U);var j=U,V=r(138),H=r(106),W=r(137),B=r(134),q=r(107),z=r(122),Y=r(10),K=r(131);var Q=function(){function e(t,r,a,n,o,i,s,l,u,c,h){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.q_=t,this.rootScope_=r,this.timeout_=a,this.gmfThemes_=n,this.gmfTreeManager_=o,this.ngeoBackgroundLayerMgr_=i,this.ngeoDataSources_=s,this.dataSources_=s.collection,this.ngeoLayerHelper_=l,this.ngeoRuleHelper_=u,this.ngeoWMSTime_=c,this.gmfWFSAliases_=h,this.dataSourcesCache_={},this.dimensions_,this.dimensionsWatcherUnregister=null,this.treeCtrlCache_={},this.treeCtrlsUnregister_=null,T.a(this.ngeoBackgroundLayerMgr_,"change",this.handleNgeoBackgroundLayerChange_,this),T.a(this.gmfThemes_,"change",this.handleThemesChange_,this)}return e.$inject=["$q","$rootScope","$timeout","gmfThemes","gmfTreeManager","ngeoBackgroundLayerMgr","ngeoDataSources","ngeoLayerHelper","ngeoRuleHelper","ngeoWMSTime","gmfWFSAliases"],e.prototype.setDatasourceMap=function(e){this.ngeoDataSources_.map=e},e.prototype.setDimensions=function(e){var t=this;this.dimensionsWatcherUnregister&&this.dimensionsWatcherUnregister(),this.dimensions_=e,this.dimensionsWatcherUnregister=this.rootScope_.$watch(function(){return t.dimensions_},this.handleDimensionsChange_.bind(this),!0),this.handleDimensionsChange_()},e.prototype.handleDimensionsChange_=function(){var e=[],t=[],r=this.dataSources_.getArray(),a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(i.dimensionsFiltersConfig)for(var s in i.dimensionsFiltersConfig)if(null===i.dimensionsFiltersConfig[s].value){var l=this.getDataSourceLayer_(i);if(void 0==l)return;var u=d.c(l);-1==t.indexOf(u)&&(e.push(l),t.push(u))}}e.forEach(this.updateLayerFilter_.bind(this))},e.prototype.handleThemesChange_=function(){var e=this;this.clearDataSources_(),this.treeCtrlsUnregister_&&this.treeCtrlsUnregister_(),this.clearTreeCtrlCache_(),this.gmfThemes_.getOgcServersObject().then(function(t){var r=e.gmfThemes_.getThemesObject().then(function(r){var a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i.children,l=Array.isArray(s),u=0;for(s=l?s:s[Symbol.iterator]();;){var c;if(l){if(u>=s.length)break;c=s[u++]}else{if((u=s.next()).done)break;c=u.value}var h=c;p.a.assert(h),e.createDataSource_(h,h,t)}}}),a=e.gmfThemes_.getBackgroundLayersObject().then(function(r){var a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;e.createDataSource_(null,s,t)}});e.q_.all([r,a]).then(function(){e.treeCtrlsUnregister_=e.rootScope_.$watchCollection(function(){if(e.gmfTreeManager_.rootCtrl)return e.gmfTreeManager_.rootCtrl.children},e.handleTreeManagerRootChildrenChange_.bind(e))})})},e.prototype.handleTreeManagerRootChildrenChange_=function(e){var t=this;this.timeout_(function(){if(e){for(var r=[],a=function(e,t){t.node.children||e.push(t)},n=0,o=e.length;n<o;n++)e[n].traverseDepthFirst(a.bind(t,r));for(var i=0,s=r.length;i<s;i++){var l=r[i];t.getTreeCtrlCacheItem_(l)||t.addTreeCtrlToCache_(l)}var u=t.treeCtrlCache_;for(var c in t.treeCtrlCache_){var h=u[c];r.includes(h.treeCtrl)||t.removeTreeCtrlCacheItem_(h)}}})},e.prototype.clearDataSources_=function(){for(var e=this.dataSources_.getArray(),t=e.length-1;t>=0;t--)this.dataSourcesCache_[e[t].id]&&this.dataSources_.remove(e[t]);Y.b(this.dataSourcesCache_)},e.prototype.createDataSource_=function(e,t,r){var a=t.children;if(a){var n=a,o=Array.isArray(n),i=0;for(n=o?n:n[Symbol.iterator]();;){var s;if(o){if(i>=n.length)break;s=n[i++]}else{if((i=n.next()).done)break;s=i.value}var l=s;p.a.assert(l),this.createDataSource_(e,l,r)}}else{var u=t,c=d.c(u);if(!this.dataSourcesCache_[c]){var g=u.metadata,f=u.type,m=void 0,y=void 0,v=void 0,_=void 0,S=void 0,b=void 0,C=void 0,w=void 0;if(f===h.a.NodeType.WMTS){var T=u;S=T.layer,b=T.url,m=g.maxResolution,y=g.minResolution;var E=g.queryLayers||g.wmsLayers;E&&(v=E.split(",").map(function(e){return{maxResolution:m,minResolution:y,name:e,queryable:!0}})),g.ogcServer&&r[g.ogcServer]&&(_=r[g.ogcServer]),C=T.imageType}else if(f===h.a.NodeType.WMS){var A=u;m=A.maxResolutionHint,y=A.minResolutionHint,v=A.childLayers.map(function(e){return{maxResolution:e.maxResolutionHint,minResolution:e.minResolutionHint,name:e.name,queryable:e.queryable}});var L=!e||e.mixed?A.ogcServer:e.ogcServer;p.a.assert(L),C=(_=r[L]).imageType,A.time?w=A.time:e&&e.time&&(w=e.time)}var P=_?_.type:void 0,M=_?_.isSingleTile:void 0,F=_&&_.wfsSupport?_.urlWfs:void 0,x=_?_.url:void 0,R=I.a.WFSOutputFormat.GML3;P===I.a.ServerType.QGISSERVER&&(R=I.a.WFSOutputFormat.GML2);var D=!!g.snappingConfig,k=g.snappingConfig?g.snappingConfig.tolerance:void 0,$=g.snappingConfig?g.snappingConfig.edge:void 0,O=g.snappingConfig?g.snappingConfig.vertex:void 0,N=this.dimensions_,U=t.dimensions||e.dimensions,j=t.dimensions_filters,V=void 0,H=void 0;if(w){var W=this.ngeoWMSTime_.getOptions(w).values;Array.isArray(W)?(V=W[0],H=W[1]):V=W}var B=g.copyable,q=g.identifierAttributeField,z=u.name,Y=g.timeAttribute,K=!0===g.isChecked;this.dataSourcesCache_[c]=new G({copyable:B,dimensions:N,dimensionsConfig:U,dimensionsFiltersConfig:j,gmfLayer:u,id:c,identifierAttribute:q,maxResolution:m,minResolution:y,name:z,ogcImageType:C,ogcLayers:v,ogcServerType:P,ogcType:f,snappable:D,snappingTolerance:k,snappingToEdges:$,snappingToVertice:O,timeAttributeName:Y,timeLowerValue:V,timeProperty:w,timeUpperValue:H,visible:K,wfsOutputFormat:R,wfsUrl:F,wmsIsSingleTile:M,wmsUrl:x,wmtsLayer:S,wmtsUrl:b})}}},e.prototype.addTreeCtrlToCache_=function(e){var t=d.c(e.node),r=this.dataSourcesCache_[t];p.a.assert(r,"DataSource should be set"),e.setDataSource(r);var a=this.rootScope_.$watch(function(){return e.getState()},this.handleTreeCtrlStateChange_.bind(this,e)),n=this.rootScope_.$watch(function(){var e=null!==r.filterRules,t=r.visible;return e&&t},this.handleDataSourceFilterRulesChange_.bind(this,r)),o=void 0,i=void 0,s=void 0;r.timeProperty&&r.ogcType===I.a.Type.WMS&&(o=this.rootScope_.$watch(function(){return r.timeLowerValue},this.handleDataSourceTimeValueChange_.bind(this,r)),"range"===r.timeProperty.mode&&(i=this.rootScope_.$watch(function(){return r.timeUpperValue},this.handleDataSourceTimeValueChange_.bind(this,r))),s=p.a.assertInstanceof(V.a.getLayer(e),K.a)),this.treeCtrlCache_[t]={filterRulesWatcherUnregister:n,stateWatcherUnregister:a,timeLowerValueWatcherUnregister:o,timeUpperValueWatcherUnregister:i,treeCtrl:e,wmsLayer:s},this.dataSources_.push(r),this.gmfWFSAliases_.describe(r)},e.prototype.removeTreeCtrlCacheItem_=function(e){var t=e.treeCtrl.getDataSource();p.a.assert(t,"DataSource should be set"),this.dataSources_.remove(t),e.treeCtrl.setDataSource(null),e.filterRulesWatcherUnregister(),e.stateWatcherUnregister(),e.timeLowerValueWatcherUnregister&&e.timeLowerValueWatcherUnregister(),e.timeUpperValueWatcherUnregister&&e.timeUpperValueWatcherUnregister(),delete this.treeCtrlCache_[d.c(e.treeCtrl.node)]},e.prototype.clearTreeCtrlCache_=function(){for(var e in this.treeCtrlCache_)this.removeTreeCtrlCacheItem_(this.treeCtrlCache_[e])},e.prototype.handleTreeCtrlStateChange_=function(e,t){var r=e.getDataSource();p.a.assert(r,"DataSource should be set");var a="on"===t;r.visible=a;var n=this.getDataSourceLayer_(r);void 0!=n&&this.updateLayerFilter_(n)},e.prototype.getTreeCtrlCacheItem_=function(e){return this.treeCtrlCache_[d.c(e.node)]||null},e.prototype.getDataSourceLayer_=function(e){e=e;var t=d.c(e.gmfLayer),r=this.treeCtrlCache_[t];if(void 0!=r){var a=r.treeCtrl;return V.a.getLayer(a)}},e.prototype.updateLayerFilter_=function(e){var t;p.a.assert(e instanceof K.a||e instanceof z.a);var r=e.getSource();if(r instanceof v.a||r instanceof _.a){var a=r.getParams().LAYERS.split(",");p.a.assert(a.length>=1);for(var n=[],o=!1,i=0,s=a.length;i<s;i++){var l="()",u=this.dataSources_.getArray(),c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var g;if(c){if(h>=u.length)break;g=u[h++]}else{if((h=u.next()).done)break;g=h.value}var f=g,m=this.getDataSourceLayer_(f);if(void 0!=m&&(d.c(m)==d.c(e)&&a[i]===f.name)){var y=d.c(f.gmfLayer),S=this.treeCtrlCache_[y];p.a.assert(S);var b=S.treeCtrl.map.getView().getProjection().getCode(),C=f.visible?this.ngeoRuleHelper_.createFilterString({dataSource:f,projCode:b,incDimensions:!0}):null;C&&(l="("+C+")",o=!0)}}n.push(l)}r.updateParams(((t={}).FILTER=o?n.join(""):null,t))}},e.prototype.handleDataSourceFilterRulesChange_=function(e,t){if(!0===e.filtrable&&e.ogcType===I.a.Type.WMS){var r=this.getDataSourceLayer_(e);void 0!=r&&this.updateLayerFilter_(r)}},e.prototype.handleDataSourceTimeValueChange_=function(e){var t=d.c(e.gmfLayer),r=this.treeCtrlCache_[t];p.a.assert(r);var a=p.a.assert(r.wmsLayer),n=p.a.assertInstanceof(a.getSource(),v.a),o=p.a.assert(e.timeProperty),i=void 0,s=e.timeRangeValue;s&&(i=this.ngeoWMSTime_.formatWMSTimeParam(o,s)),n.getParams().TIME!==i&&this.ngeoLayerHelper_.updateWMSLayerState(a,n.getParams().LAYERS,i)},e.prototype.handleNgeoBackgroundLayerChange_=function(e){var t=e.detail.previous,r=e.detail.current,a=this.dataSourcesCache_;if(t){var n=t.get("querySourceIds");if(Array.isArray(n)){var o=n,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var u=a[l];u&&(u.visible=!1,this.dataSources_.remove(u))}}}if(r){var c=r.get("querySourceIds");if(Array.isArray(c)){var h=c,p=Array.isArray(h),g=0;for(h=p?h:h[Symbol.iterator]();;){var d;if(p){if(g>=h.length)break;d=h[g++]}else{if((g=h.next()).done)break;d=g.value}var f=a[d];f&&(f.visible=!0,this.dataSources_.push(f))}}}},e}();Q.module=angular.module("gmfDataSourcesManager",[j.module.name,V.a.module.name,H.a.module.name,h.a.module.name,B.a.module.name,W.a.module.name,w.module.name,b.a.module.name,q.a.module.name]),Q.module.service("gmfDataSourcesManager",Q);var X=Q,Z=angular.module("gmfDatasourceModule",[P.a.module.name,M.a.module.name,O.module.name,X.module.name,j.module.name]),J=r(190),ee=r(41),te=(r(309),r(179)),re=(r(504),function(e,t,r){this.sce_=e,this.gettextCatalog_=t,this.createPopup_=r,n.a.call(this);var a=angular.element('<div class="ngeo-disclaimer"></div>');angular.element(document.body).append(a),this.container_=a,this.messages_={}});re.$inject=["$sce","gettextCatalog","ngeoCreatePopup"],re.$inject=["$sce","gettextCatalog","ngeoCreatePopup"],d.d(re,n.a),re.prototype.alert=function(e){this.show(e)},re.prototype.close=function(e){this.getMessageObjects(e).forEach(this.closeMessage_,this)},re.prototype.showMessage=function(e){var t=this,r=this.gettextCatalog_,a=e.type;p.a.assertString(a,"Type should be set.");var o=this.getMessageUid_(e);if(void 0===this.messages_[o])if(!0===e.popup){var i=this.createPopup_(),s=this.sce_.trustAsHtml(e.msg);i.open({autoDestroy:!0,content:s,title:"&nbsp;"}),i.scope.$watch("open",function(r,a){r||t.closeMessage_(e)}),this.messages_[o]=i}else{var l=["alert","fade","alert-dismissible"];switch(a){case n.a.Type.ERROR:l.push("alert-danger");break;case n.a.Type.INFORMATION:l.push("alert-info");break;case n.a.Type.SUCCESS:l.push("alert-success");break;case n.a.Type.WARNING:l.push("alert-warning")}var u=angular.element('<div role="alert" class="'+l.join(" ")+'"></div>'),c=angular.element('<button type="button" class="close" data-dismiss="alert" aria-label="'+r.getString("Close")+'"><span aria-hidden="true" class="fa fa-times"></span></button>'),h=angular.element("<span />").html(e.msg);u.append(c).append(h);(e.target?angular.element(e.target):this.container_).append(u),u.addClass("in"),u.on("closed.bs.alert",function(){t.closeMessage_(e)}),this.messages_[o]=u}},re.prototype.getMessageUid_=function(e){return e.msg+"-"+e.type},re.prototype.closeMessage_=function(e){var t=this.getMessageUid_(e),r=this.messages_[t];void 0!==r&&(r instanceof te.a?r.getOpen()&&r.setOpen(!1):r.hasClass("in")&&r.alert("close"),delete this.messages_[t])},(re.module=angular.module("ngeoDisclaimer",[te.a.module.name])).service("ngeoDisclaimer",re);var ae=re,ne=r(117),oe=(r(283),angular.module("gmfDisclaimer",["ngSanitize",b.a.module.name,ae.module.name,ne.a.module.name]));oe.Controller_=function(e,t,r,a,n,o,i,s,l){this.map,this.external,this.popup,this.visibility=!1,this.msg,this.msgs_=[],this.sce_=r,this.timeout_=a,this.gettextCatalog_=n,this.element_=e,this.createPopup_=o,this.disclaimer_=i,this.eventHelper_=s,this.ngeoLayerHelper_=l,this.dataLayerGroup_=null},oe.Controller_.$inject=["$element","$scope","$sce","$timeout","gettextCatalog","ngeoCreatePopup","ngeoDisclaimer","ngeoEventHelper","ngeoLayerHelper"],oe.Controller_.prototype.$onInit=function(){this.dataLayerGroup_=this.ngeoLayerHelper_.getGroupFromMap(this.map,ee.a.DATALAYERGROUP_NAME),this.registerLayer_(this.dataLayerGroup_)},oe.Controller_.prototype.handleLayersAdd_=function(e){var t=this;this.timeout_(function(){var r=e.element;p.a.assertInstanceof(r,J.a),t.registerLayer_(r)})},oe.Controller_.prototype.handleLayersRemove_=function(e){var t=e.element;p.a.assertInstanceof(t,J.a),this.unregisterLayer_(t)},oe.Controller_.prototype.registerLayer_=function(e){var t=this,r=d.c(e);if(e instanceof m.a)this.eventHelper_.addListenerKey(r,T.a(e.getLayers(),"add",this.handleLayersAdd_,this)),this.eventHelper_.addListenerKey(r,T.a(e.getLayers(),"remove",this.handleLayersRemove_,this)),e.getLayers().forEach(function(e){t.registerLayer_(e)});else{var a=e.get("disclaimers");a&&Array.isArray(a)&&a.forEach(function(e){t.showDisclaimerMessage_(e)})}},oe.Controller_.prototype.unregisterLayer_=function(e){var t=this,r=d.c(e);if(e instanceof m.a)this.eventHelper_.clearListenerKey(r),e.getLayers().forEach(function(e){return t.unregisterLayer_(e)});else{var a=e.get("disclaimers");a&&Array.isArray(a)&&a.forEach(function(e){t.closeDisclaimerMessage_(e)})}},oe.Controller_.prototype.$onDestroy=function(){this.unregisterLayer_(this.dataLayerGroup_)},oe.Controller_.prototype.showDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e),this.external?(this.msgs_.indexOf(e)<0&&this.msgs_.push(e),this.msg=""+this.sce_.trustAsHtml(this.msgs_.join("<br />")),this.visibility=!0):this.disclaimer_.alert({popup:this.popup,msg:e,target:this.element_,type:n.a.Type.WARNING})},oe.Controller_.prototype.closeDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e),this.external?(this.visibility=!1,this.msgs_.length=0,this.msg=""):this.disclaimer_.close({popup:this.popup,msg:e,target:this.element_,type:n.a.Type.WARNING})},oe.component_={controller:oe.Controller_,bindings:{popup:"<?gmfDisclaimerPopup",map:"=gmfDisclaimerMap",external:"<?gmfDisclaimerExternal",visibility:"=?gmfDisclaimerExternalVisibility",msg:"=?gmfDisclaimerExternalMsg"}},oe.component("gmfDisclaimer",oe.component_);var ie=oe,se=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var le=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rootScope_=t,this.currentDataSourceId_=null,this.currentDataSourceItems_=[],this.localStorageKey_="gmf_savedfilters",this.useLocalStorage_=!0;try{"localStorage"in window?(window.localStorage.test="",delete window.localStorage.test):this.useLocalStorage_=!1}catch(e){console.error(e),this.useLocalStorage_=!1}this.items_=[],this.rootScope_.$watchCollection(function(){return r.items},function(){r.rePopulateCurrentDataSourceItems_()}),this.useLocalStorage_&&this.loadItemsFromLocalStorage_()}return e.$inject=["$rootScope"],e.prototype.loadItemsFromLocalStorage_=function(){if(window.localStorage[this.localStorageKey_]){var e=JSON.parse(window.localStorage[this.localStorageKey_]);p.a.assertArray(e),this.items_=e}},e.prototype.indexOfItem=function(e,t){for(var r=void 0,a=-1,n=0,o=this.items_.length;n<o;n++)if((r=this.items[n]).dataSourceId===t&&r.name===e){a=n;break}return a},e.prototype.save=function(e){var t=this.indexOfItem(e.name,e.dataSourceId);-1!==t?this.items[t]=e:this.items.push(e),this.useLocalStorage_&&this.saveItemsInLocalStorage_()},e.prototype.remove=function(e){D.j(this.items,e)&&this.useLocalStorage_&&this.saveItemsInLocalStorage_()},e.prototype.saveItemsInLocalStorage_=function(){window.localStorage[this.localStorageKey_]=JSON.stringify(this.items)},e.prototype.rePopulateCurrentDataSourceItems_=function(){if(this.currentDataSourceItems_.length=0,null!==this.currentDataSourceId_){var e=this.items,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;n.dataSourceId===this.currentDataSourceId_&&this.currentDataSourceItems_.push(n)}}},se(e,[{key:"currentDataSourceItems",get:function(){return this.currentDataSourceItems_}},{key:"currentDataSourceId",set:function(e){this.currentDataSourceId_=e,this.rePopulateCurrentDataSourceItems_()}},{key:"items",get:function(){return this.items_}}]),e}();le.module=angular.module("gmfSavedFilters",[]),le.module.service("gmfSavedFilters",le),le.Item=function(){},le.Item.prototype.condition,le.Item.prototype.customRules,le.Item.prototype.dataSourceId,le.Item.prototype.directedRules,le.Item.prototype.name;var ue=le,ce=r(105),he=r(125),pe=r(201),ge=r(245),de=r(15),fe=r(244),me=r(199),ye=r(198),ve=r(180),_e=r(262),Se=r(112),be=r(56),Ce=r(60),we=r(159),Te=r(34),Ee=r(74),Ae=r(152),Le=r(37),Pe=r(29),Me=r(18),Fe=r(127),xe=r(53),Re=r(97);var De=angular.module("ngeoRule",[ge.a.name,B.a.module.name,ve.a.module.name,_e.a.name,be.a.module.name,we.a.module.name]);function ke(e,t){return t(e)}De.run(["$templateCache",function(e){e.put("ngeo/filter/rulecomponent",r(420))}]),De.value("ngeoRuleTemplateUrl",function(e){var t=e.ngeoRuleTemplateUrl;return void 0!==t?t:"ngeo/filter/rulecomponent"}),ke.$inject=["$attrs","ngeoRuleTemplateUrl"],De.RuleController_=function(){function e(t,r,a,n,o,i){var s,l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.featureOverlay,this.map,this.rule,this.toolGroup,this.gettextCatalog_=t,this.scope_=r,this.timeout_=a,this.ngeoFeatureHelper_=n,this.ngeoRuleHelper_=o,this.ngeoToolActivateMgr_=i,this.clone;var u=Te.a.OperatorType,c=Te.a.SpatialOperatorType,h=Te.a.TemporalOperatorType;this.operators=((s={})[u.EQUAL_TO]=t.getString("Is equal to"),s[u.GREATER_THAN]=t.getString("Is greater than"),s[u.GREATER_THAN_OR_EQUAL_TO]=t.getString("Is greater than or equal to"),s[u.LESSER_THAN]=t.getString("Is lesser than"),s[u.LESSER_THAN_OR_EQUAL_TO]=t.getString("Is lesser than or equal to"),s[u.NOT_EQUAL_TO]=t.getString("Is not equal to"),s[u.LIKE]=t.getString("Contains"),s[c.CONTAINS]=t.getString("Contains"),s[c.INTERSECTS]=t.getString("Intersects"),s[c.WITHIN]=t.getString("Is inside of"),s[h.BEGINS]=t.getString("Begins at"),s[h.DURING]=t.getString("During"),s[h.ENDS]=t.getString("Ends at"),s[h.EQUALS]=t.getString("Is equal to"),s),this.operatorsShortFormat=((l={})[u.EQUAL_TO]="=",l[u.GREATER_THAN]=">",l[u.GREATER_THAN_OR_EQUAL_TO]=">=",l[u.LESSER_THAN]="<",l[u.LESSER_THAN_OR_EQUAL_TO]="<=",l[u.NOT_EQUAL_TO]="!=",l[u.LIKE]="~",l[h.BEGINS]=">=",l[h.ENDS]="<=",l[h.EQUALS]="=",l),this.timeRangeMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createWeekAgoDate_(),mode:"range",interval:[0,1,0,0]},this.timeValueMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createDate_(),mode:"value",interval:[0,1,0,0]},this.toolActivate_,this.unlisteners_=[],this.drawActive=!1,this.drawToolActivate=new Ce.a(this,"drawActive"),this.drawnFeatures=new Pe.b,this.menu_=null,this.selectedFeatures=new Pe.b,this.interactions_=new Pe.b,this.modify_=new fe.a({features:this.selectedFeatures,style:n.getVertexStyle(!1)}),this.interactions_.push(this.modify_),this.rotate_=new me.a({features:this.selectedFeatures,style:new Me.c({text:new Fe.a({text:"",font:"normal 18px FontAwesome",fill:new xe.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.rotate_),this.translate_=new ye.a({features:this.selectedFeatures,style:new Me.c({text:new Fe.a({text:"",font:"normal 18px FontAwesome",fill:new xe.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.translate_),this.listenerKeys_=[],this.initializeInteractions_(),this.modifyToolActivate=new Ce.a(this.modify_,"active"),this.rotateToolActivate=new Ce.a(this.rotate_,"active"),this.translateToolActivate=new Ce.a(this.translate_,"active"),this.geomType=null}return e.$inject=["gettextCatalog","$scope","$timeout","ngeoFeatureHelper","ngeoRuleHelper","ngeoToolActivateMgr"],e.prototype.$onInit=function(){var e=this;this.clone=this.ngeoRuleHelper_.cloneRule(this.rule),this.toolActivate_=new Ce.a(this.rule,"active"),this.ngeoToolActivateMgr_.registerTool(this.toolGroup,this.toolActivate_),this.scope_.$watch(function(){return e.rule.active},this.handleActiveChange_.bind(this)),this.clone.type===R.a.DATE||this.clone.type===R.a.DATETIME?(this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.getExpression()},function(t){e.timeValueMode.minValue=t})),this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.lowerBoundary},function(t){e.timeRangeMode.minValue=t})),this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.upperBoundary},function(t){e.timeRangeMode.maxValue=t}))):this.clone.type===R.a.GEOMETRY&&(this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.operator},function(t){if(t&&t===Te.a.SpatialOperatorType.CONTAINS){var r=p.a.assertInstanceof(e.clone,Ee.a);if(r.feature.getGeometry()){var a=e.ngeoFeatureHelper_.getType(r.feature),n=[de.a.CIRCLE,de.a.POLYGON,de.a.RECTANGLE];D.f(n,a)||e.clone.setExpression(null)}}})),this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.expression},function(t){if(t){var r=p.a.assertInstanceof(e.clone,Ee.a);e.geomType=e.ngeoFeatureHelper_.getType(r.feature)}else e.geomType=null})),this.unlisteners_.push(this.scope_.$watch(function(){var t=null!==e.clone.getExpression(),r=!0===e.rule.active,a=e.modify_.getActive()||e.rotate_.getActive()||e.translate_.getActive();return t&&r&&a},function(t){if(t){var r=p.a.assertInstanceof(e.clone,Ee.a);e.selectedFeatures.push(r.feature)}else e.selectedFeatures.clear()})))},e.prototype.$onDestroy=function(){this.rule.active&&(this.rule.active=!1,this.handleActiveChange_(!1,!0)),this.ngeoToolActivateMgr_.unregisterTool(this.toolGroup,this.toolActivate_);for(var e=0,t=this.unlisteners_.length;e<t;e++)this.unlisteners_[e]();this.unlisteners_.length=0,this.clone.destroy()},e.prototype.toggle=function(){this.rule.active?this.cancel():this.rule.active=!0},e.prototype.apply=function(){this.ngeoRuleHelper_.extendRule(this.clone,this.rule),this.rule.active=!1},e.prototype.cancel=function(){this.ngeoRuleHelper_.extendRule(this.rule,this.clone),this.rule.active=!1},e.prototype.reset=function(){this.clone.reset(),this.rule.reset()},e.prototype.toggleChoiceSelection=function(e){var t=p.a.assertInstanceof(this.clone,Ae.a),r=t.getExpression()?t.getExpression().split(","):[],a=r.indexOf(e);a>-1?r.splice(a,1):r.push(e),t.setExpression(r.length?r.join(","):null)},e.prototype.onDateSelected=function(e){this.clone.setExpression(e.start)},e.prototype.onDateRangeSelected=function(e){this.clone.lowerBoundary=e.start,this.clone.upperBoundary=e.end},e.prototype.createDate_=function(e){var t=new Date;if(void 0!==e){var r=t.getTime()-e;t.setTime(r)}return t.toISOString()},e.prototype.createWeekAgoDate_=function(){return this.createDate_(6048e5)},e.prototype.timeToDate=function(e){return new Date(e).toLocaleDateString()},e.prototype.handleActiveChange_=function(e,t){if(this.rule instanceof Ee.a&&this.clone instanceof Ee.a&&e!==t){var r=this.listenerKeys_,a=["ngeo-rule-",d.c(this)].join("-"),n=this.ngeoToolActivateMgr_,o=this.rule.feature,i=this.clone.feature,s=this.map.getViewport();p.a.assertElement(s),e?(r.push(T.a(this.drawnFeatures,"add",this.handleFeaturesAdd_,this)),r.push(T.a(s,"contextmenu",this.handleMapContextMenu_,this)),r.push(T.a(this.translate_,"translateend",this.handleTranslateEnd_,this)),r.push(T.a(this.rotate_,"rotateend",this.handleRotateEnd_,this)),this.featureOverlay.removeFeature(o),this.featureOverlay.addFeature(i),this.registerInteractions_(),n.registerTool(a,this.drawToolActivate,!1),n.registerTool(a,this.modifyToolActivate,!0),n.registerTool(a,this.rotateToolActivate,!1),n.registerTool(a,this.translateToolActivate,!1),this.modify_.setActive(!0),i.getGeometry()&&this.ngeoFeatureHelper_.setStyle(i,!0)):(i.setStyle(null),r.forEach(T.e),r.length=0,this.drawActive=!1,n.unregisterTool(a,this.drawToolActivate),n.unregisterTool(a,this.modifyToolActivate),n.unregisterTool(a,this.rotateToolActivate),n.unregisterTool(a,this.translateToolActivate),this.modify_.setActive(!1),this.unregisterInteractions_(),this.selectedFeatures.getLength()&&this.featureOverlay.removeFeature(i),this.featureOverlay.addFeature(o),this.selectedFeatures.clear())}},e.prototype.initializeInteractions_=function(){this.interactions_.forEach(function(e){e.setActive(!1),Se.a.interaction(e)})},e.prototype.registerInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.addInteraction(t)})},e.prototype.unregisterInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.removeInteraction(t)})},e.prototype.handleFeaturesAdd_=function(e){var t=this;this.timeout_(function(){var r=p.a.assertInstanceof(t.clone,Ee.a),a=r.feature,n=p.a.assertInstanceof(e.element,Le.a),o=p.a.assertInstanceof(n.getGeometry(),Re.a);r.geometry=o,t.drawActive=!1;var i=t.ngeoFeatureHelper_.getNonSpatialProperties(n);t.ngeoFeatureHelper_.clearNonSpatialProperties(a),a.setProperties(i),t.ngeoFeatureHelper_.setStyle(a,!0),t.scope_.$apply()})},e.prototype.getRuleGeometryType=function(){var e=p.a.assertInstanceof(this.rule,Ee.a);return this.ngeoFeatureHelper_.getType(e.feature)},e.prototype.handleMapContextMenu_=function(e){var t=this;this.removeMenu_();var r=this.map.getEventPixel(e),a=this.map.getCoordinateFromPixel(r),n=this.map.forEachFeatureAtPixel(r,function(e){var r=!1;return D.f(t.selectedFeatures.getArray(),e)&&(r=e),r}),o=[];if(n=n||null){var i=this.ngeoFeatureHelper_.getType(n),s=this.gettextCatalog_;i!=de.a.CIRCLE&&i!=de.a.LINE_STRING&&i!=de.a.POLYGON&&i!=de.a.RECTANGLE||o.push({cls:"fa fa-arrows",label:s.getString("Move"),name:"move"}),i!=de.a.LINE_STRING&&i!=de.a.POLYGON&&i!=de.a.RECTANGLE||o.push({cls:"fa fa-rotate-right",label:s.getString("Rotate"),name:"rotate"})}o.length&&(this.menu_=new pe.a({actions:o}),T.a(this.menu_,"actionclick",this.handleMenuActionClick_,this),this.map.addOverlay(this.menu_),this.menu_.open(a),e.preventDefault(),e.stopPropagation(),this.scope_.$apply())},e.prototype.removeMenu_=function(){this.menu_&&(T.c(this.menu_,"actionclick",this.handleMenuActionClick_,this),this.map.removeOverlay(this.menu_),this.menu_=null)},e.prototype.handleMenuActionClick_=function(e){var t=e.detail.action;switch(t){case"move":this.translate_.setActive(!0),this.scope_.$apply();break;case"rotate":this.rotate_.setActive(!0),this.scope_.$apply();break;default:console.log("FIXME - support: "+t)}},e.prototype.handleRotateEnd_=function(e){this.rotate_.setActive(!1),this.scope_.$apply()},e.prototype.handleTranslateEnd_=function(e){this.translate_.setActive(!1),this.scope_.$apply()},e}(),De.component("ngeoRule",{bindings:{featureOverlay:"<",map:"<",rule:"<",toolGroup:"<"},controller:De.RuleController_,templateUrl:ke});var $e=De;var Oe=angular.module("ngeoFilter",[B.a.module.name,$e.name,ve.a.module.name,ce.a.module.name]);function Ie(e,t){return t(e)}Oe.run(["$templateCache",function(e){e.put("ngeo/filter",r(419))}]),Oe.value("ngeoFilterTemplateUrl",function(e){var t=e.ngeoFilterTemplateUrl;return void 0!==t?t:"ngeo/filter"}),Ie.$inject=["$attrs","ngeoFilterTemplateUrl"],Oe.component("ngeoFilter",{bindings:{aRuleIsActive:"=",customRules:"<",datasource:"<",directedRules:"<",featureOverlay:"<",map:"<",toolGroup:"<"},controller:"ngeoFilterController",templateUrl:Ie}),Oe.FilterController_=function(){function e(t,r,a,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aRuleIsActive,this.customRules,this.datasource,this.directedRules,this.featureOverlay,this.map,this.toolGroup,this.gettextCatalog_=t,this.scope_=r,this.timeout_=a,this.ngeoMapQuerent_=n,this.ngeoRuleHelper_=o,this.conditions=[{text:t.getString("All"),value:he.a.AND},{text:t.getString("At least one"),value:he.a.OR},{text:t.getString("None"),value:he.a.NOT}],this.geometryAttributes=[],this.otherAttributes=[],this.ruleUnlisteners_={}}return e.$inject=["gettextCatalog","$scope","$timeout","ngeoMapQuerent","ngeoRuleHelper"],e.prototype.$onInit=function(){var e=this;this.scope_.$watch(function(){return e.aRuleIsActive},this.handleARuleIsActiveChange_.bind(this));var t=p.a.assert(this.datasource.attributes),r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}var o=n;o.type===R.a.GEOMETRY?this.geometryAttributes.push(o):this.otherAttributes.push(o)}var i=[].concat(this.customRules,this.directedRules),s=Array.isArray(i),l=0;for(i=s?i:i[Symbol.iterator]();;){var u;if(s){if(l>=i.length)break;u=i[l++]}else{if((l=i.next()).done)break;u=l.value}var c=u;this.registerRule_(c)}this.apply()},e.prototype.$onDestroy=function(){null!==this.datasource.filterRules&&(this.datasource.filterRules=null),this.featureOverlay.clear()},e.prototype.hasARule=function(){return[].concat(this.customRules,this.directedRules).length>0},e.prototype.apply=function(){var e=this;this.datasource.filterRules=null,this.timeout_(function(){var t=e.getRulesWithValue_();t.length&&(e.datasource.filterRules=t,e.ngeoMapQuerent_.clear())})},e.prototype.getData=function(){var e=this.getRulesWithValue_();if(e.length){var t=this.datasource,r=this.map,a=r.getView().getProjection().getCode(),n=this.ngeoRuleHelper_.createFilter({dataSource:t,filterRules:e,srsName:a});p.a.assert(n),this.ngeoMapQuerent_.issue({dataSources:[t],filter:n,limit:1e3,map:r})}},e.prototype.getRulesWithValue_=function(){var e=[],t=[].concat(this.customRules,this.directedRules),r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}var o=n;o.value&&e.push(o)}return e},e.prototype.createAndAddCustomRule=function(e){var t=this.ngeoRuleHelper_.createRuleFromAttribute(e,!0);this.registerRule_(t),this.customRules.push(t),this.timeout_(function(){t.active=!0},1)},e.prototype.setCondition=function(e){this.datasource.filterCondition!==e.value&&(this.datasource.filterCondition=e.value)},e.prototype.removeCustomRule=function(e){var t=this;e.active=!1,this.timeout_(function(){D.j(t.customRules,e),t.unregisterRule_(e),e.destroy()})},e.prototype.registerRule_=function(e){var t=d.c(e);this.ruleUnlisteners_[t]=this.scope_.$watch(function(){return e.active},this.handleRuleActiveChange_.bind(this)),e instanceof Ee.a&&this.featureOverlay.addFeature(e.feature)},e.prototype.unregisterRule_=function(e){var t=d.c(e),r=this.ruleUnlisteners_[t];p.a.assert(r),r(),delete this.ruleUnlisteners_[t],e instanceof Ee.a&&this.featureOverlay.removeFeature(e.feature)},e.prototype.handleRuleActiveChange_=function(){var e=!1,t=[].concat(this.customRules,this.directedRules),r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}if(n.active){e=!0;break}}this.aRuleIsActive=e},e.prototype.handleARuleIsActiveChange_=function(){if(!this.aRuleIsActive){var e=[].concat(this.customRules,this.directedRules),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;if(n.active){n.active=!1;break}}}},e}(),Oe.controller("ngeoFilterController",Oe.FilterController_);var Ne=Oe,Ge=r(84);r(133);var Ue=angular.module("gmfFilterselector",[a.a.module.name,P.a.module.name,O.module.name,Ge.a.module.name,o.a.module.name,i.a.name,B.a.module.name,Ne.name,ue.module.name]);function je(e,t){return t(e)}Ue.run(["$templateCache",function(e){e.put("gmf/filters/filterselectorcomponent",r(418))}]),Ue.value("gmfFilterselectorTemplateUrl",function(e){var t=e.gmfFilterselectorTemplateUrl;return void 0!==t?t:"gmf/filters/filterselectorcomponent"}),je.$inject=["$attrs","gmfFilterselectorTemplateUrl"],Ue.Controller_=function(){function e(t,r,a,n,o,i,s,l,u,c){var h=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active,t.$watch(function(){return h.active},this.handleActiveChange_.bind(this)),this.map,this.toolGroup,this.timeout_=r,this.gettextCatalog_=a,this.gmfDataSourceBeingFiltered=n,t.$watch(function(){return h.gmfDataSourceBeingFiltered.dataSource},this.handleSelectedDataSourceChange_.bind(this)),this.gmfDataSourcesHelper_=o,this.gmfSavedFilters=i,t.$watchCollection(function(){return h.gmfSavedFilters.currentDataSourceItems},function(){0===h.gmfSavedFilters.currentDataSourceItems.length&&h.saveFilterManageModalShown&&(h.saveFilterManageModalShown=!1)}),this.gmfUser_=s,t.$watch(function(){return h.gmfUser_.functionalities},this.handleGmfUserFunctionalitiesChange_.bind(this)),this.ngeoNotification_=l,this.featureOverlay=p.a.assert(u.getFeatureOverlay()),this.ngeoRuleHelper_=c,this.aRuleIsActive=!1,this.customRules=null,this.directedRules=null,this.filtrableDataSources=[],this.filtrableLayerNodeNames_=null,this.gmfDataSources_=o.collection,this.listenerKeys_=[],this.readyDataSource=null,this.ruleCache_={},this.saveFilterSaveModalShown=!1,t.$watch(function(){return h.saveFilterSaveModalShown},function(){h.saveFilterName=""}),this.saveFilterName="",this.saveFilterManageModalShown=!1,this.enableDataSourceRegistration_=!1,t.$watch(function(){return h.enableDataSourceRegistration_},this.handleEnableDataSourceRegistrationChange_.bind(this)),this.defaultFiltrableDataSourceName_,this.toggleDataSourceRegistration_()}return e.$inject=["$scope","$timeout","gettextCatalog","gmfDataSourceBeingFiltered","gmfDataSourcesHelper","gmfSavedFilters","gmfUser","ngeoNotification","ngeoFeatureOverlayMgr","ngeoRuleHelper"],e.prototype.handleGmfUserFunctionalitiesChange_=function(){var e=this.gmfUser_.functionalities;e&&e.filterable_layers?this.filtrableLayerNodeNames_=e.filterable_layers:this.filtrableLayerNodeNames_=null,e&&e.preset_layer_filter&&e.preset_layer_filter[0]?this.defaultFiltrableDataSourceName_=e.preset_layer_filter[0]:this.defaultFiltrableDataSourceName_=void 0,this.toggleDataSourceRegistration_()},e.prototype.toggleDataSourceRegistration_=function(){var e=!!this.filtrableLayerNodeNames_;this.enableDataSourceRegistration_!==e&&(this.enableDataSourceRegistration_=e)},e.prototype.handleActiveChange_=function(e){var t=this;e||(this.aRuleIsActive=!1,this.timeout_(function(){t.gmfDataSourceBeingFiltered.dataSource=null}))},e.prototype.handleEnableDataSourceRegistrationChange_=function(e){var t=this.listenerKeys_;e?(t.push(T.a(this.gmfDataSources_,"add",this.handleDataSourcesAdd_,this),T.a(this.gmfDataSources_,"remove",this.handleDataSourcesRemove_,this)),this.gmfDataSources_.forEach(this.registerDataSource_,this)):(t.forEach(T.e),t.length=0,this.filtrableDataSources.length=0)},e.prototype.handleDataSourcesAdd_=function(e){var t=e.element;t instanceof G&&this.registerDataSource_(t)},e.prototype.handleDataSourcesRemove_=function(e){var t=e.element;t instanceof G&&this.unregisterDataSource_(t)},e.prototype.registerDataSource_=function(e){null===e.filtrable&&(e.filtrable=this.isDataSourceFiltrable_(e)),e.filtrable&&(this.filtrableDataSources.push(e),void 0!==this.defaultFiltrableDataSourceName_&&e.name===this.defaultFiltrableDataSourceName_&&(this.gmfDataSourceBeingFiltered.dataSource=e))},e.prototype.unregisterDataSource_=function(e){e.filtrable&&(D.j(this.filtrableDataSources,e),this.gmfDataSourceBeingFiltered.dataSource===e&&(this.gmfDataSourceBeingFiltered.dataSource=null))},e.prototype.isDataSourceFiltrable_=function(e,t){var r=!0,a=this.gettextCatalog_,o=!1!==t,i=p.a.assert(this.filtrableLayerNodeNames_),s=[];if(D.f(i,e.name)){if(e.supportsWFS||s.push(a.getString("The data source doesn't support WFS, which is required to fetch the attributes to build the filter rules.")),e.ogcLayers&&e.ogcLayers.length?e.ogcLayers[0].queryable||s.push(a.getString("The ogcLayer within the data source must be queryable.")):s.push(a.getString("The data source must have only 1 ogcLayer defined.")),r=!s.length,o&&!r){var l=a.getString("The following data source is marked as being filtrable,\n          but is missing some requirements: "),u=e.name+" ("+e.id+").",c=a.getString("Please, contact your administrator about this.\n          Here are the reasons: ");s.unshift(l+" "+u+" "+c),console.warn(s.join(" ")),this.ngeoNotification_.notify({msg:s.join(" "),type:n.a.Type.WARNING})}}else r=!1;return r},e.prototype.handleSelectedDataSourceChange_=function(e){var t=this;this.aRuleIsActive=!1,this.customRules=null,this.directedRules=null,this.readyDataSource=null,this.gmfSavedFilters.currentDataSourceId=null,e&&(this.active||(this.active=!0),this.gmfDataSourcesHelper_.prepareFiltrableDataSource(e).then(function(e){var r=t.getRuleCacheItem_(e);if(!r&&(r={customRules:[],directedRules:[]},t.setRuleCacheItem_(e,r),e.gmfLayer.metadata&&e.gmfLayer.metadata.directedFilterAttributes&&e.gmfLayer.metadata.directedFilterAttributes.length)){var a=e.gmfLayer.metadata.directedFilterAttributes,n=p.a.assert(e.attributes),o=Array.isArray(n),i=0;for(n=o?n:n[Symbol.iterator]();;){var s;if(o){if(i>=n.length)break;s=n[i++]}else{if((i=n.next()).done)break;s=i.value}var l=s;D.f(a,l.name)&&r.directedRules.push(t.ngeoRuleHelper_.createRuleFromAttribute(l))}}t.customRules=r.customRules,t.directedRules=r.directedRules,t.readyDataSource=e,t.gmfSavedFilters.currentDataSourceId=e.id}))},e.prototype.getRuleCacheItem_=function(e){return this.ruleCache_[e.id]||null},e.prototype.setRuleCacheItem_=function(e,t){this.ruleCache_[e.id]=t},e.prototype.saveFilterShowModal=function(){this.saveFilterSaveModalShown=!0},e.prototype.saveFilterSave=function(){var e=this.saveFilterName,t=p.a.assert(this.readyDataSource),r=t.id,a=-1!==this.gmfSavedFilters.indexOfItem(e,r),n=t.filterCondition,o=this.gettextCatalog_.getString("A filter with the same name already exists.\n      Do you want to overwrite it?");if(!a||confirm(o)){var i={condition:n,customRules:this.customRules?this.ngeoRuleHelper_.serializeRules(this.customRules):[],dataSourceId:r,directedRules:this.directedRules?this.ngeoRuleHelper_.serializeRules(this.directedRules):[],name:e};this.gmfSavedFilters.save(i),this.saveFilterSaveModalShown=!1}},e.prototype.saveFilterLoadItem=function(e){var t=this,r=p.a.assert(this.readyDataSource);this.customRules=null,this.directedRules=null;var a=this.ngeoRuleHelper_.createRules(e.customRules),n=this.ngeoRuleHelper_.createRules(e.directedRules);this.timeout_(function(){t.customRules=a,t.directedRules=n,r.filterCondition=e.condition;var o=p.a.assert(t.getRuleCacheItem_(r));o.customRules=a,o.directedRules=n})},e.prototype.saveFilterManage=function(){this.saveFilterManageModalShown=!0},e.prototype.saveFilterRemoveItem=function(e){this.gmfSavedFilters.remove(e)},e}(),Ue.Controller_.RuleCache,Ue.Controller_.RuleCacheItem,Ue.component("gmfFilterselector",{bindings:{active:"=",map:"<",toolGroup:"<"},controller:Ue.Controller_,templateUrl:je});var Ve=Ue,He=angular.module("gmfFiltersModule",[Ve.name,ue.module.name]),We=r(341),Be=r(259),qe=(r(414),r(413),r(467),angular.module("gmfLayertreeTimeSliderComponent",[q.a.module.name,"ui.slider"]));qe.run(["$templateCache",function(e){e.put("gmf/layertree/timesliderComponent",r(411))}]),qe.directive_=function(e,t){return{scope:{onDateSelected:"&gmfTimeSliderOnDateSelected",time:"=gmfTimeSliderTime"},bindToController:!0,controller:"gmfTimeSliderController as sliderCtrl",restrict:"AE",templateUrl:"gmf/layertree/timesliderComponent",link:{pre:function(e,t,r,a){function n(t,r){var n=void 0,o=void 0,i=void 0;return r.values?(n=new Date(a.getClosestValue_(r.values[0])),o=new Date(a.getClosestValue_(r.values[1])),a.dates=[n,o],i={start:n.getTime(),end:o.getTime()}):(n=new Date(a.getClosestValue_(r.value)),a.dates=n,i={start:n.getTime()}),e.$apply(),i}a.init(),a.sliderOptions.stop=function(t,r){a.onDateSelected({time:n(t,r)}),e.$apply()},a.sliderOptions.slide=n}}}},qe.directive_.$inject=["$timeout","$filter"],qe.directive("gmfTimeSlider",qe.directive_),qe.Controller_=function(e,t){this.ngeoWMSTime_=t,this.onDateSelected,this.time,this.isModeRange,this.minValue,this.maxValue,this.timeValueList,this.sliderOptions,this.dates},qe.Controller_.$inject=["$scope","ngeoWMSTime"],qe.Controller_.prototype.init=function(){this.timeValueList=this.getTimeValueList_();var e=this.ngeoWMSTime_.getOptions(this.time);this.isModeRange="range"===this.time.mode,this.minValue=e.minDate,this.maxValue=e.maxDate,this.dates=this.isModeRange?[e.values[0],e.values[1]]:e.values,this.sliderOptions={range:this.isModeRange,min:this.minValue,max:this.maxValue}},qe.Controller_.prototype.getTimeValueList_=function(){var e=this.time,t=null,r=new Date(this.minValue),a=new Date(this.maxValue);if(e.values)t=[],e.values.forEach(function(e){t.push(new Date(e).getTime())});else{var n=new Date(r.getTime());if(n.setFullYear(r.getFullYear()+1024*e.interval[0]),n.setMonth(r.getMonth()+1024*e.interval[1],r.getDate()+1024*e.interval[2]),n.setSeconds(r.getSeconds()+1024*e.interval[3]),n>a){t=[];for(var o=0;;o++){var i=new Date(r.getTime());if(i.setFullYear(r.getFullYear()+o*e.interval[0]),i.setMonth(r.getMonth()+o*e.interval[1],r.getDate()+o*e.interval[2]),i.setSeconds(r.getSeconds()+o*e.interval[3]),!(i<=a))break;t.push(i.getTime())}}}return t},qe.Controller_.prototype.getClosestValue_=function(e){if(e<=this.minValue)return this.minValue;if(e>=this.maxValue)return this.maxValue;if(this.timeValueList){for(var t=void 0,r=0,a=this.timeValueList.length-1;a-r>1;)t=Math.floor((r+a)/2),this.timeValueList[t]>=e?a=t:r=t;var n=Math.abs(this.timeValueList[r]-e),o=Math.abs(this.timeValueList[a]-e);return this.timeValueList[n<o?r:a]}for(var i=new Date(e),s=new Date(this.minValue),l=new Date(this.minValue),u=new Date(this.maxValue),c=Math.abs(i-l),h=1;;h++){var p=new Date(s.getTime());if(p.setFullYear(s.getFullYear()+h*this.time.interval[0]),p.setMonth(s.getMonth()+h*this.time.interval[1],s.getDate()+h*this.time.interval[2]),p.setSeconds(s.getSeconds()+h*this.time.interval[3]),p>u)break;var g=Math.abs(i-p);if(!(g<=c))break;l=p,c=g}return l.getTime()},qe.Controller_.prototype.getLocalizedDate=function(e){return this.ngeoWMSTime_.formatTimeValue(e,this.time.resolution)},qe.controller("gmfTimeSliderController",qe.Controller_);var ze=qe,Ye=(r(466),angular.module("gmfLayertreeModule",[We.a.name,Be.a.name,V.a.module.name,ze.name,H.a.module.name])),Ke=r(261),Qe=r(209),Xe=r(258),Ze=(r(465),angular.module("gmfPermalinkModule",[Ke.a.module.name,Qe.a.module.name,Xe.a.name])),Je=r(197),et=r(142),tt=angular.module("ngeoMap",[]);tt.directive_=function(e){return{restrict:"A",link:function(t,r,a){var n=a.ngeoMap,o=t.$eval(n);p.a.assertInstanceof(o,et.a),o.setTarget(r[0]);var i=a.ngeoMapManageResize;if(t.$eval(i)){var s=a.ngeoMapResizeTransition,l=t.$eval(s);T.a(e,"resize",function(){if(l){var t=Date.now(),r=!0;!function a(){o.updateSize(),o.renderSync(),r&&e.requestAnimationFrame(a),Date.now()-t>l&&(r=!1)}()}else o.updateSize()})}}}},tt.directive_.$inject=["$window"],tt.directive("ngeoMap",tt.directive_);var rt=tt,at=r(334),nt=r(257),ot=angular.module("ngeoScaleselector",[]);ot.value("ngeoScaleselectorTemplateUrl",function(e,t){var r=t.ngeoScaleselectorTemplateurl;return void 0!==r?r:"ngeo/map/scaleselector"}),ot.run(["$templateCache",function(e){e.put("ngeo/map/scaleselector",r(401))}]);var it=function(e){return{restrict:"A",scope:!0,controller:"NgeoScaleselectorController",templateUrl:e}};it.$inject=["ngeoScaleselectorTemplateUrl"],it.$inject=["ngeoScaleselectorTemplateUrl"],ot.directive("ngeoScaleselector",it);var st=function e(t,r,a){var n=this,o=a.ngeoScaleselector;this.scales=t.$eval(o),p.a.assert(void 0!==this.scales),this.zoomLevels,t.$watch(function(){return Object.keys(n.scales).length},function(e){n.zoomLevels=Object.keys(n.scales).map(Number),n.zoomLevels.sort(D.i)});var i=a.ngeoScaleselectorMap;this.map_=t.$eval(i),p.a.assertInstanceof(this.map_,et.a);var s=a.ngeoScaleselectorOptions,l=t.$eval(s);if(this.options=e.getOptions_(l),this.$scope_=t,this.resolutionChangeKey_=null,this.currentScale=void 0,null!==this.map_.getView()){var u=this.map_.getView().getZoom();void 0!==u&&(this.currentScale=this.getScale(u))}T.a(this.map_,"change:view",this.handleViewChange_,this),this.registerResolutionChangeListener_(),t.scaleselectorCtrl=this};st.$inject=["$scope","$element","$attrs"],st.$inject=["$scope","$element","$attrs"],st.getOptions_=function(e){var t=!1;return void 0!==e&&(t=1==e.dropup),{dropup:t}},st.prototype.getScale=function(e){return this.scales[e]},st.prototype.changeZoom=function(e){this.map_.getView().setZoom(e)},st.prototype.handleResolutionChange_=function(e){var t=this,r=this.map_.getView(),a=this.scales[r.getZoom()];void 0!==a&&this.$scope_.$applyAsync(function(){t.currentScale=a})},st.prototype.handleViewChange_=function(e){this.registerResolutionChangeListener_(),this.handleResolutionChange_(null)},st.prototype.registerResolutionChangeListener_=function(){null!==this.resolutionChangeKey_&&T.e(this.resolutionChangeKey_);var e=this.map_.getView();this.resolutionChangeKey_=T.a(e,"change:resolution",this.handleResolutionChange_,this)},ot.controller("NgeoScaleselectorController",st);var lt=ot,ut=angular.module("ngeoMapModule",[w.module.name,rt.name,Ge.a.module.name,at.a.name,nt.a.name,lt.name]),ct=angular.module("gmfMapComponent",[Ze.name,Je.a.module.name,ut.name,Ge.a.module.name]);ct.run(["$templateCache",function(e){e.put("gmf/map",r(400))}]),ct.directive_=function(){return{scope:{map:"<gmfMapMap",manageResize:"<gmfMapManageResize",resizeTransition:"<gmfMapResizeTransition"},controller:"GmfMapController as ctrl",bindToController:!0,templateUrl:"gmf/map"}},ct.directive("gmfMap",ct.directive_),ct.Controller_=function(e,t,r){this.map,this.manageResize,this.resizeTransition,this.ngeoFeatureOverlayMgr_=e,this.gmfPermalink_=t,this.gmfSnapping_=r},ct.Controller_.$inject=["ngeoFeatureOverlayMgr","gmfPermalink","gmfSnapping"],ct.Controller_.prototype.$onInit=function(){this.ngeoFeatureOverlayMgr_.init(this.map),this.gmfPermalink_.setMap(this.map),this.gmfSnapping_.setMap(this.map)},ct.controller("GmfMapController",ct.Controller_);var ht=ct,pt=r(108),gt=r(443),dt=r(12),ft=angular.module("gmfMapMouseposition",[pt.a.name]);function mt(e,t){return t(e)}ft.run(["$templateCache",function(e){e.put("gmf/map/mousepositionComponent",r(399))}]),ft.value("gmfMapMousepositionTemplateUrl",function(e){var t=e.gmfMapMousepositionTemplateUrl;return void 0!==t?t:"gmf/map/mousepositionComponent"}),mt.$inject=["$attrs","gmfMapMousepositionTemplateUrl"],ft.component_={controller:"gmfMousepositionController as ctrl",bindings:{map:"<gmfMousepositionMap",projections:"<gmfMousepositionProjections"},templateUrl:mt},ft.component("gmfMouseposition",ft.component_),ft.Controller_=function(e,t,r,a){this.map,this.projections,this.projection,this.$scope_=r,this.gettextCatalog_=a,this.$element_=e,this.$filter_=t,this.control_=null},ft.Controller_.$inject=["$element","$filter","$scope","gettextCatalog"],ft.Controller_.prototype.$onInit=function(){var e=this;this.$scope_.$on("gettextLanguageChanged",function(){e.initOlControl_()}),this.initOlControl_()},ft.Controller_.prototype.initOlControl_=function(){null!==this.control_&&this.map.removeControl(this.control_);var e=this.gettextCatalog_;this.control_=new gt.a({className:"gmf-mouseposition-control",coordinateFormat:function(e){var t=this.projection.filter.split(":"),r=this.$filter_(t.shift());p.a.assertFunction(r);var a=t;return a.unshift(e),r.apply(this,a)}.bind(this),target:angular.element(".gmf-mouseposition-control-target",this.$element_)[0],undefinedHTML:e.getString("Coordinates")}),this.setProjection(this.projections[0]),this.map.addControl(this.control_)},ft.Controller_.prototype.setProjection=function(e){this.control_.setProjection(dt.f(e.code)),this.projection=e},ft.controller("gmfMousepositionController",ft.Controller_);var yt=ft,vt=angular.module("gmfMapModule",[ht.name,yt.name]),_t=r(256),St=r(203),bt=function(e,t){this.data=e,this.columnDefs=t,this.selectedRows={}};bt.getRowUid=function(e){return""+d.c(e)},bt.prototype.isRowSelected=function(e){return!!this.selectedRows[bt.getRowUid(e)]},bt.prototype.getSelectedCount=function(){return Object.keys(this.selectedRows).length},bt.prototype.getSelectedRows=function(){var e=this;return this.data.filter(function(t){return e.isRowSelected(t)})},bt.prototype.selectRow=function(e){var t=bt.getRowUid(e);this.selectedRows[t]=e},bt.prototype.toggleRow=function(e){var t=bt.getRowUid(e);this.isRowSelected(e)?delete this.selectedRows[t]:this.selectedRows[t]=e},bt.prototype.selectAll=function(){var e=this;this.data.forEach(function(t){e.selectRow(t)})},bt.prototype.unselectAll=function(){for(var e in this.selectedRows)delete this.selectedRows[e]},bt.prototype.invertSelection=function(){var e=this;this.data.forEach(function(t){e.toggleRow(t)})},bt.module=angular.module("ngeoGridConfig",[]);var Ct=bt,wt=r(71),Tt=(r(398),r(397),angular.module("ngeoGrid",[Ct.module.name,pt.a.name,"floatThead"]));function Et(e,t){return t(e)}Tt.run(["$templateCache",function(e){e.put("ngeo/grid",r(396))}]),Tt.value("ngeoGridTemplateUrl",function(e){var t=e.ngeoGridTemplateurl;return void 0!==t?t:"ngeo/grid"}),Et.$inject=["$attrs","ngeoGridTemplateUrl"],Tt.component_={controller:"ngeoGridController as ctrl",bindings:{configuration:"=ngeoGridConfiguration"},templateUrl:Et},Tt.component("ngeoGrid",Tt.component_),Tt.Controller_=function(e){this.scope_=e,this.configuration,this.selectedRows,this.sortedBy,this.sortAscending=!0,this.floatTheadConfig={scrollContainer:function(e){return e.closest(".ngeo-grid-table-container")}}},Tt.Controller_.$inject=["$scope"],Tt.Controller_.prototype.$onInit=function(){this.selectedRows=this.configuration.selectedRows},Tt.Controller_.prototype.sort=function(e){this.sortAscending=this.sortedBy!==e||!this.sortAscending,this.sortedBy=e;var t=this.sortAscending?1:-1;this.configuration.data.sort(function(r,a){return r[e]?a[e]?r[e]>a[e]?t:-t:-1:1})},Tt.Controller_.prototype.clickRow=function(e,t){var r=this.isShiftKeyOnly_(t),a=this.isPlatformModifierKeyOnly_(t);this.clickRow_(e,r,a)},Tt.Controller_.prototype.clickRow_=function(e,t,r){if(t&&!r)this.selectRange_(e);else if(!t&&r)this.configuration.toggleRow(e);else{var a=this.configuration.isRowSelected(e);this.configuration.unselectAll(),a||this.configuration.selectRow(e)}},Tt.Controller_.prototype.selectRange_=function(e){var t=Ct.getRowUid(e),r=this.configuration.data;if(!this.configuration.isRowSelected(e)){for(var a=void 0,n=[],o=0;o<r.length;o++){var i=r[o];t===Ct.getRowUid(i)?a=o:this.configuration.isRowSelected(i)&&n.push(o)}p.a.assert(void 0!==a),0==n.length&&this.configuration.selectRow(e);for(var s=1/0,l=n[0],u=0;u<n.length;u++){var c=n[u],h=Math.abs(c-a);s>h&&(s=h,l=c)}for(var g=a>l?a:l,d=a<l?a:l;d<=g;d++)this.configuration.selectRow(r[d])}},Tt.Controller_.prototype.preventTextSelection=function(e){var t=this.isShiftKeyOnly_(e),r=this.isPlatformModifierKeyOnly_(e);(t||r)&&e.preventDefault()},Tt.Controller_.prototype.isPlatformModifierKeyOnly_=function(e){return!e.altKey&&(wt.d?e.metaKey:e.ctrlKey)&&!e.shiftKey},Tt.Controller_.prototype.isShiftKeyOnly_=function(e){return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Tt.controller("ngeoGridController",Tt.Controller_);var At=Tt,Lt=r(5),Pt=r(115),Mt=r(58),Ft=angular.module("gmfQueryGridComponent",[_t.a.module.name,St.a.name,At.name,Ct.module.name,Ge.a.module.name,ce.a.module.name]);function xt(e,t,r){return r(e,t)}Ft.value("gmfDisplayquerygridTemplateUrl",function(e,t){var r=t.gmfDisplayquerygridTemplateurl;return void 0!==r?r:"gmf/query/gridComponent"}),Ft.run(["$templateCache",function(e){e.put("gmf/query/gridComponent",r(395))}]),xt.$inject=["$element","$attrs","gmfDisplayquerygridTemplateUrl"],Ft.component_={controller:"GmfDisplayquerygridController as ctrl",bindings:{active:"=?gmfDisplayquerygridActive",featuresStyleFn:"&gmfDisplayquerygridFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerygridSelectedfeaturestyle",getMapFn:"&gmfDisplayquerygridMap",removeEmptyColumnsFn:"&?gmfDisplayquerygridRemoveemptycolumns",maxResultsFn:"&?gmfDisplayquerygridMaxresults",maxRecenterZoomFn:"&?gmfDisplayquerygridMaxrecenterzoom",mergeTabs:"<?gmfDisplayquerygridMergetabs"},templateUrl:xt},Ft.component("gmfDisplayquerygrid",Ft.component_),Ft.Controller_=function(e,t,r,a,n,o,i,s){var l=this,u=e.has("ngeoQueryOptions")?e.get("ngeoQueryOptions"):{};this.$scope_=t,this.$timeout_=o,this.ngeoQueryResult=r,this.ngeoMapQuerent_=a,this.ngeoCsvDownload_=i,this.$element_=s,this.maxResults=void 0!==u.limit?u.limit:50,this.active=!1,this.pending=!1,this.gridSources={},this.loadedGridSources=[],this.selectedTab=null,this.removeEmptyColumns_=!1,this.maxRecenterZoom,this.mergeTabs={},this.featuresForSources_={},this.features_=new Pe.b,this.ngeoFeatureOverlayMgr_=n,this.highlightFeatures_=new Pe.b,this.filename_=e.has("gmfCsvFilename")?e.get("gmfCsvFilename"):"query-results.csv",this.map_=null,this.$scope_.$watchCollection(function(){return r},function(e,t){e!==t&&l.updateData_()}),this.unregisterSelectWatcher_=null},Ft.Controller_.$inject=["$injector","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr","$timeout","ngeoCsvDownload","$element"],Ft.Controller_.prototype.$onInit=function(){this.removeEmptyColumns_=!!this.removeEmptyColumnsFn&&!0===this.removeEmptyColumnsFn(),this.maxRecenterZoom=this.maxRecenterZoomFn?this.maxRecenterZoomFn():void 0;var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this.featuresStyleFn();void 0!==t&&(p.a.assertInstanceof(t,Me.c),e.setStyle(t));var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this.selectedFeatureStyleFn();if(void 0!==a)p.a.assertInstanceof(a,Me.c);else{var n=new xe.a({color:[255,0,0,.6]}),o=new Mt.a({color:[255,0,0,1],width:2});a=new Me.c({fill:n,image:new Pt.a({fill:n,radius:5,stroke:o}),stroke:o,zIndex:10})}r.setStyle(a);var i=this.getMapFn;if(i){var s=i();p.a.assertInstanceof(s,et.a),this.map_=s}},Ft.Controller_.prototype.getGridSources=function(){var e=this;return this.loadedGridSources.map(function(t){return e.gridSources[t]})},Ft.Controller_.prototype.updateData_=function(){var e=this;if(0===this.ngeoQueryResult.total&&!this.hasOneWithTooManyResults_()){var t=this.active;return this.clear(),void(t&&(this.active=this.ngeoQueryResult.pending,this.pending=this.ngeoQueryResult.pending))}this.active=!0,this.pending=!1;var r=this.ngeoQueryResult.sources;Object.keys(this.mergeTabs).length>0&&(r=this.getMergedSources_(r)),r.forEach(function(t){t.tooManyResults?e.makeGrid_(null,t):(t.id=e.escapeValue(t.id),t.features.length>0&&e.collectData_(t))}),0!==this.loadedGridSources.length?null!==this.selectedTab&&""+this.selectedTab in this.gridSources||this.$timeout_(function(){var t=e.loadedGridSources[0];e.selectTab(e.gridSources[t])},0):this.active=!1},Ft.Controller_.prototype.hasOneWithTooManyResults_=function(){return this.ngeoQueryResult.sources.some(function(e){return e.tooManyResults})},Ft.Controller_.prototype.escapeValue=function(e){if(Number.isInteger(e))return e;var t=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\ |]/g;return null!==e.match(t)?e.replace(t,"_"):e},Ft.Controller_.prototype.isSelected=function(e){return this.selectedTab===e.source.label},Ft.Controller_.prototype.getMergedSources_=function(e){var t=this,r=[],a={};for(var n in e.forEach(function(e){null===t.getMergedSource_(e,a)&&r.push(e)}),a)r.push(a[n]);return r},Ft.Controller_.prototype.getMergedSource_=function(e,t){var r=null;for(var a in this.mergeTabs){if(this.mergeTabs[a].some(function(t){return t==e.label})){r=a;break}}if(null===r)return null;var n=void 0;return r in t?n=t[r]:(n={features:[],id:r,label:r,limit:this.maxResults,pending:!1,queried:!0,tooManyResults:!1,totalFeatureCount:void 0},t[r]=n),e.features.forEach(function(e){n.features.push(e)}),n.tooManyResults=n.tooManyResults||e.tooManyResults,n.tooManyResults&&(n.totalFeatureCount=void 0!==n.totalFeatureCount?n.totalFeatureCount+n.features.length:n.features.length,n.features=[]),void 0!==e.totalFeatureCount&&(n.totalFeatureCount=void 0!==n.totalFeatureCount?n.totalFeatureCount+e.totalFeatureCount:e.totalFeatureCount),n},Ft.Controller_.prototype.collectData_=function(e){var t=[],r=[],a={},n=void 0,o=void 0;(e.features.forEach(function(e){void 0!==(n=e.getProperties())&&(o=e.getGeometryName(),-1===r.indexOf(o)&&r.push(o),t.push(n),a[Ct.getRowUid(n)]=e)}),this.cleanProperties_(t,r),t.length>0)&&(this.makeGrid_(t,e)&&(this.featuresForSources_[""+e.label]=a))},Ft.Controller_.prototype.cleanProperties_=function(e,t){e.forEach(function(e){t.forEach(function(t){delete e[t]}),delete e.boundedBy,delete e.ngeo_feature_type_}),!0===this.removeEmptyColumns_&&this.removeEmptyColumnsFn_(e)},Ft.Controller_.prototype.removeEmptyColumnsFn_=function(e){var t=[],r=void 0,a=void 0;for(a in e[0])for(r=0;r<e.length;r++)if(void 0!==e[r][a]){t.push(a);break}var n=void 0;e.forEach(function(e){for(a in n=[],e)-1===t.indexOf(a)&&n.push(a);n.forEach(function(t){delete e[t]})})},Ft.Controller_.prototype.makeGrid_=function(e,t){var r=""+t.label,a=null;return(null===e||null!==(a=this.getGridConfiguration_(e)))&&(-1==this.loadedGridSources.indexOf(r)&&this.loadedGridSources.push(r),this.gridSources[r]={configuration:a,source:t},!0)},Ft.Controller_.prototype.getGridConfiguration_=function(e){p.a.assert(e.length>0);var t={};Object.assign(t,e[0]),delete t.ol_uid;var r=[];return Object.keys(t).forEach(function(e){r.push({name:e})}),r.length>0?new Ct(e,r):null},Ft.Controller_.prototype.clear=function(){this.active=!1,this.pending=!1,this.gridSources={},this.loadedGridSources=[],this.selectedTab=null,this.tooManyResults=!1,this.features_.clear(),this.highlightFeatures_.clear(),this.ngeoMapQuerent_.clear(),this.featuresForSources_={},this.unregisterSelectWatcher_&&this.unregisterSelectWatcher_()},Ft.Controller_.prototype.selectTab=function(e){var t=this,r=e.source;this.selectedTab=r.label,this.unregisterSelectWatcher_&&(this.unregisterSelectWatcher_(),this.unregisterSelectWatcher_=null),null!==e.configuration&&(this.unregisterSelectWatcher_=this.$scope_.$watchCollection(function(){return e.configuration.selectedRows},function(e,r){Object.keys(e)!==Object.keys(r)&&t.onSelectionChanged_()})),this.updateFeatures_(e),this.reflowGrid_()},Ft.Controller_.prototype.reflowGrid_=function(){var e=this.escapeValue(this.selectedTab||""),t=this.$element_.find("div.tab-pane#"+e);t.removeClass("active").addClass("active"),this.$timeout_(function(){t.find("div.ngeo-grid-table-container table").trigger("reflow")})},Ft.Controller_.prototype.onSelectionChanged_=function(){if(null!==this.selectedTab){var e=this.gridSources[""+this.selectedTab];this.updateFeatures_(e)}},Ft.Controller_.prototype.updateFeatures_=function(e){if(this.features_.clear(),this.highlightFeatures_.clear(),null!==e.configuration){var t=""+e.source.label,r=this.featuresForSources_[t],a=e.configuration.selectedRows;for(var n in r){var o=r[n];n in a?this.highlightFeatures_.push(o):this.features_.push(o)}}},Ft.Controller_.prototype.getActiveGridSource=function(){return null===this.selectedTab?null:this.gridSources[""+this.selectedTab]},Ft.Controller_.prototype.isOneSelected=function(){var e=this.getActiveGridSource();return null!==e&&null!==e.configuration&&e.configuration.getSelectedCount()>0},Ft.Controller_.prototype.getSelectedRowCount=function(){var e=this.getActiveGridSource();return null===e||null===e.configuration?0:e.configuration.getSelectedCount()},Ft.Controller_.prototype.selectAll=function(){var e=this.getActiveGridSource();null!==e&&e.configuration.selectAll()},Ft.Controller_.prototype.unselectAll=function(){var e=this.getActiveGridSource();null!==e&&e.configuration.unselectAll()},Ft.Controller_.prototype.invertSelection=function(){var e=this.getActiveGridSource();null!==e&&e.configuration.invertSelection()},Ft.Controller_.prototype.zoomToSelection=function(){if(null!==this.getActiveGridSource()){var e=Lt.j();this.highlightFeatures_.forEach(function(t){Lt.q(e,t.getGeometry().getExtent())});var t=this.map_.getSize();p.a.assert(void 0!==t);var r=this.maxRecenterZoom;this.map_.getView().fit(e,{size:t,maxZoom:r})}},Ft.Controller_.prototype.downloadCsv=function(){var e=this.getActiveGridSource();if(null!==e){var t=e.configuration.columnDefs;p.a.assert(void 0!==t);var r=e.configuration.getSelectedRows();this.ngeoCsvDownload_.startDownload(r,t,this.filename_)}},Ft.controller("GmfDisplayquerygridController",Ft.Controller_);var Rt=Ft,Dt=angular.module("ngeoMiscSwipe",[]);Dt.factory("$verticalSwipe",[function(){var e={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup",cancel:"pointercancel"}};function t(e){var t=e.originalEvent||e,r=t.touches&&t.touches.length?t.touches:[t],a=t.changedTouches&&t.changedTouches[0]||r[0];return{x:a.clientX,y:a.clientY}}function r(t,r){var a=[];return angular.forEach(t,function(t){var n=e[t][r];n&&a.push(n)}),a.join(" ")}return{bind:function(e,a,n){var o=void 0,i=void 0,s=void 0,l=void 0,u=!1;n=n||["mouse","touch","pointer"],e.on(r(n,"start"),function(e){s=t(e),u=!0,o=0,i=0,l=s,a.start&&a.start(s,e)});var c=r(n,"cancel");c&&e.on(c,function(e){u=!1,a.cancel&&a.cancel(e)}),e.on(r(n,"move"),function(e){if(u&&s){var r=t(e);if(o+=Math.abs(r.x-l.x),i+=Math.abs(r.y-l.y),l=r,!(o<10&&i<10))return o>i?(u=!1,void(a.cancel&&a.cancel(e))):(e.preventDefault(),void(a.move&&a.move(r,e)))}}),e.on(r(n,"end"),function(e){u&&(u=!1,a.end&&a.end(t(e),e))})}}}]),Dt.makeSwipeDirective_=function(e,t,r){Dt.directive(e,["$parse","$verticalSwipe",function(a,n){var o=75,i=.3,s=30;return function(l,u,c){var h=a(c[e]),p=void 0,g=void 0;var d=["touch"];angular.isDefined(c.ngeoSwipeDisableMouse)||d.push("mouse"),n.bind(u,{start:function(e,t){p=e,g=!0},cancel:function(e){g=!1},end:function(e,a){(function(e){if(!p)return!1;var r=(e.y-p.y)*t,a=Math.abs(e.x-p.x);return g&&a<o&&r>0&&r>s&&a/r<i})(e)&&l.$apply(function(){u.triggerHandler(r),h(l,{$event:a})})}},d)}}])},Dt.makeSwipeDirective_("ngeoSwipeDown",1,"swipedown"),Dt.makeSwipeDirective_("ngeoSwipeUp",-1,"swipeup");var kt=Dt,$t=(r(302),r(393),r(391),r(242),angular.module("gmfQueryWindowComponent",[Ge.a.module.name,be.a.module.name,kt.name,ce.a.module.name,"ngAnimate","ngTouch"]));function Ot(e,t,r){return r(e,t)}$t.config(["$animateProvider",function(e){e.classNameFilter(/gmf-animatable/)}]),$t.value("gmfDisplayquerywindowTemplateUrl",function(e,t){var r=t.gmfDisplayquerywindowTemplateurl;return void 0!==r?r:"gmf/query/windowComponent"}),$t.run(["$templateCache",function(e){e.put("gmf/query/windowComponent",r(389))}]),Ot.$inject=["$element","$attrs","gmfDisplayquerywindowTemplateUrl"],$t.component_={controller:"GmfDisplayquerywindowController as ctrl",bindings:{draggableContainment:"<?gmfDisplayquerywindowDraggableContainment",featuresStyleFn:"&gmfDisplayquerywindowFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerywindowSelectedfeaturestyle",defaultCollapsedFn:"&?gmfDisplayquerywindowDefaultcollapsed",desktop:"=gmfDisplayquerywindowDesktop",showUnqueriedLayers:"=gmfDisplayquerywindowShowunqueriedlayers"},templateUrl:Ot},$t.component("gmfDisplayquerywindow",$t.component_),$t.Controller_=function(e,t,r,a,n){var o=this;this.draggableContainment,this.desktop=!1,this.collapsed=!this.desktop,this.showUnqueriedLayers_=!1,this.sourcesFilter={queried:!0},this.ngeoQueryResult={sources:[],total:0,pending:!1},this.ngeoMapQuerent_=a,this.selectedSource=null,this.features_=new Pe.b,this.ngeoFeatureOverlayMgr_=n,this.highlightFeatures_=new Pe.b,this.source=null,this.feature=null,this.currentResult=-1,this.isNext=!0,this.animate=0,this.open=!1,this.element_=e,t.$watchCollection(function(){return r},function(e,t){o.updateQueryResult_(e),e.total>0?o.show():t!==e&&o.close()})},$t.Controller_.$inject=["$element","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr"],$t.Controller_.prototype.$onInit=function(){this.draggableContainment=this.draggableContainment||"document",this.desktop=this.desktop,this.collapsed=this.defaultCollapsedFn?!0===this.defaultCollapsedFn():!this.desktop,this.showUnqueriedLayers_=!!this.showUnqueriedLayers&&!0===this.showUnqueriedLayers,this.sourcesFilter=this.showUnqueriedLayers_?{}:{queried:!0};var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this.featuresStyleFn();void 0!==t&&(p.a.assertInstanceof(t,Me.c),e.setStyle(t));var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this.selectedFeatureStyleFn();if(void 0!==a)p.a.assertInstanceof(a,Me.c);else{var n=new xe.a({color:[255,0,0,.6]}),o=new Mt.a({color:[255,0,0,1],width:2});a=new Me.c({fill:n,image:new Pt.a({fill:n,radius:5,stroke:o}),stroke:o})}r.setStyle(a),this.desktop&&(this.element_.find(".gmf-displayquerywindow .windowcontainer").draggable({cancel:"input,textarea,button,select,option,tr",containment:this.draggableContainment}),this.element_.find(".gmf-displayquerywindow .windowcontainer").resizable({minHeight:240,minWidth:240}))},$t.Controller_.prototype.show=function(){this.clear(),this.updateFeatures_()},$t.Controller_.prototype.updateFeatures_=function(){this.setCurrentResult_(0,!1),null!==this.source&&(this.collectFeatures_(),this.highlightCurrentFeature_(),this.open=!0)},$t.Controller_.prototype.setCurrentResult_=function(e,t){var r=!1;if(e!==this.currentResult){var a=void 0,n=void 0,o=void 0,i=this.feature,s=this.ngeoQueryResult.sources;for(this.currentResult=e,a=0;a<s.length;a++)if(n=s[a],null===this.selectedSource||this.selectedSource===n){if(!(e>=(o=n.features).length)){this.source=n,this.feature=n.features[e],r=!0;break}e-=o.length}t&&this.highlightCurrentFeature_(i)}return r},$t.Controller_.prototype.previous=function(){var e=this.currentResult-1;e<0&&(e=this.getResultLength()-1),this.setCurrentResult_(e,!0)&&this.animate_(!1)},$t.Controller_.prototype.next=function(){var e=this.currentResult+1;e>this.getResultLength()-1&&(e=0),this.setCurrentResult_(e,!0)&&this.animate_(!0)},$t.Controller_.prototype.updateQueryResult_=function(e){this.ngeoQueryResult.total=0,this.ngeoQueryResult.sources.length=0;for(var t=0;t<e.sources.length;t++){var r=e.sources[t];r.features=r.features.filter(function(e){return p.a.assert(e),!Y.d(be.a.getFilteredFeatureValues(e))}),this.ngeoQueryResult.sources.push(r),this.ngeoQueryResult.total+=r.features.length}},$t.Controller_.prototype.getResultLength=function(){return null===this.selectedSource?this.ngeoQueryResult.total:this.selectedSource.features.length},$t.Controller_.prototype.isFirst=function(){return 0==this.currentResult},$t.Controller_.prototype.isLast=function(){return this.currentResult==this.getResultLength()-1},$t.Controller_.prototype.getFeatureValues=function(){return this.feature?be.a.getFilteredFeatureValues(this.feature):null},$t.Controller_.prototype.animate_=function(e){this.isNext=e,this.animate++},$t.Controller_.prototype.collectFeatures_=function(){var e=this.ngeoQueryResult.sources;this.features_.clear();for(var t=0;t<e.length;t++){var r=e[t];if(null===this.selectedSource||this.selectedSource===r)for(var a=r.features,n=0;n<a.length;n++)this.features_.push(a[n])}},$t.Controller_.prototype.highlightCurrentFeature_=function(e){this.highlightFeatures_.clear(),this.features_.remove(this.feature),this.highlightFeatures_.push(this.feature),void 0!==e&&this.features_.push(e)},$t.Controller_.prototype.close=function(){this.open=!1,this.clear(),this.ngeoMapQuerent_.clear()},$t.Controller_.prototype.clear=function(){this.feature=null,this.source=null,this.currentResult=-1,this.features_.clear(),this.highlightFeatures_.clear(),this.selectedSource=null},$t.Controller_.prototype.setSelectedSource=function(e){null!==e&&e.features.length<=0||(this.clear(),this.selectedSource=e,this.updateFeatures_())},$t.controller("GmfDisplayquerywindowController",$t.Controller_);var It=$t,Nt=(r(464),r(463),angular.module("gmfQueryExtraModule",[Rt.name,It.name])),Gt=r(333),Ut=r(255),jt=(r(462),angular.module("gmfSearchModule",[Gt.a.name,Ut.a.module.name])),Vt=r(149),Ht=angular.module("gmfThemeSelectorComponent",[Vt.a.module.name,h.a.module.name]);function Wt(e,t){return t(e)}Ht.run(["$templateCache",function(e){e.put("gmf/theme/selectorComponent",r(380))}]),Ht.value("gmfThemeSelectorTemplateUrl",function(e){var t=e.gmfThemeSelectorTemplateUrl;return void 0!==t?t:"gmf/theme/selectorComponent"}),Wt.$inject=["$attrs","gmfThemeSelectorTemplateUrl"],Ht.component_={bindings:{filter:"<gmfThemeselectorFilter"},controller:"gmfThemeselectorController",templateUrl:Wt},Ht.component("gmfThemeselector",Ht.component_),Ht.Controller_=function(e,t,r){this.gmfThemeManager=t,this.gmfThemes_=r,this.themes,this.filter,this.listenerKeys_=[],this.listenerKeys_.push(T.a(this.gmfThemes_,"change",this.setThemes_,this)),e.$on("$destroy",this.handleDestroy_.bind(this))},Ht.Controller_.$inject=["$scope","gmfThemeManager","gmfThemes"],Ht.Controller_.prototype.setThemes_=function(){var e=this;this.gmfThemes_.getThemesObject().then(function(t){e.themes=e.filter?t.filter(e.filter):t})},Ht.Controller_.prototype.setTheme=function(e,t){e&&this.gmfThemeManager.addTheme(e,t)},Ht.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(T.e),this.listenerKeys_.length=0},Ht.controller("gmfThemeselectorController",Ht.Controller_);var Bt=Ht,qt=angular.module("gmfThemeModule",[Bt.name,Vt.a.module.name,h.a.module.name]),zt=(r(308),function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}());var Yt=angular.module("ngeoMessageDisplaywindowComponent",["ngSanitize"]);function Kt(e,t){return t(e)}Yt.run(["$templateCache",function(e){e.put("ngeo/message/displaywindowComponent",r(379))}]),Yt.value("ngeoMessageDisplaywindowTemplateUrl",function(e){var t=e.ngeoMessageDisplaywindowTemplateUrl;return void 0!==t?t:"ngeo/message/displaywindowComponent"}),Kt.$inject=["$attrs","ngeoMessageDisplaywindowTemplateUrl"],Yt.Controller_=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clearOnClose,this.content=null,this.contentTemplate=null,this.contentScope=null,this.draggable,this.draggableContainment,this.desktop,this.height=null,this.open,this.resizable,this.title=null,this.url=null,this.width=null,this.element_=t,this.sce_=r,this.scope_=a,this.compile_=n}return e.$inject=["$element","$sce","$scope","$compile"],e.prototype.$onInit=function(){if(this.clearOnClose=!1!==this.clearOnClose,this.content=this.content||null,this.contentTemplate=this.contentTemplate||null,this.contentScope=this.contentScope||null,this.desktop=!1!==this.desktop,this.draggableContainment=this.draggableContainment||"document",this.open=!0===this.open,this.height=this.height||"240px",this.width=this.width||"240px",this.draggable=void 0!==this.draggable?this.draggable:this.desktop,this.resizable=void 0!==this.resizable?this.resizable:this.desktop,this.draggable&&this.element_.find(".ngeo-displaywindow .windowcontainer").draggable({containment:this.draggableContainment,handle:"div.header"}),this.resizable&&this.element_.find(".ngeo-displaywindow .windowcontainer").resizable({minHeight:240,minWidth:240}),this.contentTemplate){var e=p.a.assert(this.contentScope||this.scope_),t=this.compile_(this.contentTemplate)(e);this.element_.find(".ngeo-displaywindow .windowcontainer .animation-container").append(t)}},e.prototype.close=function(){this.open=!1,this.clearOnClose&&this.clear_()},e.prototype.clear_=function(){this.content=null,this.title=null,this.url=null},zt(e,[{key:"style",get:function(){return{height:this.height,width:this.width}}},{key:"urlTrusted",get:function(){if(this.url)return this.sce_.trustAsResourceUrl(this.url)}}]),e}(),Yt.component("ngeoDisplaywindow",{bindings:{clearOnClose:"<?",content:"=?",contentTemplate:"<?",contentScope:"<?",desktop:"<?",draggable:"<?",draggableContainment:"<?",height:"=?",open:"=?",resizable:"<?",title:"=?",url:"=?",width:"=?"},controller:Yt.Controller_,templateUrl:Kt});var Qt=Yt,Xt=r(254),Zt=r(160),Jt=r(63),er=angular.module("ngeoControl",[]);er.component_=function(){return{restrict:"A",link:function(e,t,r){var a=e.$eval(r.ngeoControl);p.a.assertInstanceof(a,Jt.a);var n=e.$eval(r.ngeoControlMap);p.a.assertInstanceof(n,et.a),a.setTarget(t[0]),n.addControl(a)}}},er.directive("ngeoControl",er.component_);var tr=er,rr=r(158),ar=r(269),nr=angular.module("ngeoFilereader",[]);nr.component_=function(e){return{restrict:"A",scope:{fileContent:"=ngeoFilereader",supported:"=?ngeoFilereaderSupported"},link:function(t,r,a){var n="FileReader"in e;t.supported=n,n&&r.on("change",function(r){var a=new e.FileReader;a.onload=function(e){t.$apply(function(){t.fileContent=e.target.result})},a.readAsText(r.target.files[0])})}}},nr.component_.$inject=["$window"],nr.directive("ngeoFilereader",nr.component_);var or=nr,ir=angular.module("ngeoGetBrowserLanguage",[]);ir.factory_=function(e){return function(t){var r=e.navigator,a=r.languages||r.language||r.browserLanguage||r.systemLanguage||r.userLanguage;return Array.isArray(a)||(a=[a]),(a=(a=a.map(function(e){return e.substring(0,2)})).filter(function(e,t,r){return r.indexOf(e)==t})).filter(function(e){return-1!=t.indexOf(e)})[0]}},ir.factory_.$inject=["$window"],ir.factory("ngeoGetBrowserLanguage",ir.factory_);var sr=ir,lr=r(331),ur=r(166),cr=angular.module("ngeoMiscExtraModule",[Xt.a.module.name,Zt.a.name,tr.name,_e.a.name,rr.a.name,ne.a.module.name,be.a.module.name,ar.a.module.name,or.name,pt.a.name,sr.name,lr.a.name,ur.a.module.name,we.a.module.name,q.a.module.name]),hr=angular.module("ngeoMapQuery",[ce.a.module.name]);hr.directive_=function(e,t){return{restrict:"A",scope:!1,link:function(r,a,n){var o=r.$eval(n.ngeoMapQueryMap),i=null,s=null,l=function(t){var r=t.coordinate;e.issue({coordinate:r,map:o})},u=function(e){if(!e.dragging){var t=o.getEventPixel(e.originalEvent),r=o.forEachLayerAtPixel(t,function(){return!0},void 0,function(e){var t=e.get("visible"),r=e.get("querySourceIds");return t&&!!r});o.getTargetElement().style.cursor=r?"pointer":""}};r.$watch(n.ngeoMapQueryActive,function(a,c){a?(i=T.a(o,"singleclick",l),(t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{}).cursorHover&&(s=T.a(o,"pointermove",u))):(null!==i&&(T.e(i),i=null),null!==s&&(T.e(s),s=null),!1!==r.$eval(n.ngeoMapQueryAutoclear)&&e.clear())})}}},hr.directive_.$inject=["ngeoMapQuerent","$injector"],hr.directive("ngeoMapQuery",hr.directive_);var pr=hr,gr=r(260),dr=r(57),fr=r(213),mr=function(e,t,r){var a=this,n=r;this.url_=n.url,this.maxFeatures_=void 0!==n.maxFeatures?n.maxFeatures:50,this.wfsTypes_={},p.a.assertArray(n.wfsTypes,"wfsTypes is not correctly set"),n.wfsTypes.forEach(function(e){a.wfsTypes_[e.featureType]=e}),this.defaultFeatureNS_=n.defaultFeatureNS,this.defaultFeaturePrefix_=n.defaultFeaturePrefix,this.pointRecenterZoom_=n.pointRecenterZoom,this.$http_=e,this.result_=t};mr.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"],mr.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"],mr.prototype.clear=function(){this.clearResult_()},mr.prototype.issue=function(e,t){p.a.assert(this.url_,"url is not set. to use the wfs permalink service, set the value `ngeoWfsPermalinkOptions`"),this.clearResult_();var r=e.wfsType;if(this.wfsTypes_.hasOwnProperty(r)){var a=this.wfsTypes_[r],n=this.createFilters_(e.filterGroups);null!==n&&this.issueRequest_(a,n,t,e.showFeatures)}},mr.prototype.issueRequest_=function(e,t,r,a){var n=this,o=new fr.a,i=o.writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:void 0!==e.featureNS?e.featureNS:this.defaultFeatureNS_,featurePrefix:void 0!==e.featurePrefix?e.featurePrefix:this.defaultFeaturePrefix_,featureTypes:[e.featureType],outputFormat:"GML3",filter:t,maxFeatures:this.maxFeatures_}),s=(new XMLSerializer).serializeToString(i);this.$http_.post(this.url_,s,{headers:{"Content-Type":"text/xml; charset=UTF-8"}}).then(function(t){var i=o.readFeatures(t.data);if(0!=i.length){var s=r.getSize();if(void 0!==s){var l=n.pointRecenterZoom_;r.getView().fit(n.getExtent_(i),{size:s,maxZoom:l,padding:[10,10,10,10]})}if(a){var u={features:i,id:e.featureType,identifierAttributeField:e.label,label:e.featureType,pending:!1};n.result_.sources.push(u),n.result_.total=i.length}}})},mr.prototype.getExtent_=function(e){return e.reduce(function(e,t){return Lt.q(e,t.getGeometry().getExtent())},Lt.j())},mr.prototype.createFilters_=function(e){if(0==e.length)return null;var t=dr;return mr.or_(e.map(function(e){var r=e.filters.map(function(e){var r=e.condition;return Array.isArray(r)?mr.or_(r.map(function(r){return t.equalTo(e.property,r)})):t.equalTo(e.property,e.condition)});return mr.and_(r)}))},mr.and_=function(e){return mr.joinFilters_(e,dr.and)},mr.or_=function(e){return mr.joinFilters_(e,dr.or)},mr.joinFilters_=function(e,t){return e.reduce(function(e,r){return null===e?r:(p.a.assert(null!==r),t(e,r))},null)},mr.prototype.clearResult_=function(){this.result_.total=0,this.result_.sources.forEach(function(e){e.features.length=0})},(mr.module=angular.module("ngeoWfsPermalink",[])).value("ngeoWfsPermalinkOptions",{url:"",wfsTypes:[],defaultFeatureNS:"",defaultFeaturePrefix:""}),mr.module.service("ngeoWfsPermalink",mr);var yr=mr,vr=function(e,t,r){var a=this;this.ngeoLocation=r.get("ngeoLocation"),this.ngeoLocation.hasParam("debug")&&(window.injector=r),p.a.assertInstanceof(this.map,et.a),r.get("ngeoFeatureHelper").setProjection(p.a.assert(this.map.getView().getProjection())),this.gmfThemeManager=r.get("gmfThemeManager"),this.gmfTreeManager_=r.get("gmfTreeManager"),this.gmfThemes_=r.get("gmfThemes"),this.permalink_=r.get("gmfPermalink");var n=r.get("gmfAuthenticationService");this.hasEditableLayers=!1,this.updateHasEditableLayers_=function(){var e=this;this.gmfThemes_.hasEditableLayers().then(function(t){e.hasEditableLayers=t})};var o=function(e){var t=e.detail.user,r=null!==t.username?t.role_id:void 0;a.gmfThemes_.getThemesObject().then(function(e){var t=a.gmfUser.functionalities;t&&t.open_panel&&"layer_filter"===t.open_panel[0]&&(a.filterSelectorActive=!0)});var n=a.gmfThemeManager.getThemeName();a.gmfThemeManager.setThemeName("",!0),"ready"!==e.type&&a.updateCurrentTheme_(n),a.gmfThemes_.loadThemes(r),a.updateHasEditableLayers_()};T.a(n,"ready",o),T.a(n,"login",o),T.a(n,"logout",o),this.searchDatasources=[{labelKey:"label",groupValues:r.get("gmfSearchGroups"),groupActions:r.get("gmfSearchActions"),projection:"EPSG:"+(e.srid||21781),url:r.get("fulltextsearchUrl")}],this.dimensions={},this.permalink_.setDimensions(this.dimensions);var i=r.get("gmfDataSourcesManager");if(i.setDatasourceMap(this.map),i.setDimensions(this.dimensions),r.has("gmfDefaultDimensions")){var s=r.get("gmfDefaultDimensions");for(var l in s)void 0===this.dimensions[l]&&(this.dimensions[l]=s[l])}this.backgroundLayerMgr_=r.get("ngeoBackgroundLayerMgr"),t.$watchCollection(function(){return a.dimensions},function(){a.backgroundLayerMgr_.updateDimensions(a.map,a.dimensions)}),this.backgroundLayerMgr_.on("change",function(){a.backgroundLayerMgr_.updateDimensions(a.map,a.dimensions)}),this.leftNavVisible=!1,this.rightNavVisible=!1;var u=new xe.a({color:[255,170,0,.6]}),c=new Mt.a({color:[255,170,0,1],width:2});this.queryFeatureStyle=new Me.c({fill:u,image:new Pt.a({fill:u,radius:5,stroke:c}),stroke:c}),this.filterSelectorActive=!1,this.queryActive=!0,this.queryAutoClear=!0,this.printPanelActive=!1,this.printActive=!1,this.ngeoMapQuerent_=r.get("ngeoMapQuerent"),t.$watch(function(){return a.printPanelActive},function(e){e||a.queryActive||a.ngeoMapQuerent_.clear(),a.queryAutoClear=!e,a.printActive=e}),this.measurePointActive=!1,this.measureLengthActive=!1,this.drawFeatureActive=!1,this.drawProfilePanelActive=!1,this.gmfUser=r.get("gmfUser"),this.getBrowserLanguage=r.get("ngeoGetBrowserLanguage"),this.stateManager=r.get("ngeoStateManager"),this.tmhDynamicLocale=r.get("tmhDynamicLocale"),this.$scope=t,this.lang,this.defaultLang=r.get("defaultLang"),this.langUrls=r.get("langUrls"),this.gettextCatalog=r.get("gettextCatalog"),this.initLanguage();this.mapToolsGroup="mapTools",r.get("ngeoFeatureOverlayMgr").init(this.map);var h=r.get("ngeoToolActivateMgr"),g=new Ce.a(this,"queryActive");h.registerTool("mapTools",g,!0);var d=new Ce.a(this,"measurePointActive");h.registerTool("mapTools",d,!1);var f=new Ce.a(this,"measureLengthActive");h.registerTool("mapTools",f,!1);var m=new Ce.a(this,"drawFeatureActive");h.registerTool("mapTools",m,!1);var y=new Ce.a(this,"drawProfilePanelActive");h.registerTool("mapTools",y,!1);var v=new Ce.a(this,"printPanelActive");h.registerTool("mapTools",v,!1),t.$root.$on(Vt.a.EventType.THEME_NAME_SET,function(e,t){a.gmfThemes_.getThemeObject(t).then(function(e){a.setDefaultBackground_(e)})}),this.updateCurrentBackgroundLayer_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;if(e||(a=t.permalink_.getBackgroundLayer(r)),!a){var n=t.gmfUser.functionalities;if(n){var o=n.default_basemap;if(o.length>0){var i=o[0];a=D.d(r,function(e){return e.get("label")===i})}}}!a&&r[1]&&(a=r[1]),a&&t.backgroundLayerMgr_.set(t.map,a)})}.bind(this),this.updateCurrentBackgroundLayer_(!1);var _=window.gmfx||{};window.gmfx=_,_.openIframePopup=function(e,t,r,n,o){a.displaywindowUrl=e,_.openPopup_(t,r,n,o)},_.openTextPopup=function(e,t,r,n,o){a.displaywindowContent=e,_.openPopup_(t,r,n,o)},_.openPopup_=function(e,t,r,n){a.displaywindowTitle=e,a.displaywindowOpen=!0,t&&(a.displaywindowWidth=t+"px"),r&&(a.displaywindowHeight=r+"px"),!1!==n&&a.$scope.$apply()},this.manageResize=!1,this.resizeTransition;var S=window.cgxp||{};window.cgxp=S,S.tools=window.cgxp.tools||{},S.tools.openInfoWindow=function(e,t,r,a,n){_.openIframePopup(e,t,r,a,n)},this.displaywindowContent=null,this.displaywindowDraggableContainment=".gmf-map",this.displaywindowHeight="50vh",this.displaywindowOpen=!1,this.displaywindowTitle=null,this.displaywindowUrl=null,this.displaywindowWidth="50vw"};vr.$inject=["config","$scope","$injector"],vr.$inject=["config","$scope","$injector"],vr.prototype.userMustChangeItsPassword=function(){return!1===this.gmfUser.is_password_changed},vr.getLayerByLabels=function(e,t){return t&&t.length>0?D.d(e,function(e){return e.get("label")===t[0]}):null},vr.prototype.switchLanguage=function(e){p.a.assert(e in this.langUrls),this.gettextCatalog.setCurrentLanguage(e),this.gettextCatalog.loadRemote(this.langUrls[e]),this.tmhDynamicLocale.set(e),this.lang=e},vr.prototype.initLanguage=function(){var e=this;this.$scope.$watch(function(){return e.lang},function(t){e.stateManager.updateState({lang:t})});var t=this.getBrowserLanguage(Object.keys(this.langUrls)),r=this.stateManager.getInitialValue("lang");return void 0!==r&&r in this.langUrls?void this.switchLanguage(r):void 0!==t&&t in this.langUrls?void this.switchLanguage(t):void this.switchLanguage(this.defaultLang)},vr.prototype.setDefaultBackground_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;!(a=t.permalink_.getBackgroundLayer(r))&&t.gmfUser.functionalities&&(a=vr.getLayerByLabels(r,t.gmfUser.functionalities.default_basemap)),!a&&e&&(a=vr.getLayerByLabels(r,e.functionalities.default_basemap)),a||(a=r[r.length>1?1:0]),p.a.assert(a),t.backgroundLayerMgr_.set(t.map,a)})},vr.prototype.updateCurrentTheme_=function(e){var t=this;this.gmfThemes_.getThemesObject().then(function(r){var a=t.permalink_.defaultThemeNameFromFunctionalities();if(a){var n=h.a.findThemeByName(r,a);n&&t.gmfThemeManager.addTheme(n,!0)}else t.gmfThemeManager.setThemeName(e)})},vr.prototype.getLocationIcon=function(){var e=document.createElement("span");e.className="fa fa-location-arrow",e.style.transform="rotate(-0.82rad)";var t=document.createElement("span");return t.appendChild(e),t},(vr.module=angular.module("GmfAbstractAppControllerModule",["gettext","tmh.dynamicLocale",c.name,L.name,Z.name,ie.name,He.name,Ye.name,vt.name,Nt.name,jt.name,qt.name,Qt.name,cr.name,be.a.module.name,ce.a.module.name,pr.name,gr.a.name,yr.module.name])).controller("AbstractController",vr),vr.module.value("ngeoExportFeatureFormats",[be.a.FormatType.KML,be.a.FormatType.GPX]),vr.module.config(["tmhDynamicLocaleProvider","angularLocaleScript",function(e,t){e.localeLocationPattern(t)}]);t.a=vr},,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(62),o=r(17),i=r(68),s=r(163),l=r(178),u=r(3),c=r(37),h=r(123),p=r(23),g=r(2),d=r(5),f=r(235),m=r(50),y=r(45),v=r(47),_=r(24),S=r(102),b=r(93),C=r(236),w=function e(t){var r=this;a.a.assert(t.features),_.b.call(this,{handleDownEvent:e.handleDownEvent_,handleDragEvent:e.handleDragEvent_,handleEvent:e.handleEvent,handleUpEvent:e.handleUpEvent_}),this.vertexFeature_=null,this.lastPixel_=[0,0],this.modified_=!1,this.rBush_=new C.a,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=null,this.overlay_=new S.a({source:new b.b({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style||s.a.getDefaultModifyStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=t.features,this.features_.forEach(function(e){return r.addFeature_(e)}),g.a(this.features_,"add",this.handleFeatureAdd_,this),g.a(this.features_,"remove",this.handleFeatureRemove_,this)};u.d(w,_.b),w.prototype.addFeature_=function(e){if("Polygon"===e.getGeometry().getType()&&e.get(o.a.IS_CIRCLE)){var t=e.getGeometry();this.writeCircleGeometry_(e,t);var r=this.getMap();r&&this.handlePointerAtPixel_(this.lastPixel_,r)}},w.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=!0;var t=new i.a("modifystart",{features:this.features_});this.dispatchEvent(t)}},w.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},w.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach(function(t){e===t.feature&&r.push(t)});for(var a=r.length-1;a>=0;--a)t.remove(r[a])},w.prototype.setMap=function(e){this.overlay_.setMap(e),_.b.prototype.setMap.call(this,e)},w.prototype.handleFeatureAdd_=function(e){var t=e.element;a.a.assertInstanceof(t,c.a,"feature should be an ol.Feature"),this.addFeature_(t)},w.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},w.prototype.writeCircleGeometry_=function(e,t){var r,a=t.getCoordinates(),n=void 0,o=void 0,i=void 0,s=void 0,l=void 0,u=void 0;for(s=0,r=a.length;s<r;++s)for(o=0,i=(n=a[s]).length-1;o<i;++o)u={feature:e,geometry:t,depth:[s],index:o,segment:l=n.slice(o,o+2)},this.rBush_.insert(d.b(l),u)},w.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(t=new c.a(new y.a(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t));return t},w.compareIndexes_=function(e,t){return e.index-t.index},w.handleDownEvent_=function(e){this.handlePointerAtPixel_(e.pixel,e.map),this.dragSegments_=[],this.modified_=!1;var t=this.vertexFeature_;if(t){var r=t.getGeometry().getCoordinates(),a=d.b([r]),n=this.rBush_.getInExtent(a),o={};n.sort(w.compareIndexes_);for(var i=0,s=n.length;i<s;++i){var l=n[i],c=l.segment,h=u.c(l.feature),g=l.depth;g&&(h+="-"+g.join("-")),o[h]||(o[h]=new Array(2)),p.e(c[0],r)&&!o[h][0]?(this.dragSegments_.push([l,0]),o[h][0]=l):p.e(c[1],r)&&!o[h][1]&&(this.dragSegments_.push([l,1]),o[h][1]=l)}}return!!this.vertexFeature_},w.handleDragEvent_=function(e){this.willModifyFeatures_(e);var t=e.coordinate,r=this.dragSegments_[0][0].geometry,a=d.x(r.getExtent()),n=new m.a([a,t]),i=new f.a(a,n.getLength()),s=Object(v.b)(i,64).getCoordinates();this.setGeometryCoordinates_(r,s);var u=l.a.getAzimut(n);this.features_.getArray()[0].set(o.a.AZIMUT,u),this.createOrUpdateVertexFeature_(t)},w.handleUpEvent_=function(e){if(this.rBush_.clear(),this.writeCircleGeometry_(this.dragSegments_[0][0].feature,this.dragSegments_[0][0].geometry),this.modified_){var t=new i.a("modifyend",{features:this.features_});this.dispatchEvent(t),this.modified_=!1}return!1},w.handleEvent=function(e){if(!(e instanceof h.a))return!0;return e.map.getView().getInteracting()||"pointermove"!=e.type||this.handlingDownUpSequence||this.handlePointerMove_(e),_.c.call(this,e)&&!0},w.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},w.prototype.handlePointerAtPixel_=function(e,t){var r=t.getCoordinateFromPixel(e),a=t.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),n=t.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),o=d.b([a,n]),i=this.rBush_.getInExtent(o);if(i.length>0){i.sort(function(e,t){return p.i(r,e.segment)-p.i(r,t.segment)});var s=i[0].segment,l=p.c(r,s),c=t.getPixelFromCoordinate(l);if(Math.sqrt(p.h(e,c))<=this.pixelTolerance_){var h=t.getPixelFromCoordinate(s[0]),g=t.getPixelFromCoordinate(s[1]),f=p.h(c,h),m=p.h(c,g),y=Math.sqrt(Math.min(f,m));if(this.snappedToVertex_=y<=this.pixelTolerance_,this.snappedToVertex_){l=f>m?s[1]:s[0],this.createOrUpdateVertexFeature_(l);var v={};v[u.c(s)]=!0;for(var _=void 0,S=1,b=i.length;S<b&&(_=i[S].segment,p.e(s[0],_[0])&&p.e(s[1],_[1])||p.e(s[0],_[1])&&p.e(s[1],_[0]));++S)v[u.c(_)]=!0;return}}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},w.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1};var T=w,E=function(e){var t=this;a.a.assert(e.features),_.b.call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_}),this.modified_=!1,this.vectorPoints_=new S.a({source:new b.b({wrapX:!!e.wrapX}),visible:this.getActive(),style:e.style||s.a.getDefaultModifyStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=e.features,this.feature_=null,this.cache_={},this.params_=null,g.a(this.features_,"add",this.handleFeatureAdd_,this),g.a(this.features_,"remove",this.handleFeatureRemove_,this),this.features_.forEach(function(e){t.addFeature_(e)})};u.d(E,_.b),E.prototype.setActive=function(e){_.b.prototype.setActive.call(this,e),this.vectorPoints_&&this.vectorPoints_.setVisible(e)},E.prototype.addFeature_=function(e){var t=e.getGeometry();if(t instanceof v.a){var r=u.c(e),a=this.cache_[r];if(a)return;for(var n=this.vectorPoints_.getSource(),o=t.getCoordinates()[0];o.length>4;)o[0][0]<o[1][0]&&o[0][1]<=o[1][1]?o.pop():o.shift();var i=[],s=void 0,l=void 0;o.forEach(function(t){s=new y.a(t),l=new c.a({corner:!0,geometry:s,siblingX:null,siblingY:null,boxFeature:e}),i.push(l)},this),a={corners:i},this.cache_[r]=a;var h=void 0,p=void 0;i.forEach(function(e,t){(h=i[t-1])||(h=i[i.length-1]),(p=i[t+1])||(p=i[0]),t%2==0?(e.set("siblingX",p),e.set("siblingY",h)):(e.set("siblingX",h),e.set("siblingY",p))},this),n.addFeatures(i)}},E.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=!0;var t=new i.a("modifystart",{features:this.features_});this.dispatchEvent(t),this.params_=this.initializeParams_()}},E.prototype.initializeParams_=function(){var e=this.feature_.get("siblingX");a.a.assertInstanceof(e,c.a);var t=e.get("siblingY");a.a.assertInstanceof(t,c.a);var r=t.getGeometry();a.a.assertInstanceof(r,y.a);var n=r.getCoordinates(),o=this.getMap().getPixelFromCoordinate(n),i=t.get("siblingX");a.a.assertInstanceof(i,c.a);var s=i.getGeometry();a.a.assertInstanceof(s,y.a);var l=s.getCoordinates(),u=this.getMap().getPixelFromCoordinate(l),h=[u[0]-o[0],u[1]-o[1]],p=Math.sqrt(h[0]*h[0]+h[1]*h[1]);h[0]/=p,h[1]/=p;var g=e.getGeometry();a.a.assertInstanceof(g,y.a);var d=g.getCoordinates(),f=this.getMap().getPixelFromCoordinate(d),m=[f[0]-o[0],f[1]-o[1]],v=Math.sqrt(m[0]*m[0]+m[1]*m[1]);return m[0]/=v,m[1]/=v,isNaN(h[0])&&isNaN(m[0])?(h=[0,1],m=[1,0]):isNaN(h[0])?h=[m[1],-m[0]]:isNaN(m[0])&&(m=[h[1],-h[0]]),{originCoordinate:n,originPixel:o,siblingXPoint:s,siblingYPoint:g,vectorX:h,vectorY:m}},E.prototype.removeFeature_=function(e){for(var t=u.c(e),r=this.cache_[t].corners,a=0;a<r.length;a++)this.vectorPoints_.getSource().removeFeature(r[a]);this.feature_=null,r.length=0,delete this.cache_[t]},E.prototype.setMap=function(e){this.vectorPoints_.setMap(e),_.b.prototype.setMap.call(this,e)},E.prototype.handleFeatureAdd_=function(e){var t=e.element;a.a.assertInstanceof(t,c.a,"feature should be an ol.Feature"),this.addFeature_(t)},E.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},E.prototype.handleDown_=function(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e.get("siblingX")&&e.get("siblingY")?e:void 0});return!!t&&(this.feature_=t,!0)},E.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_,r=t.getGeometry();if(r instanceof y.a){r.setCoordinates(e.coordinate);var n=e.pixel,o=this.params_.originPixel,i=this.params_.siblingXPoint,s=this.params_.siblingYPoint,l=this.params_.vectorX,u=this.params_.vectorY,c=this.params_.originCoordinate,h=this.calculateNewPixel_(o,n,l),p=this.getMap().getCoordinateFromPixel(h);i.setCoordinates(p);var g=this.calculateNewPixel_(o,n,u),d=this.getMap().getCoordinateFromPixel(g);s.setCoordinates(d);var f=t.get("boxFeature").getGeometry();a.a.assertInstanceof(f,v.a),f.setCoordinates([[e.coordinate,p,c,d,e.coordinate]])}},E.prototype.calculateNewPixel_=function(e,t,r){var a=[t[0]-e[0],t[1]-e[1]],n=a[0]*r[0]+a[1]*r[1],o=[r[0]*n,r[1]*n];return[o[0]+e[0],o[1]+e[1]]},E.prototype.handleUp_=function(e){if(this.modified_){var t=new i.a("modifyend",{features:this.features_});this.dispatchEvent(t),this.params_=null,this.modified_=!1}return!1};var A=E,L=r(36),P=r(42),M=r(29),F=r(289),x=function(e){a.a.assert(e.features),this.features_=e.features,this.listenerKeys_=[],this.interactions_=[],this.otherFeatures_=new M.b,this.interactions_.push(new F.a({deleteCondition:n.a.deleteCondition,features:this.otherFeatures_,pixelTolerance:e.pixelTolerance,style:e.style,wrapX:e.wrapX})),this.circleFeatures_=new M.b,this.interactions_.push(new T({features:this.circleFeatures_,pixelTolerance:e.pixelTolerance,style:e.style,wrapX:e.wrapX})),this.rectangleFeatures_=new M.b,this.interactions_.push(new A({features:this.rectangleFeatures_,pixelTolerance:e.pixelTolerance,style:e.style,wrapX:e.wrapX})),P.a.call(this,{handleEvent:L.b})};u.d(x,P.a),x.prototype.setActive=function(e){P.a.prototype.setActive.call(this,e),this.setState_()},x.prototype.setMap=function(e){var t=this.interactions_,r=this.getMap();r&&t.forEach(function(e){r.removeInteraction(e)}),P.a.prototype.setMap.call(this,e),e&&t.forEach(function(t){e.addInteraction(t)}),this.setState_()},x.prototype.setState_=function(){var e=this,t=this.getMap(),r=this.getActive(),a=this.interactions_,n=this.listenerKeys_;a.forEach(function(e){e.setActive(r&&!!t)}),r&&t?(this.features_.forEach(function(t){return e.addFeature_(t)}),n.push(g.a(this.features_,"add",this.handleFeaturesAdd_,this),g.a(this.features_,"remove",this.handleFeaturesRemove_,this))):(n.forEach(g.e),n.length=0,this.features_.forEach(function(t){return e.removeFeature_(t)}))},x.prototype.handleFeaturesAdd_=function(e){var t=e.element;a.a.assertInstanceof(t,c.a,"feature should be an ol.Feature"),this.addFeature_(t)},x.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)},x.prototype.addFeature_=function(e){this.getFeatureCollection_(e).push(e)},x.prototype.removeFeature_=function(e){this.getFeatureCollection_(e).remove(e)},x.prototype.getFeatureCollection_=function(e){var t=e.get(o.a.IS_CIRCLE),r=e.get(o.a.IS_RECTANGLE);return!0===t||"true"===t?this.circleFeatures_:!0===r||"true"===r?this.rectangleFeatures_:this.otherFeatures_};t.a=x},function(e,t,r){"use strict";var a=r(1),n=r(200),o=r(17),i=r(15),s=r(160),l=r(112),u=r(56),c=r(37),h=function(e,t,r,a,n){var o=this;this.active,void 0===this.active&&(this.active=!1),this.features,this.map,this.showMeasure,this.gettextCatalog_=r,r.getString("Point"),r.getString("LineString"),r.getString("Polygon"),r.getString("Circle"),r.getString("Rectangle"),r.getString("Text"),this.featureHelper_=a,this.ngeoFeatures_=n,this.interactions_=[],this.drawPoint,this.measureLength,this.measureArea,this.measureAzimut,this.drawRectangle,this.drawText,e.$watch(function(){return o.active},function(e){!1===e&&o.interactions_.forEach(function(e){e.setActive(!1)})})};h.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoFeatures"],h.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoFeatures"],h.prototype.registerInteraction=function(e){this.interactions_.push(e),e.setActive(!1),l.a.interaction(e),this.map.addInteraction(e)},h.prototype.handleActiveChange=function(e){this.active=this.interactions_.some(function(e){return e.getActive()},this)},h.prototype.handleDrawEnd=function(e,t){var r=void 0;r=t.feature?t.feature:t.detail.feature,a.a.assert(r);var n=r.get("azimut"),s=this.features||this.ngeoFeatures_,l=new c.a(r.getGeometry()),u=o.a;switch(e){case i.a.CIRCLE:l.set(u.IS_CIRCLE,!0),void 0!==n&&l.set(u.AZIMUT,n);break;case i.a.TEXT:l.set(u.IS_TEXT,!0);break;case i.a.RECTANGLE:l.set(u.IS_RECTANGLE,!0)}var h=this.gettextCatalog_.getString(e);l.set(u.NAME,h+" "+(s.getLength()+1));var p=e!==i.a.TEXT?"#DB4436":"#000000";l.set(u.COLOR,p),l.set(u.ANGLE,0),l.set(u.OPACITY,.2),l.set(u.SHOW_MEASURE,!!this.showMeasure),l.set(u.SHOW_LABEL,!1),l.set(u.SIZE,10),l.set(u.STROKE,2),this.featureHelper_.setStyle(l),s.push(l)},(h.module=angular.module("ngeoDrawfeatureController",[n.a.name,s.a.name,u.a.module.name])).controller("ngeoDrawfeatureController",h);var p=h,g=r(2),d=r(153),f=angular.module("ngeoDrawpoint",[]);f.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(e,t,r,a){var n=new d.a({type:"Point"});a.registerInteraction(n),a.drawPoint=n,g.a(n,"drawend",a.handleDrawEnd.bind(a,i.a.POINT),a),g.a(n,"change:active",a.handleActiveChange,a)}}},f.directive("ngeoDrawpoint",f.directive_);var m=f,y=r(47),v=angular.module("ngeoDrawrectangle",[]);v.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(e,t,r,a){var n=new d.a({type:"LineString",geometryFunction:function(e,t){t||(t=new y.a(null));var r=e[0],a=e[1];return t.setCoordinates([[r,[r[0],a[1]],a,[a[0],r[1]],r]]),t},maxPoints:2});a.registerInteraction(n),a.drawRectangle=n,g.a(n,"drawend",a.handleDrawEnd.bind(a,i.a.RECTANGLE),a),g.a(n,"change:active",a.handleActiveChange,a)}}},v.directive("ngeoDrawrectangle",v.directive_);var _=v,S=angular.module("ngeoDrawtext",[]);S.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(e,t,r,a){var n=new d.a({type:"Point"});a.registerInteraction(n),a.drawText=n,g.a(n,"drawend",a.handleDrawEnd.bind(a,i.a.TEXT),a),g.a(n,"change:active",a.handleActiveChange,a)}}},S.directive("ngeoDrawtext",S.directive_);var b=S,C=r(227),w=r(18),T=angular.module("ngeoMeasurearea",[p.module.name]);T.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(n,o,s,l){var u=t.getString("Click to start drawing polygon"),c=t.getString("Click to continue drawing<br>Double-click or click starting point to finish"),h=new C.a(r("ngeoUnitPrefix"),t,{style:new w.c,startMsg:e("<div translate>"+u+"</div>")(n)[0],continueMsg:e("<div translate>"+c+"</div>")(n)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):void 0});l.registerInteraction(h),l.measureArea=h,g.a(h,"measureend",l.handleDrawEnd.bind(l,i.a.POLYGON),l),g.a(h,"change:active",l.handleActiveChange,l)}}},T.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"],T.directive("ngeoMeasurearea",T.directive_);var E=T,A=r(108),L=r(178),P=angular.module("ngeoMeasureazimut",[p.module.name,A.a.name]);P.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(n,o,s,l){var u=t.getString("Click to start drawing circle"),h=t.getString("Click to finish"),p=new L.a(r("ngeoUnitPrefix"),r("number"),{style:new w.c,startMsg:e("<div translate>"+u+"</div>")(n)[0],continueMsg:e("<div translate>"+h+"</div>")(n)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):void 0,decimals:a.has("ngeoMeasureDecimals")?a.get("ngeoMeasureDecimals"):void 0});l.registerInteraction(p),l.measureAzimut=p,g.a(p,"measureend",function(e){var t=e.detail.feature.getGeometry(),r=t.getGeometries()[1],a=Object(y.b)(r,64);e.detail.feature=new c.a(a);var n=L.a.getAzimut(t.getGeometries()[0]);e.detail.feature.set("azimut",n),l.handleDrawEnd(i.a.CIRCLE,e)},l),g.a(p,"change:active",l.handleActiveChange,l)}}},P.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"],P.directive("ngeoMeasureazimut",P.directive_);var M=P,F=r(226),x=angular.module("ngeoMeasurelength",[p.module.name,A.a.name]);x.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(n,o,s,l){var u=t.getString("Click to start drawing line"),c=t.getString("Click to continue drawing<br>Double-click or click last point to finish"),h=new F.a(r("ngeoUnitPrefix"),t,{style:new w.c,startMsg:e("<div translate>"+u+"</div>")(n)[0],continueMsg:e("<div translate>"+c+"</div>")(n)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):void 0});l.registerInteraction(h),l.measureLength=h,g.a(h,"measureend",l.handleDrawEnd.bind(l,i.a.LINE_STRING),l),g.a(h,"change:active",l.handleActiveChange,l)}}},x.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"],x.directive("ngeoMeasurelength",x.directive_);var R=x,D=angular.module("ngeoDrawfeature",[p.module.name,m.name,_.name,b.name,E.name,M.name,R.name]);D.directive_=function(){return{controller:"ngeoDrawfeatureController as dfCtrl",scope:!0,bindToController:{active:"=ngeoDrawfeatureActive",features:"=?ngeoDrawfeatureFeatures",map:"=ngeoDrawfeatureMap",showMeasure:"=?ngeoDrawfeatureShowmeasure"}}},D.directive("ngeoDrawfeature",D.directive_);t.a=D},,function(e,t,r){"use strict";var a=r(182),n=function(e,t){this.http_=e,this.baseUrl_=t,this.promises_={}};n.$inject=["$http","gmfLayersUrl"],n.$inject=["$http","gmfLayersUrl"],n.prototype.getAttributes=function(e){if(!this.promises_[e]){var t=this.baseUrl_+"/"+e+"/md.xsd";this.promises_[e]=this.http_.get(t).then(this.handleGetAttributes_.bind(this))}return this.promises_[e]},n.prototype.handleGetAttributes_=function(e){return(new a.a).read(e.data)},(n.module=angular.module("gmfXSDAttributes",[])).service("gmfXSDAttributes",n),t.a=n},function(e,t,r){"use strict";var a=r(167),n=r(148),o=function(e,t){this.http_=e,this.baseUrl_=t};o.$inject=["$http","gmfLayersUrl"],o.$inject=["$http","gmfLayersUrl"],o.prototype.getFeaturesInExtent=function(e,t){var r=n.a(this.baseUrl_+"/"+e.join(","),{bbox:t.join(",")});return this.http_.get(r).then(this.handleGetFeatures_.bind(this))},o.prototype.getFeaturesWithComparisonFilters=function(e,t){var r=[],a={},o=t,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var u=l;a[u.property+"__"+u.operator]=u.value,r.push(u.property)}a.queryable=r.join(",");var c=n.a(this.baseUrl_+"/"+e.join(","),a);return this.http_.get(c).then(this.handleGetFeatures_.bind(this))},o.prototype.handleGetFeatures_=function(e){return(new a.a).readFeatures(e.data)},o.prototype.insertFeatures=function(e,t){var r=this.baseUrl_+"/"+e,n=(new a.a).writeFeatures(t);return this.http_.post(r,n,{headers:{"Content-Type":"application/json"},withCredentials:!0})},o.prototype.updateFeature=function(e,t){var r=this.baseUrl_+"/"+e.toString()+"/"+t.getId(),n=(new a.a).writeFeature(t);return this.http_.put(r,n,{headers:{"Content-Type":"application/json"},withCredentials:!0})},o.prototype.deleteFeature=function(e,t){var r=this.baseUrl_+"/"+e.toString()+"/"+t.getId();return this.http_.delete(r,{headers:{"Content-Type":"application/json"},withCredentials:!0})},(o.module=angular.module("gmfEditFeature",[])).service("gmfEditFeature",o),t.a=o},function(e,t,r){"use strict";var a=function(e,t){this.$http_=e,this.url_=t};a.$inject=["$http","gmfRasterUrl"],a.$inject=["$http","gmfRasterUrl"],a.prototype.getRaster=function(e,t){var r=t||{};return r[a.Param.X]=e[0],r[a.Param.Y]=e[1],this.$http_.get(this.url_,{params:r}).then(this.handleGetRaster_.bind(this))},a.prototype.handleGetRaster_=function(e){return e.data},a.Param={X:"lon",Y:"lat"},(a.module=angular.module("gmfRaster",[])).service("gmfRaster",a),t.a=a},,,function(e,t,r){"use strict";var a=r(165),n=r(250);a.a.Proj.projections.add(n.a);t.a="somerc"},function(e,t,r){"use strict";var a=angular.module("ngeoColorpicker",[]);a.value("ngeoColorpickerTemplateUrl",function(e,t){var r=t.ngeoColorpickerTemplateurl;return void 0!==r?r:"ngeo/misc/colorpickerComponent"}),a.run(["$templateCache",function(e){e.put("ngeo/misc/colorpickerComponent",r(388))}]),a.component_=function(e){return{restrict:"A",scope:{colors:"<?ngeoColorpicker",color:"=?ngeoColorpickerColor"},controller:"NgeoColorpickerController as ctrl",bindToController:!0,templateUrl:e}},a.component_.$inject=["ngeoColorpickerTemplateUrl"],a.directive("ngeoColorpicker",a.component_),a.DEFAULT_COLORS=[["#F4EB37","#CDDC39","#62AF44","#009D57","#0BA9CC","#4186F0","#3F5BA9","#7C3592","#A61B4A","#DB4436","#F8971B","#F4B400","#795046"],["#F9F7A6","#E6EEA3","#B7DBAB","#7CCFA9","#93D7E8","#9FC3FF","#A7B5D7","#C6A4CF","#D698AD","#EE9C96","#FAD199","#FFDD5E","#B29189"],["#ffffff","#CCCCCC","#777","#000000"]],a.Controller_=function(e,t,r){this.colors=this.colors||a.DEFAULT_COLORS,this.color},a.Controller_.$inject=["$scope","$element","$attrs"],a.Controller_.prototype.setColor=function(e){this.color=e},a.controller("NgeoColorpickerController",a.Controller_),t.a=a},function(e,t,r){"use strict";var a=r(12),n=r(5),o=function(){};o.prototype.stringToCoordinates=function(e){var t=e.match(/([\d\.']+)[\s,]+([\d\.']+)/);if(t){var r=parseFloat(t[1].replace("'","")),a=parseFloat(t[2].replace("'",""));if(!isNaN(r)&&!isNaN(a))return[r,a]}return null},o.prototype.getProjectionList=function(e){var t=void 0,r=void 0,n=[];return e.forEach(function(e){"EPSG:"!=(t=e.toUpperCase()).substr(0,5)&&(t="EPSG:"+t),null!==(r=a.f(t))?n.push(r):console.error("The projection "+t+" is not defined in ol.proj.")}),n},o.prototype.tryProjections=function(e,t,r,o){var i=void 0;return void 0===o&&(o=[r]),o.some(function(o){try{if(i=a.k(e,o,r),n.f(t,i))return!0}catch(e){}i=null}),i},o.prototype.tryProjectionsWithInversion=function(e,t,r,a){var n=this.tryProjections(e,t,r,a);return null===n&&(n=this.tryProjections(e.reverse(),t,r,a)),n},(o.module=angular.module("ngeoAutoProjection",[])).service("ngeoAutoProjection",o),t.a=o},function(e,t,r){"use strict";var a=r(62),n=function(e,t){this.$http_=t,this.url_=e.get("fulltextsearchUrl");var r=this.url_.split("?");this.baseUrl_=r[0];var n=2==r.length?"?"+r[1]:"";this.defaultParams_=a.a.decodeQueryString(n)};n.$inject=["$injector","$http"],n.$inject=["$injector","$http"],n.prototype.search=function(e,t){var r=this,n=Object.assign({},this.defaultParams_,t);n.query=e;var o=this.baseUrl_+"?"+a.a.encodeQueryString(n);return new Promise(function(e,t){r.$http_.get(o).then(function(t){return e(t.data)}).catch(t)})},(n.module=angular.module("gmfSearchFulltextSearch",[])).service("gmfSearchFulltextSearch",n),t.a=n},function(e,t,r){"use strict";var a=r(203),n=function(e,t){this.gettextCatalog_=t,this.encoding_=e.has("ngeoCsvEncoding")?e.get("ngeoCsvEncoding"):"utf-8",this.extension_=e.has("ngeoCsvExtension")?e.get("ngeoCsvExtension"):".csv",this.includeHeader_=!e.has("ngeoCsvIncludeHeader")||e.get("ngeoCsvIncludeHeader"),this.quote_=e.has("ngeoCsvQuote")?e.get("ngeoCsvQuote"):'"',this.separator_=e.has("ngeoCsvSeparator")?e.get("ngeoCsvSeparator"):",",this.download_=e.get("ngeoDownload")};n.$inject=["$injector","gettextCatalog"],n.$inject=["$injector","gettextCatalog"],n.prototype.generateCsv=function(e,t){var r=this;if(0==e.length||0==t.length)return"";var a=t.map(function(e){return r.gettextCatalog_.getString(e.name)}),n=this.getRow_(a),o=e.map(function(e){var a=t.map(function(t){return e[t.name]});return r.getRow_(a)});return this.includeHeader_?n+o.join(""):o.join("")},n.prototype.getRow_=function(e){var t=this,r=new RegExp(this.quote_,"g"),a=this.quote_+this.quote_;return e.map(function(e){return void 0!==e&&null!==e?(e=""+e,t.quote_+e.replace(r,a)+t.quote_):""}).join(this.separator_)+"\n"},n.prototype.startDownload=function(e,t,r){var a=this.generateCsv(e,t);this.download_(a,r,"text/csv;charset="+this.encoding_)},(n.module=angular.module("ngeoCsvDownload",[a.a.name])).service("ngeoCsvDownload",n),t.a=n},function(e,t,r){"use strict";var a=r(1),n=r(142),o=angular.module("ngeoResizemap",[]);o.directive_=function(e){return{restrict:"A",link:function(t,r,o){var i=o.ngeoResizemap,s=t.$eval(i);a.a.assertInstanceof(s,n.a);var l=o.ngeoResizemapState;a.a.assert(void 0!==l);var u=void 0,c=void 0,h=function t(){s.updateSize(),s.renderSync(),Date.now()-u<1e3&&(c=e.requestAnimationFrame(t))};r.on("transitionend",function(){s.updateSize(),s.renderSync()}),t.$watch(l,function(t,r){t!=r&&(u=Date.now(),e.cancelAnimationFrame(c),c=e.requestAnimationFrame(h))})}}},o.directive_.$inject=["$window"],o.directive("ngeoResizemap",o.directive_),t.a=o},function(e,t,r){"use strict";var a=r(209),n=r(202);var o=angular.module("gmfPermalinkShareComponent",[a.a.module.name,n.a.module.name]);function i(e,t){return t(e)}o.run(["$templateCache",function(e){e.put("gmf/permalink/shareComponent",r(410))}]),o.value("gmfPermalinkShareTemplateUrl",function(e){var t=e.gmfPermalinkShareTemplateUrl;return void 0!==t?t:"gmf/permalink/shareComponent"}),i.$inject=["$attrs","gmfPermalinkShareTemplateUrl"],o.component_={bindings:{enableEmail:"<gmfShareEmail"},controller:"GmfShareController",templateUrl:i},o.component("gmfShare",o.component_);var s=function(){function e(t,r,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$scope_=t,this.gmfShareService_=n,this.$q_=o,this.ngeoLocation_=r,this.enableEmail,this.shortLink,this.email,this.message,this.permalink_=this.ngeoLocation_.getUriString(),this.showLengthWarning=this.permalink_.length>a.a.URL_MAX_LEN||r.getPath()>a.a.URL_PATH_MAX_LEN,this.successfullySent=!1,this.errorOnsend=!1,this.errorOnGetShortUrl=!1,this.getShortUrl()}return e.$inject=["$scope","ngeoLocation","gmfShareService","$q","$attrs"],e.prototype.getShortUrl=function(){var e=this;this.$q_.when(this.gmfShareService_.getShortUrl(this.permalink_)).then(function(t){e.shortLink=t.data.short_url,e.errorOnGetShortUrl=!1},function(t){e.shortLink=e.permalink,e.errorOnGetShortUrl=!0})},e.prototype.sendShortUrl=function(){var e=this;this.$scope_.gmfShareForm.$valid&&this.$q_.when(this.gmfShareService_.sendShortUrl(this.permalink_,this.email,this.message)).then(function(t){e.successfullySent=!0},function(t){e.errorOnsend=!0})},e}();o.controller("GmfShareController",s),t.a=o},function(e,t,r){"use strict";var a=r(137),n=r(3);var o=angular.module("gmfLayertreeDatasourceGroupTreeComponent",[a.a.module.name]);function i(e,t){return t(e)}o.run(["$templateCache",function(e){e.put("gmf/layertree/datasourceGroupTreeComponent",r(417))}]),o.value("gmfLayertreeDatasourceGroupTreeTemplateUrl",function(e){var t=e.gmfLayertreeDatasourceGroupTreeTemplateUrl;return void 0!==t?t:"gmf/layertree/datasourceGroupTreeComponent"}),i.$inject=["$attrs","gmfLayertreeDatasourceGroupTreeTemplateUrl"],o.Controller_=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.group,this.scope_=t,this.dataSources_=r.collection}return e.$inject=["$scope","ngeoDataSources"],e.prototype.getGroupUid=function(){return"datasourcegrouptree-"+n.c(this.group)},e.prototype.toggle=function(){this.group.toggleVisibilityState()},e.prototype.toggleDataSource=function(e){e.visible=!e.visible},e.prototype.remove=function(){for(var e=this.group.dataSources.length-1;e>=0;e--)this.dataSources_.remove(this.group.dataSources[e])},e.prototype.removeDataSource=function(e){this.dataSources_.remove(e)},e}(),o.component("gmfDatasourcegrouptree",{bindings:{group:"<"},controller:o.Controller_,templateUrl:i}),t.a=o},function(e,t,r){"use strict";var a=r(202),n=r(161),o=angular.module("ngeoStatemanagerModule",[a.a.module.name,n.a.module.name]);t.a=o},function(e,t,r){"use strict";(function(e){var a=r(41),n=r(149),o=r(33),i=r(340),s=r(200),l=r(183),u=r(38),c=r(339),h=r(314),p=r(17),g=r(158),d=r(117),f=r(260),m=r(161),y=r(87),v=r(1),_=r(3),S=r(8),b=r(2),C=r(37),w=r(45),T=r(58),E=r(188),A=r(18),L=r(103),P=function e(t,r,a,o,i,s,l,u,c){var g=this;this.q_=t,this.rootScope_=a,this.$timeout_=r,this.mapViewPropertyChangeEventKey_=null,this.ngeoDebounce_=i,this.ngeoEventHelper_=l,this.ngeoStateManager_=u,this.ngeoFeatures_=o.has("ngeoFeatures")?o.get("ngeoFeatures"):null,this.ngeoBackgroundLayerMgr_=o.has("ngeoBackgroundLayerMgr")?o.get("ngeoBackgroundLayerMgr"):null;var d=o.has("ngeoFeatureOverlayMgr")?o.get("ngeoFeatureOverlayMgr"):null;this.featureOverlay_=d?d.getFeatureOverlay():null,this.featureHelper_=o.has("ngeoFeatureHelper")?o.get("ngeoFeatureHelper"):null,this.ngeoQuerent_=o.has("ngeoQuerent")?o.get("ngeoQuerent"):null;var f=o.has("gmfPermalinkOptions")?o.get("gmfPermalinkOptions"):{};if(!0===f.useLocalStorage&&this.ngeoStateManager_.setUseLocalStorage(!0),this.crosshairEnabledByDefault_=!!f.crosshairEnabledByDefault,this.gmfExternalDataSourcesManager_=o.has("gmfExternalDataSourcesManager")?o.get("gmfExternalDataSourcesManager"):null,this.gmfThemes_=o.has("gmfThemes")?o.get("gmfThemes"):null,this.gmfObjectEditingManager_=o.has("gmfObjectEditingManager")?o.get("gmfObjectEditingManager"):null,this.gmfThemeManager_=o.has("gmfThemeManager")?o.get("gmfThemeManager"):null,this.defaultTheme_=o.has("defaultTheme")?o.get("defaultTheme"):void 0,this.gmfTreeManager_=o.has("gmfTreeManager")?o.get("gmfTreeManager"):null,this.ngeoLocation_=c,this.ngeoWfsPermalink_=o.has("ngeoWfsPermalink")?o.get("ngeoWfsPermalink"):null,this.gmfUser_=o.has("gmfUser")?o.get("gmfUser"):null,this.map_=null,this.ngeoAutoProjection_=o.has("ngeoAutoProjection")?o.get("ngeoAutoProjection"):null,this.sourceProjections_=null,void 0!==f.projectionCodes&&this.ngeoAutoProjection_){var m=this.ngeoAutoProjection_.getProjectionList(f.projectionCodes);m.length>0&&(this.sourceProjections_=m)}this.crosshairFeature_=null,this.crosshairStyle_,void 0!==f.crosshairStyle?this.crosshairStyle_=f.crosshairStyle:this.crosshairStyle_=[new A.c({image:new E.a({stroke:new T.a({color:"rgba(255, 255, 255, 0.8)",width:5}),points:4,radius:8,radius2:0,angle:0})}),new A.c({image:new E.a({stroke:new T.a({color:"rgba(255, 0, 0, 1)",width:2}),points:4,radius:8,radius2:0,angle:0})})],this.mapTooltip_=null,this.featureHashFormat_=new h.a({setStyle:!1,encodeStyles:!1,propertiesType:{fillColor:p.a.COLOR,fillOpacity:p.a.OPACITY,fontColor:p.a.COLOR,fontSize:p.a.SIZE,isBox:p.a.IS_RECTANGLE,isCircle:p.a.IS_CIRCLE,isLabel:p.a.IS_TEXT,name:p.a.NAME,pointRadius:p.a.SIZE,showLabel:p.a.SHOW_LABEL,showMeasure:p.a.SHOW_MEASURE,strokeColor:p.a.COLOR,strokeWidth:p.a.STROKE},defaultValues:{name:function(e){return s.getString(e.getGeometry().getType())},fillOpacity:function(){return.5},showLabel:function(){return!1},showMeasure:function(){return!1}}}),this.ngeoBackgroundLayerMgr_&&b.a(this.ngeoBackgroundLayerMgr_,"change",this.handleBackgroundLayerManagerChange_,this),this.rootScope_.$on("ngeo-layertree-state",function(t,r,a){var n={};if(a.node.mixed){var o=r.getState();v.a.assert("on"===o||"off"===o);var i="on"===o;r.traverseDepthFirst(function(t){if(void 0===t.node.children){var r=e.ParamPrefix.TREE_ENABLE+t.node.name;n[r]=i}})}else{var s=[];a.traverseDepthFirst(function(e){void 0===e.node.children&&"on"===e.getState()&&s.push(e.node.name)}),n[e.ParamPrefix.TREE_GROUP_LAYERS+a.node.name]=s.join(",")}g.ngeoStateManager_.updateState(n)}),this.rootScope_.$on("ngeo-layertree-opacity",function(t,r){var a={},n=r.layer.getOpacity();a[(r.parent.node.mixed?e.ParamPrefix.TREE_OPACITY:e.ParamPrefix.TREE_GROUP_OPACITY)+r.node.name]=n,g.ngeoStateManager_.updateState(a)});var y=this.getFeatures();this.ngeoFeatures_&&(y.forEach(function(e){g.featureHelper_&&g.featureHelper_.setStyle(e),g.addNgeoFeature_(e)}),this.ngeoFeatures_.extend(y),b.a(this.ngeoFeatures_,"add",this.handleNgeoFeaturesAdd_,this),b.a(this.ngeoFeatures_,"remove",this.handleNgeoFeaturesRemove_,this)),this.featureHelper_&&this.rootScope_.$on("$localeChangeSuccess",function(){y.forEach(function(e){g.featureHelper_.setStyle(e)})}),this.gmfThemeManager_&&this.rootScope_.$on(n.a.EventType.THEME_NAME_SET,function(e,t){g.setThemeInUrl_(t)}),this.setExternalDataSourcesStatePromise_=null,this.ngeoQuerent_&&this.gmfExternalDataSourcesManager_&&this.initExternalDataSources_().then(function(){b.a(g.gmfExternalDataSourcesManager_.wmsGroupsCollection,"add",g.handleExternalDSGroupCollectionAdd_,g),b.a(g.gmfExternalDataSourcesManager_.wmsGroupsCollection,"remove",g.handleExternalDSGroupCollectionRemove_,g),b.a(g.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"add",g.handleExternalDSGroupCollectionAdd_,g),b.a(g.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"remove",g.handleExternalDSGroupCollectionRemove_,g);var e=g.gmfExternalDataSourcesManager_.wmsGroups,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;g.registerExternalDSGroup_(n)}var o=g.gmfExternalDataSourcesManager_.wmtsGroups,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var u=l;g.registerExternalDSGroup_(u)}}),this.initLayers_()};P.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation"],P.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation"],P.prototype.getMapCenter=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a.a.PermalinkParam.MAP_X),t=this.ngeoStateManager_.getInitialNumberValue(a.a.PermalinkParam.MAP_Y);if(!isNaN(e)&&!isNaN(t)){var r=[e,t];if(null!==this.sourceProjections_&&this.ngeoAutoProjection_){var n=this.map_.getView().getProjection(),o=this.ngeoAutoProjection_.tryProjectionsWithInversion(r,n.getExtent(),n,this.sourceProjections_);if(o)return o}return r}return null},P.prototype.getMapZoom=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a.a.PermalinkParam.MAP_Z);return isNaN(e)?void 0:e},P.prototype.getMapCrosshair=function(){var e=this.ngeoStateManager_.getInitialBooleanValue(a.a.PermalinkParam.MAP_CROSSHAIR);return void 0===e?this.crosshairEnabledByDefault_:e},P.prototype.setMapCrosshair=function(e){var t=void 0;t=e||this.map_.getView().getCenter(),v.a.assertArray(t),this.crosshairFeature_&&this.featureOverlay_.removeFeature(this.crosshairFeature_),this.crosshairFeature_=new C.a(new w.a(t)),this.crosshairFeature_.setStyle(this.crosshairStyle_),this.featureOverlay_.addFeature(this.crosshairFeature_)},P.prototype.getMapTooltip=function(){return this.ngeoStateManager_.getInitialStringValue(a.a.PermalinkParam.MAP_TOOLTIP)},P.prototype.setMapTooltip=function(t,r){var a=void 0;a=r||this.map_.getView().getCenter(),v.a.assertArray(a);var n=e("<div/>",{class:"gmf-permalink-tooltip",text:t})[0];null!==this.mapTooltip_&&this.map_.removeOverlay(this.mapTooltip_),this.mapTooltip_=new i.a({element:n,position:a}),this.map_.addOverlay(this.mapTooltip_)},P.prototype.getFeatures=function(){var e=this.ngeoStateManager_.getInitialStringValue(a.a.PermalinkParam.FEATURES);return void 0!==e&&""!==e?v.a.assert(this.featureHashFormat_.readFeatures(e)):[]},P.prototype.setDimensions=function(e){for(var t=this,r=this.ngeoLocation_.getParamKeysWithPrefix(P.ParamPrefix.DIMENSIONS),a=0;a<r.length;a++){var n=r[a],o=this.ngeoLocation_.getParam(n);v.a.assert(o),e[n.slice(P.ParamPrefix.DIMENSIONS.length)]=o}this.rootScope_.$watchCollection(function(){return e},function(e){var r={};for(var a in e)r[P.ParamPrefix.DIMENSIONS+a]=e[a];t.ngeoLocation_.updateParams(r)})},P.prototype.setMap=function(e){var t=this;e!==this.map_&&(this.map_&&(this.unregisterMap_(),this.map_=null),e&&(this.map_=e,this.gmfObjectEditingManager_?this.gmfObjectEditingManager_.getFeature().then(function(r){t.registerMap_(e,r)}):this.registerMap_(e,null)))},P.prototype.registerMap_=function(e,t){var r=this,n=e.getView(),o=void 0;if(t&&t.getGeometry()){var i=e.getSize();v.a.assert(i),n.fit(t.getGeometry().getExtent(),i)}else{if(!this.ngeoStateManager_.getInitialBooleanValue(c.a.Permalink3dParam.ENABLED)){(o=this.getMapCenter())&&n.setCenter(o);var s=this.getMapZoom();void 0!==s&&n.setZoom(s)}}this.mapViewPropertyChangeEventKey_=b.a(n,"propertychange",this.ngeoDebounce_(function(){var e=n.getCenter(),t=n.getZoom(),o={};o[a.a.PermalinkParam.MAP_X]=Math.round(e[0]),o[a.a.PermalinkParam.MAP_Y]=Math.round(e[1]),o[a.a.PermalinkParam.MAP_Z]=t,r.ngeoStateManager_.updateState(o)},300,!0),this),this.getMapCrosshair()&&this.featureOverlay_&&this.setMapCrosshair(o);var l=this.getMapTooltip();l&&this.setMapTooltip(l,o);var u=this.getWfsPermalinkData_();null!==u&&this.ngeoWfsPermalink_&&this.ngeoWfsPermalink_.issue(u,e)},P.prototype.unregisterMap_=function(){v.a.assert(this.mapViewPropertyChangeEventKey_,"Key should be thruthy"),b.e(this.mapViewPropertyChangeEventKey_),this.mapViewPropertyChangeEventKey_=null},P.prototype.getBackgroundLayer=function(e){var t=this.ngeoStateManager_.getInitialStringValue(a.a.PermalinkParam.BG_LAYER);if(void 0!==t){var r=e,n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var s=i;if(s.get("label")===t)return s}}return null},P.prototype.handleBackgroundLayerManagerChange_=function(){if(this.map_&&this.ngeoBackgroundLayerMgr_){var e=this.ngeoBackgroundLayerMgr_.get(this.map_).get("label");v.a.assertString(e);var t={};t[a.a.PermalinkParam.BG_LAYER]=e,this.ngeoStateManager_.updateState(t)}},P.prototype.refreshFirstLevelGroups=function(){if(this.gmfTreeManager_){var e=this.gmfTreeManager_.rootCtrl.node.children.map(function(e){return e.name}),t={};t[a.a.PermalinkParam.TREE_GROUPS]=e.join(","),this.ngeoStateManager_.updateState(t)}},P.prototype.themeInUrl_=function(e){var t=e.indexOf("theme");return-1!=t&&t==e.length-2},P.prototype.setThemeInUrl_=function(e){if(e){var t=this.ngeoLocation_.getPath().split("/");v.a.assert(t.length>1),""===t[t.length-1]&&t.splice(t.length-1),this.themeInUrl_(t)?t[t.length-1]=e:t.push("theme",e),this.ngeoLocation_.setPath(t.join("/"))}},P.prototype.defaultThemeName=function(){var e=this.ngeoLocation_.getPath().split("/");if(this.themeInUrl_(e))return decodeURI(e[e.length-1]);var t=this.ngeoStateManager_.getInitialStringValue("theme");if(t)return t;var r=this.defaultThemeNameFromFunctionalities();return null!==r?r:this.defaultTheme_?this.defaultTheme_:null},P.prototype.defaultThemeNameFromFunctionalities=function(){if(!this.gmfUser_)return null;var e=this.gmfUser_.functionalities;if(e&&"default_theme"in e){var t=e.default_theme;if(t.length>0)return t[0]}return null},P.prototype.initLayers_=function(){var e=this;this.gmfThemes_&&this.gmfThemes_.getThemesObject().then(function(t){var r=e.defaultThemeName();v.a.assert(null!==r),e.gmfThemeManager_&&e.gmfThemeManager_.setThemeName(e.gmfThemeManager_.modeFlush?r:"");var n=[],i=void 0,s=e.ngeoLocation_.getParam(a.a.PermalinkParam.TREE_GROUPS);void 0===s?(v.a.assertString(r),(i=o.a.findThemeByName(t,r))&&(n=i.children)):s.split(",").forEach(function(e){var r=o.a.findGroupByName(t,e);r&&n.push(r)}),e.gmfTreeManager_&&e.gmfTreeManager_.setFirstLevelGroups(n),e.$timeout_(function(){e.gmfTreeManager_&&e.gmfTreeManager_.rootCtrl&&(e.gmfTreeManager_.rootCtrl.traverseDepthFirst(function(t){if(!t.isRoot){var r=e.ngeoStateManager_.getInitialNumberValue((t.parent.node.mixed?P.ParamPrefix.TREE_OPACITY:P.ParamPrefix.TREE_GROUP_OPACITY)+t.node.name);if(void 0!==r&&t.layer&&t.layer.setOpacity(r),t.parent.node&&t.parent.node.mixed&&void 0==t.node.children){var a=e.ngeoStateManager_.getInitialBooleanValue(P.ParamPrefix.TREE_ENABLE+t.node.name);void 0!==a&&t.setState(a?"on":"off",!1)}else if(!t.node.mixed&&1==t.depth){var n=e.ngeoStateManager_.getInitialStringValue(P.ParamPrefix.TREE_GROUP_LAYERS+t.node.name);if(void 0!==n){var o=n.split(",");t.traverseDepthFirst(function(e){if(void 0===e.node.children){var t=S.f(o,e.node.name);e.setState(t?"on":"off",!1)}})}}}}),e.gmfTreeManager_.rootCtrl.children.forEach(function(t){t.traverseDepthFirst(function(r){if("indeterminate"!==r.getState())return e.rootScope_.$broadcast("ngeo-layertree-state",r,t),y.a.VisitorDecision.STOP})}))})})},P.prototype.handleNgeoFeaturesAdd_=function(e){var t=e.element;v.a.assertInstanceof(t,C.a),this.addNgeoFeature_(t)},P.prototype.handleNgeoFeaturesRemove_=function(e){var t=e.element;v.a.assertInstanceof(t,C.a),this.removeNgeoFeature_(t)},P.prototype.addNgeoFeature_=function(e){var t=_.c(e);this.ngeoEventHelper_.addListenerKey(t,b.a(e,"change",this.ngeoDebounce_(this.handleNgeoFeaturesChange_,250,!0),this))},P.prototype.removeNgeoFeature_=function(e){var t=_.c(e);this.ngeoEventHelper_.clearListenerKey(t),this.handleNgeoFeaturesChange_()},P.prototype.handleNgeoFeaturesChange_=function(){if(this.ngeoFeatures_){var e=this.ngeoFeatures_.getArray(),t=this.featureHashFormat_.writeFeatures(e),r={};r[a.a.PermalinkParam.FEATURES]=t,this.ngeoStateManager_.updateState(r)}},P.prototype.getWfsPermalinkData_=function(){var e=this.ngeoLocation_.getParam(a.a.PermalinkParam.WFS_LAYER);if(!e)return null;var t=this.ngeoLocation_.getParamAsInt(a.a.PermalinkParam.WFS_NGROUPS),r=this.ngeoLocation_.getParamKeysWithPrefix(P.ParamPrefix.WFS),n=[],o=void 0;if(void 0===t)null!==(o=this.createFilterGroup_(P.ParamPrefix.WFS,r))&&n.push(o);else for(var i=0;i<t;i++)null!==(o=this.createFilterGroup_(P.ParamPrefix.WFS+i+"_",r))&&n.push(o);if(0==n.length)return null;var s=this.ngeoLocation_.getParam(a.a.PermalinkParam.WFS_SHOW_FEATURES);return{wfsType:e,showFeatures:!("0"===s||"false"===s),filterGroups:n}},P.prototype.createFilterGroup_=function(e,t){var r=this,n=[];return t.forEach(function(t){if(t!=a.a.PermalinkParam.WFS_LAYER&&t!=a.a.PermalinkParam.WFS_SHOW_FEATURES&&t!=a.a.PermalinkParam.WFS_NGROUPS&&0==t.indexOf(e)){var o=r.ngeoLocation_.getParam(t);if(o){var i=o;o.indexOf(",")>-1&&(i=o.split(","));var s={property:t.replace(e,""),condition:i};n.push(s)}}}),n.length>0?{filters:n}:null},P.prototype.initExternalDataSources_=function(){var e=this,t=v.a.assert(this.ngeoQuerent_),r=v.a.assert(this.gmfExternalDataSourcesManager_),n=[],o=this.ngeoStateManager_.getInitialValue(a.a.PermalinkParam.EXTERNAL_DATASOURCES_NAMES),i=this.ngeoStateManager_.getInitialValue(a.a.PermalinkParam.EXTERNAL_DATASOURCES_URLS);if(o&&i)for(var s=o.split(P.ExtDSSeparator.LIST),l=i.split(P.ExtDSSeparator.LIST),c=function(r,a){var o=s[r];if(!o)return"break";var i=o.split(P.ExtDSSeparator.NAMES),c=l[r],h=u.a.guessServiceTypeByUrl(c),p=e.q_.defer();n.push(p.promise),h===u.a.Type.WMS?t.wmsGetCapabilities(c).then(function(e){p.resolve({capabilities:e,groupLayerNames:i,serviceType:h,url:c})},function(){p.reject({groupLayerNames:i,serviceType:h,url:c})}):h===u.a.Type.WMTS?t.wmtsGetCapabilities(c).then(function(e){p.resolve({capabilities:e,groupLayerNames:i,serviceType:h,url:c})},function(){p.reject({groupLayerNames:i,serviceType:h,url:c})}):p.reject({groupLayerNames:i,serviceType:h,url:c})},h=0,p=l.length;h<p;h++){if("break"===c(h))break}return this.q_.all(n).then(function(e){var a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.serviceType===u.a.Type.WMS){var l=s.groupLayerNames,c=Array.isArray(l),h=0;for(l=c?l:l[Symbol.iterator]();;){var p;if(c){if(h>=l.length)break;p=l[h++]}else{if((h=l.next()).done)break;p=h.value}var g=p,d=t.wmsFindLayerCapability(s.capabilities.Capability.Layer.Layer,g);d&&r.createAndAddDataSourceFromWMSCapability(d,s.capabilities,s.url)}}else if(s.serviceType===u.a.Type.WMTS){var f=s.groupLayerNames,m=Array.isArray(f),y=0;for(f=m?f:f[Symbol.iterator]();;){var v;if(m){if(y>=f.length)break;v=f[y++]}else{if((y=f.next()).done)break;v=y.value}var _=v,S=t.wmtsFindLayerCapability(s.capabilities.Contents.Layer,_);S&&r.createAndAddDataSourceFromWMTSCapability(S,s.capabilities,s.url)}}}},function(e){})},P.prototype.handleExternalDSGroupCollectionAdd_=function(e){var t=e.element;v.a.assertInstanceof(t,l.a),this.registerExternalDSGroup_(t),this.setExternalDataSourcesState_()},P.prototype.registerExternalDSGroup_=function(e){b.a(e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this),b.a(e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)},P.prototype.containsLayerName=function(e,t){if(e instanceof L.a){var r=e.getLayers().getArray(),a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(v.a.assert(i),this.containsLayerName(i,t))return!0}return!1}return e.get("layerNodeName")==t},P.prototype.handleExternalDSGroupCollectionRemove_=function(e){var t=e.element;v.a.assertInstanceof(t,l.a),this.unregisterExternalDSGroup_(t),this.setExternalDataSourcesState_()},P.prototype.unregisterExternalDSGroup_=function(e){b.c(e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this),b.c(e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)},P.prototype.setExternalDataSourcesState_=function(){var e=this;this.setExternalDataSourcesStatePromise_&&this.$timeout_.cancel(this.setExternalDataSourcesStatePromise_),this.setExternalDataSourcesStatePromise_=this.$timeout_(function(){var t,r=[],n=[],o=e.gmfExternalDataSourcesManager_.wmsGroups,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var c=l;n.push(c.url);var h=[],p=c.dataSources,g=Array.isArray(p),d=0;for(p=g?p:p[Symbol.iterator]();;){var f;if(g){if(d>=p.length)break;f=p[d++]}else{if((d=p.next()).done)break;f=d.value}var m=f;v.a.assertInstanceof(m,u.a);var y=m.getOGCLayerNames()[0];h.push(y)}r.push(h.join(P.ExtDSSeparator.NAMES))}var _=e.gmfExternalDataSourcesManager_.wmtsGroups,S=Array.isArray(_),b=0;for(_=S?_:_[Symbol.iterator]();;){var C;if(S){if(b>=_.length)break;C=_[b++]}else{if((b=_.next()).done)break;C=b.value}var w=C;n.push(w.url);var T=[],E=w.dataSources,A=Array.isArray(E),L=0;for(E=A?E:E[Symbol.iterator]();;){var M;if(A){if(L>=E.length)break;M=E[L++]}else{if((L=E.next()).done)break;M=L.value}var F=M;v.a.assert(F.wmtsLayer),T.push(F.wmtsLayer)}r.push(T.join(P.ExtDSSeparator.NAMES))}e.ngeoStateManager_.updateState(((t={})[a.a.PermalinkParam.EXTERNAL_DATASOURCES_NAMES]=r.join(P.ExtDSSeparator.LIST),t[a.a.PermalinkParam.EXTERNAL_DATASOURCES_URLS]=n.join(P.ExtDSSeparator.LIST),t)),e.setExternalDataSourcesStatePromise_=null})},P.prototype.cleanParams=function(e){var t=this,r=v.a.assert(this.ngeoLocation_.getParamKeys()),a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.startsWith(P.ParamPrefix.TREE_GROUP_LAYERS)){var l=s.substring(P.ParamPrefix.TREE_GROUP_LAYERS.length),u=e,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}if(p.name==l){this.ngeoStateManager_.deleteParam(s);break}}}if(s.startsWith(P.ParamPrefix.TREE_GROUP_OPACITY)){var g=s.substring(P.ParamPrefix.TREE_GROUP_OPACITY.length),d=e,f=Array.isArray(d),m=0;for(d=f?d:d[Symbol.iterator]();;){var y;if(f){if(m>=d.length)break;y=d[m++]}else{if((m=d.next()).done)break;y=m.value}if(y.name==g){this.ngeoStateManager_.deleteParam(s);break}}}}this.$timeout_(function(){if(t.map_){var e=t.map_.getLayerGroup();v.a.assert(e);var a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.startsWith(P.ParamPrefix.TREE_ENABLE)){var l=s.substring(P.ParamPrefix.TREE_ENABLE.length);t.containsLayerName(e,l)||t.ngeoStateManager_.deleteParam(s)}if(s.startsWith(P.ParamPrefix.TREE_OPACITY)){var u=s.substring(P.ParamPrefix.TREE_OPACITY.length);t.containsLayerName(e,u)||t.ngeoStateManager_.deleteParam(s)}}}})},(P.module=angular.module("gmfPermalink",[n.a.module.name,o.a.module.name,s.a.name,y.a.module.name,g.a.name,d.a.module.name,f.a.name])).service("gmfPermalink",P),P.OpenLayersLayerProperties={OPACITY:"opacity"},P.ParamPrefix={DIMENSIONS:"dim_",TREE_ENABLE:"tree_enable_",TREE_GROUP_LAYERS:"tree_group_layers_",TREE_GROUP_OPACITY:"tree_group_opacity_",TREE_OPACITY:"tree_opacity_",WFS:"wfs_"},P.ExtDSSeparator={LIST:",",NAMES:";"},P.module.value("gmfPermalinkOptions",{}),function(){var e=[];for(var t in P.ParamPrefix)e.push(new RegExp(P.ParamPrefix[t]+".*"));for(var r in a.a.PermalinkParam)e.push(new RegExp(P.ParamPrefix[r]));m.a.module.value("ngeoUsedKeyRegexp",e)}(),t.a=P}).call(this,r(27))},function(e,t,r){"use strict";(function(e){var a=r(1),n=r(166),o=(r(426),r(495),r(425),r(424),r(423),r(422),angular.module("ngeoDatePicker",[n.a.module.name,"ui.date"]));o.value("ngeoDatePickerTemplateUrl",function(e,t){var r=t.ngeoDatePickerTemplateUrl;return void 0!==r?r:"ngeo/misc/datepickerComponent"}),o.run(["$templateCache",function(e){e.put("ngeo/misc/datepickerComponent",r(421))}]),o.component_=function(t,r){return{scope:{onDateSelected:"&",time:"="},bindToController:!0,controller:"ngeoDatePickerController as datepickerCtrl",restrict:"AE",templateUrl:t,link:function(t,a,n,o){o.init();var i=o.gettextCatalog_.getCurrentLanguage();e.datepicker.setDefaults(e.datepicker.regional[i]),o.sdateOptions=angular.extend({},o.sdateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function(t){t&&e(a[0]).find('input[name="edate"]').datepicker("option","minDate",t)}}),o.edateOptions=angular.extend({},o.edateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function(t){t&&e(a[0]).find('input[name="sdate"]').datepicker("option","maxDate",t)}}),angular.element("body").on("hidden.bs.popover",function(){var t=angular.element("#ui-datepicker-div");t&&"block"===t.css("display")&&e(a[0]).find('input[name$="date"]').datepicker("hide")}),r(function(){angular.element("#ui-datepicker-div").on("mousedown",function(e){e.stopPropagation()})})}}},o.component_.$inject=["ngeoDatePickerTemplateUrl","$timeout"],o.directive("ngeoDatePicker",o.component_),o.Controller_=function(e,t,r,a){var n=this;this.ngeoTime_=r,this.time,this.gettextCatalog_=a,this.isModeRange,this.onDateSelected,this.initialMinDate,this.initialMaxDate,this.edateOptions={changeMonth:!0,changeYear:!0},this.sdateOptions={changeMonth:!0,changeYear:!0},this.sdate,this.edate,e.$watchGroup(["datepickerCtrl.sdate","datepickerCtrl.edate"],function(e,t){var r=e[0],a=e[1];!angular.isDate(r)||n.isModeRange&&!angular.isDate(a)||n.onDateSelected({time:{start:n.ngeoTime_.getTime(r),end:n.ngeoTime_.getTime(a)}})})},o.Controller_.$inject=["$scope","$injector","ngeoTime","gettextCatalog"],o.Controller_.prototype.init=function(){var e=this.ngeoTime_.getOptions(this.time);this.initialMinDate=this.ngeoTime_.createDate(e.minDate),this.initialMaxDate=this.ngeoTime_.createDate(e.maxDate),this.isModeRange="range"===this.time.mode,this.isModeRange?(a.a.assertArray(e.values),this.sdate=this.ngeoTime_.createDate(e.values[0]),this.edate=this.ngeoTime_.createDate(e.values[1])):(a.a.assertNumber(e.values),this.sdate=this.ngeoTime_.createDate(e.values))},o.controller("ngeoDatePickerController",o.Controller_),t.a=o}).call(this,r(27))},,,,,function(e,t,r){"use strict";var a=r(26),n={setGeometryType:function(e,t){return/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/.exec(t)&&(e.type=a.a.GEOMETRY,/^gml:Point/.exec(t)?e.geomType="Point":/^gml:LineString|^gml:Curve/.exec(t)?e.geomType="LineString":/^gml:Polygon|^gml:Surface/.exec(t)?e.geomType="Polygon":/^gml:MultiPoint/.exec(t)?e.geomType="MultiPoint":/^gml:MultiLineString|^gml:MultiCurve/.exec(t)?e.geomType="MultiLineString":/^gml:MultiPolygon|^gml:MultiSurface/.exec(t)&&(e.geomType="MultiPolygon")),!!e.type&&!!e.geomType}};t.a=n},function(e,t,r){"use strict";var a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.http_=t,this.baseUrl_=r,this.promises_={}}return e.$inject=["$http","gmfLayersUrl"],e.prototype.getAttributeValues=function(e,t){var r=e.id+"_"+t,a=e.name;if(!this.promises_[r]){var n=this.baseUrl_+"/"+a+"/values/"+t;this.promises_[r]=this.http_.get(n).then(this.handleGetAttributeValues_.bind(this))}return this.promises_[r]},e.prototype.handleGetAttributeValues_=function(e){return e.data.items},e}();a.module=angular.module("gmfEnumerateAttribute",[]),a.module.service("gmfEnumerateAttribute",a),t.a=a},function(e,t,r){"use strict";var a=function(e,t,r){var a=void 0,n=void 0;this.isValidFileSize=function(e){return!(e>2e7)},this.isWmsGetCap=function(e){return/<(WMT_MS_Capabilities|WMS_Capabilities)/.test(e)},this.isWmtsGetCap=function(e){return/<Capabilities/.test(e)},this.isKml=function(e){return/<kml/.test(e)&&/<\/kml>/.test(e)},this.isGpx=function(e){return/<gpx/.test(e)&&/<\/gpx>/.test(e)},this.read=function(t){var n=e.defer();return a&&a.readyState===FileReader.LOADING&&a.abort(),(a=new FileReader).onload=function(e){n.resolve(e.target.result)},a.onerror=function(e){var t=e.target.error;console.error("Reading file failed: ",t),n.reject({message:20==t.code?r("Operation canceled"):r("Read failed"),reason:t.message})},a.onprogress=function(e){n.notify(e)},a.readAsText(t),n.promise},this.load=function(a,o){n&&n.resolve(),n=o||e.defer();var i=e.defer();return t.get(a,{timeout:n.promise}).then(function(e){i.resolve(e.data)},function(e){console.error("Uploading file failed: ",e),i.reject({message:r("Upload failed"),reason:e})}),i.promise}};a.$inject=["$q","$http","gettext"],a.$inject=["$q","$http","gettext"],(a.module=angular.module("ngeoFile",[])).service("ngeoFile",a),t.a=a},,function(e,t,r){"use strict";(function(e){var a=r(232),n=r(312),o=r(315),i=r(311),s=r(258),l=r(326),u=r(318),c=r(323),h=r(200),p=r(257),g=r(60),d=r(322),f=r(316),m=r(3),y=r(12),v=r(10),_=r(29),S=r(142),b=r(291),C=r(335),w=r(287),T=r(288),E=r(345),A=r(102),L=r(93),P=r(53),M=r(58),F=r(18),x=r(127),R=function(t,r,n){var o=this,i={projection:y.f("EPSG:"+(t.srid||21781))};v.a(i,t.mapViewConfig||{});var s=a.a.prototype.getLocationIcon();this.map=new S.a({pixelRatio:t.mapPixelRatio,layers:[],view:new b.a(i),controls:t.mapControls||[new C.a({target:document.getElementById("scaleline")}),new w.a({zoomInTipLabel:"",zoomOutTipLabel:""}),new T.a({label:s,tipLabel:""})],interactions:t.mapInteractions||E.a({pinchRotate:!0,altShiftDragRotate:!0}),loadTilesWhileAnimating:!0,loadTilesWhileInteracting:!0}),this.loginActive=!1,this.toolsActive=!1,this.modalShareShown=!1,this.editFeatureActive=!1,this.routingfeatureActive=!1,this.googleStreetViewActive=!1,this.googleStreetViewStyle=new F.c({text:new x.a({fill:new P.a({color:"#279B61"}),font:"normal 30px FontAwesome",offsetY:-15,stroke:new M.a({color:"#ffffff",width:3}),text:""})}),this.importDataSourceActive=!1;var l=e("body");l.tooltip({container:"body",trigger:"hover",selector:'[data-toggle="tooltip"]'}),l.on("touchstart.detectTouch",function(){l.tooltip("destroy"),l.off("touchstart.detectTouch")});var u=n.get("ngeoFeatures");this.drawFeatureLayer=n.get("ngeoFeatureOverlayMgr").getFeatureOverlay(),this.drawFeatureLayer.setFeatures(u);var c=n.get("ngeoFeatureHelper");this.editFeatureVectorLayer=new A.a({source:new L.b({wrapX:!1,features:new _.b}),style:function(e,t){return c.createEditingStyles(e)}}),this.editFeatureVectorLayer.setMap(this.map);var h=n.get("ngeoToolActivateMgr"),p=new g.a(this,"editFeatureActive");h.registerTool("mapTools",p,!1);var d=new g.a(this,"googleStreetViewActive");h.registerTool("mapTools",d,!1),this.scaleSelectorOptions={dropup:!0},this.profileLine=null,a.a.call(this,t,r,n),r.$watch(function(){return o.gmfUser.username},function(e){null!==e&&o.loginActive&&(o.loginActive=!1)})};R.$inject=["config","$scope","$injector"],R.$inject=["config","$scope","$injector"],m.d(R,a.a),(R.module=angular.module("GmfAbstractDesktopControllerModule",[a.a.module.name,n.a.name,o.a.name,i.a.name,s.a.name,l.a.name,u.a.name,c.a.name,h.a.name,p.a.name,d.a.name,f.a.name])).controller("AbstractDesktopController",R),R.module.value("isDesktop",!0),R.module.value("ngeoQueryOptions",{limit:20}),R.module.value("ngeoMeasurePrecision",3),R.module.value("ngeoMeasureDecimals",0),t.a=R}).call(this,r(27))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(248),n=r(140),o=r(1),i=r(106),s=r(33),l=angular.module("GmfEditingFeatureSelectorComponent",[n.a.name,i.a.module.name,s.a.module.name]);l.run(["$templateCache",function(e){e.put("gmf/editing/editFeatureSelectorComponent",r(372))}]),l.component_=function(){return{controller:"GmfEditfeatureselectorController as efsCtrl",scope:{active:"=gmfEditfeatureselectorActive",map:"<gmfEditfeatureselectorMap",tolerance:"<?gmfEditfeatureselectorTolerance",vectorLayer:"<gmfEditfeatureselectorVector"},bindToController:!0,templateUrl:"gmf/editing/editFeatureSelectorComponent"}},l.directive("gmfEditfeatureselector",l.component_),l.Controller_=function(e,t,r,a){var i=this;this.active=!0===this.active,e.$watch(function(){return i.active},this.handleActiveChange_.bind(this)),this.map,this.tolerance,this.vectorLayer,this.scope_=e,this.$timeout_=t,this.gmfThemes_=r,this.gmfTreeManager_=a;this.treeCtrlsWatcherUnregister_=e.$watchCollection(function(){if(a.rootCtrl)return a.rootCtrl.children},function(e){var t=this;this.$timeout_(function(){if(e){var r=t.editableTreeCtrls;r.length=0,t.gmfTreeManager_.rootCtrl.traverseDepthFirst(function(e){e.node.editable&&(o.a.assert(0===e.children.length),r.push(e))})}},0)}.bind(this)),this.dirty=!1,this.editableTreeCtrls=[],this.selectedEditableTreeCtrl=null,e.$watch(function(){return i.selectedEditableTreeCtrl},function(e,t){i.dirty=!1,i.state=n.a.State.IDLE}),this.state=n.a.State.IDLE,e.$watch(function(){return i.state},function(e,t){e!==n.a.State.STOP_EDITING_EXECUTE&&e!==n.a.State.DEACTIVATE_EXECUTE||(i.selectedEditableTreeCtrl=null),e===n.a.State.DEACTIVATE_EXECUTE&&(i.active=!1)}),e.$on("$destroy",this.handleDestroy_.bind(this))},l.Controller_.$inject=["$scope","$timeout","gmfThemes","gmfTreeManager"],l.Controller_.prototype.stopEditing=function(){this.state=n.a.State.STOP_EDITING_PENDING},l.Controller_.prototype.handleActiveChange_=function(e){var t=this;e||(this.dirty?this.$timeout_(function(){t.active=!0,t.stopEditing()}):this.stopEditing())},l.Controller_.prototype.handleDestroy_=function(){this.treeCtrlsWatcherUnregister_()},l.controller("GmfEditfeatureselectorController",l.Controller_);var u=l,c=r(268),h=r(197),p=r(247),g=angular.module("gmfEditingModule",[a.a.module.name,n.a.name,u.name,c.a.module.name,h.a.module.name,p.a.module.name]);t.a=g},function(e,t,r){"use strict";var a=r(249),n=r(1),o=r(126),i=r(12),s=r(2),l=r(10),u=angular.module("gmfContextualdata",[a.a.module.name]);u.directive_=function(){return{restrict:"A",scope:!1,controller:"GmfContextualdataController as cdCtrl",bindToController:{map:"<gmfContextualdataMap",projections:"<gmfContextualdataProjections",callback:"<gmfContextualdataCallback"},link:function(e,t,r,a){a.init()}}},u.directive("gmfContextualdata",u.directive_),u.Controller_=function(e,t,r,a){this.map,this.projections,this.callback,this.overlay_,this.$compile_=e,this.timeout_=t,this.$scope_=r,this.gmfRaster_=a,angular.element("body").on("mousedown",this.hidePopover.bind(this))},u.Controller_.$inject=["$compile","$timeout","$scope","gmfRaster"],u.Controller_.prototype.init=function(){this.preparePopover_();var e=this.map.getTargetElement();n.a.assertElement(e),s.a(e,"contextmenu",this.handleMapContextMenu_,this)},u.Controller_.prototype.handleMapContextMenu_=function(e){var t=this;this.$scope_.$apply(function(){var r=t.map.getEventPixel(e),a=t.map.getCoordinateFromPixel(r);t.setContent_(a),e.preventDefault(),t.hidePopover(),t.showPopover(),t.timeout_(function(){t.overlay_.setPosition(a)})})},u.Controller_.prototype.setContent_=function(e){var t=this.$scope_.$new(!0);this.$compile_(this.content_)(t);var r=this.map.getView().getProjection().getCode();this.projections.forEach(function(a){var n=i.k(e,r,"EPSG:"+a);t["coord_"+a]=n,t["coord_"+a+"_eastern"]=n[0],t["coord_"+a+"_northern"]=n[1]});var a=function(r){l.a(t,r),this.callback&&l.a(t,this.callback.call(this,e,r))}.bind(this);this.gmfRaster_.getRaster(e).then(a,function(e){console.error("Error on getting the raster.")})},u.Controller_.prototype.preparePopover_=function(){var e=document.createElement("DIV");e.classList.add("popover"),e.classList.add("bottom"),e.classList.add("gmf-contextualdata"),angular.element(e).css("position","relative");var t=document.createElement("DIV");t.classList.add("arrow"),e.appendChild(t),this.content_=document.createElement("DIV"),this.content_.setAttribute("gmf-contextualdatacontent",""),this.content_.classList.add("popover-content"),e.appendChild(this.content_),this.overlay_=new o.a({element:e,stopEvent:!0,autoPan:!0,autoPanAnimation:{duration:250},positioning:"top-center"}),this.map.addOverlay(this.overlay_)},u.Controller_.prototype.showPopover=function(){var e=this.overlay_.getElement();angular.element(e).css("display","block")},u.Controller_.prototype.hidePopover=function(){var e=this.overlay_.getElement();angular.element(e).css("display","none")},u.controller("GmfContextualdataController",u.Controller_),u.contentDirective_=function(e){return{restrict:"A",scope:!0,templateUrl:e}},u.contentDirective_.$inject=["gmfContextualdatacontentTemplateUrl"],u.directive("gmfContextualdatacontent",u.contentDirective_);var c=u,h=(r(461),angular.module("gmfContextualdataModule",[c.name]));t.a=h},function(e,t,r){"use strict";var a=r(1),n=r(62),o=r(3),i=r(167),s=r(93),l=r(188),u=r(19),c=r(272),h=r(115),p=r(96),g=function(){this.geojsonFormat=new i.a};g.PrintStyleTypes_={LineString:(g.PrintStyleType={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"}).LINE_STRING,Point:g.PrintStyleType.POINT,Polygon:g.PrintStyleType.POLYGON,MultiLineString:g.PrintStyleType.LINE_STRING,MultiPoint:g.PrintStyleType.POINT,MultiPolygon:g.PrintStyleType.POLYGON},g.prototype.encodeVectorLayer=function(e,t,r){var n=t.getSource();a.a.assertInstanceof(n,s.b);for(var i=n.getFeatures(),l=[],u={version:2},c=0,h=i.length;c<h;++c){var p=i[c],g=null,d=p.getStyleFunction();void 0!==d?g=d.call(p,r):void 0!==(d=t.getStyleFunction())&&(g=d.call(t,p,r));var f=this.geojsonFormat.writeFeatureObject(p),m=null===g||Array.isArray(g)?g:[g];if(a.a.assert(Array.isArray(m)),null!==m&&m.length>0)for(var y=!1,v=0,_=m.length;v<_;++v){var S=m[v],b=S.getGeometry(),C=void 0;if(b){var w=p.clone();w.setGeometry(b),C=this.geojsonFormat.writeFeatureObject(w),b=w.getGeometry(),w=null,l.push(C)}else{if(C=f,!(b=p.getGeometry()))continue;y||(l.push(C),y=!0)}var T=b.getType();null===C.properties&&(C.properties={});var E="_ngeo_style_"+v,A=o.c(S).toString()+"-"+T;this.encodeVectorStyle(u,T,S,A,E),C.properties[E]=A}}if(l.length>0){var L={geoJson:{type:"FeatureCollection",features:l},opacity:t.getOpacity(),style:u,type:"geojson"};e.push(L)}},g.prototype.encodeVectorStyle=function(e,t,r,a,n){if(t in g.PrintStyleTypes_){var o=g.PrintStyleTypes_[t],i="["+n+" = '"+a+"']";if(!(i in e)){var s={symbolizers:[]};e[i]=s;var l=r.getFill(),u=r.getImage(),c=r.getStroke(),h=r.getText();o===g.PrintStyleType.POLYGON?null!==l&&this.encodeVectorStylePolygon(s.symbolizers,l,c):o===g.PrintStyleType.LINE_STRING?null!==c&&this.encodeVectorStyleLine(s.symbolizers,c):o===g.PrintStyleType.POINT&&null!==u&&this.encodeVectorStylePoint(s.symbolizers,u),null!==h&&this.encodeTextStyle(s.symbolizers,h)}}},g.prototype.encodeVectorStyleFill=function(e,t){var r=t.getColor();null!==r&&(a.a.assert("string"==typeof r||Array.isArray(r)),r=p.a(r),a.a.assert(Array.isArray(r),"only supporting fill colors"),e.fillColor=n.a.rgbArrayToHex(r),e.fillOpacity=r[3])},g.prototype.encodeVectorStyleLine=function(e,t){var r={type:"line"};this.encodeVectorStyleStroke(r,t),e.push(r)},g.prototype.encodeVectorStylePoint=function(e,t){var r=void 0;if(t instanceof h.a){(r={type:"point"}).pointRadius=t.getRadius();var a=t.getFill();null!==a&&this.encodeVectorStyleFill(r,a);var n=t.getStroke();null!==n&&this.encodeVectorStyleStroke(r,n)}else if(t instanceof c.a){var o=t.getSrc();if(void 0!==o){r={type:"point",externalGraphic:o};var i=t.getOpacity();null!==i&&(r.graphicOpacity=i);var s=t.getSize();if(null!==s){var p=t.getScale();isNaN(p)&&(p=1),r.graphicWidth=s[0]*p,r.graphicHeight=s[1]*p}var g=t.getRotation();isNaN(g)&&(g=0),r.rotation=u.h(g)}}else if(t instanceof l.a){var d=t.getPoints();if(null!==d){r={type:"point"},4===d?r.graphicName="square":3===d?r.graphicName="triangle":5===d?r.graphicName="star":8===d&&(r.graphicName="cross");var f=t.getSize();null!==f&&(r.graphicWidth=f[0],r.graphicHeight=f[1]);var m=t.getRotation();isNaN(m)||0===m||(r.rotation=u.h(m));var y=t.getOpacity();null!==y&&(r.graphicOpacity=y);var v=t.getStroke();null!==v&&this.encodeVectorStyleStroke(r,v);var _=t.getFill();null!==_&&this.encodeVectorStyleFill(r,_)}}void 0!==r&&e.push(r)},g.prototype.encodeVectorStylePolygon=function(e,t,r){var a={type:"polygon"};this.encodeVectorStyleFill(a,t),null!==r&&this.encodeVectorStyleStroke(a,r),e.push(a)},g.prototype.encodeVectorStyleStroke=function(e,t){var r=t.getColor();if(null!==r){a.a.assert("string"==typeof r||Array.isArray(r));var o=p.a(r);a.a.assert(Array.isArray(o),"only supporting stroke colors"),e.strokeColor=n.a.rgbArrayToHex(o),e.strokeOpacity=o[3]}var i=t.getLineDash();null!==i&&(e.strokeDashstyle=i.join(" "));var s=t.getWidth();void 0!==s&&(e.strokeWidth=s),t.getLineCap()&&(e.strokeLinecap=t.getLineCap())},g.prototype.encodeTextStyle=function(e,t){var r={type:"Text"},o=t.getText();if(void 0!==o){r.label=o;var i="c",s="m",l=t.getTextAlign();"left"===l||"start"===l?i="l":"right"!==l&&"end"!==l||(i="r");var u=t.getTextBaseline();"bottom"===u?s="l":"top"===u&&(s="t"),r.labelAlign=""+i+s;var c=t.getRotation();void 0!==c&&(r.labelRotation=(180*c/Math.PI).toString(),r.labelAlign="cm");var h=t.getFont();if(void 0!==h){var g=h.split(" ");g.length>=3&&(r.fontWeight=g[0],r.fontSize=g[1],r.fontFamily=g.splice(2).join(" "))}var d=t.getStroke();if(null!==d){var f=d.getColor();a.a.assert("string"==typeof f||Array.isArray(f));var m=p.a(f);a.a.assert(Array.isArray(m),"only supporting stroke colors"),r.haloColor=n.a.rgbArrayToHex(m),r.haloOpacity=m[3];var y=d.getWidth();void 0!==y&&(r.haloRadius=y/2)}var v=t.getFill();if(null!==v){var _=v.getColor();a.a.assert("string"==typeof _||Array.isArray(_));var S=p.a(_);a.a.assert(Array.isArray(S),"only supporting fill colors"),r.fontColor=n.a.rgbArrayToHex(S)}void 0!==r.labelAlign&&(r.labelXOffset=t.getOffsetX(),r.labelYOffset=-t.getOffsetY()),e.push(r)}};var d=g,f=r(85),m=r(8),y=r(10),v=r(131),_=r(122),S=r(102),b=r(104),C=r(154),w=r(215),T=r(168),E=r(355),A=function(e,t,r,a){this.url_=e,this.$http_=t,this.gettextCatalog_=r,this.ngeoLayerHelper_=a,this.vectorEncoder_=new d,this.printNativeAngle_=!0};A.$inject=["url","$http","gettextCatalog","ngeoLayerHelper"],A.prototype.cancel=function(e,t){var r=void 0!==t?t:{},a=this.url_+"/cancel/"+e;return this.$http_.delete(a,r)},A.prototype.createSpec=function(e,t,r,a,n,o){var i={dpi:r,rotation:o.rotation};this.encodeMap_(e,t,i);var s={map:i};return y.a(s,o),{attributes:s,format:n,lang:this.gettextCatalog_.currentLanguage,layout:a}},A.prototype.encodeMap_=function(e,t,r){var n=this,o=e.getView(),i=o.getCenter(),s=o.getProjection(),l=o.getResolution(),c=r.rotation||u.h(o.getRotation());a.a.assert(void 0!==i),a.a.assert(void 0!==s),r.center=i,r.projection=s.getCode(),r.rotation=c,r.scale=t,r.layers=[];var h=e.getLayerGroup();a.a.assert(h),this.printNativeAngle_=!(!1===h.get("printNativeAngle"));var p=this.ngeoLayerHelper_.getFlatLayers(h);m.l(p,function(e,t){return e.getZIndex()-t.getZIndex()}),(p=p.slice().reverse()).forEach(function(e){e.getVisible()&&(a.a.assert(void 0!==l),n.encodeLayer(r.layers,e,l))})},A.prototype.encodeLayer=function(e,t,r){t instanceof v.a?this.encodeImageLayer_(e,t):t instanceof _.a?this.encodeTileLayer_(e,t):t instanceof S.a&&this.vectorEncoder_.encodeVectorLayer(e,t,r)},A.prototype.encodeImageLayer_=function(e,t){a.a.assertInstanceof(t,v.a),t.getSource()instanceof C.a&&this.encodeImageWmsLayer_(e,t)},A.prototype.encodeImageWmsLayer_=function(e,t){var r=t.getSource();a.a.assertInstanceof(t,v.a),a.a.assertInstanceof(r,C.a);var n=r.getUrl();void 0!==n&&this.encodeWmsLayer_(e,t,n,r.getParams())},A.prototype.encodeWmsLayer_=function(e,t,r,a){r.startsWith("//")&&(r=window.location.protocol+r);var n=new URL(r),o={TRANSPARENT:!0};if(n.searchParams){var i=n.searchParams,s=Array.isArray(i),l=0;for(i=s?i:i[Symbol.iterator]();;){var u;if(s){if(l>=i.length)break;u=i[l++]}else{if((l=i.next()).done)break;u=l.value}var c=u;o[c[0]]=c[1]}}for(var h in a){var p=a[h];null!==p&&void 0!==p&&(o[h]=p)}delete o.LAYERS,delete o.FORMAT,delete o.SERVERTYPE,delete o.VERSION;var g={baseURL:A.getAbsoluteUrl_(n.origin+n.pathname),imageFormat:"FORMAT"in a?a.FORMAT:"image/png",layers:a.LAYERS.split(","),customParams:o,serverType:a.SERVERTYPE,type:"wms",opacity:this.getOpacityOrInherited_(t),version:a.VERSION,useNativeAngle:this.printNativeAngle_};e.push(g)},A.getAbsoluteUrl_=function(e){var t=document.createElement("a");return t.href=encodeURI(e),decodeURI(t.href)},A.prototype.encodeTileLayer_=function(e,t){a.a.assertInstanceof(t,_.a);var r=t.getSource();r instanceof T.a?this.encodeTileWmtsLayer_(e,t):r instanceof w.a&&this.encodeTileWmsLayer_(e,t)},A.prototype.encodeTileWmtsLayer_=function(e,t){a.a.assertInstanceof(t,_.a);var r=t.getSource();a.a.assertInstanceof(r,T.a);var n=r.getProjection(),o=r.getTileGrid();a.a.assertInstanceof(o,E.b);for(var i=o.getMatrixIds(),s=[],l=0,u=i.length;l<u;++l){var c=o.getFullTileRange(l);s.push({identifier:i[l],scaleDenominator:o.getResolution(l)*n.getMetersPerUnit()/28e-5,tileSize:b.d(o.getTileSize(l)),topLeftCorner:o.getOrigin(l),matrixSize:[c.maxX-c.minX,c.maxY-c.minY]})}var h=r.getDimensions(),p=Object.keys(h),g={baseURL:this.getWmtsUrl_(r),dimensions:p,dimensionParams:h,imageFormat:r.getFormat(),layer:r.getLayer(),matrices:s,matrixSet:r.getMatrixSet(),opacity:this.getOpacityOrInherited_(t),requestEncoding:r.getRequestEncoding(),style:r.getStyle(),type:"WMTS",version:r.getVersion()};e.push(g)},A.prototype.encodeTileWmsLayer_=function(e,t){var r=t.getSource();a.a.assertInstanceof(t,_.a),a.a.assertInstanceof(r,w.a),this.encodeWmsLayer_(e,t,r.getUrls()[0],r.getParams())},A.prototype.getWmtsUrl_=function(e){var t=e.getUrls();return a.a.assert(t.length>0),A.getAbsoluteUrl_(t[0])},A.prototype.getOpacityOrInherited_=function(e){return void 0!==e.get("inheritedOpacity")?e.get("inheritedOpacity"):e.getOpacity()},A.prototype.createReport=function(e,t){var r=e.format||"pdf",a=this.url_+"/report."+r,n={headers:{"Content-Type":"application/json; charset=UTF-8"}};return y.a(n,void 0!==t?t:{}),this.$http_.post(a,e,n)},A.prototype.getStatus=function(e,t){var r=void 0!==t?t:{},a=this.url_+"/status/"+e+".json";return this.$http_.get(a,r)},A.prototype.getReportUrl=function(e){return this.url_+"/report/"+e},A.prototype.getCapabilities=function(e){var t=void 0!==e?e:{withCredentials:!0},r=this.url_+"/capabilities.json";return this.$http_.get(r,t)},(A.createPrintServiceFactory=function(e,t,r){return function(a){return new A(a,e,t,r)}}).$inject=["$http","gettextCatalog","ngeoLayerHelper"],(A.module=angular.module("ngeoPrint",[f.a.module.name])).service("ngeoPrintService",A),A.module.factory("ngeoCreatePrint",A.createPrintServiceFactory);t.a=A},function(e,t,r){"use strict";var a=r(1),n=r(17),o={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"},i=r(62),s=r(3),l=r(37),u=r(96),c=r(8),h=r(76),p=r(347),g=r(20),d=r(50),f=r(124),m=r(143),y=r(141),v=r(45),_=r(47),S=r(115),b=r(53),C=r(58),w=r(18),T=r(127),E=function e(t){p.a.call(this);var r=void 0!==t?t:{};this.accuracy_=void 0!==r.accuracy?r.accuracy:e.ACCURACY_,this.encodeStyles_=void 0===r.encodeStyles||r.encodeStyles,this.propertiesFunction_=void 0!==r.properties?r.properties:e.defaultPropertiesFunction_,this.setStyle_=void 0===r.setStyle||r.setStyle,this.prevX_=0,this.prevY_=0,e.LegacyProperties_=void 0!==r.propertiesType&&r.propertiesType,this.defaultValues_=void 0!==r.defaultValues?r.defaultValues:{}};s.d(E,p.a),E.StyleTypes_={LineString:o.LINE_STRING,Point:o.POINT,Polygon:o.POLYGON,MultiLineString:o.LINE_STRING,MultiPoint:o.POINT,MultiPolygon:o.POLYGON},E.LegacyProperties_={},E.prototype.readFeature,E.prototype.readFeatures,E.prototype.readGeometry,E.prototype.writeFeature,E.prototype.writeFeatures,E.prototype.writeGeometry,E.CHAR64_=".-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz",E.ACCURACY_=.1,E.defaultPropertiesFunction_=function(e){return e.getProperties()},E.encodeSignedNumber_=function(e){var t=e<<1;return e<0&&(t=~t),E.encodeNumber_(t)},E.encodeNumber_=function(e){for(var t="";e>=32;)t+=E.CHAR64_.charAt(32|31&e),e>>=5;return t+=E.CHAR64_.charAt(e)},E.encodeStyles_=function(e,t,r){var n=E.StyleTypes_[t];a.a.assert(void 0!==n);for(var i=0;i<e.length;++i){var s=e[i],l=s.getFill(),u=s.getImage(),c=s.getStroke(),h=s.getText();n==o.POLYGON?null!==l&&E.encodeStylePolygon_(l,c,r):n==o.LINE_STRING?null!==c&&E.encodeStyleLine_(c,r):n==o.POINT&&null!==u&&E.encodeStylePoint_(u,r),null!==h&&E.encodeStyleText_(h,r)}},E.encodeStyleLine_=function(e,t){E.encodeStyleStroke_(e,t)},E.encodeStylePoint_=function(e,t){if(e instanceof S.a){var r=e.getRadius();t.length>0&&t.push("'"),t.push(encodeURIComponent("pointRadius*"+r));var a=e.getFill();null!==a&&E.encodeStyleFill_(a,t);var n=e.getStroke();null!==n&&E.encodeStyleStroke_(n,t)}},E.encodeStylePolygon_=function(e,t,r){E.encodeStyleFill_(e,r),null!==t&&E.encodeStyleStroke_(t,r)},E.encodeStyleFill_=function(e,t,r){var n=void 0!==r?r:"fillColor",o=e.getColor();if(null!==o){a.a.assert(Array.isArray(o),"only supporting fill colors");var s=u.a(o);a.a.assert(Array.isArray(s),"fill color must be an array");var l=i.a.rgbArrayToHex(s);t.length>0&&t.push("'"),t.push(encodeURIComponent(n+"*"+l))}},E.encodeStyleStroke_=function(e,t){var r=e.getColor();if(null!==r){a.a.assert(Array.isArray(r));var n=u.a(r);a.a.assert(Array.isArray(n),"only supporting stroke colors");var o=i.a.rgbArrayToHex(n);t.length>0&&t.push("'"),t.push(encodeURIComponent("strokeColor*"+o))}var s=e.getWidth();void 0!==s&&(t.length>0&&t.push("'"),t.push(encodeURIComponent("strokeWidth*"+s)))},E.encodeStyleText_=function(e,t){var r=e.getFont();if(void 0!==r){var a=r.split(" ");a.length>=3&&(t.length>0&&t.push("'"),t.push(encodeURIComponent("fontSize*"+a[1])))}var n=e.getFill();null!==n&&E.encodeStyleFill_(n,t,"fontColor")},E.readLineStringGeometry_=function(e){a.a.assert("l("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]),e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e),r=new d.a(null);return r.setFlatCoordinates(g.a.XY,t),r},E.readMultiLineStringGeometry_=function(e){a.a.assert("L("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]);for(var t=[],r=[],n=(e=e.substring(2,e.length-1)).split("'"),o=0,i=n.length;o<i;++o)t=this.decodeCoordinates_(n[o],t),r[o]=t.length;var s=new f.a(null);return s.setFlatCoordinates(g.a.XY,t,r),s},E.readPointGeometry_=function(e){a.a.assert("p("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]),e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);a.a.assert(2===t.length);var r=new v.a(null);return r.setFlatCoordinates(g.a.XY,t),r},E.readMultiPointGeometry_=function(e){a.a.assert("P("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]),e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e),r=new m.a(null);return r.setFlatCoordinates(g.a.XY,t),r},E.readPolygonGeometry_=function(e){a.a.assert("a("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]);for(var t=[],r=[],n=(e=e.substring(2,e.length-1)).split("'"),o=0,i=n.length;o<i;++o){var s=(t=this.decodeCoordinates_(n[o],t)).length;0===o?(t[s++]=t[0],t[s++]=t[1]):(t[s++]=t[r[o-1]],t[s++]=t[r[o-1]+1]),r[o]=s}var l=new _.a(null);return l.setFlatCoordinates(g.a.XY,t,r),l},E.readMultiPolygonGeometry_=function(e){a.a.assert("A("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]);for(var t=[],r=[],n=(e=e.substring(2,e.length-1)).split(")("),o=0,i=n.length;o<i;++o)for(var s=n[o].split("'"),l=r[o]=[],u=0,c=s.length;u<c;++u){var h=(t=this.decodeCoordinates_(s[u],t)).length;0===u?(t[h++]=t[0],t[h++]=t[1]):(t[h++]=t[l[u-1]],t[h++]=t[l[u-1]+1]),l[u]=h}var p=new y.a(null);return p.setFlatCoordinates(g.a.XY,t,r),p},E.setStyleInFeature_=function(e,t){if(""!=e){var r=E.getStyleProperties_(e,t),a=r.fillColor,n=r.fontSize,o=r.fontColor,i=r.pointRadius,s=r.strokeColor,l=r.strokeWidth,u=null;void 0!==a&&(u=new b.a({color:a}));var c=null;void 0!==s&&void 0!==l&&(c=new C.a({color:s,width:l}));var h=null;void 0!==i&&(h=new S.a({radius:i,fill:u,stroke:c}),u=c=null);var p=null;void 0!==n&&void 0!==o&&(p=new T.a({font:n+" sans-serif",fill:new b.a({color:o})}));var g=new w.c({fill:u,image:h,stroke:c,text:p});t.setStyle(g)}},E.setStyleProperties_=function(e,t){var r=E.getStyleProperties_(e,t),a=t.getGeometry();if(a instanceof v.a?r.isLabel||r[n.a.IS_TEXT]?(delete r.strokeColor,delete r.fillColor):(delete r.fontColor,delete r.fontSize):(delete r.fontColor,a instanceof d.a&&(delete r.fillColor,delete r.fillOpacity)),r.fontSize){var o=parseFloat(r.fontSize);-1!==r.fontSize.indexOf("px")&&(o=Math.round(o/1.333333)),r.fontSize=o}var i={};for(var s in r){var l=r[s];E.LegacyProperties_[s]?i[E.LegacyProperties_[s]]=l:i[s]=l}t.setProperties(i)},E.castValue_=function(e,t){var r=[n.a.ANGLE,n.a.OPACITY,n.a.SIZE,n.a.STROKE,"pointRadius","strokeWidth"],a=[n.a.IS_CIRCLE,n.a.IS_RECTANGLE,n.a.IS_TEXT,n.a.SHOW_MEASURE,n.a.SHOW_LABEL,"isCircle","isRectangle","isLabel","showMeasure","showLabel"];return c.f(r,e)?+t:c.f(a,e)?"true"===t:t},E.getStyleProperties_=function(e,t){for(var r=e.split("'"),n={},o=0;o<r.length;++o){var i=decodeURIComponent(r[o]).split("*");a.a.assert(2===i.length);var s=i[0],l=i[1];n[s]=E.castValue_(s,l)}return n},E.writeLineStringGeometry_=function(e){a.a.assertInstanceof(e,d.a);var t=e.getFlatCoordinates(),r=e.getStride(),n=t.length;return"l("+this.encodeCoordinates_(t,r,0,n)+")"},E.writeMultiLineStringGeometry_=function(e){a.a.assertInstanceof(e,f.a);for(var t=e.getEnds(),r=t.length,n=e.getFlatCoordinates(),o=e.getStride(),i=0,s=["L("],l=0;l<r;++l){var u=t[l],c=this.encodeCoordinates_(n,o,i,u);0!==l&&s.push("'"),s.push(c),i=u}return s.push(")"),s.join("")},E.writePointGeometry_=function(e){a.a.assertInstanceof(e,v.a);var t=e.getFlatCoordinates(),r=e.getStride(),n=t.length;return"p("+this.encodeCoordinates_(t,r,0,n)+")"},E.writeMultiPointGeometry_=function(e){a.a.assertInstanceof(e,m.a);var t=e.getFlatCoordinates(),r=e.getStride(),n=t.length;return"P("+this.encodeCoordinates_(t,r,0,n)+")"},E.encodeRings_=function(e,t,r,a,n){for(var o=a.length,i=0;i<o;++i){var s=a[i]-t,l=this.encodeCoordinates_(e,t,r,s);0!==i&&n.push("'"),n.push(l),r=a[i]}return r},E.writePolygonGeometry_=function(e){a.a.assertInstanceof(e,_.a);var t=e.getFlatCoordinates(),r=e.getStride(),n=e.getEnds(),o=["a("];return E.encodeRings_.call(this,t,r,0,n,o),o.push(")"),o.join("")},E.writeMultiPolygonGeometry_=function(e){a.a.assertInstanceof(e,y.a);for(var t=e.getFlatCoordinates(),r=e.getStride(),n=e.getEndss(),o=n.length,i=0,s=["A"],l=0;l<o;++l){var u=n[l];s.push("("),i=E.encodeRings_.call(this,t,r,i,u,s),s.push(")")}return s.join("")},E.GEOMETRY_READERS_={P:E.readMultiPointGeometry_,L:E.readMultiLineStringGeometry_,A:E.readMultiPolygonGeometry_,l:E.readLineStringGeometry_,p:E.readPointGeometry_,a:E.readPolygonGeometry_},E.GEOMETRY_WRITERS_={MultiLineString:E.writeMultiLineStringGeometry_,MultiPoint:E.writeMultiPointGeometry_,MultiPolygon:E.writeMultiPolygonGeometry_,LineString:E.writeLineStringGeometry_,Point:E.writePointGeometry_,Polygon:E.writePolygonGeometry_},E.prototype.decodeCoordinates_=function(e,t){for(var r=e.length,a=0,n=void 0!==t?t:[],o=n.length;a<r;){var i=void 0,s=0,l=0;do{l|=(31&(i=E.CHAR64_.indexOf(e.charAt(a++))))<<s,s+=5}while(i>=32);var u=1&l?~(l>>1):l>>1;this.prevX_+=u,s=0,l=0;do{l|=(31&(i=E.CHAR64_.indexOf(e.charAt(a++))))<<s,s+=5}while(i>=32);var c=1&l?~(l>>1):l>>1;this.prevY_+=c,n[o++]=this.prevX_*this.accuracy_,n[o++]=this.prevY_*this.accuracy_}return n},E.prototype.encodeCoordinates_=function(e,t,r,a){for(var n="",o=r;o<a;o+=t){var i=e[o],s=e[o+1];i=Math.floor(i/this.accuracy_),s=Math.floor(s/this.accuracy_);var l=i-this.prevX_,u=s-this.prevY_;this.prevX_=i,this.prevY_=s,n+=E.encodeSignedNumber_(l)+E.encodeSignedNumber_(u)}return n},E.prototype.readFeatureFromText=function(e,t){a.a.assert(e.length>2),a.a.assert("("===e[1]),a.a.assert(")"===e[e.length-1]);var r=e.indexOf("~"),n=r>=0?e.substring(0,r)+")":e,o=this.readGeometryFromText(n,t),i=new l.a(o);if(r>=0){var s=e.substring(r+1,e.length-1),u=(r=s.indexOf("~"))>=0?s.substring(0,r):s;if(""!=u)for(var c=u.split("'"),h=0;h<c.length;++h){var p=decodeURIComponent(c[h]).split("*");a.a.assert(2===p.length);var g=p[0],d=p[1];!this.setStyle_&&E.LegacyProperties_[g]&&(g=E.LegacyProperties_[g]),i.set(g,E.castValue_(g,d))}if(r>=0){var f=s.substring(r+1);this.setStyle_?E.setStyleInFeature_(f,i):E.setStyleProperties_(f,i)}}return i},E.prototype.readFeaturesFromText=function(e,t){var r=this;a.a.assert("F"===e[0]),this.prevX_=0,this.prevY_=0;var n=[];for(e=e.substring(1);e.length>0;){var o=e.indexOf(")");a.a.assert(o>=0);var i=this.readFeatureFromText(e.substring(0,o+1),t);n.push(i),e=e.substring(o+1)}return n.forEach(function(e){for(var t in r.defaultValues_){var a=E.LegacyProperties_[t];void 0===e.get(a)&&e.set(a,r.defaultValues_[t].call(null,e))}}),n},E.prototype.readGeometryFromText=function(e,t){var r=E.GEOMETRY_READERS_[e[0]];return a.a.assert(void 0!==r),r.call(this,e)},E.prototype.writeFeatureText=function(e,t){var r=[],n="",o=e.getGeometry();o&&(n=this.writeGeometryText(o,t)),n.length>0&&(a.a.assert(")"===n[n.length-1]),n=n.substring(0,n.length-1),r.push(n));var i=[],s=this.propertiesFunction_(e);for(var l in s){var u=s[l];if(void 0!==u&&null!==u&&l!==e.getGeometryName()){0!==i.length&&i.push("'");var c=encodeURIComponent(l.replace(/[()'*]/g,"_")+"*"+u.toString().replace(/[()'*]/g,"_"));i.push(c)}}if(i.length>0&&(r.push("~"),Array.prototype.push.apply(r,i)),this.encodeStyles_){var h=e.getStyleFunction();if(void 0!==h){var p=h.call(e,0);if(null!==p){var g=[];p=Array.isArray(p)?p:[p],E.encodeStyles_(p,o.getType(),g),g.length>0&&(r.push("~"),Array.prototype.push.apply(r,g))}}}return r.push(")"),r.join("")},E.prototype.writeFeaturesText=function(e,t){this.prevX_=0,this.prevY_=0;var r=[];if(e.length>0){r.push("F");for(var a=0,n=e.length;a<n;++a)r.push(this.writeFeatureText(e[a],t))}return r.join("")},E.prototype.writeGeometryText=function(e,t){var r=E.GEOMETRY_WRITERS_[e.getType()];a.a.assert(void 0!==r);var n=h.b(e,!0,t);return r.call(this,n)};t.a=E},function(e,t,r){"use strict";var a=r(1),n=r(2),o=r(17),i=r(253),s=r(56),l=angular.module("gmfDrawingFeatureStyle",[i.a.name,s.a.module.name]);l.run(["$templateCache",function(e){e.put("gmf/drawing/featureStyleComponent",r(377))}]),l.directive_=function(){return{controller:"GmfFeaturestyleController as fsCtrl",scope:{feature:"=gmfFeaturestyleFeature"},bindToController:!0,templateUrl:"gmf/drawing/featureStyleComponent"}},l.directive("gmfFeaturestyle",l.directive_),l.Controller_=function(e,t){var r=this;this.feature,this.scope_=e,this.featureHelper_=t,this.color=void 0,this.label=void 0,this.measure=void 0,e.$watch(function(){return r.color},this.handleColorSet_.bind(this)),this.featureListenerKeys_=[],this.type,e.$watch(function(){return r.feature},this.handleFeatureSet_.bind(this))},l.Controller_.$inject=["$scope","ngeoFeatureHelper"],l.Controller_.prototype.handleFeatureSet_=function(e,t){var r=this.featureListenerKeys_;if(t&&(r.forEach(n.e),r.length=0,this.type=void 0,this.color=void 0,this.measure=void 0,this.label=void 0),e){[o.a.ANGLE,o.a.COLOR,o.a.NAME,o.a.SHOW_LABEL,o.a.OPACITY,o.a.SHOW_MEASURE,o.a.SIZE,o.a.STROKE].forEach(function(t){r.push(n.a(e,"change:"+t,this.handleFeatureChange_,this))},this);var i=e.getGeometry();a.a.assert(i,"Geometry should be thruthy"),r.push(n.a(i,"change",this.handleGeometryChange_,this)),this.type=this.featureHelper_.getType(e),this.color=this.featureHelper_.getColorProperty(e),this.measure=this.featureHelper_.getMeasure(e)}},l.Controller_.prototype.handleColorSet_=function(e){this.feature&&e&&(this.feature.get(o.a.COLOR)!==e&&this.feature.set(o.a.COLOR,e))},l.Controller_.prototype.getSetAngle=function(e){return a.a.assertNumber(this.getSetProperty_(o.a.ANGLE,e))},l.Controller_.prototype.getSetName=function(e){return a.a.assertString(this.getSetProperty_(o.a.NAME,e))},l.Controller_.prototype.getSetShowLabel=function(e){return a.a.assertBoolean(this.getSetProperty_(o.a.SHOW_LABEL,e))},l.Controller_.prototype.getSetOpacity=function(e){return a.a.assertNumber(this.getSetProperty_(o.a.OPACITY,e))},l.Controller_.prototype.getSetShowMeasure=function(e){return a.a.assertBoolean(this.getSetProperty_(o.a.SHOW_MEASURE,e))},l.Controller_.prototype.getSetSize=function(e){return a.a.assertNumber(this.getSetProperty_(o.a.SIZE,e))},l.Controller_.prototype.getSetStroke=function(e){return a.a.assertNumber(this.getSetProperty_(o.a.STROKE,e))},l.Controller_.prototype.getSetProperty_=function(e,t){return void 0!==t&&this.feature.set(e,t),this.feature.get(e)},l.Controller_.prototype.handleFeatureChange_=function(){var e=this.feature;e&&this.featureHelper_.setStyle(e,!0)},l.Controller_.prototype.handleGeometryChange_=function(){a.a.assert(this.feature),this.measure=this.featureHelper_.getMeasure(this.feature),this.featureHelper_.getShowMeasureProperty(this.feature)&&this.handleFeatureChange_(),this.scope_.$apply()},l.controller("GmfFeaturestyleController",l.Controller_);var u=l,c=r(15),h=r(201),p=r(330),g=r(160),d=r(245),f=r(244),m=r(199),y=r(198),v=r(112),_=r(60),S=r(159),b=r(3),C=r(8),w=r(29),T=r(53),E=r(18),A=r(127),L=(r(133),angular.module("GmfDrawFeatureComponent",[u.name,p.a.name,g.a.name,d.a.name,s.a.module.name,S.a.module.name]));L.run(["$templateCache",function(e){e.put("gmf/drawing/drawFeatureComponent",r(376))}]),L.component_=function(){return{controller:"GmfDrawfeatureController as efCtrl",scope:{active:"=gmfDrawfeatureActive",map:"<gmfDrawfeatureMap",showMeasure:"=?gmfDrawfeatureShowmeasure"},bindToController:!0,templateUrl:"gmf/drawing/drawFeatureComponent"}},L.directive("gmfDrawfeature",L.component_),L.Controller_=function(e,t,r,a,n,i){var s=this;this.map,this.active,void 0===this.active&&(this.active=!1),this.drawActive=!1,this.drawToolActivate=new _.a(this,"drawActive"),this.mapSelectActive=!0,this.longPressTimeout_=null,this.mapSelectToolActivate=new _.a(this,"mapSelectActive"),this.scope_=e,this.timeout_=t,this.featureHelper_=a,this.features=n,this.ngeoToolActivateMgr_=i,this.selectedFeature=null,this.selectedFeatures=new w.b,this.interactions_=new w.b,this.modify_=new f.a({features:this.selectedFeatures,style:a.getVertexStyle(!1)}),this.interactions_.push(this.modify_),this.menu_=null,this.modifyToolActivate=new _.a(this.modify_,"active"),this.translate_=new y.a({features:this.selectedFeatures,style:new E.c({text:new A.a({text:"",font:"normal 18px FontAwesome",fill:new T.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.translate_),this.rotate_=new m.a({features:this.selectedFeatures,style:new E.c({text:new A.a({text:"",font:"normal 18px FontAwesome",fill:new T.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.rotate_),this.initializeInteractions_(),this.rotateToolActivate=new _.a(this.rotate_,"active"),this.translateToolActivate=new _.a(this.translate_,"active"),this.listenerKeys_=[],this.listSelectionInProgress_=!1,e.$watch(function(){return s.active},this.handleActiveChange_.bind(this)),e.$watch(function(){return s.drawActive},function(e){e&&(s.selectedFeature=null)}),e.$watch(function(){return s.selectedFeature},function(e,t){s.selectedFeatures.clear(),t&&(s.featureHelper_.setStyle(t),s.unregisterInteractions_()),e?(s.featureHelper_.setStyle(e,!0),s.selectedFeatures.push(e),s.registerInteractions_(),s.listSelectionInProgress_&&(s.featureHelper_.panMapToFeature(e,s.map),s.listSelectionInProgress_=!1)):s.menu_&&(s.map.removeOverlay(s.menu_),s.menu_=null)}),e.$watch(function(){return s.mapSelectActive},this.handleMapSelectActiveChange_.bind(this)),this.nameProperty=o.a.NAME,this.gettextCatalog_=r},L.Controller_.$inject=["$scope","$timeout","gettextCatalog","ngeoFeatureHelper","ngeoFeatures","ngeoToolActivateMgr"],L.Controller_.prototype.initializeInteractions_=function(){this.interactions_.forEach(function(e){e.setActive(!1),v.a.interaction(e)})},L.Controller_.prototype.registerInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.addInteraction(t)})},L.Controller_.prototype.unregisterInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.removeInteraction(t)})},L.Controller_.prototype.handleActiveChange_=function(e){var t=this.listenerKeys_,r=["draw-",b.c(this)].join("-"),a=["other-",b.c(this)].join("-"),o=this.ngeoToolActivateMgr_;e?(t.push(n.a(this.features,"add",this.handleFeaturesAdd_,this),n.a(this.features,"remove",this.handleFeaturesRemove_,this)),t.push(n.a(this.translate_,"translateend",this.handleTranslateEnd_,this)),t.push(n.a(this.rotate_,"rotateend",this.handleRotateEnd_,this)),o.registerTool(r,this.drawToolActivate,!1),o.registerTool(r,this.mapSelectToolActivate,!0),o.registerTool(a,this.drawToolActivate,!1),o.registerTool(a,this.modifyToolActivate,!0),o.registerTool(a,this.translateToolActivate,!1),o.registerTool(a,this.rotateToolActivate,!1),this.mapSelectActive=!0,this.modify_.setActive(!0)):(t.forEach(n.e),t.length=0,o.unregisterTool(r,this.drawToolActivate),o.unregisterTool(r,this.mapSelectToolActivate),o.unregisterTool(a,this.drawToolActivate),o.unregisterTool(a,this.modifyToolActivate),o.unregisterTool(a,this.translateToolActivate),o.unregisterTool(a,this.rotateToolActivate),this.drawActive=!1,this.modify_.setActive(!1),this.mapSelectActive=!1,this.selectedFeature=null,this.menu_&&(this.map.removeOverlay(this.menu_),this.menu_=null))},L.Controller_.prototype.selectFeatureFromList=function(e){this.listSelectionInProgress_=!0,this.selectedFeature=e,this.drawActive=!1},L.Controller_.prototype.getFeaturesArray=function(){return this.features.getArray()},L.Controller_.prototype.clearFeatures=function(){var e=this.gettextCatalog_.getString("Do you really want to delete all the features?");confirm(e)&&this.features.clear()},L.Controller_.prototype.removeFeature=function(e){var t=this.gettextCatalog_.getString("Do you really want to delete the selected feature?");confirm(t)&&this.features.remove(e)},L.Controller_.prototype.handleFeaturesAdd_=function(e){var t=this;this.timeout_(function(){t.selectedFeature=e.element,t.drawActive=!1,t.scope_.$apply()})},L.Controller_.prototype.handleFeaturesRemove_=function(e){this.selectedFeature=null},L.Controller_.prototype.handleMapSelectActiveChange_=function(e){var t=this.map.getViewport();a.a.assertElement(t),e?(n.a(this.map,"click",this.handleMapClick_,this),n.a(t,"contextmenu",this.handleMapContextMenu_,this),n.a(t,"touchstart",this.handleMapTouchStart_,this),n.a(t,"touchmove",this.handleMapTouchEnd_,this),n.a(t,"touchend",this.handleMapTouchEnd_,this)):(n.c(this.map,"click",this.handleMapClick_,this),n.c(t,"contextmenu",this.handleMapContextMenu_,this),n.c(t,"touchstart",this.handleMapTouchStart_,this),n.c(t,"touchmove",this.handleMapTouchEnd_,this),n.c(t,"touchend",this.handleMapTouchEnd_,this))},L.Controller_.prototype.handleMapClick_=function(e){var t=this,r=e.pixel,a=this.map.forEachFeatureAtPixel(r,function(e){var r=!1;return C.f(t.features.getArray(),e)&&(r=e),r},{hitTolerance:5});(a=a||null)!==this.selectedFeature&&(this.selectedFeature=a,this.scope_.$apply())},L.Controller_.prototype.handleMapTouchStart_=function(e){var t=this;this.longPressTimeout_=setTimeout(function(){t.handleMapContextMenu_(e)},500)},L.Controller_.prototype.handleMapTouchEnd_=function(e){clearTimeout(this.longPressTimeout_)},L.Controller_.prototype.handleMapContextMenu_=function(e){var t=this,r=this.gettextCatalog_,a=this.map.getEventPixel(e),o=this.map.getCoordinateFromPixel(a),i=this.map.forEachFeatureAtPixel(a,function(e){var r=!1;return C.f(t.features.getArray(),e)&&(r=e),r},{hitTolerance:7});if(i=i||null){var s=[],l=this.featureHelper_.getType(i);l!=c.a.CIRCLE&&l!=c.a.LINE_STRING&&l!=c.a.POLYGON&&l!=c.a.RECTANGLE||(s=s.concat([{cls:"fa fa-arrows",label:r.getString("Move"),name:"move"},{cls:"fa fa-rotate-right",label:r.getString("Rotate"),name:"rotate"}])),s=s.concat([{cls:"fa fa-trash-o",label:r.getString("Delete"),name:"delete"}]),this.menu_=new h.a({actions:s}),n.a(this.menu_,"actionclick",this.handleMenuActionClick_,this),this.map.addOverlay(this.menu_),this.menu_.open(o),e.preventDefault(),e.stopPropagation()}i!==this.selectedFeature&&(this.modify_.setActive(!0),this.selectedFeature=i,this.scope_.$apply())},L.Controller_.prototype.handleMenuActionClick_=function(e){var t=e.detail.action;switch(t){case"delete":a.a.assert(this.selectedFeature,"Selected feature should be truthy"),this.removeFeature(this.selectedFeature),this.scope_.$apply();break;case"move":this.translate_.setActive(!0),this.scope_.$apply();break;case"rotate":this.rotate_.setActive(!0),this.scope_.$apply();break;default:console.log("FIXME - support: "+t)}},L.Controller_.prototype.handleTranslateEnd_=function(e){this.translate_.setActive(!1),this.scope_.$apply()},L.Controller_.prototype.handleRotateEnd_=function(e){this.rotate_.setActive(!1),this.scope_.$apply()},L.controller("GmfDrawfeatureController",L.Controller_);var P=L,M=angular.module("gmfDrawingModule",[P.name,u.name]);t.a=M},function(e,t,r){"use strict";var a=r(135),n=r(179),o=r(3);r(242);var i=angular.module("gmfWmscapabilitylayertreenode",[a.a.module.name,n.a.module.name]);function s(e,t){return t(e)}i.run(["$templateCache",function(e){e.put("gmf/import/wmsCapabilityLayertreeComponent",r(368))}]),i.value("gmfWmscapabilitylayertreenodeTemplateUrl",function(e){var t=e.gmfWmscapabilitylayertreenodeTemplateUrl;return void 0!==t?t:"gmf/import/wmsCapabilityLayertreeComponent"}),s.$inject=["$attrs","gmfWmscapabilitylayertreenodeTemplateUrl"],i.Controller_=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.capabilities,this.layer,this.url,this.gmfExternalDataSourcesManager_=t}return e.$inject=["gmfExternalDataSourcesManager"],e.prototype.createAndAddDataSource=function(e){this.gmfExternalDataSourcesManager_.createAndAddDataSourceFromWMSCapability(e,this.capabilities,this.url)},e.prototype.getUid=function(e){return o.c(e)},e}(),i.component("gmfWmscapabilitylayertreenode",{bindings:{capabilities:"<",layer:"<",url:"<"},controller:i.Controller_,templateUrl:s});var l=i;var u=angular.module("gmfWmtscapabilitylayertree",[a.a.module.name,n.a.module.name]);function c(e,t){return t(e)}u.run(["$templateCache",function(e){e.put("ngeo/import/wmtsCapabilityLayertreeComponent",r(367))}]),u.value("gmfWmtscapabilitylayertreTemplateUrl",function(e){var t=e.gmfWmtscapabilitylayertreTemplateUrl;return void 0!==t?t:"ngeo/import/wmtsCapabilityLayertreeComponent"}),c.$inject=["$attrs","gmfWmtscapabilitylayertreTemplateUrl"],u.Controller_=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.capabilities,this.layers,this.url,this.gmfExternalDataSourcesManager_=t}return e.$inject=["gmfExternalDataSourcesManager"],e.prototype.createAndAddDataSource=function(e){this.gmfExternalDataSourcesManager_.createAndAddDataSourceFromWMTSCapability(e,this.capabilities,this.url)},e.prototype.getUid=function(e){return o.c(e)},e}(),u.component("gmfWmtscapabilitylayertree",{bindings:{capabilities:"<",layers:"<",url:"<"},controller:u.Controller_,templateUrl:c});var h=u,p=r(1),g=r(195),d=r(38),f=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var m=angular.module("gmfImportdatasource",[a.a.module.name,l.name,h.name,g.a.module.name]);function y(e,t){return t(e)}m.run(["$templateCache",function(e){e.put("gmf/import/importdatasourceComponent",r(366))}]),m.value("gmfImportdatasourceTemplateUrl",function(e){var t=e.gmfImportdatasourceTemplateUrl;return void 0!==t?t:"gmf/import/importdatasourceComponent"}),y.$inject=["$attrs","gmfImportdatasourceTemplateUrl"],m.Controller_=function(){function e(t,r,a,n,o,i,s){var l=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.map,this.element_=t,this.scope_=n,this.timeout_=o,this.gmfExternalDataSourcesManager_=i,this.ngeoQuerent_=s,this.file,this.url,this.fileInput_=t.find("input[type=file]"),this.hasError=!1,this.hasErrorPromise_=null,this.mode=m.Controller_.Mode.ONLINE,this.modes=[m.Controller_.Mode.LOCAL,m.Controller_.Mode.ONLINE],this.pending=!1,this.unitPrefixFormat_=r("ngeoUnitPrefix"),this.wmsCapabilities=null,this.wmtsCapabilities=null,this.serversEngine_;var u=a.has("gmfExternalOGCServers")?a.get("gmfExternalOGCServers"):void 0;if(u){var c=u.map(function(e){return e.url});this.serversEngine_=new Bloodhound({datumTokenizer:function(e){p.a.assertString(e);var t=Bloodhound.tokenizers.whitespace(e);p.a.assert(t);var r=[],a=t,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}for(var s=i,l=0;l+1<s.length;)r.push(s.substr(l,s.length)),l++}return r},queryTokenizer:Bloodhound.tokenizers.whitespace,identify:!1,local:c})}this.fileInput_.on("change",function(){l.file=l.fileInput_[0].files&&l.fileInput_[0].files[0]?l.fileInput_[0].files[0]:void 0,l.scope_.$apply()})}return e.$inject=["$element","$filter","$injector","$scope","$timeout","gmfExternalDataSourcesManager","ngeoQuerent"],e.prototype.$onInit=function(){var e=this;this.gmfExternalDataSourcesManager_.map=this.map,this.serversEngine_&&this.timeout_(function(){p.a.assert(e.serversEngine_);var t=e.element_.find("input[name=url]"),r=e.element_.find("button.gmf-importdatasource-connect-btn");t.typeahead({hint:!0,highlight:!0,minLength:1},{name:"url",source:e.serversEngine_.ttAdapter()}).bind("typeahead:select",function(t,a){e.timeout_(function(){e.url=a,e.scope_.$apply(),r.focus()})})})},e.prototype.browse=function(){this.hasError=!1,this.element_.find("input[type=file][name=file]").click()},e.prototype.connect=function(){var e=this,t=p.a.assertString(this.url),r=d.a.guessServiceTypeByUrl(t);this.startWorking_(),r===d.a.Type.WMS?this.ngeoQuerent_.wmsGetCapabilities(t).then(function(t){e.wmsCapabilities=t,e.stopWorking_()},function(){e.stopWorking_(!0)}):r===d.a.Type.WMTS?this.ngeoQuerent_.wmtsGetCapabilities(t).then(function(t){e.wmtsCapabilities=t,e.stopWorking_()},function(){e.stopWorking_(!0)}):this.timeout_(function(){e.stopWorking_(!0)})},e.prototype.load=function(){var e=this,t=p.a.assert(this.file);this.gmfExternalDataSourcesManager_.createAndAddDataSourceFromFile(t,function(t){t||(e.hasError=!0)})},e.prototype.startWorking_=function(){this.pending=!0,this.hasError=!1,this.wmsCapabilities=null,this.wmtsCapabilities=null},e.prototype.stopWorking_=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.pending=!1,t&&(this.hasError=!0,this.hasErrorPromise_&&this.timeout_.cancel(this.hasErrorPromise_),this.hasErrorPromise_=this.timeout_(function(){e.hasError=!1,e.hasErrorPromise_=null},3e3))},f(e,[{key:"fileNameAndSize",get:function(){var e="",t=this.file;if(void 0!==t){var r=this.unitPrefixFormat_(t.size,"o");e=t.name+", "+r}return e}}]),e}(),m.Controller_.Mode={LOCAL:"Local",ONLINE:"Online"},m.component("gmfImportdatasource",{bindings:{map:"<"},controller:m.Controller_,templateUrl:y});var v=m,_=(r(458),angular.module("gmfImportModule",[v.name,l.name,h.name]));t.a=_},function(e,t,r){"use strict";var a=function e(){return{restrict:"A",link:function(t,r,a){var n=a.ngeoSearch,o=t.$eval(n),i=a.ngeoSearchDatasets,s=t.$eval(i).slice();s.unshift(o),r.typeahead.apply(r,s);var l=a.ngeoSearchListeners,u=t.$eval(l),c=e.adaptListeners_(u);r.on("typeahead:open",function(){t.$apply(function(){c.open()})}),r.on("typeahead:close",function(){t.$apply(function(){c.close()})}),r.on("typeahead:cursorchange",function(e,r,a){t.$apply(function(){c.cursorchange(e,r,a)})}),r.on("typeahead:select",function(e,r,a){t.$apply(function(){c.select(e,r,a)})}),r.on("typeahead:autocomplete",function(e,r,a){t.$apply(function(){c.autocomplete(e,r,a)})}),r.on("typeahead:asyncreceive",function(e,a,n){t.$apply(function(){var t=r.data("tt-typeahead").menu._allDatasetsEmpty();c.datasetsempty(e,n,t)})})}}};a.adaptListeners_=function(e){return void 0===e?{open:function(){},close:function(){},cursorchange:function(){},datasetsempty:function(){},select:function(){},autocomplete:function(){}}:{open:void 0!==e.open?e.open:function(){},close:void 0!==e.close?e.close:function(){},cursorchange:void 0!==e.cursorchange?e.cursorchange:function(){},datasetsempty:void 0!==e.datasetsempty?e.datasetsempty:function(){},select:void 0!==e.select?e.select:function(){},autocomplete:void 0!==e.autocomplete?e.autocomplete:function(){}}},(a.module=angular.module("ngeoSearchDirective",[])).directive("ngeoSearch",a);var n=a,o=r(167),i=r(10),s=(r(301),function(e,t,r,a,n,s){var l=new o.a,u={remote:{url:e,prepare:function(e,t){return t.url=t.url.replace("%QUERY",e),t},transform:function(e){var n=e;return void 0!==t&&(n={type:"FeatureCollection",features:n.features.filter(t)}),l.readFeatures(n,{featureProjection:r,dataProjection:a})}},datumTokenizer:function(){},queryTokenizer:Bloodhound.tokenizers.whitespace},c=i.a({},n||{}),h=i.a({},s||{});return c.remote&&(i.a(h,c.remote),delete c.remote),i.a(u,c),i.a(u.remote,h),new Bloodhound(u)});(s.module=angular.module("ngeoSearchCreategeojsonbloodhound",[])).value("ngeoSearchCreateGeoJSONBloodhound",s);var l=s,u=r(12),c=r(225),h=r(45),p=r(37),g=function(e){var t=e||{},r=u.f(c.a),a=t.targetProjection,n={remote:{url:"https://api3.geo.admin.ch/rest/services/api/SearchServer?type=locations&searchText=%QUERY",prepare:function(e,r){return r.url=r.url.replace("%QUERY",e),void 0!==t.limit&&(r.url+="&limit="+t.limit),void 0!==t.origins&&(r.url+="&origins="+t.origins),void 0!==t.prepare?t.prepare(e,r):r},transform:function(e){return e.results.map(function(e){var t=e.attrs,n=new h.a([t.y,t.x]),o=function(e){var t=/BOX\((.*?) (.*?),(.*?) (.*?)\)/g.exec(e);return null!==t?[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])]:null}(t.geom_st_box2d);void 0!==a&&(n.transform(r,a),null!==o&&(o=u.l(o,r,a))),t.geometry=n,t.bbox=o;var i=t.label;t.label_no_html=function(e){return e.replace(/<\/?[ib]>/g,"")}(i),t.label_simple=function(e){var t=/<b>(.*?)<\/b>/g.exec(e);return null!==t?t[1]:e}(i);var s=new p.a(t);return s.setId(t.featureId),s})}},datumTokenizer:function(){},queryTokenizer:Bloodhound.tokenizers.whitespace},o=i.a({},t.options||{}),s=i.a({},t.remoteOptions||{});return o.remote&&(i.a(s,o.remote),delete o.remote),i.a(n,o),i.a(n.remote,s),new Bloodhound(n)};(g.module=angular.module("ngeoCreateLocationSearchBloodhound",[])).value("ngeoCreateLocationSearchBloodhound",g);var d=g,f=angular.module("ngeoSearchModule",[n.module.name,l.module.name,d.module.name]);t.a=f},function(e,t,r){"use strict";var a=r(1),n=r(2),o=r(37),i=r(126),s=r(50),l=r(45),u=r(10),c=r(115),h=r(53),p=r(18),g=r(256),d=r(84),f=r(158),m=(r(360),r(59)),y=r(284),v=r(319),_=r(52),S=r(285),b={bisector:m.c,extent:m.d,axisBottom:y.a,axisLeft:y.b,scaleLinear:v.a,mouse:_.b,select:_.d,selectAll:_.e,area:S.a,line:S.b},C=function(e){var t=void 0!==e.light&&e.light,r=t?{top:0,right:0,bottom:0,left:0}:{top:10,right:20,bottom:30,left:40},n=void 0!==e.hoverCallback?e.hoverCallback:function(){},o=void 0!==e.outCallback?e.outCallback:function(){},i=e.distanceExtractor,s=e.linesConfiguration,l=Object.keys(s).length,c=b.bisector(function(e){return i(e)}).left,h=e.poiExtractor,p=e.styleDefs,g=void 0!==e.poiLabelAngle?e.poiLabelAngle:-60,d=e.i18n||{},f=d.xAxis||"Distance",m=d.yAxis||"Elevation",y={xhover:function(e,t){return parseFloat(e.toPrecision(3))+" "+t},yhover:function(e,t){return Math.round(e)+" m"},xtick:function(e,t){return e},ytick:function(e,t){return e}};void 0!==e.formatter&&u.a(y,e.formatter);var v=void 0!==e.lightXAxis&&e.lightXAxis,_=void 0,S=void 0,C=void 0,w=e.scaleModifier,T=void 0,E=void 0,A=void 0,L=void 0,P=void 0,M=void 0,F=function e(a){a.each(function(a){if(b.select(this).selectAll("svg").remove(),void 0!==a){A=Math.max(this.clientWidth-r.right-r.left,0),S=b.scaleLinear().range([0,A]),E=Math.max(this.clientHeight-r.top-r.bottom,0),C=b.scaleLinear().range([E,0]);var n=b.axisBottom(S),o=b.axisLeft(C),u=void 0;1===l&&(u=b.area().x(function(e){return S(i(e))}).y0(E).y1(function(e){var t=Object.keys(s)[0];return C(s[t].zExtractor(e))}));var c=(_=b.select(this).selectAll("svg").data([a])).enter().append("svg");_=b.select(this).selectAll("svg").data([a]),void 0!==p&&c.append("defs").append("style").attr("type","text/css").text(p);var h=c.append("g");x(),h.style("font","11px Arial"),1===l&&h.append("path").attr("class","area").style("fill","rgba(222, 222, 222, 0.5)"),h.insert("g",":first-child").attr("class","grid-y"),t||(h.append("g").attr("class","x axis").attr("transform","translate(0,"+E+")"),h.append("text").attr("class","x label").attr("text-anchor","end").attr("x",A-4).attr("y",E-4),h.append("g").attr("class","y axis"),h.append("text").attr("class","y label").attr("text-anchor","end").attr("y",6).attr("dy",".75em").attr("transform","rotate(-90)").style("fill","grey").text(m+" [m]"),h.append("g").attr("class","metas").attr("transform","translate("+(A+3)+", 0)")),h.append("g").attr("class","pois");var g=h.append("g").attr("class","x grid-hover");g.append("svg:line").attr("stroke-dasharray","5,5"),g.append("text"),h.append("rect").attr("class","overlay").attr("width",A).attr("height",E).style("fill","none").style("pointer-events","all"),_.attr("width",A+r.left+r.right).attr("height",E+r.top+r.bottom),T=_.select("g").attr("transform","translate("+r.left+","+r.top+")"),M=b.extent(a,function(e){return i(e)}),S.domain(M);var d=function(){var e=[],t=void 0,r=void 0;for(r in s)t=b.extent(a,function(e){return s[r].zExtractor(e)}),e=e.concat(t);return[Math.min.apply(null,e),Math.max.apply(null,e)]}();if(C.domain(d),void 0!==w)w(S,C,A,E);else{var F=.1*(d[1]-d[0]);C.domain([d[0]-F,d[1]+F])}1===l&&T.select(".area").transition().attr("d",u);var R=void 0,D=void 0,k=void 0;for(D in s)h.append("path").attr("class","line "+D).style("stroke",s[D].color||"#F00").style("fill","none"),(k=h.append("g").attr("class","y grid-hover "+D)).append("svg:line").attr("stroke-dasharray","5,5"),k.append("text"),R=b.line().x(function(e){return S(i(e))}).y(function(e){return C(s[D].zExtractor(e))}),T.select(".line."+D).transition().attr("d",R);M[1]>2e3?(L=1e3,P="km"):(L=1,P="m"),t||(n.tickFormat(function(e){return y.xtick(e/L,P)}),v&&n.tickValues([0,S.domain()[1]]),o.tickFormat(function(e){return y.ytick(e,"m")}),T.select(".x.axis").transition().call(n),T.select(".x.label").text(f+" ["+P+"]").style("fill","grey").style("shape-rendering","crispEdges"),E/15<10&&o.ticks(E/15),T.select(".y.axis").transition().call(o)),T.select(".grid-y").transition().call(o.tickSize(-A,0).tickFormat("")).selectAll(".tick line").style("stroke","#ccc").style("opacity",.7),T.selectAll(".axis").selectAll("path, line").style("fill","none").style("stroke","#000").style("shape-rendering","crispEdges"),T.select(".grid-y").select("path").style("stroke","none"),T.selectAll(".grid-hover line").style("stroke","#222").style("opacity",.8),T.select(".overlay").on("mouseout",function(){e.clearHighlight()}).on("mousemove",function(){var t=b.mouse(this)[0],r=S.invert(t);e.highlight(r)})}})};function x(){F.showPois([])}return F.clearHighlight=function(){T.selectAll(".grid-hover").style("display","none"),o.call(null)},F.highlight=function(e){var t=_.datum(),r=c(t,e);if(!(r>=t.length)){var a=t[r],o=i(a),u=void 0,h=[],p={},g=void 0;for(g in s)u=s[g].zExtractor(a),h.push(u),p[g]=u,T.select(".y.grid-hover."+g).style("display","inline").select("line").attr("x1",S(0)).attr("y1",C(u)).attr("x2",A).attr("y2",C(u));T.select(".x.grid-hover").style("display","inline").select("line").attr("x1",S(o)).attr("y1",E).attr("x2",S(o)).attr("y2",C(Math.max.apply(null,h)));var d=o>M[1]/2,f=S(o);f+=d?-10:10,T.select(".x.grid-hover text").text(y.xhover(o/L,P)).style("text-anchor",d?"end":"start").attr("transform","translate("+f+","+(E-10)+")"),1===l&&T.select(".y.grid-hover text").text(y.yhover(h[0],"m")).style("text-anchor",d?"end":"start").attr("transform","translate("+f+","+(C(h[0])-10)+")"),n.call(null,a,o/L,P,p,"m")}},F.showPois=function(e){e=void 0!==e?e:[],a.a.assert(0===e.length||void 0!==h);var r=h,n=_.select("g"),o=_.datum(),i=n.select(".pois").selectAll(".poi").data(e,function(e){var t=c(o,Math.round(10*r.dist(e))/10,1),a=o[t];if(a){var n=void 0,i=[];for(n in s)i.push(s[n].zExtractor(a));var l=Math.max.apply(null,i);r.z(e,l)}return r.id(e)}).enter().append("g").attr("class","poi");i.append("text").attr("x",t?0:9).attr("dy",".35em").attr("text-anchor",t?"middle":"start"),i.append("line").style("shape-rendering","crispEdges"),i.style("opacity",0).transition().duration(1e3).delay(100).style("opacity",1),i.selectAll("text").attr("transform",function(e){return t?["translate(",S(r.dist(e)),",",C(r.z(e))-10,")"].join(""):["translate(",S(r.dist(e)),",",C(r.z(e))-20,") rotate(",g,")"].join("")}).text(function(e){return r.sort(e)+(t?"":" - "+r.title(e))}),i.selectAll("line").style("stroke","grey").attr("x1",function(e){return S(r.dist(e))}).attr("y1",function(e){return C(C.domain()[0])}).attr("x2",function(e){return S(r.dist(e))}).attr("y2",function(e){return C(r.z(e))}),i.exit().remove()},F},w={select:_.d},T=angular.module("ngeoProfile",[f.a.name]);T.directive_=function(e){return{restrict:"A",link:function(t,r,o){var i=o.ngeoProfileOptions;a.a.assert(void 0!==i);var s=w.select(r[0]),l=void 0,c=void 0,h=void 0;function p(){void 0!==l&&(s.datum(c).call(l),void 0!==c&&l.showPois(h))}t.$watchCollection(i,function(e){var r=u.a({},e);if(void 0!==r){if(void 0!==r.hoverCallback){var a=r.hoverCallback;r.hoverCallback=function(){a.apply(void 0,arguments),t.$applyAsync()}}if(void 0!==r.outCallback){var n=r.outCallback;r.outCallback=function(){n(),t.$applyAsync()}}l=C(r),p()}}),t.$watch(o.ngeoProfile,function(e,t){c=e,p()}),t.$watch(o.ngeoProfilePois,function(e,t){h=e,p()}),t.$watch(o.ngeoProfileHighlight,function(e,t){void 0!==e&&(e>0?l.highlight(e):l.clearHighlight())}),n.a(window,"resize",e(p,50,!0))}}},T.directive_.$inject=["ngeoDebounce"],T.directive("ngeoProfile",T.directive_);var E=T,A=(r(133),angular.module("gmfProfile",[g.a.module.name,d.a.module.name,E.name]));function L(e,t,r){return r(e,t)}A.value("gmfProfileTemplateUrl",function(e,t){var r=t.gmfProfileTemplateurl;return void 0!==r?r:"gmf/profile"}),A.run(["$templateCache",function(e){e.put("gmf/profile",r(370))}]),L.$inject=["$element","$attrs","gmfProfileTemplateUrl"],A.component_={controller:"GmfProfileController as ctrl",bindings:{active:"=gmfProfileActive",line:"=gmfProfileLine",getMapFn:"&?gmfProfileMap",getLinesConfigurationFn:"&gmfProfileLinesconfiguration",getHoverPointStyleFn:"&?gmfProfileHoverpointstyle",getNbPointsFn:"&?gmfProfileNumberofpoints",getOptionsFn:"&?gmfProfileOptions"},templateUrl:L},A.component("gmfProfile",A.component_),A.Controller_=function(e,t,r,a,n,i,s,l){var u=this;this.$scope_=e,this.$http_=t,this.$element_=r,this.$filter_=a,this.gettextCatalog_=n,this.pointHoverOverlay_=i.getFeatureOverlay(),this.gmfProfileJsonUrl_=s,this.ngeoCsvDownload_=l,this.map_=null,this.linesConfiguration_=null,this.layersNames_=[],this.nbPoints_=100,this.line,this.profileData=[],this.currentPoint={coordinate:void 0,distance:void 0,elevations:{},xUnits:void 0,yUnits:void 0},this.profileHighlight=-1,this.measureTooltip_=null,this.measureTooltipElement_=null,this.snappedPoint_=new o.a,this.pointHoverOverlay_.addFeature(this.snappedPoint_),this.profileLabels_={xAxis:n.getString("Distance"),yAxis:n.getString("Elevation")},this.profileOptions=null,this.active=!1,this.pointerMoveKey_,this.isErrored=!1,e.$watch(function(){return u.active},function(e,t){t!==e&&u.updateEventsListening_()}),e.$watch(function(){return u.line},function(e,t){t!==e&&u.update_()}),this.updateEventsListening_()},A.Controller_.$inject=["$scope","$http","$element","$filter","gettextCatalog","ngeoFeatureOverlayMgr","gmfProfileJsonUrl","ngeoCsvDownload"],A.Controller_.prototype.$onInit=function(){this.map_=this.getMapFn?this.getMapFn():null,this.nbPoints_=this.getNbPointsFn?this.getNbPointsFn():100;var e=void 0,t=this.getHoverPointStyleFn;t?(e=t(),a.a.assertInstanceof(e,p.c)):e=new p.c({image:new c.a({fill:new h.a({color:"#ffffff"}),radius:3})}),this.pointHoverOverlay_.setStyle(e);var r=this.getLinesConfigurationFn();for(var n in a.a.assertInstanceof(r,Object),this.linesConfiguration_=r,this.linesConfiguration_){this.layersNames_.push(n),this.linesConfiguration_[n].zExtractor||(this.linesConfiguration_[n].zExtractor=this.getZFactory_(n))}this.profileOptions={linesConfiguration:this.linesConfiguration_,distanceExtractor:this.getDist_,hoverCallback:this.hoverCallback_.bind(this),outCallback:this.outCallback_.bind(this),i18n:this.profileLabels_};var o=this.getOptionsFn;if(o){var i=o();a.a.assertObject(i),u.a(this.profileOptions,i)}},A.Controller_.prototype.update_=function(){this.isErrored=!1,this.line?this.getJsonProfile_():this.profileData=[],this.active=!!this.line},A.Controller_.prototype.updateEventsListening_=function(){this.active&&null!==this.map_?this.pointerMoveKey_=n.a(this.map_,"pointermove",this.onPointerMove_.bind(this)):n.e(this.pointerMoveKey_)},A.Controller_.prototype.onPointerMove_=function(e){if(!e.dragging&&this.line){var t=this.map_.getEventCoordinate(e.originalEvent),r=this.line.getClosestPoint(t),a=new s.a([r,t]).getLength()/this.map_.getView().getResolution();this.profileHighlight=a<16?this.getDistanceOnALine_(r,this.line):-1,this.$scope_.$apply()}},A.Controller_.prototype.getDistanceOnALine_=function(e,t){var r=void 0,a=0,n=[e[0]-.5,e[1]-.5,e[0]+.5,e[1]+.5];return this.line.forEachSegment(function(t,o){if((r=new s.a([t,o])).intersectsExtent(n))return r.setCoordinates([t,e]),a+=r.getLength();a+=r.getLength()}),a},A.Controller_.prototype.hoverCallback_=function(e,t,r,a,n){var o=void 0,i=[e.x,e.y];for(o in a)this.currentPoint.elevations[o]=a[o];this.currentPoint.distance=t,this.currentPoint.xUnits=r,this.currentPoint.yUnits=n,this.currentPoint.coordinate=i;var s=new l.a(i);this.createMeasureTooltip_(),this.measureTooltipElement_.innerHTML=this.getTooltipHTML_(),this.measureTooltip_.setPosition(i),this.snappedPoint_.setGeometry(s)},A.Controller_.prototype.outCallback_=function(){this.currentPoint.coordinate=void 0,this.currentPoint.distance=void 0,this.currentPoint.elevations={},this.currentPoint.xUnits=void 0,this.currentPoint.yUnits=void 0,this.removeMeasureTooltip_(),this.snappedPoint_.setGeometry(null)},A.Controller_.prototype.getTooltipHTML_=function(){var e=void 0,t=void 0,r=[],a=this.$filter_("number"),n="m"===this.currentPoint.xUnits?0:2;for(e in r.push(this.profileLabels_.xAxis+" : "+a(this.currentPoint.distance,n)+" "+this.currentPoint.xUnits),this.currentPoint.elevations)t=this.gettextCatalog_.getString(e),r.push(t+" : "+a(this.currentPoint.elevations[e],0)+" "+this.currentPoint.yUnits);return r.join("</br>")},A.Controller_.prototype.createMeasureTooltip_=function(){this.removeMeasureTooltip_(),this.measureTooltipElement_=document.createElement("div"),this.measureTooltipElement_.className+="tooltip ngeo-tooltip-measure",this.measureTooltip_=new i.a({element:this.measureTooltipElement_,offset:[0,-15],positioning:"bottom-center"}),this.map_.addOverlay(this.measureTooltip_)},A.Controller_.prototype.removeMeasureTooltip_=function(){null!==this.measureTooltipElement_&&(this.measureTooltipElement_.parentNode.removeChild(this.measureTooltipElement_),this.measureTooltipElement_=null,this.map_.removeOverlay(this.measureTooltip_))},A.Controller_.prototype.getColor=function(e){var t=this.linesConfiguration_[e];if(t)return t.color},A.Controller_.prototype.getLayersNames=function(){return this.layersNames_.slice(0)},A.Controller_.prototype.getZFactory_=function(e){return function(t){return"values"in t&&e in t.values?parseFloat(t.values[e]):0}},A.Controller_.prototype.getDist_=function(e){return"dist"in e?e.dist:0},A.Controller_.prototype.getJsonProfile_=function(){var e={type:"LineString",coordinates:this.line.getCoordinates()},t={layers:this.layersNames_.join(","),geom:JSON.stringify(e),nbPoints:this.nbPoints_};this.$http_({url:this.gmfProfileJsonUrl_,method:"POST",params:t,paramSerializer:"$httpParamSerializerJQLike",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(this.getProfileDataSuccess_.bind(this),this.getProfileDataError_.bind(this))},A.Controller_.prototype.getProfileDataSuccess_=function(e){var t=e.data.profile;t instanceof Array&&(this.profileData=t)},A.Controller_.prototype.getProfileDataError_=function(e){this.isErrored=!0,console.error("Can not get JSON profile.")},A.Controller_.prototype.downloadCsv=function(){if(0!==this.profileData.length){var e=[],t=!1,r=this.profileData[0];"dist"in r&&(e.push({name:"distance"}),t=!0);var a=[];for(var n in r.values)e.push({name:n}),a.push(n);e.push({name:"x"}),e.push({name:"y"});var o=this.profileData.map(function(e){var r={};return t&&(r.distance=e.dist),a.forEach(function(t){r[t]=e.values[t]}),r.x=e.x,r.y=e.y,r});this.ngeoCsvDownload_.startDownload(o,e,"profile.csv")}},A.controller("GmfProfileController",A.Controller_);var P=A,M=r(29),F=r(153),x=r(142),R=r(58),D=r(112),k=angular.module("gmfDrawProfileLine",[d.a.module.name]);k.directive_=function(){return{scope:!0,controller:"GmfDrawprofilelineController as ctrl",restrict:"A",bindToController:{getMapFn:"&gmfDrawprofilelineMap",line:"=gmfDrawprofilelineLine",active:"=gmfDrawprofilelineActive",getStyleFn:"&?gmfDrawprofilelineStyle"}}},k.directive("gmfDrawprofileline",k.directive_),k.Controller_=function(e,t,r,n){var o=this;this.line,this.map_=null,this.active,this.features_=new M.b;var i=n.getFeatureOverlay();i.setFeatures(this.features_);var s=void 0,l=this.getStyleFn;l?(s=l(),a.a.assertInstanceof(s,p.c)):s=new p.c({stroke:new R.a({color:"#ffcc33",width:2})}),i.setStyle(s),this.interaction=new F.a({type:"LineString",features:this.features_}),D.a.interaction(this.interaction),this.interaction.on("change:active",function(){o.interaction.getActive()&&o.clear_()}),this.interaction.on("drawend",function(e){o.line=e.feature.getGeometry(),r(function(){o.interaction.setActive(!1)},0)}),e.$watch(function(){return o.line},function(e,t){null===e&&o.clear_()}),e.$watch(function(){return o.active},function(e){!1===e&&o.clear_(),o.interaction.setActive(o.active)})},k.Controller_.$inject=["$scope","$element","$timeout","ngeoFeatureOverlayMgr"],k.Controller_.prototype.$onInit=function(){var e=this.getMapFn();a.a.assertInstanceof(e,x.a),this.map_=e,this.map_.addInteraction(this.interaction)},k.Controller_.prototype.clear_=function(){this.features_.clear(),this.line=null},k.controller("GmfDrawprofilelineController",k.Controller_);var $=k,O=(r(459),angular.module("gmfProfileModule",[P.name,$.name]));t.a=O},,,,function(e,t,r){"use strict";var a=r(105),n=r(270),o=r(44),i=angular.module("ngeoBboxQuery",[a.a.module.name]);i.directive_=function(e){return{restrict:"A",scope:!1,link:function(t,r,a){var i=t.$eval(a.ngeoBboxQueryMap),s=new n.a({condition:o.g});s.on("boxend",function(r){var n=s.getGeometry().getExtent();e.issue({limit:t.$eval(a.ngeoBboxQueryLimit),extent:n,map:i})}),t.$watch(a.ngeoBboxQueryActive,function(r,n){r?i.addInteraction(s):(i.removeInteraction(s),!1!==t.$eval(a.ngeoBboxQueryAutoclear)&&e.clear())})}}},i.directive_.$inject=["ngeoMapQuerent"],i.directive("ngeoBboxQuery",i.directive_),t.a=i},function(e,t,r){"use strict";var a=r(249),n=r(1),o=r(158),i=r(2),s=(r(133),angular.module("gmfRasterComponent",[a.a.module.name,o.a.name]));function l(e,t){return t(e)}s.run(["$templateCache",function(e){e.put("gmf/raster/widgetComponent",r(369))}]),s.value("gmfElevationwidgetTemplateUrl",function(e){var t=e.gmfElevationwidgetTemplateUrl;return void 0!==t?t:"gmf/raster/widgetComponent"}),l.$inject=["$attrs","gmfElevationwidgetTemplateUrl"],s.component_=function(){return{restrict:"A",controller:"GmfElevationController as ctrl",bindToController:!0,scope:{active:"<gmfElevationActive",elevation:"=gmfElevationElevation",loading:"=?gmfElevationLoading",layer:"<gmfElevationLayer",map:"=gmfElevationMap"},link:function(e,t,r){var a=e.ctrl;e.$watch(function(){return a.active},function(e){this.toggleActive_(e)}.bind(a)),e.$watch(function(){return a.layer},function(e){this.layer=e,this.elevation=null}.bind(a))}}},s.directive("gmfElevation",s.component_),s.Controller_=function(e,t,r){this.ngeoDebounce_=t,this.gmfRaster_=r,this.active,this.elevation,this.layer,this.map,this.listenerKeys_=[],this.scope_=e,this.inViewport_=!1,this.loading=!1},s.Controller_.$inject=["$scope","ngeoDebounce","gmfRaster"],s.Controller_.prototype.toggleActive_=function(e){var t=this;this.elevation=void 0,e?(n.a.assert(0===this.listenerKeys_.length),this.listenerKeys_.push(i.a(this.map,"pointermove",function(e){var t=this;this.scope_.$apply(function(){t.inViewport_=!0,t.elevation=void 0,t.loading=!1})},this)),this.listenerKeys_.push(i.a(this.map,"pointermove",this.ngeoDebounce_(this.pointerStop_.bind(this),500,!0))),this.listenerKeys_.push(i.a(this.map.getViewport(),"mouseout",function(){t.scope_.$apply(function(){t.elevation=void 0,t.inViewport_=!1,t.loading=!1})}))):(this.elevation=void 0,this.listenerKeys_.forEach(i.e),this.listenerKeys_.length=0)},s.Controller_.prototype.pointerStop_=function(e){if(this.inViewport_){this.loading=!0;var t={layers:this.layer};this.gmfRaster_.getRaster(e.coordinate,t).then(this.getRasterSuccess_.bind(this),this.getRasterError_.bind(this))}},s.Controller_.prototype.getRasterSuccess_=function(e){n.a.assert(this.layer,"A layer should be selected"),this.elevation=e[this.layer],this.loading=!1},s.Controller_.prototype.getRasterError_=function(){console.error("Error on getting the raster."),this.elevation=void 0,this.loading=!1},s.controller("GmfElevationController",s.Controller_),s.widgetComponent_={controller:"gmfElevationwidgetController as ctrl",bindings:{map:"<gmfElevationwidgetMap",layers:"<gmfElevationwidgetLayers",active:"<gmfElevationwidgetActive"},templateUrl:l},s.component("gmfElevationwidget",s.widgetComponent_),s.WidgetController_=function(){this.map,this.layers,this.active,this.selectedElevationLayer},s.WidgetController_.prototype.$onInit=function(){this.selectedElevationLayer=this.layers[0]},s.controller("gmfElevationwidgetController",s.WidgetController_),t.a=s},,,function(e,t,r){"use strict";(function(e){var a=r(41),n=r(164),o=r(33),i=r(1),s=r(85),l=r(84),u=r(56),c=r(313),h=r(210),p=r(105),g=r(8),d=r(2),f=r(131),m=r(122),y=r(103),v=r(142),_=r(19);r(133);var S=angular.module("gmfPrintComponent",[n.a.module.name,o.a.module.name,s.a.module.name,l.a.module.name,u.a.module.name,c.a.module.name,h.a.module.name,p.a.module.name]);function b(e,t,r){return r(e,t)}S.value("gmfPrintTemplateUrl",function(e,t){var r=t.gmfPrintTemplateurl;return void 0!==r?r:"gmf/print"}),S.run(["$templateCache",function(e){e.put("gmf/print",r(371))}]),S.PrintStateEnum={NOT_IN_USE:"notInUse",PRINTING:"printing",ERROR_ON_REPORT:"errorOnReport",CAPABILITIES_NOT_LOADED:"capabilitiesNotLoaded",ERROR_ON_GETCAPABILITIES:"errorOnGetCapabilities"},S.value("gmfPrintState",{state:S.PrintStateEnum.CAPABILITIES_NOT_LOADED}),b.$inject=["$element","$attrs","gmfPrintTemplateUrl"],S.component_={bindings:{map:"<gmfPrintMap",active:"=gmfPrintActive",rotateMask:"<?gmfPrintRotatemask",fieldValues:"<?gmfPrintFieldvalues",hiddenAttributeNames:"<?gmfPrintHiddenattributes",attributesOut:"=?gmfPrintAttributesOut"},controller:"GmfPrintController",templateUrl:b,transclude:!0},S.component("gmfPrint",S.component_),S.optionsLegendType,S.optionsType,S.Controller_=function(){function t(r,a,n,o,i,s,l,u,c,h,p,g,d,f,m,y,v){var _=this;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.gmfPrintState_=y,this.translate_=m("translate"),this.map,this.active,this.rotateMask=!1,this.fieldValues={},this.attributesOut,this.$rootScope_=a,this.$scope_=n,this.$timeout_=o,this.$q_=i,this.gettextCatalog_=l,this.ngeoLayerHelper_=u,this.featureOverlayLayer_=c.getLayer(),this.ngeoPrintUtils_=h,this.ngeoPrint_=p(g),this.ngeoQueryResult_=f,this.gmfAuthenticationService_=d,this.gmfThemes_=v,this.cacheVersion_="0",s.has("cacheVersion")&&(this.cacheVersion_=s.get("cacheVersion")),this.scaleInput=!1,this.gmfLegendOptions_={useBbox:!0,label:{},params:{}},s.has("gmfPrintOptions")){var S=s.get("gmfPrintOptions");S.scaleInput&&(this.scaleInput=S.scaleInput),S.legend&&Object.assign(this.gmfLegendOptions_,S.legend)}this.requestCanceler_=null,this.statusTimeoutPromise_=null,this.onDragPreviousMousePosition_=null,this.rotationTimeoutPromise_=null,this.postComposeListenerKey_,this.pointerDragListenerKey_,this.mapViewResolutionChangeKey_,this.curRef_="",this.formats_=[],this.layouts_=[],this.layout_={},this.paperSize_=[],this.layoutInfo={},this.rotation=0,this.hiddenAttributeNames,this.scaleManuallySelected_=!1,this.rotationInput_=r.find(".gmf-print-rotation-input"),this.rotationInput_.on("input",function(t){var r=e(t.target).val();""!==r&&_.setRotation(r)}),this.postcomposeListener_,this.capabilities_,this.ogcServers_,this.currentThemes_}return t.$inject=["$element","$rootScope","$scope","$timeout","$q","$injector","gettextCatalog","ngeoLayerHelper","ngeoFeatureOverlayMgr","ngeoPrintUtils","ngeoCreatePrint","gmfPrintUrl","gmfAuthenticationService","ngeoQueryResult","$filter","gmfPrintState","gmfThemes"],t.prototype.$onInit=function(){var e=this;this.$scope_.$watch(function(){return e.gmfAuthenticationService_.getRoleId()},function(){e.gmfPrintState_.state=S.PrintStateEnum.CAPABILITIES_NOT_LOADED,e.capabilities_=null}),this.$scope_.$watch(function(){return e.active},function(t){e.togglePrintPanel_(t)}),this.$rootScope_.$on("gmfStartPrint",function(t,r){e.print(""+r)}),this.$rootScope_.$on("gmfCancelPrint",function(){e.cancel()}),this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t}),this.gmfThemes_.getThemesObject().then(function(t){e.currentThemes_=t});var t=void 0;this.rotateMask&&(t=function(){return e.rotation}),this.postcomposeListener_=this.ngeoPrintUtils_.createPrintMaskPostcompose(function(){return e.paperSize_},this.getScaleFn.bind(this),t)},t.prototype.getScaleFn=function(e){if(i.a.assert(this.layoutInfo.scales),i.a.assert(void 0!==this.layoutInfo.scale),!this.scaleManuallySelected_&&(-1===this.layoutInfo.scale||g.f(this.layoutInfo.scales,this.layoutInfo.scale))){var t=e.size,r=e.viewState.resolution;this.layoutInfo.scale=this.getOptimalScale_(t,r)}return this.layoutInfo.scale},t.prototype.togglePrintPanel_=function(e){var t=this;e?(this.capabilities_||this.getCapabilities_(),this.capabilities_.then(function(e){t.active&&(t.gmfPrintState_.state=S.PrintStateEnum.NOT_IN_USE,t.parseCapabilities_(e),t.postComposeListenerKey_=d.a(t.map,"postcompose",t.postcomposeListener_),t.pointerDragListenerKey_=d.a(t.map,"pointerdrag",t.onPointerDrag_,t),t.mapViewResolutionChangeKey_=d.a(t.map.getView(),"change:resolution",function(){t.scaleManuallySelected_=!1}),t.map.render())},function(e){t.gmfPrintState_.state=S.PrintStateEnum.ERROR_ON_GETCAPABILITIES,t.capabilities_=null})):(d.e(this.postComposeListenerKey_),d.e(this.pointerDragListenerKey_),d.e(this.mapViewResolutionChangeKey_),this.setRotation(0),this.map.render())},t.prototype.getCapabilities_=function(e){this.capabilities_=this.ngeoPrint_.getCapabilities({withCredentials:!0,params:e?{role:e,cache_version:this.cacheVersion_}:{cache_version:this.cacheVersion_}})},t.prototype.parseCapabilities_=function(e){var t=this,r=e.data;this.formats_=r.formats||[],this.layouts_=r.layouts,this.layout_=r.layouts[0],this.layoutInfo.layouts=[],this.layouts_.forEach(function(e){t.layoutInfo.layouts.push(e.name)}),this.updateFields_()},t.prototype.updateFields_=function(){var e=this;this.layoutInfo.layout=this.layout_.name;var t=this.isAttributeInCurrentLayout_("map");i.a.assertObject(t);var r=t.clientInfo;i.a.assertObject(r),this.paperSize_=[r.width,r.height],this.updateCustomFields_();var a=this.isAttributeInCurrentLayout_("legend");void 0===this.layoutInfo.legend&&(this.layoutInfo.legend=!!(void 0!==a?a:this.fieldValues.legend)),this.layoutInfo.scales=r.scales||[],this.layoutInfo.dpis=r.dpiSuggestions||[];var n=this.map.getSize(),o=this.map.getView().getResolution();this.layoutInfo.scale=this.getOptimalScale_(n,o),this.layoutInfo.dpi=this.layoutInfo.dpi&&this.layoutInfo.dpis.indexOf(this.layoutInfo.dpi)>0?this.layoutInfo.dpi:this.layoutInfo.dpis[0],this.layoutInfo.formats={},this.formats_.forEach(function(t){e.layoutInfo.formats[t]=!0}),this.attributesOut=this.layoutInfo.simpleAttributes,this.map.render()},t.prototype.updateCustomFields_=function(){var e=this,t=void 0,r=void 0,a=void 0,n=void 0;this.layoutInfo.simpleAttributes||(this.layoutInfo.simpleAttributes=[]);var o=this.layoutInfo.simpleAttributes,i=o.splice(0,o.length);this.layout_.attributes.forEach(function(o){if(!o.clientParams){t=""+o.name;var s=o.default;switch(a=void 0!==s&&""!==s?s:e.fieldValues[t],r=""+o.type){case"String":n="comments"===t?"textarea":"text";break;case"Boolean":n="checkbox";break;case"Number":n="number",a=parseFloat(a),a=isNaN(a)?0:a;break;default:n=r}i.forEach(function(e){if(e.name===t&&e.type===n)return a=e.value}),e.layoutInfo.simpleAttributes.push({name:t,type:n,value:a})}})},t.prototype.isAttributeInCurrentLayout_=function(e){var t=null;return this.layout_.attributes.forEach(function(r){if(r.name===e)return t=r}),t},t.prototype.setRotation=function(e){this.rotation=_.a(e,-180,180),this.rotationInput_.val(this.rotation.toString()),this.rotateMask?this.map.render():this.map.getView().setRotation(_.i(this.rotation))},t.prototype.onPointerDrag_=function(e){var t=this,r=e.originalEvent,a=this.map.getView().getCenter();if(this.active&&r.altKey&&r.shiftKey&&a){var n=this.map.getPixelFromCoordinate(a),o=e.pixel;if(null===this.rotationTimeoutPromise_)this.onDragPreviousMousePosition_=null;else{this.$timeout_.cancel(this.rotationTimeoutPromise_);var i=this.onDragPreviousMousePosition_[0]-n[0],s=this.onDragPreviousMousePosition_[1]-n[1],l=o[0]-n[0],u=o[1]-n[1],c=Math.sqrt(Math.pow(i,2)+Math.pow(s,2)),h=Math.sqrt(Math.pow(l,2)+Math.pow(u,2)),p=(i*l+s*u)/(c*h);p=p<=1?(i*u-s*l>0?1:-1)*Math.acos(p):0;var g=h/200,d=Math.round(_.h(p)*g);this.setRotation(this.rotation+d),this.$scope_.$digest()}this.rotationTimeoutPromise_=this.$timeout_(function(){t.rotationTimeoutPromise_=null},500),this.onDragPreviousMousePosition_=o}},t.prototype.print=function(e){if(this.gmfPrintState_.state!==S.PrintStateEnum.PRINTING){this.requestCanceler_=this.$q_.defer(),this.gmfPrintState_.state=S.PrintStateEnum.PRINTING;var t=this.map.getSize(),r=this.map.getView().getResolution()||0,a=this.layoutInfo.scale||this.getOptimalScale_(t,r),n={datasource:this.getDataSource_()};if(this.layoutInfo.simpleAttributes&&this.layoutInfo.simpleAttributes.forEach(function(e){n[e.name]=e.value}),this.layoutInfo.legend){var o=this.map.getView().getCenter(),s=this.paperSize_[0]*a/2/h.a.INCHES_PER_METER_/h.a.DOTS_PER_INCH_,l=this.paperSize_[1]*a/2/h.a.INCHES_PER_METER_/h.a.DOTS_PER_INCH_,u=[o[0]-s,o[1]-l,o[0]+s,o[1]+l],c=this.getLegend_(a,this.layoutInfo.dpi,u);null!==c&&(n.legend=c)}i.a.assertNumber(this.layoutInfo.dpi),i.a.assertString(this.layoutInfo.layout);var p=new v.a({});p.setView(this.map.getView());for(var g=this.ngeoLayerHelper_.getFlatLayers(this.map.getLayerGroup()),d=[],m=!0,_=0,b=g.length;_<b;_++){var C=g[_],w=C.get("metadata");if(w){var T=w.ogcServer,E=w.printLayers||w.layers;if(T&&E){var A=this.ogcServers_[T];A?C=this.ngeoLayerHelper_.createBasicWMSLayer(A.url,E,A.imageType,A.type):console.error("Missing ogcServer:",T)}}C instanceof f.a&&!1===C.get("printNativeAngle")&&(m=!1),d.push(C)}p.setLayerGroup(new y.a({layers:d,printNativeAngle:m}));var L=this.ngeoPrint_.createSpec(p,a,this.layoutInfo.dpi,this.layoutInfo.layout,e,n),P=[];this.ngeoPrint_.encodeLayer(P,this.featureOverlayLayer_,r),P.length>0&&L.attributes.map.layers.unshift(P[0]),this.ngeoPrint_.createReport(L,{timeout:this.requestCanceler_.promise}).then(this.handleCreateReportSuccess_.bind(this),this.handleCreateReportError_.bind(this)),p.setTarget(null)}},t.prototype.cancel=function(){null!==this.requestCanceler_&&this.requestCanceler_.resolve(),null!==this.statusTimeoutPromise_&&this.$timeout_.cancel(this.statusTimeoutPromise_),this.curRef_.length>0&&this.ngeoPrint_.cancel(this.curRef_),this.resetPrintStates_()},t.prototype.resetPrintStates_=function(e){this.gmfPrintState_.state=e||S.PrintStateEnum.NOT_IN_USE,this.curRef_=""},t.prototype.getDataSource_=function(){var e=void 0,t=void 0,r=void 0,a=[];return this.ngeoQueryResult_.sources.forEach(function(n){t=[],r=[],n.features.forEach(function(e,a){i.a.assert(e);var n=u.a.getFilteredFeatureValues(e);0===a&&(r=Object.keys(n).map(function(e){return this.translate_(e)},this)),t.push(Object.keys(n).map(function(e){return n[e]}))},this),r.length&&(e={title:this.translate_(n.label),table:{columns:r,data:t}},a.push(e))},this),a},t.prototype.getOptimalScale_=function(e,t){var r=this.layoutInfo.scales.slice();return void 0!==e&&void 0!==t?this.ngeoPrintUtils_.getOptimalScale(e,t,this.paperSize_,r.reverse()):this.layoutInfo.scales[0]},t.prototype.handleCreateReportSuccess_=function(e){var t=e.data.ref;i.a.assert(t.length>0),this.curRef_=t,this.getStatus_(t)},t.prototype.getStatus_=function(e){this.requestCanceler_=this.$q_.defer(),this.ngeoPrint_.getStatus(e,{timeout:this.requestCanceler_.promise}).then(this.handleGetStatusSuccess_.bind(this,e),this.handleCreateReportError_.bind(this))},t.prototype.handleGetStatusSuccess_=function(e,t){var r=this,a=t.data;a.done?"error"!=a.status?(window.location.href=this.ngeoPrint_.getReportUrl(e),this.resetPrintStates_()):(console.error(a.error),this.handleCreateReportError_()):this.statusTimeoutPromise_=this.$timeout_(function(){r.getStatus_(e)},1e3,!1)},t.prototype.handleCreateReportError_=function(){this.resetPrintStates_(S.PrintStateEnum.ERROR_ON_REPORT)},t.prototype.getLegend_=function(e,t,r){var n=this,o={classes:[]},i=this.gettextCatalog_,s=this.ngeoLayerHelper_.getGroupFromMap(this.map,a.a.DATALAYERGROUP_NAME);return this.ngeoLayerHelper_.getFlatLayers(s).reverse().forEach(function(a){var s=[];if(a.getVisible()&&a.getSource())if(a instanceof m.a){var l=""+a.get("layerNodeName"),u=n.getMetadataLegendImage_(l);u||(u=n.ngeoLayerHelper_.getWMTSLegendURL(a)),u&&s.push({name:i.getString(l),icons:[u]})}else{var c=a.getSource();c.getParams().LAYERS.split(",").forEach(function(o){var l=n.getMetadataLegendImage_(o);l||(l=n.ngeoLayerHelper_.getWMSLegendURL(c.getUrl(),o,e,void 0,void 0,void 0,c.serverType_,t,n.gmfLegendOptions_.useBbox?r:void 0,n.map.getView().getProjection().getCode(),n.gmfLegendOptions_.params[a.getSource().serverType_])),l&&0!==o.length&&s.push(Object.assign({name:!1===n.gmfLegendOptions_.label[a.getSource().serverType_]?"":i.getString(o),icons:[l]},"qgis"===a.getSource().serverType_?{dpi:t}:{}))})}s.length>0&&o.classes.push({classes:s})}),o.classes.length>0?o:null},t.prototype.getMetadataLegendImage_=function(e){var t=o.a.findGroupByLayerNodeName(this.currentThemes_,e),r=void 0;t&&t.children&&(r=o.a.findObjectByName(t.children,e));var a=void 0;return r&&r.metadata&&(a=r.metadata.legendImage),a},t.prototype.setLayout=function(e){var t=void 0;this.layouts_.forEach(function(r){if(r.name===e)return t=r,!0}),this.layout_=t,this.updateFields_()},t.prototype.getSetScale=function(e){if(void 0!==e){var t=this.map.getSize()||[0,0];this.layoutInfo.scale=e;var r=this.ngeoPrintUtils_.getOptimalResolution(t,this.paperSize_,e),a=this.map.getView().constrainResolution(r,0,1);this.map.getView().setResolution(a),this.map.render(),this.scaleManuallySelected_=!0}return this.layoutInfo.scale},t.prototype.setDpi=function(e){this.layoutInfo.dpi=e},t.prototype.isState=function(e){return this.gmfPrintState_.state===S.PrintStateEnum[e]},t}(),S.controller("GmfPrintController",S.Controller_),t.a=S}).call(this,r(27))},function(e,t,r){"use strict";var a=r(1),n=r(108),o=r(15),i=r(227),s=r(226),l=r(117),u=r(62),c=r(3),h=r(29),p=r(2),g=r(37),d=r(153),f=r(18),m=angular.module("ngeoCreatefeature",[l.a.module.name,n.a.name]);m.directive_=function(){return{controller:"ngeoCreatefeatureController",bindToController:!0,scope:{active:"=ngeoCreatefeatureActive",features:"=ngeoCreatefeatureFeatures",geomType:"=ngeoCreatefeatureGeomType",map:"=ngeoCreatefeatureMap"}}},m.directive("ngeoCreatefeature",m.directive_),m.Controller_=function(e,t,r,a,n,o){var i=this;this.active,this.features,this.geomType,this.map,this.gettextCatalog_=e,this.compile_=t,this.filter_=r,this.scope_=a,this.timeout_=n,this.ngeoEventHelper_=o,this.interaction_,a.$watch(function(){return i.active},function(e){i.interaction_.setActive(e)})},m.Controller_.$inject=["gettextCatalog","$compile","$filter","$scope","$timeout","ngeoEventHelper"],m.Controller_.prototype.$onInit=function(){this.active=!0===this.active;var e=this.gettextCatalog_,t=void 0;if(this.geomType===o.a.POINT||this.geomType===o.a.MULTI_POINT)t=new d.a({type:"Point"});else if(this.geomType===o.a.LINE_STRING||this.geomType===o.a.MULTI_LINE_STRING){var r=e.getString("Click to start drawing length"),n=e.getString("Click to continue drawing<br/>Double-click or click last point to finish");t=new s.a(this.filter_("ngeoUnitPrefix"),e,{style:new f.c,startMsg:this.compile_("<div translate>"+r+"</div>")(this.scope_)[0],continueMsg:this.compile_("<div translate>"+n+"</div>")(this.scope_)[0]})}else if(this.geomType===o.a.POLYGON||this.geomType===o.a.MULTI_POLYGON){var l=e.getString("Click to start drawing area"),u=e.getString("Click to continue drawing<br/>Double-click or click starting point to finish");t=new i.a(this.filter_("ngeoUnitPrefix"),e,{style:new f.c,startMsg:this.compile_("<div translate>"+l+"</div>")(this.scope_)[0],continueMsg:this.compile_("<div translate>"+u+"</div>")(this.scope_)[0]})}a.a.assert(t),t.setActive(this.active),this.interaction_=t,this.map.addInteraction(t);var h=c.c(this);t instanceof d.a?this.ngeoEventHelper_.addListenerKey(h,p.a(t,"drawend",this.handleDrawEnd_,this)):(t instanceof s.a||t instanceof i.a)&&this.ngeoEventHelper_.addListenerKey(h,p.a(t,"measureend",this.handleDrawEnd_,this))},m.Controller_.prototype.handleDrawEnd_=function(e){var t=void 0;t=e.feature?e.feature:e.detail.feature,a.a.assert(t);var r=t.getGeometry(),n=r.getType();this.geomType.indexOf("Multi")!=n.indexOf("Multi")&&(r=u.a.toMulti(r));var o=new g.a(r);this.features instanceof h.b?this.features.push(o):this.features.addFeature(o)},m.Controller_.prototype.$onDestroy=function(){var e=this;this.timeout_(function(){var t=c.c(e);e.ngeoEventHelper_.clearListenerKey(t),e.interaction_.setActive(!1),e.map.removeInteraction(e.interaction_)},0)},m.controller("ngeoCreatefeatureController",m.Controller_),t.a=m},function(e,t,r){"use strict";(function(e){var a=r(208),n=(r(299),r(460),angular.module("ngeoDateTimePicker",["gettext"]));n.component_=function(){return{restrict:"A",controller:n.Controller_,bindToController:!0,scope:{options:"<ngeoDatetimepickerOptions"}}},n.directive("ngeoDatetimepicker",n.component_),n.Controller_=function(e,t){this.element_=e,this.gettextCatalog_=t,this.options},n.Controller_.$inject=["$element","gettextCatalog"],n.Controller_.prototype.$onInit=function(){var t=this.gettextCatalog_.getCurrentLanguage();e.datetimepicker.setLocale(t),e.datetimepicker.setDateFormatter(new a.a),"string"==typeof this.options&&(this.options=angular.fromJson(this.options)),this.element_.datetimepicker(this.options)},n.controller("ngeoDateTimePickerController",n.Controller_),t.a=n}).call(this,r(27))},function(e,t,r){"use strict";var a=r(3),n=r(2),o=r(117),i=r(328),s=angular.module("ngeoAttributes",[i.a.name,o.a.module.name]);function l(e,t){return t(e)}s.run(["$templateCache",function(e){e.put("ngeo/editing/attributescomponent",r(374))}]),s.value("ngeoAttributesTemplateUrl",function(e){var t=e.ngeoAttributesTemplateUrl;return void 0!==t?t:"ngeo/editing/attributescomponent"}),l.$inject=["$attrs","ngeoAttributesTemplateUrl"],s.component_={controller:"ngeoAttributesController as attrCtrl",bindings:{attributes:"=ngeoAttributesAttributes",disabled:"<ngeoAttributesDisabled",feature:"=ngeoAttributesFeature"},require:{form:"^"},templateUrl:l},s.component("ngeoAttributes",s.component_),s.Controller_=function(e,t){this.attributes,this.disabled=!1,this.feature,this.properties,this.scope_=e,this.ngeoEventHelper_=t,this.updating_=!1},s.Controller_.$inject=["$scope","ngeoEventHelper"],s.Controller_.prototype.$onInit=function(){this.properties=this.feature.getProperties();var e=a.c(this);this.ngeoEventHelper_.addListenerKey(e,n.a(this.feature,"propertychange",this.handleFeaturePropertyChange_,this))},s.Controller_.prototype.handleInputChange=function(e){this.updating_=!0;var t=this.properties[e];this.feature.set(e,t),this.updating_=!1},s.Controller_.prototype.$onDestroy=function(){var e=a.c(this);this.ngeoEventHelper_.clearListenerKey(e)},s.Controller_.prototype.handleFeaturePropertyChange_=function(e){this.updating_||(this.properties[e.key]=e.target.get(e.key),this.scope_.$apply())},s.controller("ngeoAttributesController",s.Controller_),t.a=s},function(e,t,r){"use strict";(function(e){var a=r(56),n=r(3),o=r(45),i=r(50),s=angular.module("ngeoExportfeatures",[a.a.module.name]);s.directive_=function(){return{controller:"ngeoExportfeaturesController as efCtrl",scope:!0,bindToController:{features:"=ngeoExportfeaturesFeatures"}}},s.directive("ngeoExportfeatures",s.directive_),s.Controller_=function(t,r,o,i){var s=this;this.features,this.element_=t;var l=["ngeo-exportfeature",n.c(this)].join("-");this.id_=l,this.featureHelper_=i;var u=void 0;if(u=r.has("ngeoExportFeatureFormats")?r.get("ngeoExportFeatureFormats"):[a.a.FormatType.KML],this.menu_=null,this.items_=[],u.length>1){t.attr("id",l);var c=e("<ul />",{class:"dropdown-menu","aria-labelledby":l}).appendTo(t.parent()[0]);this.menu_=c;var h=void 0;u.forEach(function(t){h=e("<li />").appendTo(c).append(e("<a />",{href:"#",text:t}).on(["click",l].join("."),s.handleMenuItemClick_.bind(s,t))),s.items_.push(h)})}this.formats_=u,t.on(["click",l].join("."),this.handleElementClick_.bind(this)),o.$on("$destroy",this.handleDestroy_.bind(this))},s.Controller_.$inject=["$element","$injector","$scope","ngeoFeatureHelper"],s.Controller_.prototype.handleElementClick_=function(){var e=this,t=this.features.getArray();if(1===this.formats_.length)this.featureHelper_.export(t,this.formats_[0]);else if(1===t.length){var r=t[0].getGeometry(),n=void 0;this.formats_.forEach(function(t,s){n=e.items_[s],t===a.a.FormatType.GPX&&(r instanceof o.a||r instanceof i.a?n.removeClass("disabled"):n.addClass("disabled"))})}},s.Controller_.prototype.handleMenuItemClick_=function(t,r){if(!e(r.target.parentElement).hasClass("disabled")){var a=this.features.getArray();this.featureHelper_.export(a,t)}},s.Controller_.prototype.handleDestroy_=function(){var e=this.id_;this.element_.off(["click",e].join(".")),this.menu_&&(this.menu_.remove(),this.items_.forEach(function(t){t.off(["click",e].join("."))}),this.items_.length=0,this.menu_=null)},s.controller("ngeoExportfeaturesController",s.Controller_),t.a=s}).call(this,r(27))},function(e,t,r){"use strict";(function(e){r(378);var a=r(1),n=angular.module("ngeoSortable",[]);n.component_=function(t){return{restrict:"A",link:function(r,n,o){var i=r.$eval(o.ngeoSortable)||[];a.a.assert(Array.isArray(i)),r.$watchCollection(function(){return i},function(){i.length&&t(c,0)});var s=function(e){var t=void 0;void 0===e?t={handleClassName:"ngeo-sortable-handle"}:(void 0===e.handleClassName&&(e.handleClassName="ngeo-sortable-handle"),t=e);return t}(r.$eval(o.ngeoSortableOptions)),l=r.$eval(o.ngeoSortableCallback),u=r.$eval(o.ngeoSortableCallbackCtx);function c(){for(var t=n.children(),a=0;a<t.length;++a)angular.element(t[a]).data("idx",a);var o=e(n);o.data("ui-sortable")&&(o.off("sortupdate"),o.sortable("destroy"));var c={axis:"y",classes:{"ui-sortable-helper":s.draggerClassName}};s.handleClassName&&(c.handle="."+s.handleClassName),s.placeholderClassName&&(c.placeholder=s.placeholderClassName,c.forcePlaceholderSize=!0),o.sortable(c),o.on("sortupdate",function(t,a){var o=e(a.item[0]).data("idx"),s=a.item.index();e(a.item[0]).data("idx",s),r.$apply(function(){i.splice(s,0,i.splice(o,1)[0])}),l instanceof Function&&l.apply(u,[n,i])})}}}},n.component_.$inject=["$timeout"],n.directive("ngeoSortable",n.component_),t.a=n}).call(this,r(27))},function(e,t,r){"use strict";(function(e){r(387),r(386);var a=angular.module("ngeoPopover",[]);a.component_=function(){return{restrict:"A",scope:!0,controller:"NgeoPopoverController as popoverCtrl",link:function(t,r,a,n){n.anchorElm.on("hidden.bs.popover",function(){n.anchorElm.data("bs.popover").inState.click=!1}),n.anchorElm.on("inserted.bs.popover",function(){n.bodyElm.show(),n.shown=!0}),n.anchorElm.popover({container:"body",html:!0,content:n.bodyElm,placement:a.ngeoPopoverPlacement||"right"}),a.ngeoPopoverDismiss&&e(a.ngeoPopoverDismiss).on("scroll",function(){n.dismissPopover()}),t.$on("$destroy",function(){n.anchorElm.popover("destroy"),n.anchorElm.unbind("inserted.bs.popover"),n.anchorElm.unbind("hidden.bs.popover")})}}},a.anchorComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function(e,t,r,a){a.anchorElm=t}}},a.contentComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function(e,t,r,a){a.bodyElm=t,t.hide()}}},a.PopoverController_=function(e){function t(e){this.anchorElm[0]!==e.target&&this.bodyElm.parent()[0]!==e.target&0===this.bodyElm.parent().find(e.target).length&&this.shown&&this.dismissPopover()}this.shown=!1,this.anchorElm=void 0,this.bodyElm=void 0,angular.element("body").on("mousedown",t.bind(this)),e.$on("$destroy",function(){angular.element("body").off("mousedown",t)})},a.PopoverController_.$inject=["$scope"],a.PopoverController_.prototype.dismissPopover=function(){this.shown=!1,this.anchorElm.popover("hide")},a.controller("NgeoPopoverController",a.PopoverController_),a.directive("ngeoPopover",a.component_),a.directive("ngeoPopoverAnchor",a.anchorComponent),a.directive("ngeoPopoverContent",a.contentComponent),t.a=a}).call(this,r(27))},function(e,t,r){"use strict";(function(e){var a=r(41),n=r(106),o=r(255),i=r(33),s=r(1),l=r(84),u=r(254),c=r(253),h=r(332),p=r(317),g=r(37),d=r(96),f=r(45),m=r(10),y=r(167),v=r(12),_=r(115),S=r(53),b=r(188),C=r(58),w=r(18),T=r(148);var E=angular.module("gmfSearch",[n.a.module.name,o.a.module.name,i.a.module.name,u.a.module.name,c.a.name,p.a.name,l.a.module.name,h.a.name]);function A(e,t,r){return r(e,t)}E.gmfSearchTemplateUrl_=function(e,t){var r=t.gmfSearchTemplateurl;return void 0!==r?r:"gmf/search"},E.run(["$templateCache",function(e){e.put("gmf/search",r(381))}]),A.$inject=["$element","$attrs","gmfSearchTemplateUrl"],E.component_={bindings:{inputValue:"=?gmfSearchInputValue",placeholder:"@?gmfSearchPlaceholder",map:"<gmfSearchMap",datasources:"<gmfSearchDatasources",typeaheadOptions:"<?gmfSearchOptions",featuresStyles:"<?gmfSearchStyles",clearButton:"=?gmfSearchClearbutton",colorChooser:"<?gmfSearchColorchooser",coordinatesProjections:"<?gmfSearchCoordinatesprojections",additionalListeners:"<gmfSearchListeners",maxZoom:"<?gmfSearchMaxzoom",delay:"<?gmfSearchDelay",onInitCallback:"<?gmfSearchOnInit"},controller:"gmfSearchController",templateUrl:A},E.value("gmfSearchTemplateUrl",E.gmfSearchTemplateUrl_),E.component("gmfSearch",E.component_),E.SearchController_=function(){function t(e,r,a,n,o,i,s,l,u,c,h,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.element_=e,this.scope_=r,this.compile_=a,this.timeout_=n,this.gettextCatalog_=i,this.gmfThemes_=c,this.gmfTreeManager_=h,this.fullTextSearch_=p,this.ngeoSearchCreateGeoJSONBloodhound_=l,this.ngeoFeatureOverlayMgr=u,this.ngeoLocation_,o.has("ngeoLocation")&&(this.ngeoLocation_=o.get("ngeoLocation")),this.ngeoAutoProjection_=s,this.map,this.styles_={},this.onInitCallback,this.clearButton,this.colorChooser,this.placeholder,this.delay,this.maxZoom=16,this.coordinatesProjections,this.featureOverlay_=u.getFeatureOverlay(),this.datasources=[],this.typeaheadOptions,this.options={highlight:!0},this.featuresStyles,this.datasets=[],this.inputValue="",this.color,this.displayColorPicker=!1,this.listeners,this.additionalListeners}return t.$inject=["$element","$scope","$compile","$timeout","$injector","gettextCatalog","ngeoAutoProjection","ngeoSearchCreateGeoJSONBloodhound","ngeoFeatureOverlayMgr","gmfThemes","gmfTreeManager","gmfSearchFulltextSearch"],t.prototype.$onInit=function(){var e=this,t=this.gettextCatalog_;this.clearButton=!1!==this.clearButton,this.colorChooser=!0===this.colorChooser,void 0===this.delay&&(this.delay=50),this.placeholder=void 0!==this.placeholder?this.placeholder:t.getString("Search…");var r=this.coordinatesProjections;if(r=void 0===r?[this.map.getView().getProjection()]:this.ngeoAutoProjection_.getProjectionList(r),this.coordinatesProjections=r,this.clearButton||this.element_.find("input").on("focus blur",function(){e.clear()}),this.onInitCallback&&this.onInitCallback(),this.initStyles_(),this.featureOverlay_.setStyle(this.getSearchStyle_.bind(this)),this.typeaheadOptions&&m.a(this.options,this.typeaheadOptions),this.initDatasets_(),this.scope_.$watch(function(){return e.color},this.setStyleColor.bind(this)),this.listeners=this.mergeListeners_(this.additionalListeners,{select:this.select_.bind(this),close:this.close_.bind(this),datasetsempty:this.datasetsempty_.bind(this)}),this.ngeoLocation_){var a=this.ngeoLocation_.getParam("search");if(a){var n=1;this.ngeoLocation_.getParam("search-select-index")&&(n=parseInt(this.ngeoLocation_.getParam("search-select-index"),10));var o=void 0;this.ngeoLocation_.getParam("search-maxzoom")?o=parseInt(this.ngeoLocation_.getParam("search-maxzoom"),10):this.ngeoLocation_.getParam("map_zoom")&&(o=parseInt(this.ngeoLocation_.getParam("map_zoom"),10)),this.fulltextsearch_(a,n,o)}}},t.prototype.mergeListeners_=function(e,t){return void 0===e?t:{open:e.open,close:void 0===e.close?t.close:function(){t.close(),e.close()},cursorchange:e.cursorchange,datasetsempty:e.datasetsempty,select:void 0===e.select?t.select:function(r,a,n){t.select(r,a,n),e.select(r,a,n)},autocomplete:e.autocomplete}},t.prototype.initDatasets_=function(){for(var e=this,t=this.gettextCatalog_,r=function(r){var a=e.datasources[r],n=void 0!==a.groupValues?a.groupValues:[],o=a.groupActions?a.groupActions:[],i=[];0===n.length?i.push({title:"",filter:e.filterLayername_()}):n.forEach(function(e){i.push({title:e,filter:this.filterLayername_(e)})},e),o.forEach(function(e){i.push({title:t.getString(e.title),filter:this.filterAction_(e.action)})},e),i.forEach(function(e){this.datasets.push(this.createDataset_({bloodhoundOptions:a.bloodhoundOptions,datasetTitle:e.title,groupsKey:"layer_name",labelKey:a.labelKey,projection:a.projection,typeaheadDatasetOptions:a.typeaheadDatasetOptions,url:a.url},e.filter))},e)},a=0;a<this.datasources.length;a++)r(a);this.datasets.push({source:this.createSearchCoordinates_(this.map.getView()),name:"coordinates",display:"label",templates:{header:function(){var e=t.getString("Recenter to");return'<div class="gmf-search-header" translate>'+e+"</div>"},suggestion:function(e){var t='<p class="gmf-search-label">'+e.label+"</p>";return t='<div class="gmf-search-datum">'+t+"</div>"}}})},t.prototype.createDataset_=function(e,t){var r=this.gettextCatalog_,a=this.scope_,n=this.compile_,o={limit:1/0,source:this.createAndInitBloodhound_(e,t).ttAdapter(),display:function(t){return t.get(e.labelKey)},templates:{header:function(){if(void 0===e.datasetTitle)return"";var t=r.getString(e.datasetTitle);return'<div class="gmf-search-header">'+t+"</div>"},suggestion:function(t){var r=t,o=a.$new(!0);o.feature=r;var i='<p class="gmf-search-label" translate>'+r.get(e.labelKey)+"</p>";return i+='<p class="gmf-search-group" translate>'+(r.get("layer_name")||e.datasetTitle)+"</p>",n(i='<div class="gmf-search-datum">'+i+"</div>")(o)}}};return e.typeaheadDatasetOptions&&m.a(o,e.typeaheadDatasetOptions),o},t.prototype.filterAction_=function(e){return function(t){var r=t.properties;return!!r.actions&&(!r.layer_name&&r.actions.some(function(t){return t.action===e}))}},t.prototype.filterLayername_=function(e){return function(t){var r=t.properties.layer_name;return void 0!==r&&(void 0===e||r===e)}},t.prototype.createAndInitBloodhound_=function(e,t){var r=this.map.getView().getProjection().getCode(),a=this.getBloodhoudRemoteOptions_(),n=this.ngeoSearchCreateGeoJSONBloodhound_(e.url,t,v.f(r),v.f(e.projection),e.bloodhoundOptions,a);return n.initialize(),n},t.prototype.getBloodhoudRemoteOptions_=function(){var e=this.gettextCatalog_;return{rateLimitWait:this.delay,prepare:function(t,r){var a=r.url,n=e.currentLanguage;return r.xhrFields={withCredentials:!0},r.url=T.a(a,{query:t,lang:n}),r}}},t.prototype.createSearchCoordinates_=function(e){var t=e.getProjection(),r=t.getExtent();return function(e,a){var n=[],o=this.ngeoAutoProjection_.stringToCoordinates(e);if(null!==o){var i=this.ngeoAutoProjection_.tryProjectionsWithInversion(o,r,t,this.coordinatesProjections);null!==i&&(n.push({label:o.join(" "),position:i,tt_source:"coordinates"}),a(n))}}.bind(this)},t.prototype.initStyles_=function(){this.styles_[a.a.COORDINATES_LAYER_NAME]=new w.c({image:new b.a({stroke:new C.a({color:[0,0,0,.7],width:2}),points:4,radius:8,radius2:0,angle:0})});var e=new S.a({color:[65,134,240,.5]}),t=new C.a({color:[65,134,240,1],width:2});this.styles_.default=new w.c({fill:e,image:new _.a({fill:e,radius:5,stroke:t}),stroke:t});var r=this.featuresStyles||{};m.a(this.styles_,r)},t.prototype.getSearchStyle_=function(e,t){s.a.assert(e);var r=this.styles_[e.get("layer_name")]||this.styles_.default;if(this.color){var a=d.a(this.color),n=a.slice();n[3]=1;var o=a.slice();o[3]=.5;var i=r.getStroke();i&&i.setColor(n);var l=r.getFill();l&&l.setColor(o);var u=r.getImage();if(u){var c=(u=u.clone()).getStroke();c&&c.setColor(n);var h=u.getFill();h&&h.setColor(o),r.setImage(u)}}return r},t.prototype.setStyleColor=function(e){e&&(this.color=e,this.ngeoFeatureOverlayMgr.getLayer().changed())},t.prototype.setTTDropdownVisibility_=function(){if(this.clearButton){var e=this.element_.find(".twitter-typeahead .tt-menu");this.inputValue?e.show():e.hide()}},t.prototype.onClearButton=function(){this.featureOverlay_.clear(),this.clear()},t.prototype.clear=function(){var t=this.element_.find(".twitter-typeahead"),r=t.children(".tt-menu"),a=t.children("input");this.inputValue="",e(a[1]).typeahead("val",""),r.children(".tt-dataset").empty(),this.setTTDropdownVisibility_(),this.displayColorPicker=!1},t.prototype.blur=function(){var t=this.element_.find(".twitter-typeahead").children("input");this.timeout_(function(){e(t[1]).blur()})},t.prototype.select_=function(e,t,r){if("coordinates"===t.tt_source){var n=new f.a(t.position);this.featureOverlay_.clear(),this.featureOverlay_.addFeature(new g.a({geometry:n,layer_name:a.a.COORDINATES_LAYER_NAME})),this.map.getView().setCenter(t.position),this.leaveSearch_()}else s.a.assertInstanceof(t,g.a),this.selectFromGMF_(e,t,r)},t.prototype.selectFromGMF_=function(e,t,r){var a=this,n=t.get("actions"),o=t.getGeometry();if(n)for(var s=function(e,t){var r=n[e],s=r.action,l=r.data;if("add_theme"==s)a.gmfThemes_.getThemesObject().then(function(e){var t=i.a.findThemeByName(e,l);t&&a.gmfTreeManager_.addFirstLevelGroups(t.children)});else if("add_group"==s)a.gmfTreeManager_.addGroupByName(l,!0);else if("add_layer"==s){var u=void 0;if(a.datasources[0].groupActions.forEach(function(e){if("add_layer"===e.action)return u=!0}),u){var c=!!o;a.gmfTreeManager_.addGroupByLayerName(l,!0,c)}}},l=0,u=n.length;l<u;l++)s(l);var c=this.map.getSize();if(o&&c){var h=this.map.getView();this.featureOverlay_.clear(),this.featureOverlay_.addFeature(t),this.displayColorPicker=!0;var p="GeometryCollection"===o.getType()?o.getExtent():o;h.fit(p,{size:c,maxZoom:this.maxZoom})}this.leaveSearch_()},t.prototype.leaveSearch_=function(){this.clearButton||this.clear(),this.blur()},t.prototype.close_=function(e){this.clearButton||this.setTTDropdownVisibility_()},t.prototype.datasetsempty_=function(t,r,a){var n=this.element_.find(".twitter-typeahead .tt-menu"),o=n.children(".gmf-search-no-results");if(0==o.length){var i=e('<div class="gmf-search-no-results" translate>No result found</div>');n.append(i)}a?(o.show(),n.addClass("gmf-search-no-results")):(n.removeClass("gmf-search-no-results"),o.hide())},t.prototype.fulltextsearch_=function(e,t,r){var a=this;t<1&&(t=1),this.fullTextSearch_.search(e,{limit:t}).then(function(e){if(e&&e.features[t-1]){var n=(new y.a).readFeature(e.features[t-1]);a.featureOverlay_.addFeature(n);var o={};void 0!==r&&(o.maxZoom=r,o.size=a.map.getSize()),a.map.getView().fit(n.getGeometry().getExtent(),o),a.inputValue=n.get("label")}})},t}(),E.controller("gmfSearchController",E.SearchController_),t.a=E}).call(this,r(27))},function(e,t,r){"use strict";(function(e){var r=angular.module("ngeoRecenter",[]);r.directive_=function(){return{restrict:"A",link:function(t,r,a){var n=a.ngeoRecenterMap,o=t.$eval(n);function i(e){var r=e.attr("ngeo-extent");if(void 0!==r){var a=o.getSize();o.getView().fit(t.$eval(r),{size:a})}var n=e.attr("ngeo-zoom");void 0!==n&&o.getView().setZoom(t.$eval(n))}r.on("click","*",function(t){i(angular.element(e(this)))}),r.on("change",function(e){var t=e.target.options[e.target.selectedIndex];i(angular.element(t))})}}},r.directive("ngeoRecenter",r.directive_),t.a=r}).call(this,r(27))},,,function(e,t,r){"use strict";var a=r(1);t.a=function(e,t,r,n,o){var i=n.$watchCollection(function(){return e},function(){var a=void 0,n=void 0,i=void 0;if(r)for(a=e.length-1,i=0;a>=0;--a)o(e[a])&&(t[i++]=e[a]);else for(a=0,n=e.length,i=0;a<n;++a)o(e[a])&&(t[i++]=e[a]);t.length=i}),s=n.$watchCollection(function(){return t},function(){var n=void 0,i=void 0,s=void 0;if(r){for(n=0,i=e.length,s=t.length-1;n<i;++n)o(e[n])&&(e[n]=t[s--]);a.a.assert(-1==s)}else{for(n=0,i=e.length,s=0;n<i;++n)o(e[n])&&(e[n]=t[s++]);a.a.assert(s==t.length)}});return function(){i(),s()}}},function(e,t,r){"use strict";var a=r(87),n=(r(242),angular.module("ngeoLayertree",[a.a.module.name]));n.value("ngeoLayertreeTemplateUrl",function(e,t){var r=t.ngeoLayertreeTemplateurl;return void 0!==r?r:"ngeo/layertree"}),n.run(["$templateCache",function(e){e.put("ngeo/layertree",r(416))}]),n.directive_=function(e){return{restrict:"A",scope:!0,templateUrl:e,controller:a.a}},n.directive_.$inject=["ngeoLayertreeTemplateUrl"],n.directive("ngeoLayertree",n.directive_),t.a=n},function(e,t,r){"use strict";var a={Permalink3dParam:{ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"}};t.a=a},function(e,t,r){"use strict";(function(e){var a=r(3),n=r(126),o=function(t){var r=void 0!==t?t:{},a=void 0;r.element?(a=r.element,delete r.element):a=e("<div />")[0],this.closeEl_=e("<button>",{class:"close",html:"&times;"}),this.contentEl_=e("<div/>").append(this.closeEl_).append(a),r.element=e("<div />")[0],n.a.call(this,r)};a.d(o,n.a),o.prototype.setMap=function(t){var r=this,a=this.getElement();if(this.getMap()&&e(a).popover("destroy"),n.a.prototype.setMap.call(this,t),t){var o=this.contentEl_;window.setTimeout(function(){e(a).popover({content:o,html:!0,placement:"top",template:['<div class="popover ngeo-popover" role="tooltip">','  <div class="arrow"></div>','  <h3 class="popover-title"></h3>','  <div class="popover-content"></div>',"</div>"].join("")}).popover("show")},0),this.closeEl_.one("click",function(){var e=r.getMap();e&&e.removeOverlay(r)})}},t.a=o}).call(this,r(27))},function(e,t,r){"use strict";(function(e){var a=r(41),n=r(205),o=r(135),i=r(261),s=r(259),l=r(138),u=r(106),c=r(33),h=r(1),p=r(38),g=r(338),d=r(87),f=r(85),m=r(337),y=r(107),v=r(122),_=r(98),S=r(10),b=r(154),C=r(215),w=r(168),T=(r(242),angular.module("gmfLayertreeComponent",[n.a.module.name,o.a.module.name,i.a.module.name,s.a.name,l.a.module.name,u.a.module.name,c.a.module.name,g.a.name,d.a.module.name,f.a.module.name,y.a.module.name]));function E(e,t,r){return r(e,t)}T.value("ngeoLayertreeTemplateUrl",function(e,t){return"gmf/layertree"}),T.run(["$templateCache",function(e){e.put("gmf/layertree",r(415))}]),T.value("gmfLayertreeTemplate",function(e,t){return'<div ngeo-layertree="gmfLayertreeCtrl.root" ngeo-layertree-map="gmfLayertreeCtrl.map" ngeo-layertree-nodelayer="gmfLayertreeCtrl.getLayer(treeCtrl)" ngeo-layertree-listeners="gmfLayertreeCtrl.listeners(treeScope, treeCtrl)" ngeo-layertree-templateurl="gmf/layertree"></div>'}),E.$inject=["$element","$attrs","gmfLayertreeTemplate"],T.component_={controller:"GmfLayertreeController as gmfLayertreeCtrl",bindings:{map:"=gmfLayertreeMap",dimensions:"=?gmfLayertreeDimensions",openLinksInNewWindow:"<?gmfLayertreeOpenlinksinnewwindow"},template:E},T.component("gmfLayertree",T.component_),T.Controller_=function(e,t,r,a,n,o,i,s,l,u){var c=this;this.map,this.dimensions,this.scope_=t,this.layerHelper_=r,this.gmfDataSourceBeingFiltered=a,this.gmfExternalDataSourcesManager=n,this.gmfPermalink_=o,this.gmfTreeManager_=i;var p=i.root;h.a.assert(p),this.root=p,this.gmfSyncLayertreeMap_=s,this.ngeoWMSTime_=l,this.groupNodeStates_={},this.openLinksInNewWindow,this.dataLayerGroup_=null,this.layers=[],this.gmfThemes_=u,e.on("shown.bs.collapse",function(){c.scope_.$apply()})},T.Controller_.$inject=["$element","$scope","ngeoLayerHelper","gmfDataSourceBeingFiltered","gmfExternalDataSourcesManager","gmfPermalink","gmfTreeManager","gmfSyncLayertreeMap","ngeoWMSTime","gmfThemes"],T.Controller_.prototype.$onInit=function(){var e=this;this.openLinksInNewWindow=!0===this.openLinksInNewWindow,this.dataLayerGroup_=this.layerHelper_.getGroupFromMap(this.map,a.a.DATALAYERGROUP_NAME),Object(m.a)(this.dataLayerGroup_.getLayers().getArray(),this.layers,!0,this.scope_,function(){return!0}),this.scope_.$watchCollection(function(){return e.layers},function(){e.map.render()}),this.scope_.$watchCollection(function(){if(e.gmfTreeManager_.rootCtrl)return e.dimensions},function(t){t&&e.updateDimensions_(e.gmfTreeManager_.rootCtrl)})},T.Controller_.prototype.updateDimensions_=function(e){var t=this;e.traverseDepthFirst(function(e){if(e.node.dimensions){var r=e.layer;h.a.assertInstanceof(r,_.a),t.updateLayerDimensions_(r,e.node)}})},T.Controller_.prototype.updateLayerDimensions_=function(e,t){var r=this;if(this.dimensions&&t.dimensions){var a={};for(var n in t.dimensions)if(null===t.dimensions[n]){var o=this.dimensions[n];void 0!==o&&(a[n]=o)}else a[n]=t.dimensions[n];if(!S.d(a)){var i=e.getSource();i instanceof w.a?i.updateDimensions(a):i instanceof C.a||i instanceof b.a?i.updateParams(a):e.once("change:source",function(){h.a.assertInstanceof(e,_.a),r.updateLayerDimensions_(e,t)})}}},T.Controller_.prototype.getLayer=function(e){var t=void 0;e.parent.isRoot&&(this.gmfTreeManager_.rootCtrl=e.parent,t=this.gmfTreeManager_.root.children.length-this.gmfTreeManager_.numberOfGroupsToAddInThisDigestLoop||0);var r=this.gmfSyncLayertreeMap_.createLayer(e,this.map,this.dataLayerGroup_,t);if(r instanceof _.a){var a=e.node;this.updateLayerDimensions_(r,a)}return r},T.Controller_.prototype.listeners=function(e,t){var r=this.dataLayerGroup_;e.$on("$destroy",function(){r.getLayers().remove(t.layer)})},T.Controller_.prototype.toggleActive=function(e){e.setState("on"===e.getState()?"off":"on")},T.Controller_.prototype.getNodeState=function(e){return e.getState()},T.Controller_.prototype.updateWMSTimeLayerState=function(e,t){if(t){var r=e.getDataSource();if(r)h.a.assertInstanceof(r,p.a),r.timeRangeValue=t;else if(e.children)for(var a=0,n=e.children.length;a<n;a++)this.updateWMSTimeLayerState(e.children[a],t)}},T.Controller_.prototype.getLegendIconURL=function(e){var t=e.node.metadata.iconUrl;if(void 0!==t)return t;if(void 0===e.node.children){var r=e.node;if("WMS"===r.type){var a=r,n=a.metadata.legendRule;if(void 0!==n){var o=a.layers.split(",")[0],i=this.gmfTreeManager_.getOgcServer(e);return this.layerHelper_.getWMSLegendURL(i.url,o,void 0,n,20,20)}}}},T.Controller_.prototype.getLegendsObject=function(e){var t=this,r={};if(void 0!==e.node.children)return null;var a=e.node,n=a.name;if(a.metadata.legendImage)return r[n]=a.metadata.legendImage,r;var o=e.layer;if("WMTS"===a.type){h.a.assertInstanceof(o,v.a);var i=this.layerHelper_.getWMTSLegendURL(o);return r[n]=i,i?r:null}var s=a.layers,l=this.gmfTreeManager_.getOgcServer(e),u=this.getScale_();return(s=l.type===p.a.ServerType.QGISSERVER?[s]:s.split(",")).forEach(function(e){r[e]=t.layerHelper_.getWMSLegendURL(l.url,e,u)}),r},T.Controller_.prototype.getNumberOfLegendsObject=function(e){var t=this.getLegendsObject(e);return t?Object.keys(t).length:0},T.Controller_.prototype.getScale_=function(){var e=this.map.getView();return e.getResolution()*e.getProjection().getMetersPerUnit()*39.37*(25.4/.28)},T.Controller_.prototype.displayMetadata=function(e){var t=e.node,r=t.metadata.metadataUrl;if(void 0!==r){var a=window.gmfx;a.openIframePopup&&a.openIframePopup(r,t.name,void 0,void 0,!1)}},T.Controller_.prototype.afterReorder=function(){var e=this,t=this.gmfTreeManager_.rootCtrl.node.children,r=this.gmfTreeManager_.rootCtrl.children,a=[];t.forEach(function(e){r.some(function(t){t.node!==e||a.push(t)})}),this.gmfTreeManager_.rootCtrl.children=a,this.layers.length=0,this.gmfTreeManager_.rootCtrl.children.forEach(function(t){e.layers.push(t.layer)}),this.gmfPermalink_.refreshFirstLevelGroups()},T.Controller_.prototype.removeNode=function(e){this.gmfTreeManager_.removeGroup(e)},T.Controller_.prototype.removeAllNodes=function(){this.gmfTreeManager_.removeAll()},T.Controller_.prototype.nodesCount=function(){return this.gmfTreeManager_.root.children.length},T.Controller_.prototype.getResolutionStyle=function(e){var t=this.map.getView().getResolution(),r=c.a.getNodeMinResolution(e);if(void 0!==r&&t<r)return"out-of-resolution";var a=c.a.getNodeMaxResolution(e);return void 0!==a&&t>a?"out-of-resolution":void 0},T.Controller_.prototype.zoomToResolution=function(e){var t=e.node,r=this.map.getView(),a=r.getResolution(),n=c.a.getNodeMinResolution(t);if(void 0!==n&&a<n)r.setResolution(r.constrainResolution(n,0,1));else{var o=c.a.getNodeMaxResolution(t);void 0!==o&&a>o&&r.setResolution(r.constrainResolution(o,0,-1))}},T.Controller_.prototype.toggleNodeLegend=function(t){e(t).toggle({toggle:!0})},T.Controller_.prototype.toggleFiltrableDataSource=function(e){this.gmfDataSourceBeingFiltered.dataSource=e},T.Controller_.prototype.isNodeLegendVisible=function(t){return e(t).is(":visible")},T.Controller_.prototype.supportsCustomization=function(e){return!e.isRoot&&(this.supportsLegend(e)||this.supportsOpacityChange(e))},T.Controller_.prototype.supportsLegend=function(e){var t=e.node;return!!t.metadata&&!!t.metadata.legend&&!!this.getLegendsObject(e)},T.Controller_.prototype.supportsOpacityChange=function(e){var t=e.node,r=e.parent.node;return!!e.layer&&(1===e.depth&&!t.mixed||e.depth>1&&r.mixed)},T.controller("GmfLayertreeController",T.Controller_),t.a=T}).call(this,r(27))},,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";r.r(t);var a=r(271),n=(r(457),r(62)),o={};o.module=angular.module("app",[]),o.module.config(["$compileProvider",function(e){"debug"in n.a.decodeQueryString(window.location.search)||e.debugInfoEnabled(!1)}]);var i=o,s=r(12),l=r(346),u=r(252),c=r(165),h=["+proj="+u.a,"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=2600000","+y_0=1200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");c.a.defs("EPSG:2056",h),l.a(c.a),s.f("EPSG:2056").setExtent([242e4,103e4,29e5,135e4]);var p=r(225),g=r(3),d=r(321),f=r.n(d),m=r(320),y=r.n(m);window.requestAnimationFrame||(alert("Your browser is not supported, please update it or use another one. You will be redirected.\n\nVotre navigateur n'est pas supporté, veuillez le mettre à jour ou en utiliser un autre. Vous allez être redirigé.\n\nIhr Browser wird nicht unterstützt, bitte aktualisieren Sie ihn oder verwenden Sie einen anderen. Sie werden weitergeleitet."),window.location="http://geomapfish.org/");var v=function(e,t){a.a.call(this,{srid:21781,mapViewConfig:{center:[632464,185457],zoom:3,resolutions:[250,100,50,20,10,5,2,1,.5,.25,.1,.05]}},e,t),this.searchCoordinatesProjections=[p.a,"EPSG:2056","EPSG:4326"],this.scaleSelectorValues=[25e4,1e5,5e4,2e4,1e4,5e3,2e3,1e3,500,250,100,50],this.elevationLayers=["aster","srtm"],this.selectedElevationLayer=this.elevationLayers[0],this.profileLinesconfiguration={aster:{color:"#0000A0"},srtm:{color:"#00A000"}},this.mousePositionProjections=[{code:"EPSG:2056",label:"CH1903+ / LV95",filter:"ngeoNumberCoordinates::{x}, {y} m"},{code:p.a,label:"CH1903 / LV03",filter:"ngeoNumberCoordinates::{x}, {y} m"},{code:"EPSG:4326",label:"WGS84",filter:"ngeoDMSCoordinates:2"}];var r=t.get("gettextCatalog");if(r.getString("Add a theme"),r.getString("Add a sub theme"),r.getString("Add a layer"),t.has("sentryUrl")){var n=t.has("sentryOptions")?t.get("sentryOptions"):void 0;(new f.a).config(t.get("sentryUrl"),n).addPlugin(y.a).install()}};v.$inject=["$scope","$injector"],v.$inject=["$scope","$injector"],g.d(v,a.a),(v.module=angular.module("Appdesktop",[i.module.name,a.a.module.name])).value("gmfContextualdatacontentTemplateUrl","gmf/contextualdata"),v.module.run(["$templateCache",function(e){e.put("gmf/contextualdata",r(361))}]),v.module.controller("DesktopController",v);t.default=v},,function(e,t){e.exports="<table> <tr> <td translate> Swiss grid (LV03) </td> <td> {{coord_21781|ngeoNumberCoordinates:0:'{x} / {y}'}} </td> </tr> <tr> <td translate> Wgs Coord. </td> <td> {{coord_4326|ngeoNumberCoordinates:2:'{y} / {x}'}} </td> </tr> <tr> <td translate> Wgs Coord. DMS </td> <td> {{coord_4326|ngeoDMSCoordinates:0:'{y} {x}'}} </td> </tr> <tr> <td translate> Elevation (SRTM) </td> <td> {{srtm | number}} [m] </td> </tr> <tr> <td translate> Elevation (Aster) </td> <td> {{aster | number}} [m] </td> </tr> </table> <a ng-href=\"https://maps.google.ch/?ie=UTF8&ll={{coord_4326_northern}},{{coord_4326_eastern}}&layer=c&cbll={{coord_4326_northern}},{{coord_4326_eastern}}&cbp=12,57.78,,0,8.1\" target=_blank>Google StreetView</a> "},,,,,function(e,t){e.exports='<div class=form-group> <select class=form-control ng-model=$ctrl.mode ng-options="mode | translate for mode in $ctrl.modes" ng-click="$ctrl.hasError = false"> </select> </div> <div> <form name=idsl_form novalidate ng-show="$ctrl.mode === \'Local\'"> <div class=form-group> <div class=input-group> <input name=file type=file required/> <input class=form-control placeholder="{{\'No file\' | translate}}" readonly=readonly type=text value={{$ctrl.fileNameAndSize}} ng-click=$ctrl.browse() /> <span class=input-group-btn> <button class="btn btn-default" type=button ng-click=$ctrl.browse() translate>Browse</button> </span> </div> </div> <div class=form-group> <button class="btn btn-sm btn-default form-control" ng-class="{\'has-error\': $ctrl.hasError}" title="{{\'Load a file from local\' | translate}}" type=submit ng-click="idsl_form.$valid && $ctrl.load()" ng-disabled="$ctrl.file === undefined || $ctrl.hasError"> <span ng-if=!$ctrl.hasError>{{\'Load local file\' | translate}}</span> <span ng-if=$ctrl.hasError>{{\'Unable to load the file\' | translate}}</span> </button> </div> </form> <form name=idsc_form novalidate ng-show="$ctrl.mode === \'Online\'"> <div class="form-group gmf-importdatasource-url-form-group"> <input autocomplete=off class=form-control name=url placeholder="{{\'Choose or enter online resource URL\' | translate}}" required type=url ng-disabled=$ctrl.pending ng-model=$ctrl.url /> </div> <div class=form-group> <button class="btn btn-sm btn-default form-control gmf-importdatasource-connect-btn" ng-class="{\'has-error\': $ctrl.hasError}" title="{{\'Connect to online resource\' | translate}}" type=submit ng-click="idsc_form.$valid && $ctrl.connect()" ng-disabled="idsc_form.$invalid || $ctrl.pending"> <span ng-if=$ctrl.pending>{{\'Connecting, please wait...\' | translate}}</span> <span ng-if="!$ctrl.pending && $ctrl.hasError">{{\'Failed to connect\' | translate}}</span> <span ng-if="!$ctrl.pending && !$ctrl.hasError">{{\'Connect\' | translate}}</span> </button> </div> </form> </div> <div class=gmf-importdatasource-layers ng-if="$ctrl.wmsCapabilities !== null || $ctrl.wmtsCapabilities !== null"> <hr/> <gmf-wmscapabilitylayertreenode capabilities=::$ctrl.wmsCapabilities layer=::$ctrl.wmsCapabilities.Capability.Layer url=::$ctrl.url ng-if="$ctrl.wmsCapabilities !== null"> </gmf-wmscapabilitylayertreenode> <gmf-wmtscapabilitylayertree capabilities=::$ctrl.wmtsCapabilities layers=::$ctrl.wmtsCapabilities.Contents.Layer url=::$ctrl.url ng-if="$ctrl.wmtsCapabilities !== null"> </gmf-wmtscapabilitylayertree> </div> '},function(e,t){e.exports='<ul> <li ng-repeat="layer in ::$ctrl.layers"> <div class=gmf-wmscapabilitylayertreenode-header> <span class=gmf-wmscapabilitylayertreenode-popover-container ngeo-popover ngeo-popover-dismiss=.content ngeo-popover-placement=left> <span ngeo-popover-anchor class="fa fa-cog gmf-wmscapabilitylayertreenode-actions"> </span> <div class=gmf-wmscapabilitylayertreenode-popover-content ngeo-popover-content> <ul> <li> <i class="fa fa-plus fa-fw"></i> <a href="" ng-click="$ctrl.createAndAddDataSource(layer); popoverCtrl.dismissPopover()"> <span translate>Add layer</span> </a> </li> <li ng-if="::(layer.Abstract !== undefined)"> <i class="fa fa-th-list fa-fw"></i> <a aria-expanded=false data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-click=popoverCtrl.dismissPopover()> <span translate>Open/Close description</span> </a> </li> </ul> </div> </span> <a class="fa fa-circle-thin gmf-wmscapabilitylayertreenode-no-icon fa-fw"></a> <span class=gmf-wmscapabilitylayertreenode-title>{{ ::layer.Title }}</span> <div class="collapse gmf-wmscapabilitylayertreenode-description" id=gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-if="::(layer.Abstract !== undefined)"> <a aria-expanded=false class=gmf-wmscapabilitylayertreenode-description-toggle data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}}> <span translate>Hide description</span> </a> <span class=gmf-wmscapabilitylayertreenode-description-content>{{ ::layer.Abstract }}</span> </div> </div> </li> </ul> '},function(e,t){e.exports='<ul> <li ng-repeat="layer in ::$ctrl.layer.Layer"> <div class=gmf-wmscapabilitylayertreenode-header> <span class=gmf-wmscapabilitylayertreenode-popover-container ng-if="::(layer.Name !== undefined || layer.Abstract !== undefined)" ngeo-popover ngeo-popover-dismiss=.content ngeo-popover-placement=left> <span ngeo-popover-anchor class="fa fa-cog gmf-wmscapabilitylayertreenode-actions"> </span> <div class=gmf-wmscapabilitylayertreenode-popover-content ngeo-popover-content> <ul> <li ng-if="::(layer.Name !== undefined)"> <i class="fa fa-plus fa-fw"></i> <a href="" ng-click="$ctrl.createAndAddDataSource(layer); popoverCtrl.dismissPopover()"> <span translate>Add layer</span> </a> </li> <li ng-if="::(layer.Abstract !== undefined)"> <i class="fa fa-th-list fa-fw"></i> <a aria-expanded=false data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-click=popoverCtrl.dismissPopover()> <span translate>Open/Close description</span> </a> </li> </ul> </div> </span> <a aria-expanded=false class="fa gmf-wmscapabilitylayertreenode-expand-node fa-fw" data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-children-{{::$ctrl.getUid(layer)}} ng-if="::(layer.Layer !== undefined && layer.Layer.length)"></a> <span ng-if="::(layer.Layer !== undefined && layer.Layer.length)" class="fa fa-fw gmf-wmscapabilitylayertreenode-group"> </span> <a class="fa fa-circle-thin gmf-wmscapabilitylayertreenode-no-icon fa-fw" ng-if="::(layer.Layer === undefined || layer.Layer.length === 0)"></a> <span class=gmf-wmscapabilitylayertreenode-title>{{ ::layer.Title }}</span> <div class="collapse gmf-wmscapabilitylayertreenode-description" id=gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}} ng-if="::(layer.Abstract !== undefined)"> <a aria-expanded=false class=gmf-wmscapabilitylayertreenode-description-toggle data-toggle=collapse href=#gmf-wmscapabilitylayertreenode-description-{{::$ctrl.getUid(layer)}}> <span translate>Hide description</span> </a> <span class=gmf-wmscapabilitylayertreenode-description-content>{{ ::layer.Abstract }}</span> </div> </div> <gmf-wmscapabilitylayertreenode class=collapse id=gmf-wmscapabilitylayertreenode-children-{{::$ctrl.getUid(layer)}} capabilities=::$ctrl.capabilities layer=::layer ng-if="::(layer.Layer !== undefined)"> </gmf-wmscapabilitylayertreenode> </li> </ul> '},function(e,t){e.exports='<div class="text-center btn-group dropup" gmf-elevation gmf-elevation-active=ctrl.active gmf-elevation-elevation=ctrl.elevationValue gmf-elevation-loading=ctrl.elevationLoading gmf-elevation-layer=ctrl.selectedElevationLayer gmf-elevation-map=::ctrl.map> <a type=button class="btn btn-default" aria-expanded=false ng-class="::{\'dropdown-toggle\': ctrl.layers.length > 1}" ng-attr-data-toggle="{{::(ctrl.layers.length > 1) ? \'dropdown\' : \'\'}}"> <span class=gmf-elevationwidget-value> {{ctrl.elevationValue | number}}<span ng-show=ctrl.elevationValue> m</span> <span ng-show=ctrl.elevationLoading class="fa fa-spinner"></span> <span ng-show="!ctrl.elevationValue && !ctrl.elevationLoading" translate>Elevation…</span> </span><span class=caret ng-if="::ctrl.layers.length > 1"></span> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu ng-if="::ctrl.layers.length > 1"> <li class=dropdown-header translate>Elevation data sources</li> <li ng-repeat="elevationItem in ::ctrl.layers"> <a href ng-click="ctrl.selectedElevationLayer = elevationItem"> <span class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedElevationLayer === elevationItem}"></span> {{elevationItem | translate}} </a> </li> </ul> </div> '},function(e,t){e.exports='<div class="gmf-profile-container panel" ng-show=ctrl.active> <div class=ngeo-profile ng-show=!ctrl.isErrored ngeo-profile=ctrl.profileData ngeo-profile-highlight=ctrl.profileHighlight ngeo-profile-options=::ctrl.profileOptions> </div> <ul class=gmf-profile-legend ng-show=!ctrl.isErrored> <li ng-repeat="name in ::ctrl.getLayersNames()"> <i class="fa fa-minus" style=color:{};></i> &nbsp;{{name | translate}}&nbsp;{{ctrl.currentPoint.elevations[name]}}&nbsp;{{ctrl.currentPoint.yUnits}} </li> </ul> <div class="gmf-profile-export btn-group dropup" ng-show=!ctrl.isErrored> <a class=dropdown-toggle href="" ng-show="ctrl.profileData.length !== 0" data-toggle=dropdown aria-expanded=false> {{\'Export\' | translate}}&nbsp;<i class="fa fa-caret-up"></i> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li> <a href="" ng-click=::ctrl.downloadCsv()> <i class="fa fa-table"></i>&nbsp;{{\'Download CSV\' | translate}}</a> </li> </ul> </div> <div class=gmf-profile-error ng-show=ctrl.isErrored> <p>{{\'The profile service does not respond, please try later.\' | translate}}</p> </div> <div class=close ng-click="ctrl.line = null">&times;</div> </div> '},function(e,t){e.exports='<div class=gmf-print> <div ng-show="$ctrl.isState(\'CAPABILITIES_NOT_LOADED\') !== true && $ctrl.isState(\'ERROR_ON_GETCAPABILITIES\') !== true"> <div class="gmf-print-layout-selector form-horizontal"><ng-transclude/></div> <div ng-repeat="attribute in $ctrl.layoutInfo.simpleAttributes" class="gmf-print-layoutinfo form-group"> <div ng-if="$ctrl.hiddenAttributeNames === undefined || $ctrl.hiddenAttributeNames.indexOf(attribute.name) < 0"> <input ng-if="attribute.type === \'number\'" ng-model=attribute.value class=form-control type=number ng-attr-placeholder="{{attribute.name | translate}}"> <input ng-if="attribute.type === \'text\'" ng-model=attribute.value class=form-control type=text ng-attr-placeholder="{{attribute.name | translate}}"> <textarea ng-if="attribute.type === \'textarea\'" ng-model=attribute.value class=form-control row=3 ng-attr-placeholder="{{attribute.name | translate}}"></textarea> <div ng-if="attribute.type === \'checkbox\'" class=checkbox> <label> <input ng-model=attribute.value type=checkbox> <span>{{attribute.name | translate}}</span> </label> </div> </div> </div> <div ng-show="$ctrl.layoutInfo.legend !== undefined" class="gmf-print-legend checkbox"> <label> <input ng-model=$ctrl.layoutInfo.legend type=checkbox> <span translate>Legend</span> </label> </div> <div class="gmf-print-layout-selector form-horizontal"> <div ng-show="$ctrl.layoutInfo.layouts.length !== 1" class=form-group> <label class="control-label col-md-5" translate>Layout</label> <div class=col-md-7> <div class="btn-group btn-block"> <button type=button class="btn btn-default form-control" data-toggle=dropdown> <span>{{$ctrl.layoutInfo.layout | translate}}&nbsp;</span> <i class="fa fa-caret-down"></i> </button> <ul class="dropdown-menu dropdown-menu-right btn-block" role=menu> <li ng-repeat="layout in $ctrl.layoutInfo.layouts"> <a ng-click=$ctrl.setLayout(layout) href="">{{layout | translate}}</a> </li> </ul> </div> </div> </div> <div ng-show="$ctrl.layoutInfo.scales.length !== 1" class="gmf-print-scale-selector form-group"> <label class="control-label col-md-5" translate>Scale</label> <div class=col-md-7> <div class="btn-group btn-block"> <button type=button class="btn btn-default form-control" data-toggle=dropdown aria-expanded=false> <span>{{$ctrl.layoutInfo.scale | ngeoScalify}}&nbsp;</span> <i class="fa fa-caret-down"></i> </button> <ul class="dropdown-menu dropdown-menu-right btn-block" role=menu> <li ng-repeat="scale in $ctrl.layoutInfo.scales"> <a ng-click=$ctrl.getSetScale(scale) href="">{{scale | ngeoScalify}}</a> </li> <span ng-if=$ctrl.scaleInput> <li class=dropdown-header translate>Manual entry</li> <li> <div class=gmf-print-custom-scale> 1 : <input class=gmf-print-custom-scale-input type=number min=1 ng-model=$ctrl.getSetScale ng-model-options="{getterSetter: true}"> </div> </li> </span> </ul> </div> </div> </div> <div ng-show="$ctrl.layoutInfo.dpis.length !== 1" class="gmf-print-dpi-selector form-group"> <label class="control-label col-md-3" translate>DPI</label> <div class=col-md-5> <div class="btn-group btn-block"> <button type=button class="btn btn-default form-control" data-toggle=dropdown aria-expanded=false> <span>{{$ctrl.layoutInfo.dpi}}&nbsp;</span> <i class="fa fa-caret-down"></i> </button> <ul class="dropdown-menu dropdown-menu-right btn-block" role=menu> <li ng-repeat="dpi in $ctrl.layoutInfo.dpis"> <a href="" ng-click=$ctrl.setDpi(dpi)>{{dpi}}</a> </li> </ul> </div> </div> </div> <div class="gmf-print-rotation-selector form-group"> <label class="control-label col-md-3" translate>Rotation</label> <div class=col-md-5> <input class="form-control gmf-print-rotation-input" type=range value=0 min=-180 max=180 data-toggle=tooltip title="{{\'You can also use Alt+Shift on the map\' | translate}}"> </div> <div class=col-md-4> <input class="form-control gmf-print-rotation-input" type=number min=-180 max=180 value=0> </div> </div> </div> <div class="gmf-print-actions form-group pull-right"> <span ng-show="$ctrl.isState(\'PRINTING\')"> <i class="fa fa-refresh fa-spin"></i> </span> <a ng-show="$ctrl.isState(\'PRINTING\')" class="gmf-print-cancel btn btn-link" href="" ng-click=$ctrl.cancel() translate>Abort</a> <button ng-show=$ctrl.layoutInfo.formats.png class="gmf-print-image btn btn-primary" ng-disabled="$ctrl.isState(\'PRINTING\')" ng-click="$ctrl.print(\'png\')" translate>Image</button> <button ng-show=$ctrl.layoutInfo.formats.pdf class="gmf-print-pdf btn btn-primary" ng-disabled="$ctrl.isState(\'PRINTING\')" ng-click="$ctrl.print(\'pdf\')" translate>PDF</button> </div> <div ng-show="$ctrl.isState(\'ERROR_ON_REPORT\')" class="gmf-print-error-report form-group pull-left text-danger"> <p>{{\'Error during the print, please try again.\' | translate}}</p> </div> </div> <div ng-show="$ctrl.isState(\'CAPABILITIES_NOT_LOADED\')" class="gmf-print-wait form-group pull-left"> <p>{{\'Connecting to the print server, please wait.\' | translate}}</p> </div> <div ng-show="$ctrl.isState(\'ERROR_ON_GETCAPABILITIES\')" class="gmf-print-error-capabilities form-group pull-left text-danger"> <p>{{\'The print server is unavailable. Please, try later.\' | translate}}</p> </div> </div> '},function(e,t){e.exports='<div ng-switch=efsCtrl.selectedEditableTreeCtrl> <div ng-switch-when=null> <select class=form-control ng-model=efsCtrl.selectedEditableTreeCtrl ng-show="efsCtrl.editableTreeCtrls.length > 0" ng-options="treeCtrl.node.name | translate for treeCtrl in efsCtrl.editableTreeCtrls"> <option value="" translate>-- Choose a layer --</option> </select> <span ng-show="efsCtrl.editableTreeCtrls.length == 0" translate>No editable layer available!</span> </div> <div ng-switch-default> <div class=row> <div class=col-sm-12> <span translate>Currently editing: </span> <b>{{ efsCtrl.selectedEditableTreeCtrl.node.name | translate }}</b> <span class="fa fa-pencil"></span> <br> <button ng-click=efsCtrl.stopEditing() class="btn btn-link btn-xs pull-right"> <span class="fa fa-times"></span> {{\'Stop editing\' | translate}} </button> </div> </div> <gmf-editfeature gmf-editfeature-dirty=efsCtrl.dirty gmf-editfeature-editabletreectrl=::efsCtrl.selectedEditableTreeCtrl gmf-editfeature-map=::efsCtrl.map gmf-editfeature-state=efsCtrl.state gmf-editfeature-tolerance=::efsCtrl.tolerance gmf-editfeature-vector=::efsCtrl.vectorLayer> </gmf-editfeature> </div> </div> '},function(e,t){e.exports='<div> <div ng-switch=efCtrl.feature> <a ng-switch-when=null ng-if=efCtrl.geomType href ngeo-btn ngeo-createfeature ngeo-createfeature-active=efCtrl.createActive ngeo-createfeature-features=::efCtrl.features ngeo-createfeature-geom-type=::efCtrl.geomType ngeo-createfeature-map=::efCtrl.map class="btn btn-default" ng-class="{active: efCtrl.createActive}" ng-model=efCtrl.createActive> <span ng-switch=::efCtrl.geomType> <span ng-switch-when=Point> <span class="gmf-icon gmf-icon-point"></span> {{\'Draw new point\' | translate}} </span> <span ng-switch-when=MultiPoint> <span class="gmf-icon gmf-icon-point"></span> {{\'Draw new point\' | translate}} </span> <span ng-switch-when=LineString> <span class="gmf-icon gmf-icon-line"></span> {{\'Draw new linestring\' | translate}} </span> <span ng-switch-when=MultiLineString> <span class="gmf-icon gmf-icon-line"></span> {{\'Draw new linestring\' | translate}} </span> <span ng-switch-when=Polygon> <span class="gmf-icon gmf-icon-polygon"></span> {{\'Draw new polygon\' | translate}} </span> <span ng-switch-when=MultiPolygon> <span class="gmf-icon gmf-icon-polygon"></span> {{\'Draw new polygon\' | translate}} </span> </span> </a> <div ng-switch-default> <form novalidate name=form class="form gmf-editfeature-attributes-container" ng-if=efCtrl.attributes> <div class=row> <div class=col-sm-12> <a class=close ng-click=efCtrl.cancel() ng-disabled=efCtrl.pending title="{{\'Cancel modifications\' | translate}}" href>&times;</a> </div> </div> <ngeo-attributes ngeo-attributes-attributes=::efCtrl.attributes ngeo-attributes-disabled=efCtrl.pending ngeo-attributes-feature=::efCtrl.feature> </ngeo-attributes> <input type=submit value="{{\'Save\' | translate}}" class="btn btn-sm btn-default gmf-editfeature-btn-save" ng-click="form.$valid && efCtrl.save()" ng-disabled="!efCtrl.dirty || efCtrl.pending" title="{{\'Save modifications\' | translate}}"> <a class="btn btn-sm btn-default gmf-editfeature-btn-cancel" ng-click=efCtrl.confirmCancel() ng-disabled=efCtrl.pending title="{{\'Cancel modifications\' | translate}}" href>{{\'Cancel\' | translate}}</a> <button class="btn btn-sm btn-link gmf-editfeature-btn-delete" ng-click=efCtrl.delete() ng-disabled=efCtrl.pending ng-show=efCtrl.featureId title="{{\'Delete this feature\' | translate}}"> <span class="fa fa-trash"></span> {{\'Delete\' | translate}} </button> </form> </div> </div> <ngeo-modal ng-model=efCtrl.unsavedModificationsModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Unsaved modifications!\' | translate}} </h4> </div> <div class=modal-body> {{\'There are unsaved changes.\' | translate}} </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal ng-click=efCtrl.continueWithoutSaving()> {{\'Continue without saving\' | translate}} </button> <button type=button class="btn btn-primary" data-dismiss=modal> {{\'Cancel\' | translate}} </button> <button type=button class="btn btn-default" data-dismiss=modal ng-click=efCtrl.submit()> {{\'Save\' | translate}} </button> </div> </ngeo-modal> <ngeo-modal ng-model=efCtrl.showServerError> <div class=modal-header>{{\'Server error.\' | translate}}</div> <div class=modal-body>{{$parent.efCtrl.serverErrorType}}<br> {{$parent.efCtrl.serverErrorMessage || (\'Unexpected server error.\' | translate)}}</div> </ngeo-modal> </div> '},function(e,t){e.exports='<fieldset ng-disabled=attrCtrl.disabled> <div class=form-group ng-repeat="attribute in ::attrCtrl.attributes"> <div ng-if="attribute.type !== \'geometry\'"> <label ng-if="::attribute.type !== \'boolean\'" class=control-label>{{ ::attribute.name | translate }} <span class=text-muted>{{::attribute.required ? "*" : ""}}</span> </label> <div ng-switch=::attribute.type> <div ng-switch-when=boolean class=checkbox> <label> <input name={{::attribute.name}} ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); type=checkbox>  <span> {{ ::attribute.name | translate }} <span class=text-muted>{{::attribute.required ? "*" : ""}}</span></span> </label> </div> <select name={{::attribute.name}} ng-required=attribute.required ng-switch-when=select ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); class=form-control type=text> <option ng-repeat="attribute in ::attribute.choices" value="{{ ::attribute }}"> {{ ::attribute }} </option> </select> <input name={{::attribute.name}} ng-required=attribute.required ng-switch-when=date ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ngeo-datetimepicker ngeo-datetimepicker-options="\'{&quot;timepicker&quot;: false, &quot;format&quot;: &quot;\' + attribute.format + \'&quot;, &quot;allowBlank&quot;: true, &quot;todayButton&quot;: false, &quot;mask&quot;: &quot;\' + attribute.mask + \'&quot;}\'" class=form-control type=text>  <input name={{::attribute.name}} id=time ng-required=attribute.required ng-switch-when=time ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ngeo-datetimepicker ngeo-datetimepicker-options="\'{&quot;datepicker&quot;: false, &quot;format&quot;: &quot;\' + attribute.format + \'&quot;, &quot;todayButton&quot;: false, &quot;mask&quot;: &quot;\' + attribute.mask + \'&quot;, &quot;defaultTime&quot;: &quot;00:00&quot;}\'" class=form-control type=text>  <input name={{::attribute.name}} ng-required=attribute.required ng-switch-when=datetime ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ngeo-datetimepicker ngeo-datetimepicker-options="\'{&quot;scrollTime&quot;: false, &quot;format&quot;: &quot;\' + attribute.format + \'&quot;, &quot;allowBlank&quot;: true, &quot;todayButton&quot;: false, &quot;mask&quot;: &quot;\' + attribute.mask + \'&quot;, &quot;defaultTime&quot;: &quot;00:00&quot;}\'" class=form-control type=text>  <div ng-switch-when=number ng-switch=::attribute.numType> <input name={{::attribute.name}} ng-required=attribute.required ng-switch-when=integer ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); class=form-control step=1 type=number>  <input name={{::attribute.name}} ng-required=attribute.required ng-switch-default ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); class=form-control type=number>  </div> <input name={{::attribute.name}} ng-required=attribute.required ng-switch-default ng-model=attrCtrl.properties[attribute.name] ng-change=attrCtrl.handleInputChange(attribute.name); ng-maxlength=attribute.maxLength class=form-control type=text>  <div ng-show="attrCtrl.form.$submitted || attrCtrl.form[attribute.name].$touched"> <p class=text-danger ng-show=attrCtrl.form[attribute.name].$error.required> {{\'This field is required\' | translate}} </p> </div> </div> </div> </div> </fieldset> '},,function(e,t){e.exports='<ngeo-drawfeature ngeo-btn-group class=btn-group ngeo-drawfeature-active=efCtrl.drawActive ngeo-drawfeature-map=efCtrl.map ngeo-drawfeature-showmeasure=efCtrl.showMeasure> <a data-toggle=tooltip title="{{\'Draw a point on the map\' | translate}}" href ngeo-btn ngeo-drawpoint class="btn btn-default ngeo-drawfeature-point" ng-class="{active: dfCtrl.drawPoint.active}" ng-model=dfCtrl.drawPoint.active> <span class="gmf-icon gmf-icon-point"></span> </a> <a data-toggle=tooltip title="{{\'Draw a line on the map\' | translate}}" href ngeo-btn ngeo-measurelength class="btn btn-default ngeo-drawfeature-linestring" ng-class="{active: dfCtrl.measureLength.active}" ng-model=dfCtrl.measureLength.active> <span class="gmf-icon gmf-icon-line"></span> </a> <a data-toggle=tooltip title="{{\'Draw a polygon on the map\' | translate}}" href ngeo-btn ngeo-measurearea class="btn btn-default ngeo-drawfeature-polygon" ng-class="{active: dfCtrl.measureArea.active}" ng-model=dfCtrl.measureArea.active> <span class="gmf-icon gmf-icon-polygon"></span> </a> <a data-toggle=tooltip title="{{\'Draw a circle on the map\' | translate}}" href ngeo-btn ngeo-measureazimut class="btn btn-default ngeo-drawfeature-circle" ng-class="{active: dfCtrl.measureAzimut.active}" ng-model=dfCtrl.measureAzimut.active> <span class="gmf-icon gmf-icon-circle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a rectangle on the map\' | translate}}" href ngeo-btn ngeo-drawrectangle class="btn btn-default ngeo-drawfeature-rectangle" ng-class="{active: dfCtrl.drawRectangle.active}" ng-model=dfCtrl.drawRectangle.active> <span class="gmf-icon gmf-icon-rectangle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a text label on the map\' | translate}}" href ngeo-btn ngeo-drawtext class="btn btn-default ngeo-drawfeature-text" ng-class="{active: dfCtrl.drawText.active}" ng-model=dfCtrl.drawText.active> <span class="gmf-icon gmf-icon-text"></span> </a> </ngeo-drawfeature> <div ng-switch=efCtrl.selectedFeature> <hr class=gmf-drawfeature-separator ng-show="efCtrl.getFeaturesArray().length > 0"> <div ng-switch-when=null> <div ng-show="efCtrl.getFeaturesArray().length > 0"> <div class=ngeo-drawfeature-actionbuttons> <button type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false ngeo-exportfeatures ngeo-exportfeatures-features=efCtrl.features class="btn btn-link btn-sm"> <span class="fa fa-mail-forward"></span> {{\'Export\' | translate}} <span class=caret></span> </button> <button ng-click=efCtrl.clearFeatures() class="btn btn-link btn-xs"> <span class="fa fa-trash"></span> {{\'Delete All\' | translate}} </button> </div> <div class=gmf-eol></div> <div class="gmf-drawfeature-featurelist list-group list-group-sm"> <button role=button class=list-group-item ng-repeat="feature in efCtrl.getFeaturesArray()" ng-click=efCtrl.selectFeatureFromList(feature);> {{ feature.get(efCtrl.nameProperty) }} </button> </div> </div> </div> <div ng-switch-default> <button ng-click="efCtrl.selectedFeature = null;" class="btn btn-link btn-xs"> <span class="fa fa-arrow-left"></span> {{\'List\' | translate}} </button> <div class=ngeo-drawfeature-actionbuttons> <button type=button data-toggle=dropdown aria-haspopup=true aria-expanded=false ngeo-exportfeatures ngeo-exportfeatures-features=efCtrl.selectedFeatures class="btn btn-link btn-xs"> <span class="fa fa-mail-forward"></span> {{\'Export\' | translate}} <span class=caret></span> </button> <button ng-click=efCtrl.removeFeature(efCtrl.selectedFeature); class="btn btn-link btn-xs"> <span class="fa fa-trash"></span> {{\'Delete\' | translate}} </button> </div> <div class=gmf-eol></div> <gmf-featurestyle gmf-featurestyle-feature=efCtrl.selectedFeature> </gmf-featurestyle> </div> </div> '},function(e,t){e.exports='<div ng-if="fsCtrl.feature && fsCtrl.type"> <div class=form-group> <input ng-model=fsCtrl.getSetName ng-model-options="{getterSetter: true}" ng-attr-placeholder="{{\'Name\' | translate}}" class=form-control /> </div> <div ng-if="fsCtrl.type !== \'Text\'" class=form-group> <input id=gmf-featurestyle-showlabel type=checkbox ng-model=fsCtrl.getSetShowLabel ng-model-options="{getterSetter: true}"/> <label ng-switch=fsCtrl.type for=gmf-featurestyle-showlabel class=control-label> {{\'Display label\' | translate}} </label> </div> <div ng-if="fsCtrl.type !== \'Text\'" class=form-group> <input id=gmf-featurestyle-showmeasure type=checkbox ng-model=fsCtrl.getSetShowMeasure ng-model-options="{getterSetter: true}"/> <label ng-switch=fsCtrl.type for=gmf-featurestyle-showmeasure class=control-label> <span ng-switch-when=Circle> {{\'Display azimuth and radius\' | translate}} </span> <span ng-switch-when=Polygon> {{\'Display surface\' | translate}} </span> <span ng-switch-when=Rectangle> {{\'Display surface\' | translate}} </span> <span ng-switch-when=LineString> {{\'Display length\' | translate}} </span> <span ng-switch-when=Point> {{\'Display coordinates\' | translate}} </span> </label> <em class=text-muted> ({{ fsCtrl.measure }}) </em> </div> </div> <div ng-if="fsCtrl.feature && fsCtrl.type" class=form-horizontal> <div class=form-group> <div ngeo-colorpicker="" ngeo-colorpicker-color=fsCtrl.color class=col-md-12> </div> </div> <div ng-if="fsCtrl.type === \'Point\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Size\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=3 max=20 step=1 ng-model=fsCtrl.getSetSize ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Text\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Size\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=8 max=30 step=1 ng-model=fsCtrl.getSetSize ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Circle\' || fsCtrl.type === \'LineString\' || fsCtrl.type === \'Polygon\' || fsCtrl.type === \'Rectangle\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Stroke\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=0.5 max=5 step=0.5 ng-model=fsCtrl.getSetStroke ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Circle\' || fsCtrl.type === \'Polygon\' || fsCtrl.type === \'Rectangle\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Opacity\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=0 max=1 step=0.05 ng-model=fsCtrl.getSetOpacity ng-model-options="{getterSetter: true}"/> </div> </div> <div ng-if="fsCtrl.type === \'Text\'" class="form-group form-group-nomargin"> <label class="control-label col-md-4">{{\'Angle\' | translate}}</label> <div class=col-md-8> <input type=range class=form-control min=-180 max=180 step=22.5 ng-model=fsCtrl.getSetAngle ng-model-options="{getterSetter: true}"/> </div> </div> </div> '},,function(e,t){e.exports='<div class=ngeo-displaywindow ng-show=$ctrl.open ng-style=$ctrl.style> <div class=windowcontainer> <button type=button class="btn fa-close close" ng-click=$ctrl.close()> </button> <div class=animation-container> <div class=slide-animation> <div class="header ui-draggable-handle" ng-if="$ctrl.title !== null"> <p class=title>{{$ctrl.title | translate}}</p> </div> <div class="details content" ng-if=$ctrl.content ng-bind-html=$ctrl.content> </div> <div class="details iframe" ng-if="$ctrl.url !== null"> <iframe frameborder=0 type=text/html height=100% width=100% ng-src="{{ $ctrl.urlTrusted }}"></iframe> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<ul class=gmf-theme-selector> <li ng-repeat="theme in $ctrl.themes" ng-click=$ctrl.setTheme(theme) ng-class="{\'gmf-theme-selector-active\': $ctrl.gmfThemeManager.getThemeName() == theme.name}"> <img class=gmf-thumb ng-src={{::theme.icon}} /> <span class=gmf-text>{{theme.name | translate}}</span> </li> </ul> '},function(e,t){e.exports='<div class=gmf-search> <input type=text ng-attr-placeholder={{$ctrl.placeholder|translate}} class=form-control ng-model=$ctrl.inputValue ngeo-search=$ctrl.options ngeo-search-datasets=$ctrl.datasets ngeo-search-listeners=$ctrl.listeners> <span class="gmf-clear-button ng-hide" ng-hide="!$ctrl.clearButton || $ctrl.inputValue == \'\'" ng-click=$ctrl.onClearButton()> </span> </div> <span ng-if=$ctrl.colorChooser> <span ng-show=$ctrl.displayColorPicker ngeo-popover ngeo-popover-placement=bottom> <button class="gmf-color-button fa fa-tint" ngeo-popover-anchor data-original-title="{{\'Change the color of the search result\'|translate}}"></button> <div ngeo-popover-content> <div ngeo-colorpicker ngeo-colorpicker-color=$ctrl.color></div> </div> </span> </span> '},,,,,,,function(e,t){e.exports='<table class=ngeo-colorpicker-palette> <tr ng-repeat="colors in ::ctrl.colors"> <td ng-repeat="color in ::colors" ng-click=ctrl.setColor(color) ng-class="{\'ngeo-colorpicker-selected\': color == ctrl.color}"> <div ng-style="::{\'background-color\': color}"></div> </td> </tr> </table> '},function(e,t){e.exports='<div class=gmf-displayquerywindow ng-class="{\'desktop\': ctrl.desktop, \'mobile\': !ctrl.desktop}" ng-show=ctrl.open ngeo-swipe-up="ctrl.collapsed = false" ngeo-swipe-down="ctrl.collapsed = true" ngeo-swipe-disable-mouse ng-swipe-disable-mouse ng-swipe-left=ctrl.next() ng-swipe-right=ctrl.previous()> <button class=collapse-button type=button ng-show=::!ctrl.desktop ng-click="ctrl.collapsed = !ctrl.collapsed" ng-class="[ctrl.collapsed ? \'collapse-button-up\' : \'collapse-button-down\']"> </button> <div class=windowcontainer> <button type=button class="btn fa-close close" ng-click=ctrl.close()> </button> <div class=animation-container ng-class="[ctrl.collapsed ? \'\' : \'animation-container-detailed\', ctrl.isNext ? \'next\' : \'previous\']"> <div ng-animate-swap=ctrl.animate class="slide-animation gmf-animatable"> <div class=header> <p class=title>{{ctrl.source.label | translate}}</p> <p class=subtitle>{{ctrl.getFeatureValues()[ctrl.source.identifierAttributeField]}}</p> </div> <div class=details> <table> <tr ng-repeat="(key, value) in ctrl.getFeatureValues()" ng-if="value !== undefined"> <td class=details-key ng-bind-html="key | translate | ngeoTrustHtml"></td> <td class=details-value ng-bind-html="value | ngeoTrustHtml"></td> </tr> </table> </div> </div> </div> <div class=navigate> <div class=placeholder> <button type=button class="previous btn" ng-disabled=ctrl.isFirst() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.previous()> <span ng-show=::ctrl.desktop>{{\'Prev.\' | translate}}</span> </button> </div> <div class=results> <span ng-show=::!ctrl.desktop>{{\'Result\' | translate}}</span> <span>{{ctrl.currentResult + 1}}</span> <span>/</span> <span>{{ctrl.getResultLength()}}</span> <div ng-show=::ctrl.desktop class=dropup> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class="fa fa-filter"></span> <span class="fa fa-caret-up"></span> </button> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li> <a href=# ng-click=ctrl.setSelectedSource(null)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === null}"> </i> <span>{{\'All layers\' | translate}} ({{ctrl.ngeoQueryResult.total}})</span> </a> </li> <li role=separator class=divider> </li> <li ng-repeat-start="source in ctrl.ngeoQueryResult.sources | filter: ctrl.sourcesFilter" ng-repeat-end ng-class="{\'disabled\': source.features.length <= 0}"> <a href=# ng-click=ctrl.setSelectedSource(source)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === source}"> </i> <span>{{source.label | translate}} ({{source.features.length}})</span> </a> </li> </ul> </div> </div> <div class=placeholder> <button type=button class="next btn" ng-disabled=ctrl.isLast() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.next()> <span ng-show=::ctrl.desktop>{{\'Next\' | translate}}</span> </button> </div> </div> </div> </div> '},,,,,,function(e,t){e.exports='<div class="gmf-displayquerygrid panel" ng-show=ctrl.active> <div class=close ng-click=ctrl.clear()> &times; </div> <ul class="nav nav-pills" role=tablist> <li ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=presentation ng-class="{\'active\' : ctrl.isSelected(gridSource)}" ng-click=ctrl.selectTab(gridSource)> <a href=#{{ctrl.escapeValue(gridSource.source.label)}} data-target=#{{ctrl.escapeValue(gridSource.source.label)}} aria-controls={{ctrl.escapeValue(gridSource.source.label)}} role=tab data-toggle=tab> <span ng-if="gridSource.source.tooManyResults !== true"> {{gridSource.source.label | translate}} ({{gridSource.source.features.length}}) </span> <span ng-if="gridSource.source.tooManyResults === true"> {{gridSource.source.label | translate}} ({{gridSource.source.totalFeatureCount}}*) </span> </a> </li> </ul> <div class=tab-content> <div ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=tabpanel class=tab-pane ng-class="{\'active\' : ctrl.isSelected(gridSource)}" id={{ctrl.escapeValue(gridSource.source.label)}}> <ngeo-grid ngeo-grid-configuration=gridSource.configuration ng-if="gridSource.source.tooManyResults !== true"> </ngeo-grid> <div ng-if="gridSource.source.tooManyResults === true"> <div class="gmf-displayquerygrid-message alert alert-warning"> <p><span translate>The results can not be displayed because the maximum number has been reached</span> ({{gridSource.source.limit}}).</p> <p translate>Please refine your query.</p> </div> </div> </div> </div> <div class=navbar ng-show="!ctrl.pending && ctrl.getActiveGridSource() && ctrl.getActiveGridSource().configuration !== null"> <ul class="nav navbar-nav navbar-right"> <li class=ng-hide ng-show=ctrl.isOneSelected()> <p class="navbar-text ng-binding"> {{ctrl.getSelectedRowCount()}} <span translate>selected element(s)</span> </p> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Zoom to selection\' | translate}}" ng-click=ctrl.zoomToSelection()> <i class="fa fa-search-plus"></i> <span translate>Zoom to</span> </button> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Export selection as CSV\' | translate}}" ng-click=ctrl.downloadCsv()> <i class="fa fa-download"></i> <span translate>Export as CSV</span> </button> </li> <li class="dropdown navbar-link dropup"> <button type=button class="dropup btn btn-default btn-xs" data-toggle=dropdown aria-haspopup=true aria-expanded=false> <span translate>Select</span> <span class=caret></span> </button> <ul class=dropdown-menu aria-labelledby=dLabel> <li> <a href="" ng-click=ctrl.selectAll() translate>All</a> </li> <li> <a href="" ng-click=ctrl.unselectAll() translate>None</a> </li> <li> <a href="" ng-click=ctrl.invertSelection() translate>Reverse selection</a> </li> </ul> </li> </ul> </div> <div ng-show=ctrl.pending class=gmf-displayquerygrid-pending> <span class="fa fa-spinner fa-spin"></span> </div> </div> '},function(e,t){e.exports='<div class=ngeo-grid-table-container> <table float-thead=ctrl.floatTheadConfig ng-model=ctrl.configuration.data class="table table-bordered table-striped table-hover"> <thead class=table-header> <tr> <th ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-click=ctrl.sort(columnDefs.name) ng-bind-html="columnDefs.name | ngeoTrustHtml | translate"> <i ng-show="ctrl.sortedBy !== columnDefs.name" class="fa fa-fw"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === true" class="fa fa-caret-up"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === false" class="fa fa-caret-down"></i> </th> </tr> </thead> <tbody> <tr ng-repeat="attributes in ctrl.configuration.data" ng-class="[\'row-\' + ctrl.configuration.getRowUid(attributes), ctrl.configuration.isRowSelected(attributes) ? \'ngeo-grid-active\': \'\']" ng-click="ctrl.clickRow(attributes, $event)" ng-mousedown=ctrl.preventTextSelection($event)> <td ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-bind-html="attributes[columnDefs.name] | ngeoTrustHtml"></td> </tr> </tbody> </table> </div> '},,,function(e,t){e.exports='<div class="btn-group dropup"> <a type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class=gmf-mouseposition-control-target></span> <span class=caret></span> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li class=dropdown-header translate>Coordinate systems</li> <li ng-repeat="projitem in ::ctrl.projections"> <a href ng-click=ctrl.setProjection(projitem)> <span class="fa fa-fw" ng-class="{\'fa-check\': ctrl.projection == projitem}"></span> {{::projitem.label}} </a> </li> </ul> </div> '},function(e,t){e.exports="<div ngeo-map=ctrl.map ngeo-map-manage-resize=ctrl.manageResize ngeo-map-resize-transition=ctrl.resizeTransition> </div> "},function(e,t){e.exports='<div class="btn-group btn-block" ng-class="::{\'dropup\': scaleselectorCtrl.options.dropup}"> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span ng-bind-html="scaleselectorCtrl.currentScale | ngeoScalify | ngeoTrustHtml"></span>&nbsp;<i class=caret></i> </button> <ul class="dropdown-menu btn-block" role=menu> <li ng-repeat="zoomLevel in ::scaleselectorCtrl.zoomLevels"> <a href ng-click=scaleselectorCtrl.changeZoom(zoomLevel) ng-bind-html="scaleselectorCtrl.getScale(zoomLevel) | ngeoScalify | ngeoTrustHtml"> </a> </li> </ul> </div> '},,,,,,,,,function(e,t){e.exports='<div class=modal-header> <button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&times;</span></button> <h4 class=modal-title translate>Share this map</h4> </div> <div class=modal-body> <form role=form name=gmfShareForm novalidate> <div class=form-group> <label for=gmfShareInputShortLink translate>Permalink</label> <input type=text class=form-control id=gmfShareInputShortLink onclick=this.select() ng-model=$ctrl.shortLink readonly=True> <p class=help-block translate>Copy this link to share it.</p> <p class=text-danger ng-if=$ctrl.showLengthWarning> <span class="fa fa-exclamation-triangle"></span> {{\'You have a lot of drawn elements in this map. The above link may not be correctly supported by some browsers.\' | translate}} </p> <p class=text-danger ng-if=$ctrl.errorOnGetShortUrl> <span class="fa fa-exclamation"></span> {{\'Error, cannot get the shortened URL.\' | translate}} </p> </div> <hr> <div class=gmf-share-email ng-if=::$ctrl.enableEmail> <div class=form-group> <label for=gmfShareInputEmail translate>Send this link to</label> <input type=email class=form-control name=inputEmail id=gmfShareInputEmail placeholder=E-mail ng-model=$ctrl.email required> <span ng-show="gmfShareForm.$submitted || gmfShareForm.inputEmail.$touched"> <span class=text-danger ng-show="gmfShareForm.inputEmail.$error.email || gmfShareForm.inputEmail.$error.required"> <i class="fa fa-exclamation-triangle" aria-hidden=true></i> {{\'Invalid email.\' | translate}}</span> </span> </div> <div class=form-group> <textarea class=form-control ng-attr-placeholder="{{\'Message (optional)\' | translate }}" ng-model=$ctrl.message></textarea> </div> <span class=text-success ng-if=$ctrl.successfullySent> <i class="fa fa-check" aria-hidden=true></i> {{ \'Link successfully sent.\' | translate }} </span> <span class=text-danger ng-if=$ctrl.errorOnsend> <i class="fa fa-exclamation" aria-hidden=true></i> {{ \'Error, the link has not been sent.\' | translate }} </span> </div> <div class=text-right> <button type=button class="btn btn-default" data-dismiss=modal translate>Close</button> <button ng-if=::$ctrl.enableEmail type=submit class="btn btn-default btn-primary" ng-click=$ctrl.sendShortUrl() ng-disabled=!gmfShareForm.$valid translate>Send </button> </div> </form> </div> '},function(e,t){e.exports='<div class=gmf-time-slider> <div ui-slider=sliderCtrl.sliderOptions ng-model=sliderCtrl.dates> <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex=0 data-toggle=tooltip title=""> </span> </div> <div class=gmf-time-slider-displayed-dates> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[0])}}</span> </div> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'value\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates)}}</span> </div> <div class=gmf-time-slider-end-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[1])}}</span> </div> </div> </div> '},,,,function(e,t){e.exports='<div class=gmf-layertree-root-tools ng-if=layertreeCtrl.isRoot> <a href ng-if="gmfLayertreeCtrl.nodesCount() > 0" ng-click=gmfLayertreeCtrl.removeAllNodes()> <span class="fa fa-trash"></span> {{\'Clear all\' | translate}} </a> </div> <div ng-if=::!layertreeCtrl.isRoot id=gmf-layertree-node-{{::layertreeCtrl.uid}} ng-class="[layertreeCtrl.node.children ? \'gmf-layertree-group\' : \'gmf-layertree-leaf\', \'gmf-layertree-depth-\' + layertreeCtrl.depth, gmfLayertreeCtrl.getResolutionStyle(layertreeCtrl.node), gmfLayertreeCtrl.getNodeState(layertreeCtrl)]"> <div class=ngeo-sortable-handle ng-show="layertreeCtrl.depth === 1 && layertreeCtrl.parent.children.length > 1"> <i class="gmf-layertree-sortable-handle-icon fa fa-ellipsis-v"></i> </div> <a ng-if=::layertreeCtrl.node.children data-toggle=collapse href=#gmf-layertree-layer-group-{{::layertreeCtrl.uid}} aria-expanded={{::layertreeCtrl.node.metadata.isExpanded}} class="fa gmf-layertree-expand-node fa-fw"> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::!layertreeCtrl.node.children ng-class="::{\'gmf-layertree-no-layer-icon\' : !gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl)}" class=gmf-layertree-layer-icon> <img ng-if="::(legendIconUrl=gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl))" ng-src={{::legendIconUrl}}>  </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::layertreeCtrl.node.children ng-class="[\'fa fa-fw\', layertreeCtrl.node.children && !layertreeCtrl.layer.loading ? \'gmf-layertree-state\' : \'fa-refresh fa-spin\']"> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) class=gmf-layertree-name data-toggle=tooltip data-placement=top title="{{layertreeCtrl.node.name | translate}}"> {{layertreeCtrl.node.name | translate}} <i class="gmf-icon gmf-icon-search-go gmf-layertree-zoom" data-toggle=tooltip data-placement=bottom data-title="{{\'Not visible at current scale. Click to zoom.\'|translate}}" ng-click="::gmfLayertreeCtrl.zoomToResolution(layertreeCtrl); $event.preventDefault(); $event.stopPropagation();" ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) == \'on\'"> </i> <span ngeo-popover ngeo-popover-dismiss=.content ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) !== \'off\' && layertreeCtrl.node.time && layertreeCtrl.node.time.mode !== \'disabled\'"> <span ngeo-popover-anchor class="fa fa-clock-o" ng-click="$event.preventDefault(); $event.stopPropagation()"> </span> <div ngeo-popover-content> <ngeo-date-picker ng-if="::layertreeCtrl.node.time.widget === \'datepicker\'" time=layertreeCtrl.node.time on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </ngeo-date-picker> <gmf-time-slider ng-if="::layertreeCtrl.node.time.widget === \'slider\'" gmf-time-slider-time=layertreeCtrl.node.time gmf-time-slider-on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </gmf-time-slider> </div> </span> <span class="fa fa-pencil" data-toggle=tooltip data-placement=right title="{{\'Currently editing this layer\'|translate}}" ng-if=layertreeCtrl.properties.editing> </span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-if="::layertreeCtrl.depth == 1" ng-click=gmfLayertreeCtrl.removeNode(layertreeCtrl.node)> <span class="fa fa-trash"></span> </a> <a class=gmf-layertree-node-menu-btn href="" ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl) ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-menu-\' + layertreeCtrl.uid)"> <span class="fa fa-cog"></span> </a> <span ngeo-popover ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed && !layertreeCtrl.node.children) || (gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend) || layertreeCtrl.getDataSource().filtrable" ngeo-popover-dismiss=.content> <span ngeo-popover-anchor class="extra-actions fa fa-cog"> </span> <div ngeo-popover-content> <ul> <li ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed)"> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </li> <li ng-if="::gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend"> <i class="fa fa-th-list fa-fw"></i> <a ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\'); popoverCtrl.dismissPopover()" data-toggle=collapse href=""> {{\'Show/hide legend\'|translate}} </a> </li> <li ng-if="layertreeCtrl.getDataSource() && layertreeCtrl.getDataSource().filtrable"> <i class="fa fa-filter fa-fw"></i> <a ng-click=gmfLayertreeCtrl.toggleFiltrableDataSource(layertreeCtrl.getDataSource()) href=""> {{\'Filter\'|translate}} </a> </li> </ul> </div> </span> <span class=gmf-layertree-metadata ng-if=::layertreeCtrl.node.metadata.metadataUrl> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow === true"> <a title="{{\'More informations\'|translate}}" href={{::layertreeCtrl.node.metadata.metadataUrl}} target=blank_> </a> </span> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow !== true"> <a title="{{\'More informations\'|translate}}" href="" ng-click=gmfLayertreeCtrl.displayMetadata(layertreeCtrl)> </a> </span> </span> </span> </div> <div class=gmf-layertree-node-menu id=gmf-layertree-node-menu-{{::layertreeCtrl.uid}} style=display:none ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl)> <div ng-if=::gmfLayertreeCtrl.supportsOpacityChange(layertreeCtrl)> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </div> <a class=gmf-layertree-node-menu-togglelegend ng-if=::gmfLayertreeCtrl.supportsLegend(layertreeCtrl) data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> <span class="fa fa-th-list"> </span> {{\'Show/hide legend\'|translate}} </a> </div> <div ng-if="::!layertreeCtrl.isRoot && gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend" id=gmf-layertree-node-{{::layertreeCtrl.uid}}-legend class="collapse gmf-layertree-legend" ng-class="::[layertreeCtrl.node.metadata.isLegendExpanded ? \'in\' : \'\']"> <a title="{{\'Hide legend\'|translate}}" data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> {{\'Hide legend\'|translate}} </a> <div ng-if="gmfLayertreeCtrl.isNodeLegendVisible(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')"> <div ng-repeat="(title, url) in gmfLayertreeCtrl.getLegendsObject(layertreeCtrl)"> <p ng-if="gmfLayertreeCtrl.getNumberOfLegendsObject(layertreeCtrl) > 1">{{title|translate}}</p> <img ng-src={{url}}> </div> </div> </div> <ul class=gmf-layertree-root-external-datasources ng-if="layertreeCtrl.isRoot && (gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length)"> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmtsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups" group=wmtsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups" group=wmsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-if=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length group=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup> </gmf-datasourcegrouptree> </ul> <ul id=gmf-layertree-layer-group-{{::layertreeCtrl.uid}} ng-if=::layertreeCtrl.node.children ng-class="{collapse: !layertreeCtrl.isRoot, in : layertreeCtrl.node.metadata.isExpanded}" ngeo-sortable="::layertreeCtrl.isRoot && layertreeCtrl.node.children" ngeo-sortable-options="{handleClassName: \'ngeo-sortable-handle\', draggerClassName: \'gmf-layertree-dragger\', placeholderClassName : \'gmf-layertree-curr-drag-item\'}" ngeo-sortable-callback=::gmfLayertreeCtrl.afterReorder ngeo-sortable-callback-ctx=::gmfLayertreeCtrl> <li class=gmf-layertree-node ng-repeat="node in layertreeCtrl.node.children" ng-class="\'gmf-layertree-depth-\' + layertreeCtrl.depth" ngeo-layertree=node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<span ng-if=::!layertreeCtrl.isRoot>{{::layertreeCtrl.node.name}}</span> <input type=checkbox ng-if="::layertreeCtrl.node && !layertreeCtrl.node.children" ng-model=layertreeCtrl.getSetActive ng-model-options="{getterSetter: true}"/> <ul ng-if=::layertreeCtrl.node.children> <li ng-repeat="node in ::layertreeCtrl.node.children" ngeo-layertree=::node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<div class="gmf-layertree-group gmf-layertree-depth-1 {{$ctrl.group.visibilityState}}"> <a data-toggle=collapse href=#gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} aria-expanded=true class="fa gmf-layertree-expand-node fa-fw"> </a> <a class="fa fa-fw gmf-layertree-state" href ng-click=$ctrl.toggle()> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggle()> <span>{{$ctrl.group.title | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.remove()> <span class="fa fa-trash"></span> </a> </span> </div> <ul id=gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} class="collapse in"> <li class="gmf-layertree-node gmf-layertree-depth-2" ng-class="[dataSource.visible ? \'on\' : \'off\']" ng-repeat="dataSource in $ctrl.group.dataSources"> <div class=gmf-layertree-leaf> <a href ng-click=$ctrl.toggleDataSource(dataSource) class="gmf-layertree-layer-icon gmf-layertree-no-layer-icon"> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggleDataSource(dataSource)> <span>{{dataSource.name | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.removeDataSource(dataSource)> <span class="fa fa-trash"></span> </a> </span> </div> </li> </ul> '},function(e,t){e.exports='<div class=form-group ng-switch=$ctrl.filtrableDataSources.length> <span ng-switch-when=0 translate>No filtrable layer available!</span> <select class=form-control ng-disabled=$ctrl.aRuleIsActive ng-switch-default ng-model=$ctrl.gmfDataSourceBeingFiltered.dataSource ng-options="dataSource.name | translate for dataSource in $ctrl.filtrableDataSources"> <option value="" translate>-- Layer to filter --</option> </select> <div ng-if="$ctrl.customRules && $ctrl.directedRules && $ctrl.readyDataSource"> <hr class=gmf-filterselector-separator /> <div class="dropdown gmf-filterselector-savedfilters"> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0}" type=button data-toggle=dropdown ng-disabled="$ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0"> <span translate>Saved</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <a href ng-click=$ctrl.saveFilterLoadItem(item)> <span>{{::item.name}}</span> </a> </li> <li role=separator class=divider></li> <li> <a href ng-click=$ctrl.saveFilterManage()> <span translate>Manage saved filters</span> </a> </li> </ul> </div> <ngeo-filter a-rule-is-active=$ctrl.aRuleIsActive custom-rules=$ctrl.customRules datasource=$ctrl.readyDataSource directed-rules=$ctrl.directedRules feature-overlay=$ctrl.featureOverlay map=$ctrl.map tool-group=$ctrl.toolGroup> </ngeo-filter> <div> <a class="btn btn-link gmf-filterselector-savebtn" type=button data-toggle=dropdown ng-click="!$ctrl.aRuleIsActive && $ctrl.saveFilterShowModal()" ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-save"></span> <span translate>Save</span> </a> </div> </div> <ngeo-modal ng-model=$ctrl.saveFilterSaveModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Save filter\' | translate}}</h4> </div> <div class=modal-body> <p class=gmf-filterselector-savefilter-desc translate> You can save the filter that you created to re-load it later. </p> <input type=text class=form-control name=name ng-model=$ctrl.saveFilterName placeholder="{{\'Filter name\' | translate}}"/> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Cancel\' | translate}}</button> <button type=button ng-click=$ctrl.saveFilterSave() ng-disabled="$ctrl.saveFilterName === \'\'" class="btn btn-primary">{{\'Save\' | translate}}</button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.saveFilterManageModalShown> <div class=gmf-filterselector-managefilter-modal> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Manage filters\' | translate}}</h4> </div> <div class=modal-body> <ul> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <span>{{::item.name}}</span> <a href ng-click=$ctrl.saveFilterRemoveItem(item)> {{ \'Delete\' | translate }} </a> <div class=gmf-eol></div> </li> </ul> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Close\' | translate}}</button> </div> </div> </ngeo-modal> </div> '},function(e,t){e.exports='<div class=dropdown> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-cog"></span> <span class=caret></span> </a> <ul class=dropdown-menu> <li class=ngeo-filter-condition-criteria-header translate>Criteria taken into account</li> <li ng-repeat="condition in ::$ctrl.conditions"> <a href ng-click=$ctrl.setCondition(condition)> <span ng-class="{\'ngeo-filter-condition-criteria-active\': condition.value == $ctrl.datasource.filterCondition}" class="fa fa-check ngeo-filter-condition-criteria"> </span> <span>{{::condition.text | translate}}</span> </a> </li> </ul> </div> <ngeo-rule ng-repeat="rule in $ctrl.directedRules" feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-directed map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> <hr class=ngeo-filter-separator-rules /> <div ng-repeat="rule in $ctrl.customRules"> <a class="btn btn-xs btn-link ngeo-filter-rule-custom-rm-btn" ng-click="!$ctrl.aRuleIsActive && $ctrl.removeCustomRule(rule)" ng-disabled=$ctrl.aRuleIsActive href> <span class="fa fa-remove"></span> </a> <ngeo-rule feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-custom map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> </div> <div class=dropdown> <a class="btn btn-link dropdown-toggle" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span translate>+ Add a new criteria</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="attribute in ::$ctrl.geometryAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span translate>Spatial filter</span> </a> </li> <li role=presentation class=divider></li> <li ng-repeat="attribute in ::$ctrl.otherAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span>{{::attribute.name | translate}}</span> </a> </li> </ul> </div> <hr class=ngeo-filter-separator-criteria /> <a class="btn btn-link" type=button ng-click=$ctrl.apply() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-check"></span> <span translate>Apply filter</span> </a> <a class="btn btn-link" type=button ng-click=$ctrl.getData() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-chevron-right"></span> <span translate>Get data</span> </a> '},function(e,t){e.exports='<div class=dropdown ng-class="{open: $ctrl.rule.active}"> <a class="btn btn-default btn-sm dropdown-toggle" type=button ng-click=$ctrl.toggle()> <span>{{ ::$ctrl.clone.name | translate }}</span> <span class=caret></span> </a> <div class="dropdown-menu form-group"> <select class="form-control input-sm ngeo-rule-operators-list" ng-disabled=$ctrl.drawActive ng-if=::$ctrl.clone.operators ng-model=$ctrl.clone.operator ng-options="$ctrl.operators[operator] | translate for operator in ::$ctrl.clone.operators track by operator"> </select> <div ng-switch=::$ctrl.clone.type> <div class="ngeo-rule-type-date form-group" ng-if=$ctrl.rule.active ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <ngeo-date-picker time=$ctrl.timeRangeMode on-date-selected=$ctrl.onDateRangeSelected(time)> </ngeo-date-picker> </div> <div ng-switch-default> <ngeo-date-picker time=$ctrl.timeValueMode on-date-selected=$ctrl.onDateSelected(time)> </ngeo-date-picker> </div> </div> </div> <div class="ngeo-rule-type-geometry form-group" ng-switch-when=geometry> <div ng-switch=$ctrl.geomType> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </div> <ngeo-drawfeature ngeo-drawfeature-active=$ctrl.drawActive ngeo-drawfeature-features=$ctrl.drawnFeatures ngeo-drawfeature-map=$ctrl.map> <div ngeo-btn-group class=btn-group> <a data-toggle=tooltip title="{{\'Draw a point on the map\' | translate}}" href ngeo-btn ngeo-drawpoint class="btn btn-sm btn-default ngeo-drawfeature-point" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.drawPoint.active}" ng-model=dfCtrl.drawPoint.active> <span class="gmf-icon gmf-icon-point"></span> </a> <a data-toggle=tooltip title="{{\'Draw a line on the map\' | translate}}" href ngeo-btn ngeo-measurelength class="btn btn-sm btn-default ngeo-drawfeature-linestring" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.measureLength.active}" ng-model=dfCtrl.measureLength.active> <span class="gmf-icon gmf-icon-line"></span> </a> <a data-toggle=tooltip title="{{\'Draw a polygon on the map\' | translate}}" href ngeo-btn ngeo-measurearea class="btn btn-sm btn-default ngeo-drawfeature-polygon" ng-class="{active: dfCtrl.measureArea.active}" ng-model=dfCtrl.measureArea.active> <span class="gmf-icon gmf-icon-polygon"></span> </a> <a data-toggle=tooltip title="{{\'Draw a circle on the map\' | translate}}" href ngeo-btn ngeo-measureazimut class="btn btn-sm btn-default ngeo-drawfeature-circle" ng-class="{active: dfCtrl.measureAzimut.active}" ng-model=dfCtrl.measureAzimut.active> <span class="gmf-icon gmf-icon-circle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a rectangle on the map\' | translate}}" href ngeo-btn ngeo-drawrectangle class="btn btn-sm btn-default ngeo-drawfeature-rectangle" ng-class="{active: dfCtrl.drawRectangle.active}" ng-model=dfCtrl.drawRectangle.active> <span class="gmf-icon gmf-icon-rectangle"></span> </a> </div> <div class=ngeo-rule-type-geometry-instructions ng-if=$ctrl.drawActive> <span ng-if=dfCtrl.drawPoint.active> {{ \'Draw a point on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureLength.active> {{ \'Draw a line string on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureArea.active> {{ \'Draw a polygon on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureAzimut.active> {{ \'Draw a circle on the map.\' | translate }} </span> <span ng-if=dfCtrl.drawRectangle.active> {{ \'Draw a rectangle on the map.\' | translate }} </span> </div> </ngeo-drawfeature> </div> <div class="checkbox ngeo-rule-type-select" ng-switch-when=select> <a ng-click=$ctrl.selectAllChoices() href>{{ All | translate}} </a> <label class="form-group ol-unselectable" ng-repeat="choice in ::$ctrl.clone.choices"> <input ng-checked="$ctrl.clone.getExpression() && $ctrl.clone.getExpression().split(\',\').indexOf(choice) > -1" ng-click=$ctrl.toggleChoiceSelection(choice) type=checkbox value=choice /> <span>{{ choice | translate }}</span> </label> </div> <div class="form-group ngeo-rule-type-text" ng-switch-default> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.lowerBoundary /> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.upperBoundary /> </div> <div ng-switch-default> <input type=number class="form-control input-sm" ng-if="$ctrl.clone.type === \'number\'" ng-model=$ctrl.clone.expression /> <input type=text class="form-control input-sm" ng-if="$ctrl.clone.type !== \'number\'" ng-model=$ctrl.clone.expression /> </div> </div> </div> <div class=ngeo-rule-btns> <button class="btn btn-xs btn-default" ng-click=$ctrl.apply() type=button>{{\'Apply\' | translate}}</button> <button class="btn btn-xs btn-default" ng-click=$ctrl.cancel() type=button>{{\'Cancel\' | translate}}</button> </div> </div> </div> </div> <div class=ngeo-rule-value ng-if="$ctrl.rule.value !== null"> <a class="btn btn-xs btn-link" ng-click="!$ctrl.rule.active && $ctrl.reset()" ng-disabled=$ctrl.rule.active href> <span class="fa fa-remove"></span> </a> <div ng-switch=::$ctrl.rule.type> <div ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>From </span> <span>{{ $ctrl.timeToDate($ctrl.rule.lowerBoundary) }}</span> <span translate> to </span> <span>{{ $ctrl.timeToDate($ctrl.rule.upperBoundary) }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.timeToDate($ctrl.rule.getExpression()) }}</span> </div> </div> </div> <div ng-switch-when=geometry> <span>{{ $ctrl.operators[$ctrl.rule.operator] }}</span> <span ng-switch=$ctrl.getRuleGeometryType()> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </span> </div> <div ng-switch-when=select> <span ng-repeat="choice in $ctrl.rule.getExpression().split(\',\')"> {{ choice | translate }}{{ $last ? \'\' : \', \' }} </span> </div> <div ng-switch-default> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>Between </span> <span>{{ $ctrl.rule.lowerBoundary }}</span> <span translate> and </span> <span>{{ $ctrl.rule.upperBoundary }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.rule.getExpression() }}</span> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<div class=ngeo-datepicker> <form name=dateForm class=ngeo-datepicker-form novalidate> <div ng-if="::datepickerCtrl.time.widget === \'datepicker\'"> <div class=ngeo-datepicker-start-date> <span ng-if="::datepickerCtrl.time.mode === \'range\'" translate>From:</span> <span ng-if="::datepickerCtrl.time.mode !== \'range\'" translate>Date:</span> <input name=sdate ui-date=datepickerCtrl.sdateOptions ng-model=datepickerCtrl.sdate required=""/> </div> <div class=ngeo-datepicker-end-date ng-if="::datepickerCtrl.time.mode === \'range\'"> <span translate>To:</span> <input name=edate ui-date=datepickerCtrl.edateOptions ng-model=datepickerCtrl.edate required=""/> </div> </div> </form> </div> '},,,,,,function(e,t){e.exports='<h4 class="popover-title ngeo-popup-title"> <span ng-bind-html=title></span> <button type=button class=close ng-click="open = false"> &times;</button> </h4> <div class=popover-content ng-bind-html=content></div> '},,,,,,function(e,t){e.exports='<ul class=gmf-backgroundlayerselector> <li ng-repeat="layer in ctrl.bgLayers" ng-click=ctrl.setLayer(layer) ng-class="{\'gmf-backgroundlayerselector-active\': ctrl.bgLayer == layer, \'gmf-backgroundlayerselector-disabled\': ctrl.opacityLayer == layer}"> <img class=gmf-thumb ng-src="{{::layer.get(\'metadata\')[\'thumbnail\']}}"/> <span class=gmf-text>{{layer.get("label") | translate}}</span> <span ng-class="{\'gmf-backgroundlayerselector-opacity-check\': ctrl.opacityLayer == layer}"></span> </li> <input ng-if=ctrl.opacityLayer class="input-action gmf-backgroundlayerselector-opacity-slider" name=bg-layer-opacity type=range min=0 max=1 step=0.01 ng-model=ctrl.getSetBgLayerOpacity ng-model-options="{getterSetter: true}"> </ul> '},function(e,t){e.exports='<div ng-if=$ctrl.gmfUser.username> <div class=form-group> <span>{{\'Logged in as\' | translate}}</span> <strong>{{ ::$ctrl.gmfUser.username }}</strong>. </div> <form name=logoutForm role=form ng-submit=$ctrl.logout() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=!$ctrl.changingPassword> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Logout\' | translate}}"/> </div> <div class=form-group> <input ng-show=$ctrl.allowPasswordChange type=button class="form-control btn btn-default" value="{{\'Change password\' | translate}}" ng-click="$ctrl.changingPassword = true"/> </div> </form> <form name=changePasswordForm role=form ng-submit=$ctrl.changePassword() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=$ctrl.changingPassword> <div class=form-group> <input type=password class=form-control name=oldpassword ng-model=$ctrl.oldPwdVal ng-attr-placeholder="{{\'Old password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpassword ng-model=$ctrl.newPwdVal ng-attr-placeholder="{{\'New password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpasswordconfirm ng-model=$ctrl.newPwdConfVal ng-attr-placeholder="{{\'Confirm new password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Change password\' | translate}}"/> </div> <div class=form-group> <input type=button class="form-control btn btn-default" value="{{\'Cancel\' | translate}}" ng-if=!$ctrl.userMustChangeItsPassword() ng-click=$ctrl.changePasswordReset() /> <input type=button class="form-control btn btn-default" value="{{\'Logout\' | translate}}" ng-if=$ctrl.userMustChangeItsPassword() ng-click=$ctrl.logout() /> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> <ngeo-modal ng-model=$ctrl.changePasswordModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Password Changed\' | translate}} </h4> </div> <div class=modal-body> {{\'Your password has successfully been changed.\' | translate}} </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'OK\' | translate}}</button> </div> </ngeo-modal> </div> <div ng-if=!$ctrl.gmfUser.username> <form name=loginForm role=form ng-submit=$ctrl.login() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}"> <div class=form-group> <input type=text class=form-control name=login ng-model=$ctrl.loginVal ng-attr-placeholder="{{\'Username\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=password ng-model=$ctrl.pwdVal ng-attr-placeholder="{{\'Password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Connect\' | translate}}"/> </div> <div ng-show=$ctrl.allowPasswordReset class=form-group> <a ng-click=$ctrl.resetPassword() href="">{{\'Password forgotten?\' | translate}}</a> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> <ngeo-modal ng-model=$ctrl.resetPasswordModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Password forgotten?\' | translate}} </h4> </div> <div class=modal-body translate> A new password has just been sent to you by e-mail. </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'OK\' | translate}}</button> </div> </ngeo-modal> </div> '},,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){}]);
//# sourceMappingURL=desktop.2c9645.js.map