!function(e){function t(t){for(var a,i,s=t[0],l=t[1],u=t[2],h=0,p=[];h<s.length;h++)i=s[h],n[i]&&p.push(n[i][0]),n[i]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);for(c&&c(t);p.length;)p.shift()();return o.push.apply(o,u||[]),r()}function r(){for(var e,t=0;t<o.length;t++){for(var r=o[t],a=!0,s=1;s<r.length;s++){var l=r[s];0!==n[l]&&(a=!1)}a&&(o.splice(t--,1),e=i(i.s=r[0]))}return e}var a={},n={1:0},o=[];function i(t){if(a[t])return a[t].exports;var r=a[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=a,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;o.push([286,0]),r()}([,function(e,t,r){"use strict";var a={assert:function(e,t,r){return e},assertNumber:function(e,t,r){return e},assertString:function(e,t,r){return e},assertFunction:function(e,t,r){return e},assertObject:function(e,t,r){return e},assertArray:function(e,t,r){return e},assertBoolean:function(e,t,r){return e},assertElement:function(e,t,r){return e},assertInstanceof:function(e,t,r,a){return e},assertObjectPrototypeIsIntact:function(){}};t.a=a},,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";t.a={BOOLEAN:"boolean",DATE:"date",DATETIME:"datetime",TIME:"time",GEOMETRY:"geometry",NUMBER:"number",SELECT:"select",TEXT:"text"}},,function(e,t,r){"use strict";t.a={ANGLE:"a",COLOR:"c",IS_CIRCLE:"l",IS_RECTANGLE:"r",IS_TEXT:"t",NAME:"n",SHOW_LABEL:"b",OPACITY:"o",AZIMUT:"z",SHOW_MEASURE:"m",SIZE:"s",STROKE:"k"}},,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(100),o=r(2),i=r(8),s=r(36),l=r(73),u=r(168),c=function(e,t,r,a,n,o){l.a.call(this),this.addBlankBackgroundLayer_=!0,void 0!==o.addBlankBackgroundLayer&&(this.addBlankBackgroundLayer_=o.addBlankBackgroundLayer),this.$q_=r,this.$http_=e,this.treeUrl_=void 0,t.has("gmfTreeUrl")&&(this.treeUrl_=t.get("gmfTreeUrl")),this.cacheVersion_="0",t.has("cacheVersion")&&(this.cacheVersion_=t.get("cacheVersion")),this.ngeoLocation_=null,t.has("ngeoLocation")&&(this.ngeoLocation_=t.get("ngeoLocation")),this.layerHelper_=a,this.gettextCatalog=n,this.deferred_=r.defer(),this.promise_=this.deferred_.promise,this.loaded=!1,this.bgLayerPromise_=null};c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"],c.$inject=["$http","$injector","$q","ngeoLayerHelper","gettextCatalog","gmfThemesOptions"],o.d(c,l.a),c.findGroupByLayerNodeName=function(e,t){for(var r=0,a=e.length;r<a;r++)for(var n=e[r],o=0,i=n.children.length;o<i;o++){var s=n.children[o],l=[];if(c.getFlatNodes(s,l),c.findObjectByName(l,t))return s}return null},c.findGroupByName=function(e,t){for(var r=0,a=e.length;r<a;r++)for(var n=e[r],o=0,i=n.children.length;o<i;o++){var s=n.children[o],l=[];if(c.getFlatInternalNodes(s,l),c.findObjectByName(l,t))return s}return null},c.findObjectByName=function(e,t){return i.d(e,function(e){return e.name===t})},c.findThemeByName=function(e,t){return c.findObjectByName(e,t)},c.getFlatInternalNodes=function(e,t){var r=e.children;if(void 0!==r){t.push(e);for(var a=0;a<r.length;a++)c.getFlatInternalNodes(r[a],t)}},c.getFlatNodes=function(e,t){var r=void 0,a=e.children;if(void 0!==a)for(r=0;r<a.length;r++)c.getFlatNodes(a[r],t);else t.push(e)},c.prototype.getBgLayers=function(){var e=this,t=this.gettextCatalog;if(this.bgLayerPromise_)return this.bgLayerPromise_;var r=this.$q_,n=this.layerHelper_,i=function(e,t){t.set("label",e.name),t.set("metadata",e.metadata),t.set("dimensions",e.dimensions);var r=[];return function e(t,r){r.push(o.c(t)),(t.children||[]).forEach(function(t){e(t,r)})}(e,r),t.set("querySourceIds",r),t},l=function(e,t){if("WMTS"===t.type){var o=t;return a.a.assert(o.url,"Layer URL is required"),n.createWMTSLayerFromCapabilitites(o.url,o.layer||"",o.matrixSet,t.dimensions,o.metadata.customOpenLayersOptions).then(i.bind(null,t)).then(null,function(e){var t='Unable to build layer "'+o.layer+'" from WMTSCapabilities: '+o.url+"\n";return t+='OpenLayers error is "'+e.message,console.error(t),r.resolve(void 0)})}if("WMS"===t.type){var s=t;a.a.assert(s.ogcServer,"An OGC server is required");var l=e[s.ogcServer];return a.a.assert(l,"The OGC server was not found"),a.a.assert(l.url,"The server URL is required"),a.a.assert(l.imageType,"The server image type is required"),i(t,n.createBasicWMSLayer(l.url,s.layers||"",l.imageType,l.type,void 0,t.dimensions,l.credential?"use-credentials":"anonymous",s.metadata.customOpenLayersOptions))}a.a.fail("Unsupported type: "+t.type)},c=function(e){var t=e.background_layers.map(function(t){var a=t.type;return"WMTS"===a||"WMS"===a?l(e.ogcServers,t):t.children?function(e,t){var a=t.children.map(function(e){return e}).reverse().map(l.bind(null,e));return r.all(a).then(function(e){var r=void 0;e&&(e=e.filter(function(e){return e}),r=new s.b(e));var a=n.createBasicGroup(r);return i(t,a),a})}(e.ogcServers,t):void 0},this);return r.all(t)}.bind(this);return this.bgLayerPromise_=this.promise_.then(c).then(function(r){var a=[];return e.addBlankBackgroundLayer_&&(t.getString("blank"),a.push(new u.a({label:"blank",metadata:{thumbnail:""}}))),r.forEach(function(e){e&&a.push(e)}),a}),this.bgLayerPromise_},c.prototype.getThemeObject=function(e){return this.promise_.then(function(t){return c.findThemeByName(t.themes,e)})},c.prototype.getThemesObject=function(){return this.promise_.then(function(e){return e.themes})},c.prototype.getBackgroundLayersObject=function(){return a.a.assert(null!==this.promise_),this.promise_.then(function(e){return e.background_layers})},c.prototype.getOgcServersObject=function(){return a.a.assert(null!==this.promise_),this.promise_.then(function(e){return e.ogcServers})},c.prototype.hasEditableLayers=function(){return a.a.assert(null!==this.promise_),this.promise_.then(this.hasEditableLayers_.bind(this))},c.prototype.hasEditableLayers_=function(e){var t=this;return e.themes.some(function(e){return e.children.some(t.hasNodeEditableLayers_.bind(t))})},c.prototype.hasNodeEditableLayers_=function(e){if(e.editable)return!0;var t=!1,r=e.children;return r&&r.length&&(t=r.some(this.hasNodeEditableLayers_.bind(this))),t},c.getSnappingConfig=function(e){return e.metadata&&void 0!==e.metadata.snappingConfig?e.metadata.snappingConfig:null},c.getNodeMaxResolution=function(e){var t=e.metadata,r=e.maxResolutionHint;return void 0===r&&void 0!==t&&(r=t.maxResolution),r},c.getNodeMinResolution=function(e){var t=e.metadata,r=e.minResolutionHint;return void 0===r&&void 0!==t&&(r=t.minResolution),r},c.prototype.loadThemes=function(e){var t=this;a.a.assert(this.treeUrl_,"gmfTreeUrl should be defined."),this.loaded&&(this.deferred_=this.$q_.defer(),this.promise_=this.deferred_.promise,this.bgLayerPromise_=null,this.loaded=!1),this.$http_.get(this.treeUrl_,{params:void 0!==e?{role:e,cache_version:this.cacheVersion_}:{cache_version:this.cacheVersion_},cache:!1,withCredentials:!0}).then(function(e){if(0!=e.data.errors.length){var r="The themes contain some errors:\n"+e.data.errors.join("\n");console.error(r),null!==t.ngeoLocation_&&t.ngeoLocation_.hasParam("debug")&&window.alert(r)}t.deferred_.resolve(e.data),t.dispatchEvent("change"),t.loaded=!0},function(e){t.deferred_.reject(e)})},c.NodeType={MIXED_GROUP:"MixedGroup",NOT_MIXED_GROUP:"NotMixedGroup",WMTS:"WMTS",WMS:"WMS"},(c.module=angular.module("gmfThemes",[n.a.module.name])).value("gmfThemesOptions",{}),c.module.service("gmfThemes",c),t.a=c},function(e,t,r){"use strict";var a=r(1),n=r(122),o=r(108),i=r(24),s=r(218),l=r(135),u=r(172),c=r(361),h=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var p=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));n.dimensionsConfig_=r.dimensionsConfig||null,n.dimensionsFiltersConfig_=r.dimensionsFiltersConfig||null,n.filterCondition_=r.filterCondition||o.a.AND,n.filterRules_=r.filterRules||null,n.filtrable_=r.filtrable||null,n.copyable_=!0===r.copyable,n.dimensions_=r.dimensions||null,n.geometryName_=r.geometryName||t.DEFAULT_GEOMETRY_NAME_,n.ogcImageType_=r.ogcImageType||"image/png",n.ogcLayers_=r.ogcLayers||null,n.ogcServerType_=r.ogcServerType||t.ServerType.MAPSERVER,n.ogcType_=r.ogcType||t.Type.WMS,n.snappable_=!0===r.snappable,n.snappingToEdges_=!1!==r.snappingToEdges,n.snappingToVertice_=!1!==r.snappingToVertice,n.snappingTolerance_=void 0!==r.snappingTolerance?r.snappingTolerance:10,n.timeAttributeName_=r.timeAttributeName,n.timeLowerValue_=r.timeLowerValue,n.timeProperty_=void 0!==r.timeProperty?r.timeProperty:null,n.timeUpperValue_=r.timeUpperValue,n.wfsFeatureNS_=r.wfsFeatureNS||t.WFSFeatureNS[n.ogcServerType_],n.wfsFeaturePrefix_=r.wfsFeaturePrefix||t.WFSFeaturePrefix.FEATURE,n.wfsOutputFormat_=r.wfsOutputFormat||t.WFSOutputFormat.GML3,n.wfsUrl_=r.wfsUrl,n.wmsInfoFormat_=r.wmsInfoFormat||t.WMSInfoFormat.GML,n.wmsIsSingleTile_=!0===r.wmsIsSingleTile,n.wmsUrl_=r.wmsUrl,n.wmtsLayer_=r.wmtsLayer,n.wmtsUrl_=r.wmtsUrl;var i=[];if(n.queryable&&n.ogcLayers){var h=n.ogcLayers,p=Array.isArray(h),g=0;for(h=p?h:h[Symbol.iterator]();;){var d;if(p){if(g>=h.length)break;d=h[g++]}else{if((g=h.next()).done)break;d=g.value}var f=d;f.queryable&&i.push(f.name)}}var m=null;if(n.supportsWFS&&i.length){var y=void 0;n.wfsOutputFormat_===t.WFSOutputFormat.GML3?y=new l.a:n.wfsOutputFormat_===t.WFSOutputFormat.GML2&&(y=new s.a),a.a.assert(y),m=new u.a({featureNS:n.wfsFeatureNS,featureType:i,gmlFormat:y})}n.wfsFormat_=m;var v=null;return n.supportsWMS&&i.length&&n.wmsInfoFormat===t.WMSInfoFormat.GML&&(v=new c.a({layers:i})),n.wmsFormat_=v,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getAttributes=function(){return e.prototype.attributes},t.prototype.setAttributes=function(t){e.prototype.setAttributes.call(this,t),this.updateGeometryNameFromAttributes_()},t.prototype.combinableWithDataSourceForWFS=function(e){return this.combinableForWFS&&e.combinableForWFS&&this.supportsWFS&&e.supportsWFS&&this.queryable&&e.queryable&&this.wfsUrl===e.wfsUrl&&this.haveTheSameActiveDimensions(e)},t.prototype.combinableWithDataSourceForWMS=function(e){return this.combinableForWMS&&e.combinableForWMS&&this.supportsWMS&&e.supportsWMS&&this.queryable&&e.queryable&&this.wmsUrl===e.wmsUrl&&this.haveTheSameActiveDimensions(e)},t.prototype.isAnyOGCLayerInRange=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!!this.getInRangeOGCLayerNames(e,t).length},t.prototype.getInRangeOGCLayerNames=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=[];if(this.ogcLayers){var a=this.ogcLayers,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i,l=s.maxResolution,u=s.minResolution;!((void 0===u||e>=u)&&(void 0===l||e<=l))||t&&!s.queryable||r.push(s.name)}}return r},t.prototype.getOGCLayerNames=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];if(this.ogcLayers){var r=this.ogcLayers,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;e&&!i.queryable||t.push(i.name)}}return t},t.prototype.getFiltrableOGCLayerName=function(){a.a.assert(this.filtrable);var e=this.getOGCLayerNames();return a.a.assert(1===e.length),e[0]},t.prototype.updateGeometryNameFromAttributes_=function(){var e=t.DEFAULT_GEOMETRY_NAME_;if(this.attributes){var r=this.attributes,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var s=o;if(s.type===i.a.GEOMETRY){e=s.name;break}}}this.geometryName_=e},t.prototype.haveTheSameActiveDimensions=function(e){var t=!0,r=this.activeDimensions,a=e.activeDimensions;for(var n in r)if(r[n]!==a[n]){t=!1;break}if(t)for(var o in a)if(a[o]!==r[o]){t=!1;break}return t},h(t,[{key:"dimensions",get:function(){return this.dimensions_}},{key:"dimensionsConfig",get:function(){return this.dimensionsConfig_},set:function(e){this.dimensionsConfig_=e}},{key:"dimensionsFiltersConfig",get:function(){return this.dimensionsFiltersConfig_},set:function(e){this.dimensionsFiltersConfig_=e}},{key:"filterCondition",get:function(){return this.filterCondition_},set:function(e){this.filterCondition_=e}},{key:"filterRules",get:function(){return this.filterRules_},set:function(e){this.filterRules_=e}},{key:"timeLowerValue",get:function(){return this.timeLowerValue_},set:function(e){this.timeLowerValue_=e}},{key:"timeRangeValue",get:function(){var e=null,t=this.timeLowerValue,r=this.timeUpperValue;return void 0!==t&&(e={end:r,start:t}),e},set:function(e){e?(this.timeUpperValue=e.end,this.timeLowerValue=e.start):(this.timeUpperValue=void 0,this.timeLowerValue=void 0)}},{key:"timeUpperValue",get:function(){return this.timeUpperValue_},set:function(e){this.timeUpperValue_=e}},{key:"copyable",get:function(){return this.copyable_}},{key:"filtrable",get:function(){return this.filtrable_},set:function(e){this.filtrable_=e}},{key:"geometryName",get:function(){return this.geometryName_}},{key:"ogcImageType",get:function(){return this.ogcImageType_}},{key:"ogcLayers",get:function(){return this.ogcLayers_}},{key:"ogcServerType",get:function(){return this.ogcServerType_}},{key:"ogcType",get:function(){return this.ogcType_}},{key:"snappable",get:function(){return this.snappable_}},{key:"snappingToEdges",get:function(){return this.snappingToEdges_}},{key:"snappingToVertice",get:function(){return this.snappingToVertice_}},{key:"snappingTolerance",get:function(){return this.snappingTolerance_}},{key:"timeAttributeName",get:function(){return this.timeAttributeName_}},{key:"timeProperty",get:function(){return this.timeProperty_}},{key:"wfsFeatureNS",get:function(){return this.wfsFeatureNS_}},{key:"wfsFeaturePrefix",get:function(){return this.wfsFeaturePrefix_}},{key:"wfsOutputFormat",get:function(){return this.wfsOutputFormat_}},{key:"wfsUrl",get:function(){return this.wfsUrl_}},{key:"wmsInfoFormat",get:function(){return this.wmsInfoFormat_}},{key:"wmsIsSingleTile",get:function(){return this.wmsIsSingleTile_}},{key:"wmsUrl",get:function(){return this.wmsUrl_}},{key:"wmtsLayer",get:function(){return this.wmtsLayer_}},{key:"wmtsUrl",get:function(){return this.wmtsUrl_}},{key:"activeDimensions",get:function(){var e={},t=this.dimensions_||{},r=this.dimensionsConfig||{};for(var a in r)null===r[a]?void 0!==t[a]&&null!==t[a]&&(e[a]=t[a]):e[a]=r[a];return e}},{key:"combinableForWFS",get:function(){return null===this.filterRules_&&null===this.timeRangeValue}},{key:"combinableForWMS",get:function(){return null===this.filterRules_&&null===this.timeRangeValue}},{key:"queryable",get:function(){var e=!1;if((this.supportsWMS||this.supportsWFS)&&this.ogcLayers){var t=this.ogcLayers,r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}if(!0===n.queryable){e=!0;break}}}return e}},{key:"supportsWFS",get:function(){return void 0!==this.wfsUrl}},{key:"supportsAttributes",get:function(){return null!==this.attributes||this.supportsWFS&&null!==this.ogcLayers&&1===this.ogcLayers.length&&!0===this.ogcLayers[0].queryable}},{key:"supportsWMS",get:function(){return void 0!==this.wmsUrl}},{key:"supportsWMTS",get:function(){return void 0!==this.wmtsUrl}},{key:"wfsFormat",get:function(){return this.wfsFormat_}},{key:"wmsFormat",get:function(){return this.wmsFormat_}}]),t}(n.a);p.guessServiceTypeByUrl=function(e){return/(wmts)/i.test(e)?p.Type.WMTS:p.Type.WMS},p.DEFAULT_GEOMETRY_NAME_="the_geom",p.ServerType={GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGISSERVER:"qgisserver"},p.Type={WMS:"WMS",WMTS:"WMTS"},p.WFSFeatureNS={geoserver:"http://www.opengis.net/gml/3.2",mapserver:"http://mapserver.gis.umn.edu/mapserver",qgisserver:"http://www.qgis.org/gml"},p.WFSFeaturePrefix={FEATURE:"feature"},p.WFSOutputFormat={GML2:"GML2",GML3:"GML3"},p.WMSInfoFormat={GML:"application/vnd.ogc.gml"},t.a=p},function(e,t,r){"use strict";var a={DATALAYERGROUP_NAME:"data",EXTERNALLAYERGROUP_NAME:"external",COORDINATES_LAYER_NAME:"gmfCoordinatesLayerName",PermalinkParam:{BG_LAYER:"baselayer_ref",EXTERNAL_DATASOURCES_NAMES:"eds_n",EXTERNAL_DATASOURCES_URLS:"eds_u",FEATURES:"rl_features",MAP_CROSSHAIR:"map_crosshair",MAP_TOOLTIP:"map_tooltip",MAP_X:"map_x",MAP_Y:"map_y",MAP_Z:"map_zoom",TREE_GROUPS:"tree_groups",WFS_LAYER:"wfs_layer",WFS_NGROUPS:"wfs_ngroups",WFS_SHOW_FEATURES:"wfs_showFeatures"}};t.a=a},,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(2),n=r(43),o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.a.call(this,e),this.detail=t};a.d(o,n.a),t.a=o},,,function(e,t,r){"use strict";var a=function(){};a.prototype.showMessage=function(e){},a.prototype.show=function(e){this.getMessageObjects(e).forEach(this.showMessage,this)},a.prototype.error=function(e){this.show(this.getMessageObjects(e,a.Type.ERROR))},a.prototype.info=function(e){this.show(this.getMessageObjects(e,a.Type.INFORMATION))},a.prototype.success=function(e){this.show(this.getMessageObjects(e,a.Type.SUCCESS))},a.prototype.warn=function(e){this.show(this.getMessageObjects(e,a.Type.WARNING))},a.prototype.getMessageObjects=function(e,t){var r=[],n=null,o=a.Type.INFORMATION;return"string"==typeof e?r.push({msg:e,type:void 0!==t?t:o}):Array.isArray(e)?e.forEach(function(a){"string"==typeof e?n={msg:a,type:void 0!==t?t:o}:(n=a,void 0!==t&&(n.type=t)),r.push(n)},this):(n=e,void 0!==t&&(n.type=t),void 0===n.type&&(n.type=o),r.push(n)),r},a.Type={ERROR:"error",INFORMATION:"information",SUCCESS:"success",WARNING:"warning"},t.a=a},,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(95),o=r(2),i=r(3),s=r(92),l=r(84),u=function(e,t,r){var u=this,c=void 0===r.ngeoLayertreeNotroot;this.isRoot=c;var h=r.ngeoLayertree;this.rootScope_=t,this.properties={},this.state_="off",this.node,c?e.$watch(h,function(e,t){u.node=e}):(this.node=e.$eval(h),a.a.assert(void 0!==this.node));var p=r.ngeoLayertreeMap,g=e.$eval(p);a.a.assert(void 0!==g),this.parent=e.$parent.layertreeCtrl,this.children=[],this.parent&&this.parent.children.push(this),e.$on("$destroy",function(){if(u.parent){var e=u.parent.children.indexOf(u);a.a.assert(e>=0),u.parent.children.splice(e,1)}}),this.uid=o.c(this),this.depth=c?0:this.parent.depth+1,e.uid=this.uid,e.depth=this.depth,this.map=g;var d=r.ngeoLayertreeNodelayer;if(void 0===d){var f=r.ngeoLayertreeNodelayerexpr,m=e.$eval(f);a.a.assertString(m),d=m}if(a.a.assert(void 0!==d),this.nodelayerExpr=d,this.layer=null,!c){var y=e.$eval(d,{treeCtrl:this})||null;y&&(a.a.assert(y instanceof l.a||y instanceof s.a),this.layer=y)}this.dataSource_=null,this.layer&&(n.a.layerLoading(this.layer,e),n.a.layer(this.layer),i.a(this.layer,"change:opacity",function(){u.rootScope_.$broadcast("ngeo-layertree-opacity",u)}));var v=r.ngeoLayertreeListeners;if(void 0===v){var _=r.ngeoLayertreeListenersexpr;v=e.$eval(_)}void 0!==v&&a.a.assertString(v),this.listenersExpr=v,v&&e.$eval(v,{treeScope:e,treeCtrl:this}),e.layertreeCtrl=this};u.$inject=["$scope","$rootScope","$attrs"],u.$inject=["$scope","$rootScope","$attrs"],u.prototype.getState=function(){return this.state_},u.prototype.setState=function(e,t){var r=this;if(e!==this.state_){this.setStateInternal_(e),this.parent&&this.parent.refreshState();var a=this.isRoot?this.children:[u.getFirstParentTree(this)];(void 0===t||t)&&a.forEach(function(e){r.rootScope_.$broadcast("ngeo-layertree-state",r,e)})}},u.prototype.setStateInternal_=function(e){var t=this;this.state_="on"===e?"on":"off",this.children.forEach(function(e){e.setStateInternal_(t.state_)})},u.prototype.refreshState=function(){var e=this.getCalculateState();this.state_!==e&&(this.state_=e,this.parent&&this.parent.refreshState())},u.prototype.getCalculateState=function(){if(void 0===this.node.children)return this.state_;var e=void 0,t=void 0;return this.children.some(function(r){if(e=r.getCalculateState(),t&&t!==e)return e="indeterminate";t=e}),e},u.prototype.getSetActive=function(e){var t=this.layer,r=this.map;if(t)return void 0===e?r.getLayers().getArray().indexOf(t)>=0:void(e?r.addLayer(t):r.removeLayer(t))},u.prototype.getDataSource=function(){return this.dataSource_},u.prototype.setDataSource=function(e){this.dataSource_=e},u.getFirstParentTree=function(e){for(var t=e;!t.parent.isRoot;)t=t.parent;return t},u.VisitorDecision={STOP:"STOP",SKIP:"SKIP",DESCEND:"DESCEND"},u.prototype.traverseDepthFirst=function(e){switch(e(this)||u.VisitorDecision.DESCEND){case u.VisitorDecision.STOP:return!0;case u.VisitorDecision.SKIP:return!1;case u.VisitorDecision.DESCEND:for(var t=0;t<this.children.length;++t){if(this.children[t].traverseDepthFirst(e))return!0}return!1;default:a.a.fail("Unhandled case")}},(u.module=angular.module("ngeoLayertreeController",[])).controller("ngeoLayertreeController",u),t.a=u},,,function(e,t,r){"use strict";var a=r(44),n=r(53),o=r(116),i=r(105),s=r(115),l=r(41),u=r(45),c={toMulti:function(e){var t=void 0;return e instanceof l.a?(t=new o.a([])).appendPoint(e):e instanceof n.a?(t=new i.a([])).appendLineString(e):e instanceof u.b?(t=new s.a([])).appendPolygon(e):t=e,t},isSafari:function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")},colorZeroPadding:function(e){return 1==e.length?"0"+e:e},rgbArrayToHex:function(e){var t=e[0],r=e[1],a=e[2];if(t!=(255&t)||r!=(255&r)||a!=(255&a))throw Error('"('+t+","+r+","+a+')" is not a valid RGB color');return"#"+c.colorZeroPadding(t.toString(16))+c.colorZeroPadding(r.toString(16))+c.colorZeroPadding(a.toString(16))},decodeQueryString:function(e){var t={};if(e){var r=e.substring(1).split("&"),a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o,s=i.indexOf("=");if(s>=0){var l=i.substring(0,s),u=i.substring(s+1);t[decodeURIComponent(l)]=decodeURIComponent(u)}else t[i]=""}}return t},encodeQueryString:function(e){var t=[];for(var r in e){var a=e[r];t.push(encodeURIComponent(r)+"="+encodeURIComponent(a))}return t.join("&")},deleteCondition:function(e){return a.f(e)&&a.i(e)}};t.a=c},,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(145),o=r(2),i=r(91),s=r(11),l=r(82),u=r(16),c=function(){this.featureUidToGroupIndex_={},this.groups_=[],this.source_=new l.b({useSpatialIndex:!1}),this.layer_=new i.a({source:this.source_,style:this.styleFunction_.bind(this),updateWhileAnimating:!0,updateWhileInteracting:!0})};c.prototype.addFeature=function(e,t){a.a.assert(t>=0),a.a.assert(t<this.groups_.length);var r=o.c(e).toString();this.featureUidToGroupIndex_[r]=t,this.groups_[t].features[r]=e,this.source_.addFeature(e)},c.prototype.removeFeature=function(e,t){a.a.assert(t>=0),a.a.assert(t<this.groups_.length);var r=o.c(e).toString();delete this.featureUidToGroupIndex_[r],delete this.groups_[t].features[r],this.source_.removeFeature(e)},c.prototype.clear=function(e){a.a.assert(e>=0),a.a.assert(e<this.groups_.length);var t=this.groups_[e];for(var r in t.features)this.removeFeature(t.features[r],e);a.a.assert(s.d(t.features))},c.prototype.getLayer=function(){return this.layer_},c.prototype.getFeatureOverlay=function(){var e=this.groups_.length;return this.groups_.push({styleFunction:u.a,features:{}}),new n.a(this,e)},c.prototype.init=function(e){this.layer_.setMap(e)},c.prototype.setStyle=function(e,t){a.a.assert(t>=0),a.a.assert(t<this.groups_.length),this.groups_[t].styleFunction=null===e?u.c.defaultFunction:Object(u.d)(e)},c.prototype.styleFunction_=function(e,t){var r=o.c(e).toString();a.a.assert(r in this.featureUidToGroupIndex_);var n=this.featureUidToGroupIndex_[r];return this.groups_[n].styleFunction(e,t)},(c.module=angular.module("ngeoFeatureOverlayMgr",[n.a.module.name])).service("ngeoFeatureOverlayMgr",c),t.a=c},function(e,t,r){"use strict";var a=r(1),n=r(133),o=r(2),i=function(e,t){this.$filter_=e,this.gettextCatalog_=t,n.a.call(this)};i.$inject=["$filter","gettextCatalog"],i.$inject=["$filter","gettextCatalog"],o.d(i,n.a),i.prototype.formatTimeValue=function(e,t,r,a){var n=new Date(e),o=a?"UTC":void 0,i="yyyy",s="yyyy-MM",l="yyyy-MM-dd";if(!r){var u=this.gettextCatalog_;i=u.getString("yyyy"),s=u.getString("M/yyyy"),l=u.getString("M/d/yyyy")}switch(t){case"year":return this.$filter_("date")(n,i,o);case"month":return this.$filter_("date")(n,s,o);case"day":return this.$filter_("date")(n,l,o);default:return n.toISOString().replace(/\.\d{3}/,"")}},i.prototype.formatWMSTimeParam=function(e,t,r){return a.a.assert(void 0!==e.resolution),"range"===e.mode?(a.a.assert(void 0!==t.end),this.formatTimeValue(t.start,e.resolution,!0,r)+"/"+this.formatTimeValue(t.end,e.resolution,!0,r)):this.formatTimeValue(t.start,e.resolution,!0,r)},(i.module=angular.module("ngeoWMSTime",[n.a.module.name])).service("ngeoWMSTime",i),t.a=i},,,,,,function(e,t,r){"use strict";var a=r(1),n=r(35),o=r(153),i=r(92),s=r(84),l=r(215),u=r(225),c={interaction:function(e){a.a.assertInstanceof(e,n.a),Object.defineProperty(e,"active",{get:function(){return e.getActive()},set:function(t){e.setActive(t)}})},layer:function(e){a.a.assertInstanceof(e,o.a),Object.defineProperty(e,"visible",{configurable:!0,get:function(){return e.getVisible()},set:function(t){e.setVisible(t)}}),Object.defineProperty(e,"opacity",{configurable:!0,get:function(){return e.getOpacity()},set:function(t){e.setOpacity(t)}})},layerLoading:function(e,t){var r=void 0,n=null,o=null,c=function e(t){var r=t.get("load_count");var a=t.get("parent_group");t.set("load_count",++r,!0);a&&e(a)},h=function e(t){var r=t.get("load_count");var a=t.get("parent_group");t.set("load_count",--r,!0);a&&e(a)};if(e.set("load_count",0,!0),e instanceof i.a&&e.getLayers().on("add",function(t){t.element.set("parent_group",e)}),e instanceof s.a){if(null===(r=e.getSource()))return;r instanceof u.b?(n=["tileloadstart"],o=["tileloadend","tileloaderror"]):r instanceof l.a?(n=["imageloadstart"],o=["imageloadend","imageloaderror"]):a.a.fail("unsupported source type"),r.on(n,function(){c(e),t.$applyAsync()}),r.on(o,function(){h(e),t.$applyAsync()})}Object.defineProperty(e,"loading",{configurable:!0,get:function(){return e.get("load_count")>0}})}};t.a=c},,,function(e,t,r){"use strict";(function(e){var a=r(40),n=r(38),o=r(1),i=r(75),s=r(59),l=r(130),u=r(128),c=r(8),h=r(3),p=r(11),g=function(e,t,r,a,n,o,i){this.$timeout_=e,this.$injector_=t,this.gettextCatalog_=r,this.layerHelper_=a,this.ngeoNotification_=n,this.gmfThemes_=o,this.root={children:[]},this.rootCtrl=null,this.numberOfGroupsToAddInThisDigestLoop=0,this.groupsToAddInThisDigestLoop_=[],this.promiseForGroupsToAddInThisDigestLoop_=null,this.ngeoStateManager_=i,this.ogcServers_=null,h.a(this.gmfThemes_,"change",this.handleThemesChange_,this)};g.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"],g.$inject=["$timeout","$injector","gettextCatalog","ngeoLayerHelper","ngeoNotification","gmfThemes","ngeoStateManager"],g.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t}),this.rootCtrl&&this.rootCtrl.children&&this.gmfThemes_.getThemesObject().then(function(t){e.refreshFirstLevelGroups_(t)})},g.prototype.setFirstLevelGroups=function(e){return this.root.children.length=0,this.ngeoStateManager_.deleteParam(a.a.PermalinkParam.TREE_GROUPS),this.addFirstLevelGroups(e)},g.prototype.addFirstLevelGroups=function(e,t,r){var a=this,n=[];return e.slice().reverse().forEach(function(e){a.addFirstLevelGroup_(e)||n.push(e)}),n.length>0&&!r&&this.notifyCantAddGroups_(n),0===n.length},g.prototype.updateTreeGroupsState_=function(e){var t={};t[a.a.PermalinkParam.TREE_GROUPS]=e.map(function(e){return e.name}).join(","),this.ngeoStateManager_.updateState(t),this.$injector_.has("gmfPermalink")&&this.$injector_.get("gmfPermalink").cleanParams(e)},g.prototype.addFirstLevelGroup_=function(e){var t=this,r=!1,a=e.id;return this.root.children.some(function(e){if(a===e.id)return r=!0},this),this.groupsToAddInThisDigestLoop_.some(function(e){if(a===e.id)return r=!0},this),!r&&(this.groupsToAddInThisDigestLoop_.push(e),this.numberOfGroupsToAddInThisDigestLoop=0,null!==this.promiseForGroupsToAddInThisDigestLoop_&&this.$timeout_.cancel(this.promiseForGroupsToAddInThisDigestLoop_),this.promiseForGroupsToAddInThisDigestLoop_=this.$timeout_(function(){t.numberOfGroupsToAddInThisDigestLoop=t.groupsToAddInThisDigestLoop_.length,t.groupsToAddInThisDigestLoop_.forEach(function(e){t.root.children.unshift(e)}),t.updateTreeGroupsState_(t.root.children),t.groupsToAddInThisDigestLoop_.length=0,t.promiseForGroupsToAddInThisDigestLoop_=null}),!0)},g.prototype.addGroupByName=function(e,t){var r=this;this.gmfThemes_.getThemesObject().then(function(a){var o=n.a.findGroupByName(a,e);o&&r.addFirstLevelGroups([o],t,!1)})},g.prototype.addGroupByLayerName=function(e,t,r){var a=this;this.gmfThemes_.getThemesObject().then(function(o){var s=n.a.findGroupByLayerNodeName(o,e);if(s){var l=a.addFirstLevelGroups([s],t,r);a.$timeout_(function(){var t=a.getTreeCtrlByNodeId(s.id);if(t){var r=void 0;t.traverseDepthFirst(function(t){if(t.node.name===e)return r=t,i.a.VisitorDecision.STOP}),l&&t.setState("off"),r&&r.setState("on")}else console.warn("Tree controller not found, unable to add the group")})}})},g.prototype.removeGroup=function(e){var t=this.root.children,r=0,a=!1;t.some(function(t){if(t.name===e.name)return a=!0;r++}),a&&(t.splice(r,1),this.updateTreeGroupsState_(t))},g.prototype.removeAll=function(){for(;this.root.children.length;)this.removeGroup(this.root.children[0])},g.prototype.cloneGroupNode_=function(e,t){var r=p.a({},e);return this.toggleNodeCheck_(r,t),r},g.prototype.toggleNodeCheck_=function(e,t){var r=this;e.children&&e.children.forEach(function(e){e.children?r.toggleNodeCheck_(e,t):e.metadata&&(e.metadata.isChecked=c.f(t,e.name))})},g.prototype.notifyCantAddGroups_=function(e){var t=[],r=this.gettextCatalog_;e.forEach(function(e){t.push(r.getString(e.name))});var a=t.length<2?r.getString("group is already loaded."):r.getString("groups are already loaded.");this.ngeoNotification_.notify({msg:t.join(", ")+" "+a,type:s.a.Type.INFORMATION})},g.prototype.getTreeCtrlByNodeId=function(e){var t=null;return this.rootCtrl&&this.rootCtrl.traverseDepthFirst&&this.rootCtrl.traverseDepthFirst(function(r){if(r.node.id===e)return t=r,i.a.VisitorDecision.STOP}),t},g.prototype.getOgcServer=function(e){if(e.parent.node.mixed){var t=e.node;return o.a.assert(t.ogcServer),this.ogcServers_[t.ogcServer]}for(var r=e;!r.parent.isRoot;)r=r.parent;var a=r.node;return o.a.assert(a.ogcServer),this.ogcServers_[a.ogcServer]},g.prototype.refreshFirstLevelGroups_=function(e){var t=this,r={};this.rootCtrl.children.map(function(e){var a=e.node.name;r[a]=t.getFirstLevelGroupFullState_(e)});var a=[];this.root.children.map(function(o){var i=o.name,s=n.a.findGroupByName(e,i);if(s){var l=r[i];l&&t.setNodeMetadataFromFullState_(s,l),a.push(s)}}),this.setFirstLevelGroups(a),this.$timeout_(function(){t.updateTreeGroupsState_(t.root.children)})},g.prototype.getFirstLevelGroupFullState_=function(t){var r=this,a={};t.children.map(function(e){a[e.node.name]=r.getFirstLevelGroupFullState_(e)});var n=void 0,o=void 0,i=void 0;if(t.children.length>0){var s=e("#gmf-layertree-layer-group-"+t.uid);s&&(o=s.hasClass("in"))}else{n="on"===(n=t.getState())||"off"!==n&&void 0;var l=e("#gmf-layertree-node-"+t.uid+"-legend");l&&(i=l.is(":visible"))}return{children:a,isChecked:n,isExpanded:o,isLegendExpanded:i}},g.prototype.setNodeMetadataFromFullState_=function(e,t){var r=this;if(!t)return e;e.children&&e.children.map(function(e){r.setNodeMetadataFromFullState_(e,t.children[e.name])});var a=e.metadata;return a.isChecked=t.isChecked,a.isExpanded=t.isExpanded,a.isLegendExpanded=t.isLegendExpanded,e},(g.module=angular.module("gmfTreeManager",[n.a.module.name,i.a.module.name,l.a.module.name,u.a.module.name])).service("gmfTreeManager",g),t.a=g}).call(this,r(33))},,function(e,t,r){"use strict";var a=r(1),n=r(8),o=r(272),i=r(92),s=r(175),l=r(168),u=r(11),c=r(149),h=r(222),p=r(169),g=r(142),d=function(e,t,r){this.$q_=e,this.$http_=t,this.tilesPreloadingLimit_=r};d.$inject=["$q","$http","ngeoTilesPreloadingLimit"],d.$inject=["$q","$http","ngeoTilesPreloadingLimit"],d.GROUP_KEY="groupName",d.REFRESH_PARAM="random",d.prototype.createBasicWMSLayer=function(e,t,r,a,n,o,i,l){var u={FORMAT:r,LAYERS:t},h=void 0;n&&(u.TIME=n),a&&(u.SERVERTYPE=a,h=a.replace("qgisserver","qgis"));var p=Object.assign({},l,{url:e,params:u,serverType:h,crossOrigin:i}),g=new c.a(p);return o&&g.updateParams(o),new s.a({source:g})},d.prototype.createBasicWMSLayerFromDataSource=function(e,t){var r=e.wmsUrl;a.a.assert(r);var n=e.getOGCLayerNames().join(","),o=e.ogcServerType,i=e.ogcImageType,s=this.createBasicWMSLayer(r,n,i,o,void 0,void 0,t);return s.setVisible(e.visible),s.set("querySourceIds",[e.id]),s},d.prototype.createWMTSLayerFromCapabilitites=function(e,t,r,a,i){var s=new o.a,c=new l.a({preload:this.tilesPreloadingLimit_}),h=this.$q_;return this.$http_.get(e,{cache:!0}).then(function(o){var l=void 0;if(o.data&&(l=s.read(o.data)),l){var g=Object.assign({},i,Object(p.b)(l,{matrixSet:r,crossOrigin:"anonymous",layer:t})),d=new p.a(g);a&&!u.d(a)&&d.updateDimensions(a),c.setSource(d);var f=l.Contents.Layer,m=n.d(f,function(e,r,a){return e.Identifier==t});return c.set("capabilitiesStyles",m.Style),h.resolve(c)}return h.reject("Failed to get WMTS capabilities from "+e)})},d.prototype.createWMTSLayerFromCapabilititesObj=function(e,t,r){var n=Object(p.b)(e,{crossOrigin:"anonymous",layer:t.Identifier});a.a.assert(n);var o=new p.a(n);return r&&!u.d(r)&&o.updateDimensions(r),new l.a({capabilitiesStyles:t.Style,preload:1/0,source:o})},d.prototype.createBasicGroup=function(e){var t=new i.a;return e&&t.setLayers(e),t},d.prototype.getGroupFromMap=function(e,t){var r=void 0;return e.getLayerGroup().getLayers().getArray().some(function(e){return e.get(d.GROUP_KEY)===t&&(r=e,!0)}),r||((r=this.createBasicGroup()).set(d.GROUP_KEY,t),e.addLayer(r)),r},d.prototype.getFlatLayers=function(e){if(e instanceof i.a){var t=e.getLayers().getArray();if(!t.some(function(e){return e instanceof i.a}))return t.slice()}return this.getFlatLayers_(e,[],void 0)},d.prototype.getFlatLayers_=function(e,t,r){var a=this,n=e.getOpacity();(void 0!==r?r*=n:r=n,e instanceof i.a)?e.getLayers().forEach(function(e){a.getFlatLayers_(e,t,r)}):t.indexOf(e)<0&&(e.set("inheritedOpacity",r,!0),t.push(e));return t},d.prototype.getLayerByName=function(e,t){var r=this,a=null;return t.some(function(t){if(t instanceof i.a){var n=t.getLayers().getArray();a=r.getLayerByName(e,n)}else t.get("layerNodeName")===e&&(a=t);return!!a}),a},d.prototype.getWMTSLegendURL=function(e){var t=void 0,r=e.get("capabilitiesStyles");if(void 0!==r){var a=r[0].legendURL;void 0!==a&&(t=a[0].href)}return t},d.prototype.getWMSLegendURL=function(e,t,r,a,n,o,i,s,l,u,c){if(e){var h={FORMAT:"image/png",TRANSPARENT:!0,SERVICE:"WMS",VERSION:"1.1.1",REQUEST:"GetLegendGraphic",LAYER:t};return void 0!==r&&(h.SCALE=r),void 0!==a&&(h.RULE=a,void 0!==n&&(h.WIDTH=n),void 0!==o&&(h.HEIGHT=o)),"qgis"==i&&(void 0!=s&&(h.DPI=s),void 0!=l&&void 0!=u&&void 0!=r&&void 0!=s&&void 0==a&&(h.BBOX=l.join(","),h.SRS=u,h.WIDTH=Math.round((l[2]-l[0])/r*39.37*s),h.HEIGHT=Math.round((l[3]-l[1])/r*39.37*s))),c&&Object.assign(h,c),g.a(e,h)}},d.prototype.isLayerVisible=function(e,t){if(!e.getVisible())return!1;var r=t.getView().getResolution();return r>e.getMinResolution()&&r<e.getMaxResolution()},d.prototype.refreshWMSLayer=function(e){var t=e.getSource();a.a.assert(t instanceof c.a||t instanceof h.a);var r=t,n=r.getParams();n[d.REFRESH_PARAM]=Math.random(),r.updateParams(n)},d.prototype.setZIndexToFirstLevelChildren=function(e,t){e instanceof i.a&&e.getLayers().forEach(function(e){return e.setZIndex(t)})},d.prototype.updateWMSLayerState=function(e,t,r){if(t.length<=0)e.setVisible(!1);else{e.setVisible(!0);var a=e.getSource();r?a.updateParams({LAYERS:t,TIME:r}):a.updateParams({LAYERS:t})}},d.prototype.getQuerySourceIds=function(e){return e.get("querySourceIds")},d.module=angular.module("ngeoLayerHelper",[]).service("ngeoLayerHelper",d).value("ngeoTilesPreloadingLimit",1/0),t.a=d},,,,,,,,function(e,t,r){"use strict";t.a={AND:"&&",NOT:"!",OR:"||"}},,,,,function(e,t,r){"use strict";var a=r(1),n=r(122),o=r(36),i=r(3),s=r(232),l=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.collection_=new o.b,this.map_=null,this.listenerKeys_=[],i.a(this.collection_,"add",this.handleDataSourcesAdd_,this)}return e.prototype.bindMap_=function(e){var t=e.getView();this.listenerKeys_.push(i.a(t,"change:resolution",this.handleViewResolutionChange_,this));var r=t.getResolution();a.a.assertNumber(r),this.syncDataSourcesToResolution_(r)},e.prototype.unbindMap_=function(e){this.listenerKeys_.forEach(i.e),this.listenerKeys_=[]},e.prototype.handleViewResolutionChange_=function(e){var t=e.target;a.a.assertInstanceof(t,s.a);var r=t.getResolution();a.a.assertNumber(r),this.syncDataSourcesToResolution_(r)},e.prototype.syncDataSourcesToResolution_=function(e){var t=this;this.collection_.forEach(function(r){t.syncDataSourceToResolution_(r,e)})},e.prototype.syncDataSourceToResolution_=function(e,t){if(e.supportsDynamicInRange){var r=e.maxResolution,a=e.minResolution,n=(null===a||void 0===a||t>=a)&&(null===r||void 0===r||t<=r);e.inRange=n}},e.prototype.handleDataSourcesAdd_=function(e){var t=a.a.assertInstanceof(e.element,n.a);if(this.map_){var r=this.map_.getView().getResolution();a.a.assertNumber(r),this.syncDataSourceToResolution_(t,r)}},l(e,[{key:"map",set:function(e){this.map_!==e&&(this.map_&&this.unbindMap_(this.map_),this.map_=e,e&&this.bindMap_(e))}},{key:"collection",get:function(){return this.collection_}}]),e}();u.module=angular.module("ngeoDataSources",[]),u.module.service("ngeoDataSources",u),t.a=u},,,,,,,,function(e,t,r){"use strict";var a=r(98),n=r(38),o=r(128),i=function(e,t,r,a,n){this.$rootScope_=e,this.gmfThemes_=t,this.modeFlush=r,this.gmfTreeManager_=a,this.ngeoStateManager_=n,this.themeName_=""};i.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"],i.$inject=["$rootScope","gmfThemes","gmfTreeManagerModeFlush","gmfTreeManager","ngeoStateManager"],i.prototype.addTheme=function(e,t){this.modeFlush?(this.ngeoStateManager_.updateState({theme:e.name}),this.setThemeName(e.name),this.gmfTreeManager_.setFirstLevelGroups(e.children)):this.gmfTreeManager_.addFirstLevelGroups(e.children,!1,t)},i.prototype.getThemeName=function(){return this.themeName_},i.prototype.isLoading=function(){return!this.gmfThemes_.loaded},i.prototype.setThemeName=function(e,t){this.themeName_=e,t||this.$rootScope_.$emit(i.EventType.THEME_NAME_SET,e)},i.prototype.removeAll=function(){this.gmfTreeManager_.removeAll()},i.EventType={THEME_NAME_SET:"gmf-thememanager-theme_name_set"},(i.module=angular.module("gmfThemeManager",[a.a.module.name,n.a.module.name,o.a.module.name])).value("gmfTreeManagerModeFlush",!0),i.module.service("gmfThemeManager",i),t.a=i},function(e,t,r){"use strict";var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var n=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.inRange_=!1!==t.inRange,this.visible_=!0===t.visible,this.attributes=t.attributes||null,this.id_=t.id,this.identifierAttribute_=t.identifierAttribute,this.maxResolution_=t.maxResolution,this.minResolution_=t.minResolution,this.name_=t.name}return e.prototype.getAttributes=function(){return this.attributes},e.prototype.setAttributes=function(e){this.attributes=e},a(e,[{key:"inRange",get:function(){return this.inRange_},set:function(e){this.inRange_=e}},{key:"visible",get:function(){return this.visible_},set:function(e){this.visible_=e}},{key:"id",get:function(){return this.id_}},{key:"identifierAttribute",get:function(){return this.identifierAttribute_}},{key:"maxResolution",get:function(){return this.maxResolution_}},{key:"minResolution",get:function(){return this.minResolution_}},{key:"name",get:function(){return this.name_}},{key:"queryable",get:function(){return!1}},{key:"supportsDynamicInRange",get:function(){return null!==this.maxResolution||null!==this.minResolution}}]),e}();t.a=n},,,,,,function(e,t,r){"use strict";var a=r(1),n=r(161),o=function(e,t){var r=this;this.initialState={},this.ngeoLocation=e,this.usedKeyRegexp=t,this.useLocalStorage_,this.setUseLocalStorage(!1);var n=e.getParamKeys().filter(function(e){return"debug"!=e&&"no_redirect"!=e});if(0===n.length){if(this.useLocalStorage_){var o=function(e){a.a.assert(e),r.usedKeyRegexp.some(function(t){if(e.match(t)){var a=window.localStorage[e];return r.initialState[e]=void 0!==a||null!==a?a:"",!0}})};for(var i in window.localStorage)o(i)}}else n.forEach(function(e){r.usedKeyRegexp.some(function(t){if(e.match(t)){var a=r.ngeoLocation.getParam(e);if(void 0!==a)return r.initialState[e]=a,!0}})})};o.$inject=["ngeoLocation","ngeoUsedKeyRegexp"],o.$inject=["ngeoLocation","ngeoUsedKeyRegexp"],o.prototype.setUseLocalStorage=function(e){if(this.useLocalStorage_=e,this.useLocalStorage_)try{"localStorage"in window?(window.localStorage.test="",delete window.localStorage.test):this.useLocalStorage_=!1}catch(e){console.error(e),this.useLocalStorage_=!1}return this.useLocalStorage_},o.prototype.getInitialValue=function(e){return this.initialState[e]},o.prototype.getInitialStringValue=function(e){var t=this.initialState[e];if(void 0!==t)return t},o.prototype.getInitialNumberValue=function(e){var t=this.initialState[e];if(void 0!==t)return parseFloat(t)},o.prototype.getInitialBooleanValue=function(e){var t=this.initialState[e];if(void 0!==t)return"true"===t},o.prototype.updateState=function(e){if(this.ngeoLocation.updateParams(e),this.useLocalStorage_)for(var t in e){a.a.assert(t);var r=e[t];a.a.assert(void 0!==r),window.localStorage[t]=r}},o.prototype.deleteParam=function(e){this.ngeoLocation.deleteParam(e),this.useLocalStorage_&&delete window.localStorage[e]},(o.module=angular.module("ngeoStateManager",[n.a.module.name])).service("ngeoStateManager",o),o.module.value("ngeoUsedKeyRegexp",[new RegExp(".*")]),t.a=o},,function(e,t,r){"use strict";r(249);var a=r(1),n=r(59),o=r(2),i=function(e){n.a.call(this),this.timeout_=e;var t=angular.element('<div class="ngeo-notification"></div>');angular.element(document.body).append(t),this.container_=t,this.cache_={}};i.$inject=["$timeout"],i.$inject=["$timeout"],o.d(i,n.a),i.DEFAULT_DELAY_=7e3,i.prototype.notify=function(e){this.show(e)},i.prototype.clear=function(){for(var e in this.cache_)this.clearMessageByCacheItem_(this.cache_[parseInt(e,10)])},i.prototype.showMessage=function(e){var t=this,r=e.type;a.a.assertString(r,"Type should be set.");var s=["alert","fade"];switch(r){case n.a.Type.ERROR:s.push("alert-danger");break;case n.a.Type.INFORMATION:s.push("alert-info");break;case n.a.Type.SUCCESS:s.push("alert-success");break;case n.a.Type.WARNING:s.push("alert-warning")}var l=angular.element('<div class="'+s.join(" ")+'"></div>');(e.target?angular.element(e.target):this.container_).append(l),l.html(e.msg).addClass("in");var u=void 0!==e.delay?e.delay:i.DEFAULT_DELAY_,c={el:l},h=o.c(l);c.promise=this.timeout_(function(){l.alert("close"),delete t.cache_[h]},u),this.cache_[h]=c},i.prototype.clearMessageByCacheItem_=function(e){var t=e.el,r=e.promise,a=o.c(t);t.alert("close"),this.timeout_.cancel(r),delete this.cache_[a]},(i.module=angular.module("ngeoNotification",[])).service("ngeoNotification",i),t.a=i},,function(e,t,r){"use strict";var a=r(38),n=r(1),o=r(75),i=r(89),s=r(2),l=r(175),u=r(168),c=function(e,t,r,a){var n=this;this.layerHelper_=t,this.ngeoWMSTime_=r,this.ogcServersObject_,a.getOgcServersObject().then(function(e){n.ogcServersObject_=e}),e.$on("ngeo-layertree-state",function(e,t,r){n.sync_(e,r)})};c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"],c.$inject=["$rootScope","ngeoLayerHelper","ngeoWMSTime","gmfThemes"],c.prototype.createLayer=function(e,t,r,a){var n=null;return void 0!==e.node.children&&e.node.mixed?n=this.createGroup_(e,t,r,a):void 0===e.node.children&&e.parent.node.mixed?n=this.createLeafInAMixedGroup_(e,t):void 0===e.node.children?this.initGmfLayerInANotMixedGroup_(e,t):1!==e.depth||e.node.mixed||(n=this.createGroup_(e,t,r,a)),n&&e.node.metadata.opacity&&n.setOpacity(e.node.metadata.opacity),n},c.prototype.sync_=function(e,t){var r=this;t.traverseDepthFirst(function(e){e.layer&&!e.node.mixed&&r.updateLayerState_(e.layer,e)})},c.prototype.updateLayerState_=function(e,t){var r="on"===t.getState();if("WMTS"===t.node.type)e.setVisible(r);else if(t.node.mixed||1!==t.depth)n.a.assertInstanceof(e,l.a),e.setVisible(r);else{n.a.assertInstanceof(e,l.a);var a=[];t.traverseDepthFirst(function(e){void 0===e.node.children&&"on"===e.getState()&&a.push(e.node.layers)}),0===a.length&&e.setVisible(!1),e.getSource().updateParams({LAYERS:a.reverse().join(",")}),0!==a.length&&e.setVisible(!0)}},c.prototype.createGroup_=function(e,t,r,a){var n=e.node,o=null,i=e.parent.isRoot,s=!0;if(void 0!==n.metadata.printNativeAngle&&(s=n.metadata.printNativeAngle),i){o=this.createLayerFromGroup_(e,!!n.mixed);var l=0|a;r.getLayers().insertAt(l,o)}else{if(!this.isOneParentNotMixed_(e))o=this.createLayerFromGroup_(e,!0),c.getLayer(e.parent).getLayers().insertAt(0,o)}return o.set("printNativeAngle",s),o},c.prototype.createLayerFromGroup_=function(e,t){var r=this,a=void 0,o=e.node;if(t)a=this.layerHelper_.createBasicGroup();else{var i=this.getTimeParam_(e),s=this.ogcServersObject_[o.ogcServer||""];n.a.assert(s),n.a.assert(s.url),n.a.assert(s.type),n.a.assert(s.imageType),a=this.layerHelper_.createBasicWMSLayer(s.url,"",s.imageType,s.type,i,void 0,s.credential?"use-credentials":"anonymous");var l=!1;e.traverseDepthFirst(function(e){r.updateLayerReferences_(e.node,a),e.node.metadata.isChecked&&(e.setState("on",!1),r.updateLayerState_(a,e),l=!0)}),a.setVisible(l),a.set("layerNodeName",o.name)}return a},c.prototype.createLeafInAMixedGroup_=function(e,t){var r=e.node,a=void 0;if("WMTS"===r.type)a=this.createWMTSLayer_(r);else{var o=r,i=this.getTimeParam_(e),s=this.ogcServersObject_[o.ogcServer];n.a.assert(s),n.a.assert(s.url),n.a.assert(s.type),n.a.assert(o.layers),n.a.assert(s.imageType),a=this.layerHelper_.createBasicWMSLayer(s.url,o.layers,s.imageType,s.type,i,void 0,s.credential?"use-credentials":"anonymous")}a.set("layerNodeName",r.name),this.updateLayerReferences_(r,a);var l=!0===r.metadata.isChecked;return l&&e.setState("on",!1),a.setVisible(l),c.getLayer(e.parent).getLayers().insertAt(0,a),a},c.prototype.initGmfLayerInANotMixedGroup_=function(e,t){var r=e.node,a=this.getFirstLevelGroupCtrl_(e);n.a.assert(a);var o=a.layer;n.a.assertInstanceof(o,l.a),this.updateLayerReferences_(r,o),r.metadata.isChecked?(e.setState("on",!1),this.updateLayerState_(o,a)):e.parent.refreshState()},c.prototype.createWMTSLayer_=function(e){var t=new u.a;return n.a.assert(e.url),n.a.assert(e.layer),this.layerHelper_.createWMTSLayerFromCapabilitites(e.url,e.layer,e.matrixSet,e.dimensions).then(function(e){t.setSource(e.getSource()),t.set("capabilitiesStyles",e.get("capabilitiesStyles"))}),t},c.prototype.updateLayerReferences_=function(e,t){var r=s.c(e),a=t.get("querySourceIds")||[];if(a.push(r),t.set("querySourceIds",a),e.metadata.disclaimer){var n=t.get("disclaimers")||[];n.push(e.metadata.disclaimer),t.set("disclaimers",n)}},c.prototype.getTimeParam_=function(e){var t=void 0,r=void 0,a=e.node;if(a.time?t=a.time:a.children&&e.traverseDepthFirst(function(e){if(void 0===e.node.children&&e.node.time)return t=e.node.time,o.a.VisitorDecision.STOP}),t){var n=this.ngeoWMSTime_.getOptions(t).values;r=this.ngeoWMSTime_.formatWMSTimeParam(t,{start:n[0]||n,end:n[1]})}return r},c.prototype.isOneParentNotMixed_=function(e){var t=e.parent,r=!1;do{r=!1===t.node.mixed,t=t.parent}while(t.parent&&!r);return r},c.prototype.getFirstLevelGroupCtrl_=function(e){for(var t=e;!t.parent.isRoot;)t=t.parent;return t},c.getLayer=function(e){for(var t=e,r=null;!t.isRoot&&null===r;)t.layer&&(r=t.layer),t=t.parent;return r},(c.module=angular.module("gmfSyncLayertreeMap",[a.a.module.name,o.a.module.name,i.a.module.name])).service("gmfSyncLayertreeMap",c),t.a=c},function(e,t,r){"use strict";var a=function(){};a.prototype.createDate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null!==e?new Date(e):t},a.prototype.getTime=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e?e.getTime():t},a.prototype.getOptions=function(e){var t=this.createDate(e.minValue),r=this.createDate(e.maxValue),a=this.createDate(e.minDefValue,t),n=this.createDate(e.maxDefValue,r),o="range"===e.mode?[this.getTime(a),this.getTime(n)]:this.getTime(a);return{minDate:this.getTime(t),maxDate:this.getTime(r),values:o}},a.prototype.getUTCDate=function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())},(a.module=angular.module("ngeoTime",[])).service("ngeoTime",a),t.a=a},,,,,,,,,,,,function(e,t,r){"use strict";var a=r(3),n=function(e,t){this.manager_=e,this.features_=null,this.index_=t};n.prototype.addFeature=function(e){this.manager_.addFeature(e,this.index_)},n.prototype.removeFeature=function(e){this.manager_.removeFeature(e,this.index_)},n.prototype.clear=function(){this.manager_.clear(this.index_)},n.prototype.setFeatures=function(e){var t=this;null!==this.features_&&(this.features_.clear(),a.c(this.features_,"add",this.handleFeatureAdd_,this),a.c(this.features_,"remove",this.handleFeatureRemove_,this)),null!==e&&(e.forEach(function(e){t.addFeature(e)}),a.a(e,"add",this.handleFeatureAdd_,this),a.a(e,"remove",this.handleFeatureRemove_,this)),this.features_=e},n.prototype.setStyle=function(e){this.manager_.setStyle(e,this.index_)},n.prototype.handleFeatureAdd_=function(e){var t=e.element;this.addFeature(t)},n.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature(t)},n.module=angular.module("ngeoFeatureOverlay",[]),t.a=n},,function(e,t,r){"use strict";var a=r(1),n=r(36),o=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dataSourcesCollection_=new n.b(t.dataSources),this.title_=t.title}return e.prototype.destroy=function(){this.dataSourcesCollection_.clear()},e.prototype.getDataSourceState=function(t){return t.visible?e.VisibilityState.ON:e.VisibilityState.OFF},e.prototype.addDataSource=function(e){this.dataSourcesCollection_.push(e)},e.prototype.removeDataSource=function(e){this.dataSourcesCollection_.remove(e)},e.prototype.toggleVisibilityState=function(){var t=this.visibilityState!==e.VisibilityState.ON,r=this.dataSources,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;i.visible!==t&&(i.visible=t)}},o(e,[{key:"dataSources",get:function(){return this.dataSourcesCollection_.getArray()}},{key:"dataSourcesCollection",get:function(){return this.dataSourcesCollection_}},{key:"title",get:function(){return this.title_}},{key:"visibilityState",get:function(){var t=void 0,r=this.dataSources,n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var s=i;if(void 0===t)t=this.getDataSourceState(s);else this.getDataSourceState(s)!==t&&(t=e.VisibilityState.INDETERMINATE);if(t===e.VisibilityState.INDETERMINATE)break}return a.a.assertString(t),t}}]),e}();i.VisibilityState={INDETERMINATE:"indeterminate",OFF:"off",ON:"on"},t.a=i},,,,,,,,,,,,function(e,t,r){"use strict";var a=angular.module("ngeoDebounce",[]);a.factory_=function(e){return function(t,r,a){var n=null;return function(){for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];var l=this;null!==n&&e.cancel(n),n=e(function(){n=null,t.apply(l,i)},r,a)}}},a.factory_.$inject=["$timeout"],a.factory("ngeoDebounce",a.factory_),t.a=a},function(e,t,r){"use strict";var a=r(3),n=function(){this.listenerKeys_={}};n.prototype.addListenerKey=function(e,t){this.listenerKeys_[e]||this.initListenerKey_(e),this.listenerKeys_[e].push(t)},n.prototype.clearListenerKey=function(e){this.initListenerKey_(e)},n.prototype.initListenerKey_=function(e){this.listenerKeys_[e]?this.listenerKeys_[e].length&&(this.listenerKeys_[e].forEach(a.e),this.listenerKeys_[e].length=0):this.listenerKeys_[e]=[]},(n.module=angular.module("ngeoEventHelper",[])).service("ngeoEventHelper",n),t.a=n},function(e,t,r){"use strict";var a=r(1),n=r(78),o=function(e,t){this.history_=t,this.schema_=e.protocol.substring(0,e.protocol.length-1),this.domain_=e.hostname,this.port_=e.port?parseInt(e.port,10):void 0,this.path_=e.pathname,this.queryData_=n.a.decodeQueryString(e.search),this.fragment_=n.a.decodeQueryString(e.hash)};o.replaceState=function(e,t){try{e.replaceState(null,"",t)}catch(e){}},o.prototype.getPath=function(){return this.path_},o.prototype.getUriString=function(){var e=[];this.schema_&&e.push(this.schema_,":"),(this.domain_||"file"===this.schema_)&&(e.push("//"),e.push(this.domain_),void 0!==this.port_&&e.push(":",String(this.port_))),this.path_&&(this.domain_&&"/"!==this.path_.charAt(0)&&e.push("/"),e.push(this.path_));var t=n.a.encodeQueryString(this.queryData_);t.length>0&&e.push("?",t);var r=n.a.encodeQueryString(this.fragment_);return r.length>0&&e.push("#",r),e.join("")},o.prototype.hasParam=function(e){return e in this.queryData_},o.prototype.hasFragmentParam=function(e){return e in this.fragment_},o.prototype.getParam=function(e){return this.queryData_[e]},o.prototype.getFragmentParam=function(e){return this.fragment_[e]},o.prototype.getParamAsInt=function(e){var t=this.getParam(e);if(void 0!==t){a.a.assertString(t);var r=parseInt(t,10);return isNaN(r)?void 0:r}},o.prototype.getParamAsFloat=function(e){var t=this.getParam(e);if(void 0!==t){a.a.assertString(t);var r=parseFloat(t);return isNaN(r)?void 0:r}},o.prototype.getFragmentParamAsInt=function(e){var t=this.getFragmentParam(e);if(void 0!==t){a.a.assertString(t);var r=parseInt(t,10);return isNaN(r)?void 0:r}},o.prototype.getParamKeys=function(){var e=[];for(var t in this.queryData_)e.push(t);return e},o.prototype.getFragmentParamKeys=function(){var e=[];for(var t in this.fragment_)e.push(t);return e},o.prototype.getParamKeysWithPrefix=function(e){var t=[];for(var r in this.queryData_)0==r.indexOf(e)&&t.push(r);return t},o.prototype.getFragmentParamKeysWithPrefix=function(e){var t=[];for(var r in this.fragment_)0==r.indexOf(e)&&t.push(r);return t},o.prototype.updateParams=function(e){for(var t in e)this.queryData_[t]=e[t]},o.prototype.updateFragmentParams=function(e){for(var t in e)this.fragment_[t]=e[t]},o.prototype.deleteParam=function(e){delete this.queryData_[e]},o.prototype.deleteFragmentParam=function(e){delete this.fragment_[e]},o.prototype.refresh=function(){o.replaceState(this.history_,this.getUriString())},o.prototype.setPath=function(e){this.path_=e},(o.LocationFactory=function(e,t){var r=t.history,a=new o(t.location,t.history),n=a.getUriString();return e.$watch(function(){var t=a.getUriString();n!==t&&e.$evalAsync(function(){n=t,void 0!==r&&void 0!==r.replaceState&&o.replaceState(r,t),e.$broadcast("ngeoLocationChange")})}),a}).$inject=["$rootScope","$window"],(o.MockProvider=function(e){e.$get=function(){return{absUrl:function(){return""},hash:function(e){return void 0!==e?this:""},host:function(){return""},path:function(e){return void 0!==e?this:""},port:function(){return 0},protocol:function(){return""},replace:function(){},search:function(e,t){return void 0!==e?this:{}},url:function(e){return""}}}}).$inject=["$locationProvider"],(o.module=angular.module("ngeoLocation",[])).factory("ngeoLocation",o.LocationFactory),t.a=o},,function(e,t,r){"use strict";var a={};a.module=angular.module("gmfDataSourceBeingFiltered",[]),a.module.value("gmfDataSourceBeingFiltered",{dataSource:null}),t.a=a},function(e,t,r){"use strict";(function(e){var a=r(56);var n=function(t){function r(e,a,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,t.call(this));return s.$http_=e,s.$rootScope_=n,s.baseUrl_=o.replace(/\/$/,""),s.user_=i,s.noReloadRole_=a.has("gmfAuthenticationNoReloadRole")?a.get("gmfAuthenticationNoReloadRole"):null,s.load_(),s}return r.$inject=["$http","$injector","$rootScope","authenticationBaseUrl","gmfUser"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,t),r.prototype.load_=function(){var e=this.baseUrl_+"/"+r.RouteSuffix.IS_LOGGED_IN;this.$http_.get(e,{withCredentials:!0}).then(this.handleLogin_.bind(this,!0))},r.prototype.changePassword=function(t,a,n){var o=this,i=this.baseUrl_+"/"+r.RouteSuffix.CHANGE_PASSWORD;return this.$http_.post(i,e.param({oldPassword:t,newPassword:a,confirmNewPassword:n}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(function(e){o.user_.is_password_changed=!0,o.$rootScope_.$digest()}.bind(this))},r.prototype.login=function(t,a){var n=this.baseUrl_+"/"+r.RouteSuffix.LOGIN;return this.$http_.post(n,e.param({login:t,password:a}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(this.handleLogin_.bind(this,!1))},r.prototype.logout=function(){var e=this,t=this.user_.role_name===this.noReloadRole_,a=this.baseUrl_+"/"+r.RouteSuffix.LOGOUT;return this.$http_.get(a,{withCredentials:!0}).then(function(){e.resetUser_(t)})},r.prototype.resetPassword=function(t){var a=this.baseUrl_+"/"+r.RouteSuffix.RESET_PASSWORD,n=function(e){return e.data}.bind(this);return this.$http_.post(a,e.param({login:t}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(n)},r.prototype.getFunctionalities=function(){return this.user_.functionalities},r.prototype.getRoleId=function(){return this.user_.role_id},r.prototype.handleLogin_=function(e,t){var r=t.data;if(this.setUser_(r,!e),e){var n=new a.a("ready",{user:this.user_});this.dispatchEvent(n)}return t},r.prototype.setUser_=function(e,t){for(var r in e)this.user_[r]=e[r];if(t&&void 0!==e.username){var n=new a.a("login",{user:this.user_});this.dispatchEvent(n)}},r.prototype.resetUser_=function(e){for(var t in e=e||!1,this.user_)this.user_[t]=null;var r=new a.a("logout",{user:this.user_});this.dispatchEvent(r),e||this.load_()},r}(r(73).a);n.RouteSuffix={CHANGE_PASSWORD:"loginchange",IS_LOGGED_IN:"loginuser",LOGIN:"login",LOGOUT:"logout",RESET_PASSWORD:"loginresetpassword"},n.module=angular.module("gmfAuthenticationService",[]),n.module.service("gmfAuthenticationService",n),n.module.value("gmfUser",{functionalities:null,is_password_changed:null,role_id:null,role_name:null,username:null}),t.a=n}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var r=function(e,t){this.$http_=e,this.gmfShortenerCreateUrl_=t};r.$inject=["$http","gmfShortenerCreateUrl"],r.$inject=["$http","gmfShortenerCreateUrl"],r.prototype.getShortUrl=function(e){var t={url:e};return this.gmfShortenerCreateUrl_?this.postShortUrl_(t):{data:{short_url:e},status:200}},r.prototype.sendShortUrl=function(e,t,r){var a={url:e,email:t};return r&&(a.message=r),this.postShortUrl_(a)},r.prototype.postShortUrl_=function(t){return this.$http_.post(this.gmfShortenerCreateUrl_,e.param(t),{headers:{"Content-Type":"application/x-www-form-urlencoded"}})},r.URL_MAX_LEN=2083,r.URL_PATH_MAX_LEN=2048,(r.module=angular.module("gmfShareService",[])).service("gmfShareService",r),t.a=r}).call(this,r(33))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(40),n=r(1),o=r(100),i=r(214),s=r(113),l=r(122),u=r(36),c=r(91),h=r(82),p=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var g=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return a.featuresCollection_=r.features||new u.b,a.source_=new h.b({features:a.featuresCollection_,wrapX:!1}),a.layer_=new c.a({source:a.source_}),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),p(t,[{key:"features",get:function(){return this.featuresCollection_.getArray()}},{key:"featuresCollection",get:function(){return this.featuresCollection_}},{key:"layer",get:function(){return this.layer_}},{key:"extent",get:function(){return this.source_.getExtent()}}]),t}(l.a),d=r(147);var f=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r)),n=r.injector;return a.rootScope_=n.get("$rootScope"),a.unregister_={},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.addDataSource=function(t){e.prototype.addDataSource.call(this,t),n.a.assertInstanceof(t,g),this.registerDataSource_(t)},t.prototype.registerDataSource_=function(e){this.unregister_[e.id]=this.rootScope_.$watch(function(){return e.visible},this.handleDataSourceVisibleChange_.bind(this,e))},t.prototype.handleDataSourceVisibleChange_=function(e,t,r){void 0!==t&&e.layer.setVisible(t)},t.prototype.removeDataSource=function(t){e.prototype.removeDataSource.call(this,t),n.a.assertInstanceof(t,g),this.unregisterDataSource_(t)},t.prototype.unregisterDataSource_=function(e){this.unregister_[e.id](),delete this.unregister_[e.id]},t}(d.a),m=r(39),y=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var v=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return a.url_=r.url,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),y(t,[{key:"url",get:function(){return this.url_}}]),t}(d.a),_=r(8),S=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var b=function(e){function t(r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r)),o=r.injector;return n.layer_,n.ngeoLayerHelper_=a,n.rootScope_=o.get("$rootScope"),n.wmsDataSourceUnregister_={},n.init_(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.init_=function(){n.a.assert(this.dataSources.length,"At least one data source is required.");var e=this.dataSources,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var o=a;n.a.assertInstanceof(o,m.a),this.registerDataSource_(o)}},t.prototype.destroy=function(){var t=this.dataSources,r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var o;if(r){if(a>=t.length)break;o=t[a++]}else{if((a=t.next()).done)break;o=a.value}var i=o;n.a.assertInstanceof(i,m.a),this.unregisterDataSource_(i)}e.prototype.destroy.call(this)},t.prototype.addDataSource=function(t){e.prototype.addDataSource.call(this,t),n.a.assertInstanceof(t,m.a),this.registerDataSource_(t)},t.prototype.registerDataSource_=function(e){var t=e.id;this.wmsDataSourceUnregister_[t]=this.rootScope_.$watch(function(){return e.visible},this.handleDataSourceVisibleChange_.bind(this)),this.layer_?(this.layer_.get("querySourceIds").push(t),this.updateLayer_()):this.layer_=this.ngeoLayerHelper_.createBasicWMSLayerFromDataSource(e)},t.prototype.handleDataSourceVisibleChange_=function(e,t){void 0!==e&&e!==t&&this.updateLayer_()},t.prototype.updateLayer_=function(){var e=this.layer,t=[],r=this.dataSources,a=Array.isArray(r),o=0;for(r=a?r:r[Symbol.iterator]();;){var i;if(a){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var s=i;n.a.assertInstanceof(s,m.a),s.visible&&(t=t.concat(s.getOGCLayerNames()))}this.ngeoLayerHelper_.updateWMSLayerState(e,t.join(","))},t.prototype.removeDataSource=function(t){e.prototype.removeDataSource.call(this,t),n.a.assertInstanceof(t,m.a),this.unregisterDataSource_(t)},t.prototype.unregisterDataSource_=function(e){var t=e.id,r=this.layer;(0,this.wmsDataSourceUnregister_[t])(),delete this.wmsDataSourceUnregister_[t],_.j(this.dataSources,e);var a=this.ngeoLayerHelper_.getQuerySourceIds(r);a&&_.j(a,t),this.dataSources.length&&this.updateLayer_()},S(t,[{key:"layer",get:function(){return this.layer_}}]),t}(v),w=r(2),C=r(5),T=r(3),E=r(277),L=r(273),M=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var A=function(){function e(t,r,a,n,o,i,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.injector_=r,this.q_=a,this.rootScope_=n,this.dataSources_=o.collection,this.ngeoFile_=i,this.ngeoLayerHelper_=s,this.extDataSources_={},this.files_={},this.map_=null,this.fileGroup_=new f({dataSources:[],injector:this.injector_,title:t.getString("Local files")}),this.wmsGroupsCollection_=new u.b,this.wmtsGroupsCollection_=new u.b,this.wmtsCache_={},T.a(this.dataSources_,"remove",this.handleDataSourcesRemove_,this)}return e.$inject=["gettextCatalog","$injector","$q","$rootScope","ngeoDataSources","ngeoFile","ngeoLayerHelper"],e.prototype.addWMSGroup_=function(e){this.wmsGroupsCollection.push(e)},e.prototype.removeWMSGroup_=function(e){this.wmsGroupsCollection.remove(e)},e.prototype.getWMSGroup=function(e){var t=null,r=this.wmsGroups,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(i.url===e){t=i;break}}return t},e.prototype.addWMTSGroup_=function(e){this.wmtsGroupsCollection.push(e)},e.prototype.removeWMTSGroup_=function(e){this.wmtsGroupsCollection.remove(e)},e.prototype.getWMTSGroup=function(e){var t=null,r=this.wmtsGroups,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(i.url===e){t=i;break}}return t},e.prototype.isExternalDataSource=function(e){return!!this.extDataSources_[e.id]},e.prototype.addLayer_=function(e){this.layerGroup.getLayers().push(e)},e.prototype.removeLayer_=function(e){this.layerGroup.getLayers().remove(e)},e.prototype.createAndAddDataSourceFromWMSCapability=function(t,r,a){var n=e.getId(t),o=r.Service,i=void 0;if(this.extDataSources_[n])i=this.extDataSources_[n];else{var s=r.Capability.Request,l=s.GetMap.Format,u=l.includes("image/png")?"image/png":l[0],c=s.GetFeatureInfo.Format.includes(m.a.WMSInfoFormat.GML)?m.a.WMSInfoFormat.GML:void 0,h=!0===t.queryable&&void 0!==c;i=new m.a({id:n,name:t.Title,ogcImageType:u,ogcLayers:[{name:t.Name,queryable:h}],ogcType:m.a.Type.WMS,visible:!0,wmsInfoFormat:c,wmsUrl:a}),this.extDataSources_[n]=i}var p=this.getWMSGroup(a);p?p.dataSources.includes(i)||(p.addDataSource(i),this.dataSources_.push(i)):(p=new b({dataSources:[i],injector:this.injector_,title:o.Title,url:a},this.ngeoLayerHelper_),this.addLayer_(p.layer),this.addWMSGroup_(p),this.dataSources_.push(i))},e.prototype.createAndAddDataSourceFromWMTSCapability=function(t,r,a){var o=e.getId(t);if(!this.wmtsCache_[o]){var i=void 0;if(this.extDataSources_[o])i=this.extDataSources_[o];else{var s=n.a.assertString(t.Title),l=n.a.assertString(t.Identifier);i=new m.a({id:o,name:s,ogcType:m.a.Type.WMTS,visible:!0,wmtsLayer:l,wmtsUrl:a}),this.extDataSources_[o]=i}var u=this.getWMTSGroup(a);u||(u=new v({dataSources:[],title:r.ServiceIdentification.Title,url:a}),this.addWMTSGroup_(u)),u.addDataSource(i);var c=this.ngeoLayerHelper_.createWMTSLayerFromCapabilititesObj(r,t);this.addLayer_(c),this.dataSources_.push(i),this.wmtsCache_[o]={layerObj:c,unregister:this.rootScope_.$watch(function(){return i.visible},this.handleWMTSDataSourceVisibleChange_.bind(this,c))}}},e.prototype.createAndAddDataSourceFromFile=function(e,t){var r=this;this.getFileDataSource_(e).then(function(e){var a=!0,n=r.fileGroup_;if(Object(C.H)(e.extent))a=!1;else{if(n.dataSources.includes(e))return;r.addLayer_(e.layer),n.addDataSource(e),r.map_.getView().fit(e.extent),r.dataSources_.push(e)}t&&t(a)},function(r){console.error("Failed to load file: "+e.name),t&&t(!1)})},e.prototype.getFileDataSource_=function(t){var r=this,a=this.q_.defer();if(this.files_[t.name])a.resolve(this.files_[t.name]);else{var n=this.ngeoFile_;n.read(t).then(function(o){var i=void 0,s={featureProjection:r.map_.getView().getProjection()};if(n.isKml(o)?i=(new L.a).readFeatures(o,s):n.isGpx(o)&&(i=(new E.a).readFeatures(o,s)),i){var l=e.getId(t),c=new g({features:new u.b(i),id:l,name:t.name,visible:!0});r.files_[t.name]=c,r.extDataSources_[l]=c,a.resolve(c)}else a.reject()})}return a.promise},e.prototype.handleWMTSDataSourceVisibleChange_=function(e,t,r){void 0!==t&&t!==r&&e.setVisible(t)},e.prototype.handleDataSourcesRemove_=function(e){var t=e.element;this.extDataSources_[t.id]===t&&(t instanceof g?this.removeFileDataSource_(t):t instanceof m.a&&this.removeOGCDataSource_(t))},e.prototype.removeFileDataSource_=function(e){this.removeLayer_(e.layer),this.fileGroup_.removeDataSource(e)},e.prototype.removeOGCDataSource_=function(e){if(e.ogcType===m.a.Type.WMS){var t=e.wmsUrl;n.a.assert(t);var r=this.getWMSGroup(t);r&&r.dataSources.includes(e)&&(r.removeDataSource(e),r.dataSources.length||(this.removeLayer_(r.layer),r.destroy(),this.removeWMSGroup_(r)))}else if(e.ogcType===m.a.Type.WMTS){var a=e.wmtsUrl;n.a.assert(a);var o=this.getWMTSGroup(a);if(o&&o.dataSources.includes(e)){o.removeDataSource(e);var i=e.id;this.removeLayer_(this.wmtsCache_[i].layerObj),this.wmtsCache_[i].unregister(),delete this.wmtsCache_[i],o.dataSources.length||(o.destroy(),this.removeWMTSGroup_(o))}}},M(e,[{key:"fileGroup",get:function(){return this.fileGroup_}},{key:"wmsGroups",get:function(){return this.wmsGroupsCollection_.getArray()}},{key:"wmsGroupsCollection",get:function(){return this.wmsGroupsCollection_}},{key:"wmtsGroups",get:function(){return this.wmtsGroupsCollection_.getArray()}},{key:"wmtsGroupsCollection",get:function(){return this.wmtsGroupsCollection_}},{key:"layerGroup",get:function(){var e=this.map_;return n.a.assert(e),this.ngeoLayerHelper_.getGroupFromMap(e,a.a.EXTERNALLAYERGROUP_NAME)}},{key:"map",set:function(e){this.map_=e}}]),e}();A.getId=function(e){return w.c(e)+1e6},A.module=angular.module("gmfExternalDataSourcesManager",[o.a.module.name,i.a.module.name,s.a.module.name]),A.module.service("gmfExternalDataSourcesManager",A);t.a=A},,,function(e,t,r){"use strict";var a=r(131),n=r(199);a.a.Proj.projections.add(n.a);t.a="somerc"},function(e,t,r){"use strict";var a=r(10),n=r(275),o=r(201),i=r(131),s=["+proj="+o.a,"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=600000","+y_0=200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");i.a.defs("EPSG:21781",s),n.a(i.a),a.f("EPSG:21781").setExtent([42e4,3e4,9e5,35e4]);t.a="EPSG:21781"},function(e,t,r){"use strict";var a=r(10),n=r(5),o=function(){};o.prototype.stringToCoordinates=function(e){var t=e.match(/([\d\.']+)[\s,]+([\d\.']+)/);if(t){var r=parseFloat(t[1].replace("'","")),a=parseFloat(t[2].replace("'",""));if(!isNaN(r)&&!isNaN(a))return[r,a]}return null},o.prototype.getProjectionList=function(e){var t=void 0,r=void 0,n=[];return e.forEach(function(e){"EPSG:"!=(t=e.toUpperCase()).substr(0,5)&&(t="EPSG:"+t),null!==(r=a.f(t))?n.push(r):console.error("The projection "+t+" is not defined in ol.proj.")}),n},o.prototype.tryProjections=function(e,t,r,o){var i=void 0;return void 0===o&&(o=[r]),o.some(function(o){try{if(i=a.k(e,o,r),n.f(t,i))return!0}catch(e){}i=null}),i},o.prototype.tryProjectionsWithInversion=function(e,t,r,a){var n=this.tryProjections(e,t,r,a);return null===n&&(n=this.tryProjections(e.reverse(),t,r,a)),n},(o.module=angular.module("ngeoAutoProjection",[])).service("ngeoAutoProjection",o),t.a=o},function(e,t,r){"use strict";var a=r(78),n=function(e,t){this.$http_=t,this.url_=e.get("fulltextsearchUrl");var r=this.url_.split("?");this.baseUrl_=r[0];var n=2==r.length?"?"+r[1]:"";this.defaultParams_=a.a.decodeQueryString(n)};n.$inject=["$injector","$http"],n.$inject=["$injector","$http"],n.prototype.search=function(e,t){var r=this,n=Object.assign({},this.defaultParams_,t);n.query=e;var o=this.baseUrl_+"?"+a.a.encodeQueryString(n);return new Promise(function(e,t){r.$http_.get(o).then(function(t){return e(t.data)}).catch(t)})},(n.module=angular.module("gmfSearchFulltextSearch",[])).service("gmfSearchFulltextSearch",n),t.a=n},function(e,t,r){"use strict";var a=r(113),n=r(2);var o=angular.module("gmfLayertreeDatasourceGroupTreeComponent",[a.a.module.name]);function i(e,t){return t(e)}o.run(["$templateCache",function(e){e.put("gmf/layertree/datasourceGroupTreeComponent",r(332))}]),o.value("gmfLayertreeDatasourceGroupTreeTemplateUrl",function(e){var t=e.gmfLayertreeDatasourceGroupTreeTemplateUrl;return void 0!==t?t:"gmf/layertree/datasourceGroupTreeComponent"}),i.$inject=["$attrs","gmfLayertreeDatasourceGroupTreeTemplateUrl"],o.Controller_=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.group,this.scope_=t,this.dataSources_=r.collection}return e.$inject=["$scope","ngeoDataSources"],e.prototype.getGroupUid=function(){return"datasourcegrouptree-"+n.c(this.group)},e.prototype.toggle=function(){this.group.toggleVisibilityState()},e.prototype.toggleDataSource=function(e){e.visible=!e.visible},e.prototype.remove=function(){for(var e=this.group.dataSources.length-1;e>=0;e--)this.dataSources_.remove(this.group.dataSources[e])},e.prototype.removeDataSource=function(e){this.dataSources_.remove(e)},e}(),o.component("gmfDatasourcegrouptree",{bindings:{group:"<"},controller:o.Controller_,templateUrl:i}),t.a=o},function(e,t,r){"use strict";var a=r(161),n=r(128),o=angular.module("ngeoStatemanagerModule",[a.a.module.name,n.a.module.name]);t.a=o},function(e,t,r){"use strict";(function(e){var a=r(40),n=r(121),o=r(38),i=r(266),s=r(209),l=r(147),u=r(39),c=r(265),h=r(251),p=r(26),g=r(159),d=r(160),f=r(206),m=r(128),y=r(75),v=r(1),_=r(2),S=r(8),b=r(3),w=r(30),C=r(41),T=r(46),E=r(136),L=r(16),M=r(92),A=function e(t,r,a,o,i,s,l,u,c){var g=this;this.q_=t,this.rootScope_=a,this.$timeout_=r,this.mapViewPropertyChangeEventKey_=null,this.ngeoDebounce_=i,this.ngeoEventHelper_=l,this.ngeoStateManager_=u,this.ngeoFeatures_=o.has("ngeoFeatures")?o.get("ngeoFeatures"):null,this.ngeoBackgroundLayerMgr_=o.has("ngeoBackgroundLayerMgr")?o.get("ngeoBackgroundLayerMgr"):null;var d=o.has("ngeoFeatureOverlayMgr")?o.get("ngeoFeatureOverlayMgr"):null;this.featureOverlay_=d?d.getFeatureOverlay():null,this.featureHelper_=o.has("ngeoFeatureHelper")?o.get("ngeoFeatureHelper"):null,this.ngeoQuerent_=o.has("ngeoQuerent")?o.get("ngeoQuerent"):null;var f=o.has("gmfPermalinkOptions")?o.get("gmfPermalinkOptions"):{};if(!0===f.useLocalStorage&&this.ngeoStateManager_.setUseLocalStorage(!0),this.crosshairEnabledByDefault_=!!f.crosshairEnabledByDefault,this.gmfExternalDataSourcesManager_=o.has("gmfExternalDataSourcesManager")?o.get("gmfExternalDataSourcesManager"):null,this.gmfThemes_=o.has("gmfThemes")?o.get("gmfThemes"):null,this.gmfObjectEditingManager_=o.has("gmfObjectEditingManager")?o.get("gmfObjectEditingManager"):null,this.gmfThemeManager_=o.has("gmfThemeManager")?o.get("gmfThemeManager"):null,this.defaultTheme_=o.has("defaultTheme")?o.get("defaultTheme"):void 0,this.gmfTreeManager_=o.has("gmfTreeManager")?o.get("gmfTreeManager"):null,this.ngeoLocation_=c,this.ngeoWfsPermalink_=o.has("ngeoWfsPermalink")?o.get("ngeoWfsPermalink"):null,this.gmfUser_=o.has("gmfUser")?o.get("gmfUser"):null,this.map_=null,this.ngeoAutoProjection_=o.has("ngeoAutoProjection")?o.get("ngeoAutoProjection"):null,this.sourceProjections_=null,void 0!==f.projectionCodes&&this.ngeoAutoProjection_){var m=this.ngeoAutoProjection_.getProjectionList(f.projectionCodes);m.length>0&&(this.sourceProjections_=m)}this.crosshairFeature_=null,this.crosshairStyle_,void 0!==f.crosshairStyle?this.crosshairStyle_=f.crosshairStyle:this.crosshairStyle_=[new L.c({image:new E.a({stroke:new T.a({color:"rgba(255, 255, 255, 0.8)",width:5}),points:4,radius:8,radius2:0,angle:0})}),new L.c({image:new E.a({stroke:new T.a({color:"rgba(255, 0, 0, 1)",width:2}),points:4,radius:8,radius2:0,angle:0})})],this.mapTooltip_=null,this.featureHashFormat_=new h.a({setStyle:!1,encodeStyles:!1,propertiesType:{fillColor:p.a.COLOR,fillOpacity:p.a.OPACITY,fontColor:p.a.COLOR,fontSize:p.a.SIZE,isBox:p.a.IS_RECTANGLE,isCircle:p.a.IS_CIRCLE,isLabel:p.a.IS_TEXT,name:p.a.NAME,pointRadius:p.a.SIZE,showLabel:p.a.SHOW_LABEL,showMeasure:p.a.SHOW_MEASURE,strokeColor:p.a.COLOR,strokeWidth:p.a.STROKE},defaultValues:{name:function(e){return s.getString(e.getGeometry().getType())},fillOpacity:function(){return.5},showLabel:function(){return!1},showMeasure:function(){return!1}}}),this.ngeoBackgroundLayerMgr_&&b.a(this.ngeoBackgroundLayerMgr_,"change",this.handleBackgroundLayerManagerChange_,this),this.rootScope_.$on("ngeo-layertree-state",function(t,r,a){var n={};if(a.node.mixed){var o=r.getState();v.a.assert("on"===o||"off"===o);var i="on"===o;r.traverseDepthFirst(function(t){if(void 0===t.node.children){var r=e.ParamPrefix.TREE_ENABLE+t.node.name;n[r]=i}})}else{var s=[];a.traverseDepthFirst(function(e){void 0===e.node.children&&"on"===e.getState()&&s.push(e.node.name)}),n[e.ParamPrefix.TREE_GROUP_LAYERS+a.node.name]=s.join(",")}g.ngeoStateManager_.updateState(n)}),this.rootScope_.$on("ngeo-layertree-opacity",function(t,r){var a={},n=r.layer.getOpacity();a[(r.parent.node.mixed?e.ParamPrefix.TREE_OPACITY:e.ParamPrefix.TREE_GROUP_OPACITY)+r.node.name]=n,g.ngeoStateManager_.updateState(a)});var y=this.getFeatures();this.ngeoFeatures_&&(y.forEach(function(e){g.featureHelper_&&g.featureHelper_.setStyle(e),g.addNgeoFeature_(e)}),this.ngeoFeatures_.extend(y),b.a(this.ngeoFeatures_,"add",this.handleNgeoFeaturesAdd_,this),b.a(this.ngeoFeatures_,"remove",this.handleNgeoFeaturesRemove_,this)),this.featureHelper_&&this.rootScope_.$on("$localeChangeSuccess",function(){y.forEach(function(e){g.featureHelper_.setStyle(e)})}),this.gmfThemeManager_&&this.rootScope_.$on(n.a.EventType.THEME_NAME_SET,function(e,t){g.setThemeInUrl_(t)}),this.setExternalDataSourcesStatePromise_=null,this.ngeoQuerent_&&this.gmfExternalDataSourcesManager_&&this.initExternalDataSources_().then(function(){b.a(g.gmfExternalDataSourcesManager_.wmsGroupsCollection,"add",g.handleExternalDSGroupCollectionAdd_,g),b.a(g.gmfExternalDataSourcesManager_.wmsGroupsCollection,"remove",g.handleExternalDSGroupCollectionRemove_,g),b.a(g.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"add",g.handleExternalDSGroupCollectionAdd_,g),b.a(g.gmfExternalDataSourcesManager_.wmtsGroupsCollection,"remove",g.handleExternalDSGroupCollectionRemove_,g);var e=g.gmfExternalDataSourcesManager_.wmsGroups,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;g.registerExternalDSGroup_(n)}var o=g.gmfExternalDataSourcesManager_.wmtsGroups,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var u=l;g.registerExternalDSGroup_(u)}}),this.initLayers_()};A.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation"],A.$inject=["$q","$timeout","$rootScope","$injector","ngeoDebounce","gettextCatalog","ngeoEventHelper","ngeoStateManager","ngeoLocation"],A.prototype.getMapCenter=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a.a.PermalinkParam.MAP_X),t=this.ngeoStateManager_.getInitialNumberValue(a.a.PermalinkParam.MAP_Y);if(!isNaN(e)&&!isNaN(t)){var r=[e,t];if(null!==this.sourceProjections_&&this.ngeoAutoProjection_){var n=this.map_.getView().getProjection(),o=this.ngeoAutoProjection_.tryProjectionsWithInversion(r,n.getExtent(),n,this.sourceProjections_);if(o)return o}return r}return null},A.prototype.getMapZoom=function(){var e=this.ngeoStateManager_.getInitialNumberValue(a.a.PermalinkParam.MAP_Z);return isNaN(e)?void 0:e},A.prototype.getMapCrosshair=function(){var e=this.ngeoStateManager_.getInitialBooleanValue(a.a.PermalinkParam.MAP_CROSSHAIR);return void 0===e?this.crosshairEnabledByDefault_:e},A.prototype.setMapCrosshair=function(e){var t=void 0;t=e||this.map_.getView().getCenter(),v.a.assertArray(t),this.crosshairFeature_&&this.featureOverlay_.removeFeature(this.crosshairFeature_),this.crosshairFeature_=new w.a(new C.a(t)),this.crosshairFeature_.setStyle(this.crosshairStyle_),this.featureOverlay_.addFeature(this.crosshairFeature_)},A.prototype.getMapTooltip=function(){return this.ngeoStateManager_.getInitialStringValue(a.a.PermalinkParam.MAP_TOOLTIP)},A.prototype.setMapTooltip=function(t,r){var a=void 0;a=r||this.map_.getView().getCenter(),v.a.assertArray(a);var n=e("<div/>",{class:"gmf-permalink-tooltip",text:t})[0];null!==this.mapTooltip_&&this.map_.removeOverlay(this.mapTooltip_),this.mapTooltip_=new i.a({element:n,position:a}),this.map_.addOverlay(this.mapTooltip_)},A.prototype.getFeatures=function(){var e=this.ngeoStateManager_.getInitialStringValue(a.a.PermalinkParam.FEATURES);return void 0!==e&&""!==e?v.a.assert(this.featureHashFormat_.readFeatures(e)):[]},A.prototype.setDimensions=function(e){for(var t=this,r=this.ngeoLocation_.getParamKeysWithPrefix(A.ParamPrefix.DIMENSIONS),a=0;a<r.length;a++){var n=r[a],o=this.ngeoLocation_.getParam(n);v.a.assert(o),e[n.slice(A.ParamPrefix.DIMENSIONS.length)]=o}this.rootScope_.$watchCollection(function(){return e},function(e){var r={};for(var a in e)r[A.ParamPrefix.DIMENSIONS+a]=e[a];t.ngeoLocation_.updateParams(r)})},A.prototype.setMap=function(e){var t=this;e!==this.map_&&(this.map_&&(this.unregisterMap_(),this.map_=null),e&&(this.map_=e,this.gmfObjectEditingManager_?this.gmfObjectEditingManager_.getFeature().then(function(r){t.registerMap_(e,r)}):this.registerMap_(e,null)))},A.prototype.registerMap_=function(e,t){var r=this,n=e.getView(),o=void 0;if(t&&t.getGeometry()){var i=e.getSize();v.a.assert(i),n.fit(t.getGeometry().getExtent(),i)}else{if(!this.ngeoStateManager_.getInitialBooleanValue(c.a.Permalink3dParam.ENABLED)){(o=this.getMapCenter())&&n.setCenter(o);var s=this.getMapZoom();void 0!==s&&n.setZoom(s)}}this.mapViewPropertyChangeEventKey_=b.a(n,"propertychange",this.ngeoDebounce_(function(){var e=n.getCenter(),t=n.getZoom(),o={};o[a.a.PermalinkParam.MAP_X]=Math.round(e[0]),o[a.a.PermalinkParam.MAP_Y]=Math.round(e[1]),o[a.a.PermalinkParam.MAP_Z]=t,r.ngeoStateManager_.updateState(o)},300,!0),this),this.getMapCrosshair()&&this.featureOverlay_&&this.setMapCrosshair(o);var l=this.getMapTooltip();l&&this.setMapTooltip(l,o);var u=this.getWfsPermalinkData_();null!==u&&this.ngeoWfsPermalink_&&this.ngeoWfsPermalink_.issue(u,e)},A.prototype.unregisterMap_=function(){v.a.assert(this.mapViewPropertyChangeEventKey_,"Key should be thruthy"),b.e(this.mapViewPropertyChangeEventKey_),this.mapViewPropertyChangeEventKey_=null},A.prototype.getBackgroundLayer=function(e){var t=this.ngeoStateManager_.getInitialStringValue(a.a.PermalinkParam.BG_LAYER);if(void 0!==t){var r=e,n=Array.isArray(r),o=0;for(r=n?r:r[Symbol.iterator]();;){var i;if(n){if(o>=r.length)break;i=r[o++]}else{if((o=r.next()).done)break;i=o.value}var s=i;if(s.get("label")===t)return s}}return null},A.prototype.handleBackgroundLayerManagerChange_=function(){if(this.map_&&this.ngeoBackgroundLayerMgr_){var e=this.ngeoBackgroundLayerMgr_.get(this.map_).get("label");v.a.assertString(e);var t={};t[a.a.PermalinkParam.BG_LAYER]=e,this.ngeoStateManager_.updateState(t)}},A.prototype.refreshFirstLevelGroups=function(){if(this.gmfTreeManager_){var e=this.gmfTreeManager_.rootCtrl.node.children.map(function(e){return e.name}),t={};t[a.a.PermalinkParam.TREE_GROUPS]=e.join(","),this.ngeoStateManager_.updateState(t)}},A.prototype.themeInUrl_=function(e){var t=e.indexOf("theme");return-1!=t&&t==e.length-2},A.prototype.setThemeInUrl_=function(e){if(e){var t=this.ngeoLocation_.getPath().split("/");v.a.assert(t.length>1),""===t[t.length-1]&&t.splice(t.length-1),this.themeInUrl_(t)?t[t.length-1]=e:t.push("theme",e),this.ngeoLocation_.setPath(t.join("/"))}},A.prototype.defaultThemeName=function(){var e=this.ngeoLocation_.getPath().split("/");if(this.themeInUrl_(e))return decodeURI(e[e.length-1]);var t=this.ngeoStateManager_.getInitialStringValue("theme");if(t)return t;var r=this.defaultThemeNameFromFunctionalities();return null!==r?r:this.defaultTheme_?this.defaultTheme_:null},A.prototype.defaultThemeNameFromFunctionalities=function(){if(!this.gmfUser_)return null;var e=this.gmfUser_.functionalities;if(e&&"default_theme"in e){var t=e.default_theme;if(t.length>0)return t[0]}return null},A.prototype.initLayers_=function(){var e=this;this.gmfThemes_&&this.gmfThemes_.getThemesObject().then(function(t){var r=e.defaultThemeName();v.a.assert(null!==r),e.gmfThemeManager_&&e.gmfThemeManager_.setThemeName(e.gmfThemeManager_.modeFlush?r:"");var n=[],i=void 0,s=e.ngeoLocation_.getParam(a.a.PermalinkParam.TREE_GROUPS);void 0===s?(v.a.assertString(r),(i=o.a.findThemeByName(t,r))&&(n=i.children)):s.split(",").forEach(function(e){var r=o.a.findGroupByName(t,e);r&&n.push(r)}),e.gmfTreeManager_&&e.gmfTreeManager_.setFirstLevelGroups(n),e.$timeout_(function(){e.gmfTreeManager_&&e.gmfTreeManager_.rootCtrl&&(e.gmfTreeManager_.rootCtrl.traverseDepthFirst(function(t){if(!t.isRoot){var r=e.ngeoStateManager_.getInitialNumberValue((t.parent.node.mixed?A.ParamPrefix.TREE_OPACITY:A.ParamPrefix.TREE_GROUP_OPACITY)+t.node.name);if(void 0!==r&&t.layer&&t.layer.setOpacity(r),t.parent.node&&t.parent.node.mixed&&void 0==t.node.children){var a=e.ngeoStateManager_.getInitialBooleanValue(A.ParamPrefix.TREE_ENABLE+t.node.name);void 0!==a&&t.setState(a?"on":"off",!1)}else if(!t.node.mixed&&1==t.depth){var n=e.ngeoStateManager_.getInitialStringValue(A.ParamPrefix.TREE_GROUP_LAYERS+t.node.name);if(void 0!==n){var o=n.split(",");t.traverseDepthFirst(function(e){if(void 0===e.node.children){var t=S.f(o,e.node.name);e.setState(t?"on":"off",!1)}})}}}}),e.gmfTreeManager_.rootCtrl.children.forEach(function(t){t.traverseDepthFirst(function(r){if("indeterminate"!==r.getState())return e.rootScope_.$broadcast("ngeo-layertree-state",r,t),y.a.VisitorDecision.STOP})}))})})},A.prototype.handleNgeoFeaturesAdd_=function(e){var t=e.element;v.a.assertInstanceof(t,w.a),this.addNgeoFeature_(t)},A.prototype.handleNgeoFeaturesRemove_=function(e){var t=e.element;v.a.assertInstanceof(t,w.a),this.removeNgeoFeature_(t)},A.prototype.addNgeoFeature_=function(e){var t=_.c(e);this.ngeoEventHelper_.addListenerKey(t,b.a(e,"change",this.ngeoDebounce_(this.handleNgeoFeaturesChange_,250,!0),this))},A.prototype.removeNgeoFeature_=function(e){var t=_.c(e);this.ngeoEventHelper_.clearListenerKey(t),this.handleNgeoFeaturesChange_()},A.prototype.handleNgeoFeaturesChange_=function(){if(this.ngeoFeatures_){var e=this.ngeoFeatures_.getArray(),t=this.featureHashFormat_.writeFeatures(e),r={};r[a.a.PermalinkParam.FEATURES]=t,this.ngeoStateManager_.updateState(r)}},A.prototype.getWfsPermalinkData_=function(){var e=this.ngeoLocation_.getParam(a.a.PermalinkParam.WFS_LAYER);if(!e)return null;var t=this.ngeoLocation_.getParamAsInt(a.a.PermalinkParam.WFS_NGROUPS),r=this.ngeoLocation_.getParamKeysWithPrefix(A.ParamPrefix.WFS),n=[],o=void 0;if(void 0===t)null!==(o=this.createFilterGroup_(A.ParamPrefix.WFS,r))&&n.push(o);else for(var i=0;i<t;i++)null!==(o=this.createFilterGroup_(A.ParamPrefix.WFS+i+"_",r))&&n.push(o);if(0==n.length)return null;var s=this.ngeoLocation_.getParam(a.a.PermalinkParam.WFS_SHOW_FEATURES);return{wfsType:e,showFeatures:!("0"===s||"false"===s),filterGroups:n}},A.prototype.createFilterGroup_=function(e,t){var r=this,n=[];return t.forEach(function(t){if(t!=a.a.PermalinkParam.WFS_LAYER&&t!=a.a.PermalinkParam.WFS_SHOW_FEATURES&&t!=a.a.PermalinkParam.WFS_NGROUPS&&0==t.indexOf(e)){var o=r.ngeoLocation_.getParam(t);if(o){var i=o;o.indexOf(",")>-1&&(i=o.split(","));var s={property:t.replace(e,""),condition:i};n.push(s)}}}),n.length>0?{filters:n}:null},A.prototype.initExternalDataSources_=function(){var e=this,t=v.a.assert(this.ngeoQuerent_),r=v.a.assert(this.gmfExternalDataSourcesManager_),n=[],o=this.ngeoStateManager_.getInitialValue(a.a.PermalinkParam.EXTERNAL_DATASOURCES_NAMES),i=this.ngeoStateManager_.getInitialValue(a.a.PermalinkParam.EXTERNAL_DATASOURCES_URLS);if(o&&i)for(var s=o.split(A.ExtDSSeparator.LIST),l=i.split(A.ExtDSSeparator.LIST),c=function(r,a){var o=s[r];if(!o)return"break";var i=o.split(A.ExtDSSeparator.NAMES),c=l[r],h=u.a.guessServiceTypeByUrl(c),p=e.q_.defer();n.push(p.promise),h===u.a.Type.WMS?t.wmsGetCapabilities(c).then(function(e){p.resolve({capabilities:e,groupLayerNames:i,serviceType:h,url:c})},function(){p.reject({groupLayerNames:i,serviceType:h,url:c})}):h===u.a.Type.WMTS?t.wmtsGetCapabilities(c).then(function(e){p.resolve({capabilities:e,groupLayerNames:i,serviceType:h,url:c})},function(){p.reject({groupLayerNames:i,serviceType:h,url:c})}):p.reject({groupLayerNames:i,serviceType:h,url:c})},h=0,p=l.length;h<p;h++){if("break"===c(h))break}return this.q_.all(n).then(function(e){var a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.serviceType===u.a.Type.WMS){var l=s.groupLayerNames,c=Array.isArray(l),h=0;for(l=c?l:l[Symbol.iterator]();;){var p;if(c){if(h>=l.length)break;p=l[h++]}else{if((h=l.next()).done)break;p=h.value}var g=p,d=t.wmsFindLayerCapability(s.capabilities.Capability.Layer.Layer,g);d&&r.createAndAddDataSourceFromWMSCapability(d,s.capabilities,s.url)}}else if(s.serviceType===u.a.Type.WMTS){var f=s.groupLayerNames,m=Array.isArray(f),y=0;for(f=m?f:f[Symbol.iterator]();;){var v;if(m){if(y>=f.length)break;v=f[y++]}else{if((y=f.next()).done)break;v=y.value}var _=v,S=t.wmtsFindLayerCapability(s.capabilities.Contents.Layer,_);S&&r.createAndAddDataSourceFromWMTSCapability(S,s.capabilities,s.url)}}}},function(e){})},A.prototype.handleExternalDSGroupCollectionAdd_=function(e){var t=e.element;v.a.assertInstanceof(t,l.a),this.registerExternalDSGroup_(t),this.setExternalDataSourcesState_()},A.prototype.registerExternalDSGroup_=function(e){b.a(e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this),b.a(e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)},A.prototype.containsLayerName=function(e,t){if(e instanceof M.a){var r=e.getLayers().getArray(),a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(v.a.assert(i),this.containsLayerName(i,t))return!0}return!1}return e.get("layerNodeName")==t},A.prototype.handleExternalDSGroupCollectionRemove_=function(e){var t=e.element;v.a.assertInstanceof(t,l.a),this.unregisterExternalDSGroup_(t),this.setExternalDataSourcesState_()},A.prototype.unregisterExternalDSGroup_=function(e){b.c(e.dataSourcesCollection,"add",this.setExternalDataSourcesState_,this),b.c(e.dataSourcesCollection,"remove",this.setExternalDataSourcesState_,this)},A.prototype.setExternalDataSourcesState_=function(){var e=this;this.setExternalDataSourcesStatePromise_&&this.$timeout_.cancel(this.setExternalDataSourcesStatePromise_),this.setExternalDataSourcesStatePromise_=this.$timeout_(function(){var t,r=[],n=[],o=e.gmfExternalDataSourcesManager_.wmsGroups,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var c=l;n.push(c.url);var h=[],p=c.dataSources,g=Array.isArray(p),d=0;for(p=g?p:p[Symbol.iterator]();;){var f;if(g){if(d>=p.length)break;f=p[d++]}else{if((d=p.next()).done)break;f=d.value}var m=f;v.a.assertInstanceof(m,u.a);var y=m.getOGCLayerNames()[0];h.push(y)}r.push(h.join(A.ExtDSSeparator.NAMES))}var _=e.gmfExternalDataSourcesManager_.wmtsGroups,S=Array.isArray(_),b=0;for(_=S?_:_[Symbol.iterator]();;){var w;if(S){if(b>=_.length)break;w=_[b++]}else{if((b=_.next()).done)break;w=b.value}var C=w;n.push(C.url);var T=[],E=C.dataSources,L=Array.isArray(E),M=0;for(E=L?E:E[Symbol.iterator]();;){var F;if(L){if(M>=E.length)break;F=E[M++]}else{if((M=E.next()).done)break;F=M.value}var P=F;v.a.assert(P.wmtsLayer),T.push(P.wmtsLayer)}r.push(T.join(A.ExtDSSeparator.NAMES))}e.ngeoStateManager_.updateState(((t={})[a.a.PermalinkParam.EXTERNAL_DATASOURCES_NAMES]=r.join(A.ExtDSSeparator.LIST),t[a.a.PermalinkParam.EXTERNAL_DATASOURCES_URLS]=n.join(A.ExtDSSeparator.LIST),t)),e.setExternalDataSourcesStatePromise_=null})},A.prototype.cleanParams=function(e){var t=this,r=v.a.assert(this.ngeoLocation_.getParamKeys()),a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.startsWith(A.ParamPrefix.TREE_GROUP_LAYERS)){var l=s.substring(A.ParamPrefix.TREE_GROUP_LAYERS.length),u=e,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}if(p.name==l){this.ngeoStateManager_.deleteParam(s);break}}}if(s.startsWith(A.ParamPrefix.TREE_GROUP_OPACITY)){var g=s.substring(A.ParamPrefix.TREE_GROUP_OPACITY.length),d=e,f=Array.isArray(d),m=0;for(d=f?d:d[Symbol.iterator]();;){var y;if(f){if(m>=d.length)break;y=d[m++]}else{if((m=d.next()).done)break;y=m.value}if(y.name==g){this.ngeoStateManager_.deleteParam(s);break}}}}this.$timeout_(function(){if(t.map_){var e=t.map_.getLayerGroup();v.a.assert(e);var a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.startsWith(A.ParamPrefix.TREE_ENABLE)){var l=s.substring(A.ParamPrefix.TREE_ENABLE.length);t.containsLayerName(e,l)||t.ngeoStateManager_.deleteParam(s)}if(s.startsWith(A.ParamPrefix.TREE_OPACITY)){var u=s.substring(A.ParamPrefix.TREE_OPACITY.length);t.containsLayerName(e,u)||t.ngeoStateManager_.deleteParam(s)}}}})},(A.module=angular.module("gmfPermalink",[n.a.module.name,o.a.module.name,s.a.name,y.a.module.name,g.a.name,d.a.module.name,f.a.name])).service("gmfPermalink",A),A.OpenLayersLayerProperties={OPACITY:"opacity"},A.ParamPrefix={DIMENSIONS:"dim_",TREE_ENABLE:"tree_enable_",TREE_GROUP_LAYERS:"tree_group_layers_",TREE_GROUP_OPACITY:"tree_group_opacity_",TREE_OPACITY:"tree_opacity_",WFS:"wfs_"},A.ExtDSSeparator={LIST:",",NAMES:";"},A.module.value("gmfPermalinkOptions",{}),function(){var e=[];for(var t in A.ParamPrefix)e.push(new RegExp(A.ParamPrefix[t]+".*"));for(var r in a.a.PermalinkParam)e.push(new RegExp(A.ParamPrefix[r]));m.a.module.value("ngeoUsedKeyRegexp",e)}(),t.a=A}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var a=r(1),n=r(133),o=(r(341),r(405),r(340),r(339),r(338),r(337),angular.module("ngeoDatePicker",[n.a.module.name,"ui.date"]));o.value("ngeoDatePickerTemplateUrl",function(e,t){var r=t.ngeoDatePickerTemplateUrl;return void 0!==r?r:"ngeo/misc/datepickerComponent"}),o.run(["$templateCache",function(e){e.put("ngeo/misc/datepickerComponent",r(336))}]),o.component_=function(t,r){return{scope:{onDateSelected:"&",time:"="},bindToController:!0,controller:"ngeoDatePickerController as datepickerCtrl",restrict:"AE",templateUrl:t,link:function(t,a,n,o){o.init();var i=o.gettextCatalog_.getCurrentLanguage();e.datepicker.setDefaults(e.datepicker.regional[i]),o.sdateOptions=angular.extend({},o.sdateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function(t){t&&e(a[0]).find('input[name="edate"]').datepicker("option","minDate",t)}}),o.edateOptions=angular.extend({},o.edateOptions,{minDate:o.initialMinDate,maxDate:o.initialMaxDate,onClose:function(t){t&&e(a[0]).find('input[name="sdate"]').datepicker("option","maxDate",t)}}),angular.element("body").on("hidden.bs.popover",function(){var t=angular.element("#ui-datepicker-div");t&&"block"===t.css("display")&&e(a[0]).find('input[name$="date"]').datepicker("hide")}),r(function(){angular.element("#ui-datepicker-div").on("mousedown",function(e){e.stopPropagation()})})}}},o.component_.$inject=["ngeoDatePickerTemplateUrl","$timeout"],o.directive("ngeoDatePicker",o.component_),o.Controller_=function(e,t,r,a){var n=this;this.ngeoTime_=r,this.time,this.gettextCatalog_=a,this.isModeRange,this.onDateSelected,this.initialMinDate,this.initialMaxDate,this.edateOptions={changeMonth:!0,changeYear:!0},this.sdateOptions={changeMonth:!0,changeYear:!0},this.sdate,this.edate,e.$watchGroup(["datepickerCtrl.sdate","datepickerCtrl.edate"],function(e,t){var r=e[0],a=e[1];!angular.isDate(r)||n.isModeRange&&!angular.isDate(a)||n.onDateSelected({time:{start:n.ngeoTime_.getTime(r),end:n.ngeoTime_.getTime(a)}})})},o.Controller_.$inject=["$scope","$injector","ngeoTime","gettextCatalog"],o.Controller_.prototype.init=function(){var e=this.ngeoTime_.getOptions(this.time);this.initialMinDate=this.ngeoTime_.createDate(e.minDate),this.initialMaxDate=this.ngeoTime_.createDate(e.maxDate),this.isModeRange="range"===this.time.mode,this.isModeRange?(a.a.assertArray(e.values),this.sdate=this.ngeoTime_.createDate(e.values[0]),this.edate=this.ngeoTime_.createDate(e.values[1])):(a.a.assertNumber(e.values),this.sdate=this.ngeoTime_.createDate(e.values))},o.controller("ngeoDatePickerController",o.Controller_),t.a=o}).call(this,r(33))},function(e,t,r){"use strict";var a=r(36),n=angular.module("ngeoFeatures",[]);n.value("ngeoFeatures",new a.b),t.a=n},,,,,function(e,t,r){"use strict";var a=function(e,t,r){var a=void 0,n=void 0;this.isValidFileSize=function(e){return!(e>2e7)},this.isWmsGetCap=function(e){return/<(WMT_MS_Capabilities|WMS_Capabilities)/.test(e)},this.isWmtsGetCap=function(e){return/<Capabilities/.test(e)},this.isKml=function(e){return/<kml/.test(e)&&/<\/kml>/.test(e)},this.isGpx=function(e){return/<gpx/.test(e)&&/<\/gpx>/.test(e)},this.read=function(t){var n=e.defer();return a&&a.readyState===FileReader.LOADING&&a.abort(),(a=new FileReader).onload=function(e){n.resolve(e.target.result)},a.onerror=function(e){var t=e.target.error;console.error("Reading file failed: ",t),n.reject({message:20==t.code?r("Operation canceled"):r("Read failed"),reason:t.message})},a.onprogress=function(e){n.notify(e)},a.readAsText(t),n.promise},this.load=function(a,o){n&&n.resolve(),n=o||e.defer();var i=e.defer();return t.get(a,{timeout:n.promise}).then(function(e){i.resolve(e.data)},function(e){console.error("Uploading file failed: ",e),i.reject({message:r("Upload failed"),reason:e})}),i.promise}};a.$inject=["$q","$http","gettext"],a.$inject=["$q","$http","gettext"],(a.module=angular.module("ngeoFile",[])).service("ngeoFile",a),t.a=a},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,r){"use strict";var a=r(1),n=r(26),o={LINE_STRING:"LineString",POINT:"Point",POLYGON:"Polygon"},i=r(78),s=r(2),l=r(30),u=r(107),c=r(8),h=r(68),p=r(276),g=r(17),d=r(53),f=r(105),m=r(116),y=r(115),v=r(41),_=r(45),S=r(106),b=r(55),w=r(46),C=r(16),T=r(171),E=function e(t){p.a.call(this);var r=void 0!==t?t:{};this.accuracy_=void 0!==r.accuracy?r.accuracy:e.ACCURACY_,this.encodeStyles_=void 0===r.encodeStyles||r.encodeStyles,this.propertiesFunction_=void 0!==r.properties?r.properties:e.defaultPropertiesFunction_,this.setStyle_=void 0===r.setStyle||r.setStyle,this.prevX_=0,this.prevY_=0,e.LegacyProperties_=void 0!==r.propertiesType&&r.propertiesType,this.defaultValues_=void 0!==r.defaultValues?r.defaultValues:{}};s.d(E,p.a),E.StyleTypes_={LineString:o.LINE_STRING,Point:o.POINT,Polygon:o.POLYGON,MultiLineString:o.LINE_STRING,MultiPoint:o.POINT,MultiPolygon:o.POLYGON},E.LegacyProperties_={},E.prototype.readFeature,E.prototype.readFeatures,E.prototype.readGeometry,E.prototype.writeFeature,E.prototype.writeFeatures,E.prototype.writeGeometry,E.CHAR64_=".-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz",E.ACCURACY_=.1,E.defaultPropertiesFunction_=function(e){return e.getProperties()},E.encodeSignedNumber_=function(e){var t=e<<1;return e<0&&(t=~t),E.encodeNumber_(t)},E.encodeNumber_=function(e){for(var t="";e>=32;)t+=E.CHAR64_.charAt(32|31&e),e>>=5;return t+=E.CHAR64_.charAt(e)},E.encodeStyles_=function(e,t,r){var n=E.StyleTypes_[t];a.a.assert(void 0!==n);for(var i=0;i<e.length;++i){var s=e[i],l=s.getFill(),u=s.getImage(),c=s.getStroke(),h=s.getText();n==o.POLYGON?null!==l&&E.encodeStylePolygon_(l,c,r):n==o.LINE_STRING?null!==c&&E.encodeStyleLine_(c,r):n==o.POINT&&null!==u&&E.encodeStylePoint_(u,r),null!==h&&E.encodeStyleText_(h,r)}},E.encodeStyleLine_=function(e,t){E.encodeStyleStroke_(e,t)},E.encodeStylePoint_=function(e,t){if(e instanceof S.a){var r=e.getRadius();t.length>0&&t.push("'"),t.push(encodeURIComponent("pointRadius*"+r));var a=e.getFill();null!==a&&E.encodeStyleFill_(a,t);var n=e.getStroke();null!==n&&E.encodeStyleStroke_(n,t)}},E.encodeStylePolygon_=function(e,t,r){E.encodeStyleFill_(e,r),null!==t&&E.encodeStyleStroke_(t,r)},E.encodeStyleFill_=function(e,t,r){var n=void 0!==r?r:"fillColor",o=e.getColor();if(null!==o){a.a.assert(Array.isArray(o),"only supporting fill colors");var s=u.a(o);a.a.assert(Array.isArray(s),"fill color must be an array");var l=i.a.rgbArrayToHex(s);t.length>0&&t.push("'"),t.push(encodeURIComponent(n+"*"+l))}},E.encodeStyleStroke_=function(e,t){var r=e.getColor();if(null!==r){a.a.assert(Array.isArray(r));var n=u.a(r);a.a.assert(Array.isArray(n),"only supporting stroke colors");var o=i.a.rgbArrayToHex(n);t.length>0&&t.push("'"),t.push(encodeURIComponent("strokeColor*"+o))}var s=e.getWidth();void 0!==s&&(t.length>0&&t.push("'"),t.push(encodeURIComponent("strokeWidth*"+s)))},E.encodeStyleText_=function(e,t){var r=e.getFont();if(void 0!==r){var a=r.split(" ");a.length>=3&&(t.length>0&&t.push("'"),t.push(encodeURIComponent("fontSize*"+a[1])))}var n=e.getFill();null!==n&&E.encodeStyleFill_(n,t,"fontColor")},E.readLineStringGeometry_=function(e){a.a.assert("l("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]),e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e),r=new d.a(null);return r.setFlatCoordinates(g.a.XY,t),r},E.readMultiLineStringGeometry_=function(e){a.a.assert("L("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]);for(var t=[],r=[],n=(e=e.substring(2,e.length-1)).split("'"),o=0,i=n.length;o<i;++o)t=this.decodeCoordinates_(n[o],t),r[o]=t.length;var s=new f.a(null);return s.setFlatCoordinates(g.a.XY,t,r),s},E.readPointGeometry_=function(e){a.a.assert("p("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]),e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e);a.a.assert(2===t.length);var r=new v.a(null);return r.setFlatCoordinates(g.a.XY,t),r},E.readMultiPointGeometry_=function(e){a.a.assert("P("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]),e=e.substring(2,e.length-1);var t=this.decodeCoordinates_(e),r=new m.a(null);return r.setFlatCoordinates(g.a.XY,t),r},E.readPolygonGeometry_=function(e){a.a.assert("a("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]);for(var t=[],r=[],n=(e=e.substring(2,e.length-1)).split("'"),o=0,i=n.length;o<i;++o){var s=(t=this.decodeCoordinates_(n[o],t)).length;0===o?(t[s++]=t[0],t[s++]=t[1]):(t[s++]=t[r[o-1]],t[s++]=t[r[o-1]+1]),r[o]=s}var l=new _.b(null);return l.setFlatCoordinates(g.a.XY,t,r),l},E.readMultiPolygonGeometry_=function(e){a.a.assert("A("===e.substring(0,2)),a.a.assert(")"==e[e.length-1]);for(var t=[],r=[],n=(e=e.substring(2,e.length-1)).split(")("),o=0,i=n.length;o<i;++o)for(var s=n[o].split("'"),l=r[o]=[],u=0,c=s.length;u<c;++u){var h=(t=this.decodeCoordinates_(s[u],t)).length;0===u?(t[h++]=t[0],t[h++]=t[1]):(t[h++]=t[l[u-1]],t[h++]=t[l[u-1]+1]),l[u]=h}var p=new y.a(null);return p.setFlatCoordinates(g.a.XY,t,r),p},E.setStyleInFeature_=function(e,t){if(""!=e){var r=E.getStyleProperties_(e,t),a=r.fillColor,n=r.fontSize,o=r.fontColor,i=r.pointRadius,s=r.strokeColor,l=r.strokeWidth,u=null;void 0!==a&&(u=new b.a({color:a}));var c=null;void 0!==s&&void 0!==l&&(c=new w.a({color:s,width:l}));var h=null;void 0!==i&&(h=new S.a({radius:i,fill:u,stroke:c}),u=c=null);var p=null;void 0!==n&&void 0!==o&&(p=new T.a({font:n+" sans-serif",fill:new b.a({color:o})}));var g=new C.c({fill:u,image:h,stroke:c,text:p});t.setStyle(g)}},E.setStyleProperties_=function(e,t){var r=E.getStyleProperties_(e,t),a=t.getGeometry();if(a instanceof v.a?r.isLabel||r[n.a.IS_TEXT]?(delete r.strokeColor,delete r.fillColor):(delete r.fontColor,delete r.fontSize):(delete r.fontColor,a instanceof d.a&&(delete r.fillColor,delete r.fillOpacity)),r.fontSize){var o=parseFloat(r.fontSize);-1!==r.fontSize.indexOf("px")&&(o=Math.round(o/1.333333)),r.fontSize=o}var i={};for(var s in r){var l=r[s];E.LegacyProperties_[s]?i[E.LegacyProperties_[s]]=l:i[s]=l}t.setProperties(i)},E.castValue_=function(e,t){var r=[n.a.ANGLE,n.a.OPACITY,n.a.SIZE,n.a.STROKE,"pointRadius","strokeWidth"],a=[n.a.IS_CIRCLE,n.a.IS_RECTANGLE,n.a.IS_TEXT,n.a.SHOW_MEASURE,n.a.SHOW_LABEL,"isCircle","isRectangle","isLabel","showMeasure","showLabel"];return c.f(r,e)?+t:c.f(a,e)?"true"===t:t},E.getStyleProperties_=function(e,t){for(var r=e.split("'"),n={},o=0;o<r.length;++o){var i=decodeURIComponent(r[o]).split("*");a.a.assert(2===i.length);var s=i[0],l=i[1];n[s]=E.castValue_(s,l)}return n},E.writeLineStringGeometry_=function(e){a.a.assertInstanceof(e,d.a);var t=e.getFlatCoordinates(),r=e.getStride(),n=t.length;return"l("+this.encodeCoordinates_(t,r,0,n)+")"},E.writeMultiLineStringGeometry_=function(e){a.a.assertInstanceof(e,f.a);for(var t=e.getEnds(),r=t.length,n=e.getFlatCoordinates(),o=e.getStride(),i=0,s=["L("],l=0;l<r;++l){var u=t[l],c=this.encodeCoordinates_(n,o,i,u);0!==l&&s.push("'"),s.push(c),i=u}return s.push(")"),s.join("")},E.writePointGeometry_=function(e){a.a.assertInstanceof(e,v.a);var t=e.getFlatCoordinates(),r=e.getStride(),n=t.length;return"p("+this.encodeCoordinates_(t,r,0,n)+")"},E.writeMultiPointGeometry_=function(e){a.a.assertInstanceof(e,m.a);var t=e.getFlatCoordinates(),r=e.getStride(),n=t.length;return"P("+this.encodeCoordinates_(t,r,0,n)+")"},E.encodeRings_=function(e,t,r,a,n){for(var o=a.length,i=0;i<o;++i){var s=a[i]-t,l=this.encodeCoordinates_(e,t,r,s);0!==i&&n.push("'"),n.push(l),r=a[i]}return r},E.writePolygonGeometry_=function(e){a.a.assertInstanceof(e,_.b);var t=e.getFlatCoordinates(),r=e.getStride(),n=e.getEnds(),o=["a("];return E.encodeRings_.call(this,t,r,0,n,o),o.push(")"),o.join("")},E.writeMultiPolygonGeometry_=function(e){a.a.assertInstanceof(e,y.a);for(var t=e.getFlatCoordinates(),r=e.getStride(),n=e.getEndss(),o=n.length,i=0,s=["A"],l=0;l<o;++l){var u=n[l];s.push("("),i=E.encodeRings_.call(this,t,r,i,u,s),s.push(")")}return s.join("")},E.GEOMETRY_READERS_={P:E.readMultiPointGeometry_,L:E.readMultiLineStringGeometry_,A:E.readMultiPolygonGeometry_,l:E.readLineStringGeometry_,p:E.readPointGeometry_,a:E.readPolygonGeometry_},E.GEOMETRY_WRITERS_={MultiLineString:E.writeMultiLineStringGeometry_,MultiPoint:E.writeMultiPointGeometry_,MultiPolygon:E.writeMultiPolygonGeometry_,LineString:E.writeLineStringGeometry_,Point:E.writePointGeometry_,Polygon:E.writePolygonGeometry_},E.prototype.decodeCoordinates_=function(e,t){for(var r=e.length,a=0,n=void 0!==t?t:[],o=n.length;a<r;){var i=void 0,s=0,l=0;do{l|=(31&(i=E.CHAR64_.indexOf(e.charAt(a++))))<<s,s+=5}while(i>=32);var u=1&l?~(l>>1):l>>1;this.prevX_+=u,s=0,l=0;do{l|=(31&(i=E.CHAR64_.indexOf(e.charAt(a++))))<<s,s+=5}while(i>=32);var c=1&l?~(l>>1):l>>1;this.prevY_+=c,n[o++]=this.prevX_*this.accuracy_,n[o++]=this.prevY_*this.accuracy_}return n},E.prototype.encodeCoordinates_=function(e,t,r,a){for(var n="",o=r;o<a;o+=t){var i=e[o],s=e[o+1];i=Math.floor(i/this.accuracy_),s=Math.floor(s/this.accuracy_);var l=i-this.prevX_,u=s-this.prevY_;this.prevX_=i,this.prevY_=s,n+=E.encodeSignedNumber_(l)+E.encodeSignedNumber_(u)}return n},E.prototype.readFeatureFromText=function(e,t){a.a.assert(e.length>2),a.a.assert("("===e[1]),a.a.assert(")"===e[e.length-1]);var r=e.indexOf("~"),n=r>=0?e.substring(0,r)+")":e,o=this.readGeometryFromText(n,t),i=new l.a(o);if(r>=0){var s=e.substring(r+1,e.length-1),u=(r=s.indexOf("~"))>=0?s.substring(0,r):s;if(""!=u)for(var c=u.split("'"),h=0;h<c.length;++h){var p=decodeURIComponent(c[h]).split("*");a.a.assert(2===p.length);var g=p[0],d=p[1];!this.setStyle_&&E.LegacyProperties_[g]&&(g=E.LegacyProperties_[g]),i.set(g,E.castValue_(g,d))}if(r>=0){var f=s.substring(r+1);this.setStyle_?E.setStyleInFeature_(f,i):E.setStyleProperties_(f,i)}}return i},E.prototype.readFeaturesFromText=function(e,t){var r=this;a.a.assert("F"===e[0]),this.prevX_=0,this.prevY_=0;var n=[];for(e=e.substring(1);e.length>0;){var o=e.indexOf(")");a.a.assert(o>=0);var i=this.readFeatureFromText(e.substring(0,o+1),t);n.push(i),e=e.substring(o+1)}return n.forEach(function(e){for(var t in r.defaultValues_){var a=E.LegacyProperties_[t];void 0===e.get(a)&&e.set(a,r.defaultValues_[t].call(null,e))}}),n},E.prototype.readGeometryFromText=function(e,t){var r=E.GEOMETRY_READERS_[e[0]];return a.a.assert(void 0!==r),r.call(this,e)},E.prototype.writeFeatureText=function(e,t){var r=[],n="",o=e.getGeometry();o&&(n=this.writeGeometryText(o,t)),n.length>0&&(a.a.assert(")"===n[n.length-1]),n=n.substring(0,n.length-1),r.push(n));var i=[],s=this.propertiesFunction_(e);for(var l in s){var u=s[l];if(void 0!==u&&null!==u&&l!==e.getGeometryName()){0!==i.length&&i.push("'");var c=encodeURIComponent(l.replace(/[()'*]/g,"_")+"*"+u.toString().replace(/[()'*]/g,"_"));i.push(c)}}if(i.length>0&&(r.push("~"),Array.prototype.push.apply(r,i)),this.encodeStyles_){var h=e.getStyleFunction();if(void 0!==h){var p=h.call(e,0);if(null!==p){var g=[];p=Array.isArray(p)?p:[p],E.encodeStyles_(p,o.getType(),g),g.length>0&&(r.push("~"),Array.prototype.push.apply(r,g))}}}return r.push(")"),r.join("")},E.prototype.writeFeaturesText=function(e,t){this.prevX_=0,this.prevY_=0;var r=[];if(e.length>0){r.push("F");for(var a=0,n=e.length;a<n;++a)r.push(this.writeFeatureText(e[a],t))}return r.join("")},E.prototype.writeGeometryText=function(e,t){var r=E.GEOMETRY_WRITERS_[e.getType()];a.a.assert(void 0!==r);var n=h.b(e,!0,t);return r.call(this,n)};t.a=E},function(e,t,r){"use strict";var a=function e(){return{restrict:"A",link:function(t,r,a){var n=a.ngeoSearch,o=t.$eval(n),i=a.ngeoSearchDatasets,s=t.$eval(i).slice();s.unshift(o),r.typeahead.apply(r,s);var l=a.ngeoSearchListeners,u=t.$eval(l),c=e.adaptListeners_(u);r.on("typeahead:open",function(){t.$apply(function(){c.open()})}),r.on("typeahead:close",function(){t.$apply(function(){c.close()})}),r.on("typeahead:cursorchange",function(e,r,a){t.$apply(function(){c.cursorchange(e,r,a)})}),r.on("typeahead:select",function(e,r,a){t.$apply(function(){c.select(e,r,a)})}),r.on("typeahead:autocomplete",function(e,r,a){t.$apply(function(){c.autocomplete(e,r,a)})}),r.on("typeahead:asyncreceive",function(e,a,n){t.$apply(function(){var t=r.data("tt-typeahead").menu._allDatasetsEmpty();c.datasetsempty(e,n,t)})})}}};a.adaptListeners_=function(e){return void 0===e?{open:function(){},close:function(){},cursorchange:function(){},datasetsempty:function(){},select:function(){},autocomplete:function(){}}:{open:void 0!==e.open?e.open:function(){},close:void 0!==e.close?e.close:function(){},cursorchange:void 0!==e.cursorchange?e.cursorchange:function(){},datasetsempty:void 0!==e.datasetsempty?e.datasetsempty:function(){},select:void 0!==e.select?e.select:function(){},autocomplete:void 0!==e.autocomplete?e.autocomplete:function(){}}},(a.module=angular.module("ngeoSearchDirective",[])).directive("ngeoSearch",a);var n=a,o=r(231),i=r(11),s=(r(241),function(e,t,r,a,n,s){var l=new o.a,u={remote:{url:e,prepare:function(e,t){return t.url=t.url.replace("%QUERY",e),t},transform:function(e){var n=e;return void 0!==t&&(n={type:"FeatureCollection",features:n.features.filter(t)}),l.readFeatures(n,{featureProjection:r,dataProjection:a})}},datumTokenizer:function(){},queryTokenizer:Bloodhound.tokenizers.whitespace},c=i.a({},n||{}),h=i.a({},s||{});return c.remote&&(i.a(h,c.remote),delete c.remote),i.a(u,c),i.a(u.remote,h),new Bloodhound(u)});(s.module=angular.module("ngeoSearchCreategeojsonbloodhound",[])).value("ngeoSearchCreateGeoJSONBloodhound",s);var l=s,u=r(10),c=r(202),h=r(41),p=r(30),g=function(e){var t=e||{},r=u.f(c.a),a=t.targetProjection,n={remote:{url:"https://api3.geo.admin.ch/rest/services/api/SearchServer?type=locations&searchText=%QUERY",prepare:function(e,r){return r.url=r.url.replace("%QUERY",e),void 0!==t.limit&&(r.url+="&limit="+t.limit),void 0!==t.origins&&(r.url+="&origins="+t.origins),void 0!==t.prepare?t.prepare(e,r):r},transform:function(e){return e.results.map(function(e){var t=e.attrs,n=new h.a([t.y,t.x]),o=function(e){var t=/BOX\((.*?) (.*?),(.*?) (.*?)\)/g.exec(e);return null!==t?[parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3]),parseFloat(t[4])]:null}(t.geom_st_box2d);void 0!==a&&(n.transform(r,a),null!==o&&(o=u.l(o,r,a))),t.geometry=n,t.bbox=o;var i=t.label;t.label_no_html=function(e){return e.replace(/<\/?[ib]>/g,"")}(i),t.label_simple=function(e){var t=/<b>(.*?)<\/b>/g.exec(e);return null!==t?t[1]:e}(i);var s=new p.a(t);return s.setId(t.featureId),s})}},datumTokenizer:function(){},queryTokenizer:Bloodhound.tokenizers.whitespace},o=i.a({},t.options||{}),s=i.a({},t.remoteOptions||{});return o.remote&&(i.a(s,o.remote),delete o.remote),i.a(n,o),i.a(n.remote,s),new Bloodhound(n)};(g.module=angular.module("ngeoCreateLocationSearchBloodhound",[])).value("ngeoCreateLocationSearchBloodhound",g);var d=g,f=angular.module("ngeoSearchModule",[n.module.name,l.module.name,d.module.name]);t.a=f},,,function(e,t,r){"use strict";(function(e){var a=r(1),n=angular.module("gmfMobileNav",[]);n.component_=function(){return{restrict:"A",controller:"gmfMobileNavController as navCtrl",bindToController:!0,scope:!0,link:function(e,t,r,a){a.init(t)}}},n.directive("gmfMobileNav",n.component_),n.Controller_=function(){this.slid_=[],this.active_=null,this.header_=null,this.backButton_=null,this.back=this.back_.bind(this)},n.controller("gmfMobileNavController",n.Controller_),n.Controller_.prototype.init=function(t){var r=this,o=n.Controller_.ClassName_;this.active_=e(t.find("."+o.ACTIVE+"."+o.SLIDE)),this.header_=e(t.find("> header")),this.backButton_=e(t.find("header > ."+o.GO_BACK)),t.find("[data-toggle=slide-in]").on("click",function(t){var o=n.Controller_.ClassName_,i=e(t.currentTarget).parents("."+o.SLIDE);a.a.assert(1===i.length),r.slid_.push(i),i.addClass(o.SLIDE_OUT).removeClass(o.ACTIVE);var s=e(e(t.currentTarget).attr("data-target"));a.a.assert(1===s.length),s.addClass(o.ACTIVE),r.updateNavigationHeader_(s,!1),r.active_=s}),this.backButton_.click(this.back.bind(this))},n.Controller_.prototype.updateNavigationHeader_=function(t,r){var a=n.Controller_.ClassName_;this.header_.toggleClass(a.BACK,r),this.header_.find("nav:not(."+a.ACTIVE+" +)").remove(),this.header_.find("nav."+a.ACTIVE).removeClass(a.ACTIVE).addClass(a.SLIDE_OUT),this.backButton_.toggleClass(a.ACTIVE,this.slid_.length>0);var o=e("<nav>");o.append(e("<span>",{text:t.attr("data-header-title")})),this.header_.append(o),window.setTimeout(function(){o.css("display","none"),o.offset(),o.css("display",""),window.setTimeout(function(){o.position(),o.addClass(n.Controller_.ClassName_.ACTIVE)},0)},0)},n.Controller_.prototype.back_=function(){if(!(this.slid_.length<=0)){var e=n.Controller_.ClassName_;this.active_.removeClass(e.ACTIVE);var t=this.slid_.pop();t.addClass(e.ACTIVE).removeClass(e.SLIDE_OUT),this.updateNavigationHeader_(t,!0),this.active_=t}},n.Controller_.prototype.backIfActive=function(e){null!==this.active_&&this.active_.is(e)&&this.back_()},n.Controller_.ClassName_={ACTIVE:"gmf-mobile-nav-active",BACK:"gmf-mobile-nav-back",GO_BACK:"gmf-mobile-nav-go-back",SLIDE:"gmf-mobile-nav-slide",SLIDE_OUT:"gmf-mobile-nav-slide-out"},n.backDirective=function(){return{require:"^^gmfMobileNav",restrict:"A",scope:!1,link:function(e,t,r,a){e.$watch(r.gmfMobileNavBack,function(e,r){!0===e&&a.backIfActive(t[0])})}}},n.directive("gmfMobileNavBack",n.backDirective),n.backOnClickDirective=function(){return{require:"^^gmfMobileNav",restrict:"A",scope:!1,link:function(e,t,r,a){t.on("click",function(){a.backIfActive(t[0])})}}},n.directive("gmfMobileNavBackOnClick",n.backOnClickDirective),t.a=n}).call(this,r(33))},function(e,t,r){"use strict";(function(e){r(293);var a=r(1),n=angular.module("ngeoSortable",[]);n.component_=function(t){return{restrict:"A",link:function(r,n,o){var i=r.$eval(o.ngeoSortable)||[];a.a.assert(Array.isArray(i)),r.$watchCollection(function(){return i},function(){i.length&&t(c,0)});var s=function(e){var t=void 0;void 0===e?t={handleClassName:"ngeo-sortable-handle"}:(void 0===e.handleClassName&&(e.handleClassName="ngeo-sortable-handle"),t=e);return t}(r.$eval(o.ngeoSortableOptions)),l=r.$eval(o.ngeoSortableCallback),u=r.$eval(o.ngeoSortableCallbackCtx);function c(){for(var t=n.children(),a=0;a<t.length;++a)angular.element(t[a]).data("idx",a);var o=e(n);o.data("ui-sortable")&&(o.off("sortupdate"),o.sortable("destroy"));var c={axis:"y",classes:{"ui-sortable-helper":s.draggerClassName}};s.handleClassName&&(c.handle="."+s.handleClassName),s.placeholderClassName&&(c.placeholder=s.placeholderClassName,c.forcePlaceholderSize=!0),o.sortable(c),o.on("sortupdate",function(t,a){var o=e(a.item[0]).data("idx"),s=a.item.index();e(a.item[0]).data("idx",s),r.$apply(function(){i.splice(s,0,i.splice(o,1)[0])}),l instanceof Function&&l.apply(u,[n,i])})}}}},n.component_.$inject=["$timeout"],n.directive("ngeoSortable",n.component_),t.a=n}).call(this,r(33))},function(e,t,r){"use strict";(function(e){r(302),r(301);var a=angular.module("ngeoPopover",[]);a.component_=function(){return{restrict:"A",scope:!0,controller:"NgeoPopoverController as popoverCtrl",link:function(t,r,a,n){n.anchorElm.on("hidden.bs.popover",function(){n.anchorElm.data("bs.popover").inState.click=!1}),n.anchorElm.on("inserted.bs.popover",function(){n.bodyElm.show(),n.shown=!0}),n.anchorElm.popover({container:"body",html:!0,content:n.bodyElm,placement:a.ngeoPopoverPlacement||"right"}),a.ngeoPopoverDismiss&&e(a.ngeoPopoverDismiss).on("scroll",function(){n.dismissPopover()}),t.$on("$destroy",function(){n.anchorElm.popover("destroy"),n.anchorElm.unbind("inserted.bs.popover"),n.anchorElm.unbind("hidden.bs.popover")})}}},a.anchorComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function(e,t,r,a){a.anchorElm=t}}},a.contentComponent=function(){return{restrict:"A",require:"^^ngeoPopover",link:function(e,t,r,a){a.bodyElm=t,t.hide()}}},a.PopoverController_=function(e){function t(e){this.anchorElm[0]!==e.target&&this.bodyElm.parent()[0]!==e.target&0===this.bodyElm.parent().find(e.target).length&&this.shown&&this.dismissPopover()}this.shown=!1,this.anchorElm=void 0,this.bodyElm=void 0,angular.element("body").on("mousedown",t.bind(this)),e.$on("$destroy",function(){angular.element("body").off("mousedown",t)})},a.PopoverController_.$inject=["$scope"],a.PopoverController_.prototype.dismissPopover=function(){this.shown=!1,this.anchorElm.popover("hide")},a.controller("NgeoPopoverController",a.PopoverController_),a.directive("ngeoPopover",a.component_),a.directive("ngeoPopoverAnchor",a.anchorComponent),a.directive("ngeoPopoverContent",a.contentComponent),t.a=a}).call(this,r(33))},function(e,t,r){"use strict";var a=angular.module("ngeoColorpicker",[]);a.value("ngeoColorpickerTemplateUrl",function(e,t){var r=t.ngeoColorpickerTemplateurl;return void 0!==r?r:"ngeo/misc/colorpickerComponent"}),a.run(["$templateCache",function(e){e.put("ngeo/misc/colorpickerComponent",r(303))}]),a.component_=function(e){return{restrict:"A",scope:{colors:"<?ngeoColorpicker",color:"=?ngeoColorpickerColor"},controller:"NgeoColorpickerController as ctrl",bindToController:!0,templateUrl:e}},a.component_.$inject=["ngeoColorpickerTemplateUrl"],a.directive("ngeoColorpicker",a.component_),a.DEFAULT_COLORS=[["#F4EB37","#CDDC39","#62AF44","#009D57","#0BA9CC","#4186F0","#3F5BA9","#7C3592","#A61B4A","#DB4436","#F8971B","#F4B400","#795046"],["#F9F7A6","#E6EEA3","#B7DBAB","#7CCFA9","#93D7E8","#9FC3FF","#A7B5D7","#C6A4CF","#D698AD","#EE9C96","#FAD199","#FFDD5E","#B29189"],["#ffffff","#CCCCCC","#777","#000000"]],a.Controller_=function(e,t,r){this.colors=this.colors||a.DEFAULT_COLORS,this.color},a.Controller_.$inject=["$scope","$element","$attrs"],a.Controller_.prototype.setColor=function(e){this.color=e},a.controller("NgeoColorpickerController",a.Controller_),t.a=a},function(e,t,r){"use strict";(function(e){var a=r(40),n=r(98),o=r(204),i=r(38),s=r(1),l=r(88),u=r(203),c=r(258),h=r(257),p=r(252),g=r(30),d=r(107),f=r(41),m=r(11),y=r(231),v=r(10),_=r(106),S=r(55),b=r(136),w=r(46),C=r(16),T=r(142);var E=angular.module("gmfSearch",[n.a.module.name,o.a.module.name,i.a.module.name,u.a.module.name,c.a.name,p.a.name,l.a.module.name,h.a.name]);function L(e,t,r){return r(e,t)}E.gmfSearchTemplateUrl_=function(e,t){var r=t.gmfSearchTemplateurl;return void 0!==r?r:"gmf/search"},E.run(["$templateCache",function(e){e.put("gmf/search",r(296))}]),L.$inject=["$element","$attrs","gmfSearchTemplateUrl"],E.component_={bindings:{inputValue:"=?gmfSearchInputValue",placeholder:"@?gmfSearchPlaceholder",map:"<gmfSearchMap",datasources:"<gmfSearchDatasources",typeaheadOptions:"<?gmfSearchOptions",featuresStyles:"<?gmfSearchStyles",clearButton:"=?gmfSearchClearbutton",colorChooser:"<?gmfSearchColorchooser",coordinatesProjections:"<?gmfSearchCoordinatesprojections",additionalListeners:"<gmfSearchListeners",maxZoom:"<?gmfSearchMaxzoom",delay:"<?gmfSearchDelay",onInitCallback:"<?gmfSearchOnInit"},controller:"gmfSearchController",templateUrl:L},E.value("gmfSearchTemplateUrl",E.gmfSearchTemplateUrl_),E.component("gmfSearch",E.component_),E.SearchController_=function(){function t(e,r,a,n,o,i,s,l,u,c,h,p){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.element_=e,this.scope_=r,this.compile_=a,this.timeout_=n,this.gettextCatalog_=i,this.gmfThemes_=c,this.gmfTreeManager_=h,this.fullTextSearch_=p,this.ngeoSearchCreateGeoJSONBloodhound_=l,this.ngeoFeatureOverlayMgr=u,this.ngeoLocation_,o.has("ngeoLocation")&&(this.ngeoLocation_=o.get("ngeoLocation")),this.ngeoAutoProjection_=s,this.map,this.styles_={},this.onInitCallback,this.clearButton,this.colorChooser,this.placeholder,this.delay,this.maxZoom=16,this.coordinatesProjections,this.featureOverlay_=u.getFeatureOverlay(),this.datasources=[],this.typeaheadOptions,this.options={highlight:!0},this.featuresStyles,this.datasets=[],this.inputValue="",this.color,this.displayColorPicker=!1,this.listeners,this.additionalListeners}return t.$inject=["$element","$scope","$compile","$timeout","$injector","gettextCatalog","ngeoAutoProjection","ngeoSearchCreateGeoJSONBloodhound","ngeoFeatureOverlayMgr","gmfThemes","gmfTreeManager","gmfSearchFulltextSearch"],t.prototype.$onInit=function(){var e=this,t=this.gettextCatalog_;this.clearButton=!1!==this.clearButton,this.colorChooser=!0===this.colorChooser,void 0===this.delay&&(this.delay=50),this.placeholder=void 0!==this.placeholder?this.placeholder:t.getString("Search…");var r=this.coordinatesProjections;if(r=void 0===r?[this.map.getView().getProjection()]:this.ngeoAutoProjection_.getProjectionList(r),this.coordinatesProjections=r,this.clearButton||this.element_.find("input").on("focus blur",function(){e.clear()}),this.onInitCallback&&this.onInitCallback(),this.initStyles_(),this.featureOverlay_.setStyle(this.getSearchStyle_.bind(this)),this.typeaheadOptions&&m.a(this.options,this.typeaheadOptions),this.initDatasets_(),this.scope_.$watch(function(){return e.color},this.setStyleColor.bind(this)),this.listeners=this.mergeListeners_(this.additionalListeners,{select:this.select_.bind(this),close:this.close_.bind(this),datasetsempty:this.datasetsempty_.bind(this)}),this.ngeoLocation_){var a=this.ngeoLocation_.getParam("search");if(a){var n=1;this.ngeoLocation_.getParam("search-select-index")&&(n=parseInt(this.ngeoLocation_.getParam("search-select-index"),10));var o=void 0;this.ngeoLocation_.getParam("search-maxzoom")?o=parseInt(this.ngeoLocation_.getParam("search-maxzoom"),10):this.ngeoLocation_.getParam("map_zoom")&&(o=parseInt(this.ngeoLocation_.getParam("map_zoom"),10)),this.fulltextsearch_(a,n,o)}}},t.prototype.mergeListeners_=function(e,t){return void 0===e?t:{open:e.open,close:void 0===e.close?t.close:function(){t.close(),e.close()},cursorchange:e.cursorchange,datasetsempty:e.datasetsempty,select:void 0===e.select?t.select:function(r,a,n){t.select(r,a,n),e.select(r,a,n)},autocomplete:e.autocomplete}},t.prototype.initDatasets_=function(){for(var e=this,t=this.gettextCatalog_,r=function(r){var a=e.datasources[r],n=void 0!==a.groupValues?a.groupValues:[],o=a.groupActions?a.groupActions:[],i=[];0===n.length?i.push({title:"",filter:e.filterLayername_()}):n.forEach(function(e){i.push({title:e,filter:this.filterLayername_(e)})},e),o.forEach(function(e){i.push({title:t.getString(e.title),filter:this.filterAction_(e.action)})},e),i.forEach(function(e){this.datasets.push(this.createDataset_({bloodhoundOptions:a.bloodhoundOptions,datasetTitle:e.title,groupsKey:"layer_name",labelKey:a.labelKey,projection:a.projection,typeaheadDatasetOptions:a.typeaheadDatasetOptions,url:a.url},e.filter))},e)},a=0;a<this.datasources.length;a++)r(a);this.datasets.push({source:this.createSearchCoordinates_(this.map.getView()),name:"coordinates",display:"label",templates:{header:function(){var e=t.getString("Recenter to");return'<div class="gmf-search-header" translate>'+e+"</div>"},suggestion:function(e){var t='<p class="gmf-search-label">'+e.label+"</p>";return t='<div class="gmf-search-datum">'+t+"</div>"}}})},t.prototype.createDataset_=function(e,t){var r=this.gettextCatalog_,a=this.scope_,n=this.compile_,o={limit:1/0,source:this.createAndInitBloodhound_(e,t).ttAdapter(),display:function(t){return t.get(e.labelKey)},templates:{header:function(){if(void 0===e.datasetTitle)return"";var t=r.getString(e.datasetTitle);return'<div class="gmf-search-header">'+t+"</div>"},suggestion:function(t){var r=t,o=a.$new(!0);o.feature=r;var i='<p class="gmf-search-label" translate>'+r.get(e.labelKey)+"</p>";return i+='<p class="gmf-search-group" translate>'+(r.get("layer_name")||e.datasetTitle)+"</p>",n(i='<div class="gmf-search-datum">'+i+"</div>")(o)}}};return e.typeaheadDatasetOptions&&m.a(o,e.typeaheadDatasetOptions),o},t.prototype.filterAction_=function(e){return function(t){var r=t.properties;return!!r.actions&&(!r.layer_name&&r.actions.some(function(t){return t.action===e}))}},t.prototype.filterLayername_=function(e){return function(t){var r=t.properties.layer_name;return void 0!==r&&(void 0===e||r===e)}},t.prototype.createAndInitBloodhound_=function(e,t){var r=this.map.getView().getProjection().getCode(),a=this.getBloodhoudRemoteOptions_(),n=this.ngeoSearchCreateGeoJSONBloodhound_(e.url,t,v.f(r),v.f(e.projection),e.bloodhoundOptions,a);return n.initialize(),n},t.prototype.getBloodhoudRemoteOptions_=function(){var e=this.gettextCatalog_;return{rateLimitWait:this.delay,prepare:function(t,r){var a=r.url,n=e.currentLanguage;return r.xhrFields={withCredentials:!0},r.url=T.a(a,{query:t,lang:n}),r}}},t.prototype.createSearchCoordinates_=function(e){var t=e.getProjection(),r=t.getExtent();return function(e,a){var n=[],o=this.ngeoAutoProjection_.stringToCoordinates(e);if(null!==o){var i=this.ngeoAutoProjection_.tryProjectionsWithInversion(o,r,t,this.coordinatesProjections);null!==i&&(n.push({label:o.join(" "),position:i,tt_source:"coordinates"}),a(n))}}.bind(this)},t.prototype.initStyles_=function(){this.styles_[a.a.COORDINATES_LAYER_NAME]=new C.c({image:new b.a({stroke:new w.a({color:[0,0,0,.7],width:2}),points:4,radius:8,radius2:0,angle:0})});var e=new S.a({color:[65,134,240,.5]}),t=new w.a({color:[65,134,240,1],width:2});this.styles_.default=new C.c({fill:e,image:new _.a({fill:e,radius:5,stroke:t}),stroke:t});var r=this.featuresStyles||{};m.a(this.styles_,r)},t.prototype.getSearchStyle_=function(e,t){s.a.assert(e);var r=this.styles_[e.get("layer_name")]||this.styles_.default;if(this.color){var a=d.a(this.color),n=a.slice();n[3]=1;var o=a.slice();o[3]=.5;var i=r.getStroke();i&&i.setColor(n);var l=r.getFill();l&&l.setColor(o);var u=r.getImage();if(u){var c=(u=u.clone()).getStroke();c&&c.setColor(n);var h=u.getFill();h&&h.setColor(o),r.setImage(u)}}return r},t.prototype.setStyleColor=function(e){e&&(this.color=e,this.ngeoFeatureOverlayMgr.getLayer().changed())},t.prototype.setTTDropdownVisibility_=function(){if(this.clearButton){var e=this.element_.find(".twitter-typeahead .tt-menu");this.inputValue?e.show():e.hide()}},t.prototype.onClearButton=function(){this.featureOverlay_.clear(),this.clear()},t.prototype.clear=function(){var t=this.element_.find(".twitter-typeahead"),r=t.children(".tt-menu"),a=t.children("input");this.inputValue="",e(a[1]).typeahead("val",""),r.children(".tt-dataset").empty(),this.setTTDropdownVisibility_(),this.displayColorPicker=!1},t.prototype.blur=function(){var t=this.element_.find(".twitter-typeahead").children("input");this.timeout_(function(){e(t[1]).blur()})},t.prototype.select_=function(e,t,r){if("coordinates"===t.tt_source){var n=new f.a(t.position);this.featureOverlay_.clear(),this.featureOverlay_.addFeature(new g.a({geometry:n,layer_name:a.a.COORDINATES_LAYER_NAME})),this.map.getView().setCenter(t.position),this.leaveSearch_()}else s.a.assertInstanceof(t,g.a),this.selectFromGMF_(e,t,r)},t.prototype.selectFromGMF_=function(e,t,r){var a=this,n=t.get("actions"),o=t.getGeometry();if(n)for(var s=function(e,t){var r=n[e],s=r.action,l=r.data;if("add_theme"==s)a.gmfThemes_.getThemesObject().then(function(e){var t=i.a.findThemeByName(e,l);t&&a.gmfTreeManager_.addFirstLevelGroups(t.children)});else if("add_group"==s)a.gmfTreeManager_.addGroupByName(l,!0);else if("add_layer"==s){var u=void 0;if(a.datasources[0].groupActions.forEach(function(e){if("add_layer"===e.action)return u=!0}),u){var c=!!o;a.gmfTreeManager_.addGroupByLayerName(l,!0,c)}}},l=0,u=n.length;l<u;l++)s(l);var c=this.map.getSize();if(o&&c){var h=this.map.getView();this.featureOverlay_.clear(),this.featureOverlay_.addFeature(t),this.displayColorPicker=!0;var p="GeometryCollection"===o.getType()?o.getExtent():o;h.fit(p,{size:c,maxZoom:this.maxZoom})}this.leaveSearch_()},t.prototype.leaveSearch_=function(){this.clearButton||this.clear(),this.blur()},t.prototype.close_=function(e){this.clearButton||this.setTTDropdownVisibility_()},t.prototype.datasetsempty_=function(t,r,a){var n=this.element_.find(".twitter-typeahead .tt-menu"),o=n.children(".gmf-search-no-results");if(0==o.length){var i=e('<div class="gmf-search-no-results" translate>No result found</div>');n.append(i)}a?(o.show(),n.addClass("gmf-search-no-results")):(n.removeClass("gmf-search-no-results"),o.hide())},t.prototype.fulltextsearch_=function(e,t,r){var a=this;t<1&&(t=1),this.fullTextSearch_.search(e,{limit:t}).then(function(e){if(e&&e.features[t-1]){var n=(new y.a).readFeature(e.features[t-1]);a.featureOverlay_.addFeature(n);var o={};void 0!==r&&(o.maxZoom=r,o.size=a.map.getSize()),a.map.getView().fit(n.getGeometry().getExtent(),o),a.inputValue=n.get("label")}})},t}(),E.controller("gmfSearchController",E.SearchController_),t.a=E}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var r=angular.module("ngeoRecenter",[]);r.directive_=function(){return{restrict:"A",link:function(t,r,a){var n=a.ngeoRecenterMap,o=t.$eval(n);function i(e){var r=e.attr("ngeo-extent");if(void 0!==r){var a=o.getSize();o.getView().fit(t.$eval(r),{size:a})}var n=e.attr("ngeo-zoom");void 0!==n&&o.getView().setZoom(t.$eval(n))}r.on("click","*",function(t){i(angular.element(e(this)))}),r.on("change",function(e){var t=e.target.options[e.target.selectedIndex];i(angular.element(t))})}}},r.directive("ngeoRecenter",r.directive_),t.a=r}).call(this,r(33))},,,function(e,t,r){"use strict";var a=r(1);t.a=function(e,t,r,n,o){var i=n.$watchCollection(function(){return e},function(){var a=void 0,n=void 0,i=void 0;if(r)for(a=e.length-1,i=0;a>=0;--a)o(e[a])&&(t[i++]=e[a]);else for(a=0,n=e.length,i=0;a<n;++a)o(e[a])&&(t[i++]=e[a]);t.length=i}),s=n.$watchCollection(function(){return t},function(){var n=void 0,i=void 0,s=void 0;if(r){for(n=0,i=e.length,s=t.length-1;n<i;++n)o(e[n])&&(e[n]=t[s--]);a.a.assert(-1==s)}else{for(n=0,i=e.length,s=0;n<i;++n)o(e[n])&&(e[n]=t[s++]);a.a.assert(s==t.length)}});return function(){i(),s()}}},function(e,t,r){"use strict";var a=r(75),n=(r(226),angular.module("ngeoLayertree",[a.a.module.name]));n.value("ngeoLayertreeTemplateUrl",function(e,t){var r=t.ngeoLayertreeTemplateurl;return void 0!==r?r:"ngeo/layertree"}),n.run(["$templateCache",function(e){e.put("ngeo/layertree",r(331))}]),n.directive_=function(e){return{restrict:"A",scope:!0,templateUrl:e,controller:a.a}},n.directive_.$inject=["ngeoLayertreeTemplateUrl"],n.directive("ngeoLayertree",n.directive_),t.a=n},function(e,t,r){"use strict";var a={Permalink3dParam:{ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"}};t.a=a},function(e,t,r){"use strict";(function(e){var a=r(2),n=r(124),o=function(t){var r=void 0!==t?t:{},a=void 0;r.element?(a=r.element,delete r.element):a=e("<div />")[0],this.closeEl_=e("<button>",{class:"close",html:"&times;"}),this.contentEl_=e("<div/>").append(this.closeEl_).append(a),r.element=e("<div />")[0],n.a.call(this,r)};a.d(o,n.a),o.prototype.setMap=function(t){var r=this,a=this.getElement();if(this.getMap()&&e(a).popover("destroy"),n.a.prototype.setMap.call(this,t),t){var o=this.contentEl_;window.setTimeout(function(){e(a).popover({content:o,html:!0,placement:"top",template:['<div class="popover ngeo-popover" role="tooltip">','  <div class="arrow"></div>','  <h3 class="popover-title"></h3>','  <div class="popover-content"></div>',"</div>"].join("")}).popover("show")},0),this.closeEl_.one("click",function(){var e=r.getMap();e&&e.removeOverlay(r)})}},t.a=o}).call(this,r(33))},function(e,t,r){"use strict";(function(e){var a=r(40),n=r(163),o=r(198),i=r(207),s=r(205),l=r(132),u=r(98),c=r(38),h=r(1),p=r(39),g=r(264),d=r(75),f=r(100),m=r(263),y=r(89),v=r(168),_=r(84),S=r(11),b=r(149),w=r(222),C=r(169),T=(r(226),angular.module("gmfLayertreeComponent",[n.a.module.name,o.a.module.name,i.a.module.name,s.a.name,l.a.module.name,u.a.module.name,c.a.module.name,g.a.name,d.a.module.name,f.a.module.name,y.a.module.name]));function E(e,t,r){return r(e,t)}T.value("ngeoLayertreeTemplateUrl",function(e,t){return"gmf/layertree"}),T.run(["$templateCache",function(e){e.put("gmf/layertree",r(330))}]),T.value("gmfLayertreeTemplate",function(e,t){return'<div ngeo-layertree="gmfLayertreeCtrl.root" ngeo-layertree-map="gmfLayertreeCtrl.map" ngeo-layertree-nodelayer="gmfLayertreeCtrl.getLayer(treeCtrl)" ngeo-layertree-listeners="gmfLayertreeCtrl.listeners(treeScope, treeCtrl)" ngeo-layertree-templateurl="gmf/layertree"></div>'}),E.$inject=["$element","$attrs","gmfLayertreeTemplate"],T.component_={controller:"GmfLayertreeController as gmfLayertreeCtrl",bindings:{map:"=gmfLayertreeMap",dimensions:"=?gmfLayertreeDimensions",openLinksInNewWindow:"<?gmfLayertreeOpenlinksinnewwindow"},template:E},T.component("gmfLayertree",T.component_),T.Controller_=function(e,t,r,a,n,o,i,s,l,u){var c=this;this.map,this.dimensions,this.scope_=t,this.layerHelper_=r,this.gmfDataSourceBeingFiltered=a,this.gmfExternalDataSourcesManager=n,this.gmfPermalink_=o,this.gmfTreeManager_=i;var p=i.root;h.a.assert(p),this.root=p,this.gmfSyncLayertreeMap_=s,this.ngeoWMSTime_=l,this.groupNodeStates_={},this.openLinksInNewWindow,this.dataLayerGroup_=null,this.layers=[],this.gmfThemes_=u,e.on("shown.bs.collapse",function(){c.scope_.$apply()})},T.Controller_.$inject=["$element","$scope","ngeoLayerHelper","gmfDataSourceBeingFiltered","gmfExternalDataSourcesManager","gmfPermalink","gmfTreeManager","gmfSyncLayertreeMap","ngeoWMSTime","gmfThemes"],T.Controller_.prototype.$onInit=function(){var e=this;this.openLinksInNewWindow=!0===this.openLinksInNewWindow,this.dataLayerGroup_=this.layerHelper_.getGroupFromMap(this.map,a.a.DATALAYERGROUP_NAME),Object(m.a)(this.dataLayerGroup_.getLayers().getArray(),this.layers,!0,this.scope_,function(){return!0}),this.scope_.$watchCollection(function(){return e.layers},function(){e.map.render()}),this.scope_.$watchCollection(function(){if(e.gmfTreeManager_.rootCtrl)return e.dimensions},function(t){t&&e.updateDimensions_(e.gmfTreeManager_.rootCtrl)})},T.Controller_.prototype.updateDimensions_=function(e){var t=this;e.traverseDepthFirst(function(e){if(e.node.dimensions){var r=e.layer;h.a.assertInstanceof(r,_.a),t.updateLayerDimensions_(r,e.node)}})},T.Controller_.prototype.updateLayerDimensions_=function(e,t){var r=this;if(this.dimensions&&t.dimensions){var a={};for(var n in t.dimensions)if(null===t.dimensions[n]){var o=this.dimensions[n];void 0!==o&&(a[n]=o)}else a[n]=t.dimensions[n];if(!S.d(a)){var i=e.getSource();i instanceof C.a?i.updateDimensions(a):i instanceof w.a||i instanceof b.a?i.updateParams(a):e.once("change:source",function(){h.a.assertInstanceof(e,_.a),r.updateLayerDimensions_(e,t)})}}},T.Controller_.prototype.getLayer=function(e){var t=void 0;e.parent.isRoot&&(this.gmfTreeManager_.rootCtrl=e.parent,t=this.gmfTreeManager_.root.children.length-this.gmfTreeManager_.numberOfGroupsToAddInThisDigestLoop||0);var r=this.gmfSyncLayertreeMap_.createLayer(e,this.map,this.dataLayerGroup_,t);if(r instanceof _.a){var a=e.node;this.updateLayerDimensions_(r,a)}return r},T.Controller_.prototype.listeners=function(e,t){var r=this.dataLayerGroup_;e.$on("$destroy",function(){r.getLayers().remove(t.layer)})},T.Controller_.prototype.toggleActive=function(e){e.setState("on"===e.getState()?"off":"on")},T.Controller_.prototype.getNodeState=function(e){return e.getState()},T.Controller_.prototype.updateWMSTimeLayerState=function(e,t){if(t){var r=e.getDataSource();if(r)h.a.assertInstanceof(r,p.a),r.timeRangeValue=t;else if(e.children)for(var a=0,n=e.children.length;a<n;a++)this.updateWMSTimeLayerState(e.children[a],t)}},T.Controller_.prototype.getLegendIconURL=function(e){var t=e.node.metadata.iconUrl;if(void 0!==t)return t;if(void 0===e.node.children){var r=e.node;if("WMS"===r.type){var a=r,n=a.metadata.legendRule;if(void 0!==n){var o=a.layers.split(",")[0],i=this.gmfTreeManager_.getOgcServer(e);return this.layerHelper_.getWMSLegendURL(i.url,o,void 0,n,20,20)}}}},T.Controller_.prototype.getLegendsObject=function(e){var t=this,r={};if(void 0!==e.node.children)return null;var a=e.node,n=a.name;if(a.metadata.legendImage)return r[n]=a.metadata.legendImage,r;var o=e.layer;if("WMTS"===a.type){h.a.assertInstanceof(o,v.a);var i=this.layerHelper_.getWMTSLegendURL(o);return r[n]=i,i?r:null}var s=a.layers,l=this.gmfTreeManager_.getOgcServer(e),u=this.getScale_();return(s=l.type===p.a.ServerType.QGISSERVER?[s]:s.split(",")).forEach(function(e){r[e]=t.layerHelper_.getWMSLegendURL(l.url,e,u)}),r},T.Controller_.prototype.getNumberOfLegendsObject=function(e){var t=this.getLegendsObject(e);return t?Object.keys(t).length:0},T.Controller_.prototype.getScale_=function(){var e=this.map.getView();return e.getResolution()*e.getProjection().getMetersPerUnit()*39.37*(25.4/.28)},T.Controller_.prototype.displayMetadata=function(e){var t=e.node,r=t.metadata.metadataUrl;if(void 0!==r){var a=window.gmfx;a.openIframePopup&&a.openIframePopup(r,t.name,void 0,void 0,!1)}},T.Controller_.prototype.afterReorder=function(){var e=this,t=this.gmfTreeManager_.rootCtrl.node.children,r=this.gmfTreeManager_.rootCtrl.children,a=[];t.forEach(function(e){r.some(function(t){t.node!==e||a.push(t)})}),this.gmfTreeManager_.rootCtrl.children=a,this.layers.length=0,this.gmfTreeManager_.rootCtrl.children.forEach(function(t){e.layers.push(t.layer)}),this.gmfPermalink_.refreshFirstLevelGroups()},T.Controller_.prototype.removeNode=function(e){this.gmfTreeManager_.removeGroup(e)},T.Controller_.prototype.removeAllNodes=function(){this.gmfTreeManager_.removeAll()},T.Controller_.prototype.nodesCount=function(){return this.gmfTreeManager_.root.children.length},T.Controller_.prototype.getResolutionStyle=function(e){var t=this.map.getView().getResolution(),r=c.a.getNodeMinResolution(e);if(void 0!==r&&t<r)return"out-of-resolution";var a=c.a.getNodeMaxResolution(e);return void 0!==a&&t>a?"out-of-resolution":void 0},T.Controller_.prototype.zoomToResolution=function(e){var t=e.node,r=this.map.getView(),a=r.getResolution(),n=c.a.getNodeMinResolution(t);if(void 0!==n&&a<n)r.setResolution(r.constrainResolution(n,0,1));else{var o=c.a.getNodeMaxResolution(t);void 0!==o&&a>o&&r.setResolution(r.constrainResolution(o,0,-1))}},T.Controller_.prototype.toggleNodeLegend=function(t){e(t).toggle({toggle:!0})},T.Controller_.prototype.toggleFiltrableDataSource=function(e){this.gmfDataSourceBeingFiltered.dataSource=e},T.Controller_.prototype.isNodeLegendVisible=function(t){return e(t).is(":visible")},T.Controller_.prototype.supportsCustomization=function(e){return!e.isRoot&&(this.supportsLegend(e)||this.supportsOpacityChange(e))},T.Controller_.prototype.supportsLegend=function(e){var t=e.node;return!!t.metadata&&!!t.metadata.legend&&!!this.getLegendsObject(e)},T.Controller_.prototype.supportsOpacityChange=function(e){var t=e.node,r=e.parent.node;return!!e.layer&&(1===e.depth&&!t.mixed||e.depth>1&&r.mixed)},T.controller("GmfLayertreeController",T.Controller_),t.a=T}).call(this,r(33))},,function(e,t,r){"use strict";(function(e){var a=r(1),n=r(56),o=r(2),i=r(3),s=r(124),l=r(86),u=function(t,r){var a=this,n=void 0!==r?r:{};n.positioning=l.a.TOP_LEFT,this.listenerKeys_=[],this.clickOutListenerKey_=null;var o=e("<div/>",{class:"panel panel-default"});if(this.autoClose_=void 0===t.autoClose||t.autoClose,t.title){var i=e("<div>",{class:"panel-heading"}).appendTo(o);e("<span>",{text:t.title}).appendTo(i)}var u=e("<div>",{class:"list-group"}).appendTo(o);this.actions_=[],t.actions.forEach(function(t){a.actions_.push(e("<button>",{class:"list-group-item","data-name":t.name,text:[" ",void 0!==t.label?t.label:t.name].join("")}).appendTo(u).prepend(e("<span>",{class:void 0!==t.cls?t.cls:""})))}),n.element=o[0],s.a.call(this,n)};o.d(u,s.a),u.prototype.setMap=function(e){var t=this;this.getMap()&&(this.listenerKeys_.forEach(i.e),this.listenerKeys_.length=0),s.a.prototype.setMap.call(this,e),e&&(this.actions_.forEach(function(e){var r=e.data();t.listenerKeys_.push(i.a(e[0],"click",t.handleActionClick_.bind(t,r.name)))}),this.listenerKeys_.push(i.a(e,"pointermove",this.handleMapPointerMove_,this)))},u.prototype.open=function(e){this.setPosition(e),this.autoClose_&&(this.clickOutListenerKey_=i.a(document.documentElement,"mousedown",this.handleClickOut_,this))},u.prototype.close=function(){this.setPosition(void 0),null!==this.clickOutListenerKey_&&i.e(this.clickOutListenerKey_)},u.prototype.handleActionClick_=function(e,t){this.dispatchEvent(new n.a("actionclick",{action:e})),this.autoClose_&&this.close(),t.stopPropagation()},u.prototype.handleClickOut_=function(t){var r=this.getElement();r&&0===e(t.target).closest(r).length&&this.close()},u.prototype.handleMapPointerMove_=function(e){var t=e.originalEvent.target;a.a.assertInstanceof(t,Element);var r=this.getElement();a.a.assertInstanceof(r,Element),r.contains(t)&&(e.coordinate=[1/0,1/0],e.pixel=[1/0,1/0])},t.a=u}).call(this,r(33))},,,,,,,,,,,,,,,,,function(e,t,r){"use strict";r.r(t);r(33),r(250),r(355),r(353);var a=r(164),n=r(59),o=r(130),i=(r(248),r(350),r(1));var s=angular.module("ngeoModal",[]);s.component_={template:'<div class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <ng-transclude></ng-transclude>\n      </div>\n    </div>\n  </div>',require:{ngModel:"ngModel"},transclude:!0,controller:"ngeoModalController",bindings:{resizable:"<ngeoModalResizable",closable:"<ngeoModalClosable"}},s.component("ngeoModal",s.component_),s.Controller_=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$element_=r,this.$scope_=t,this.modal_,this.closable,this.resizable,this.ngModel}return e.$inject=["$scope","$element"],e.prototype.$onInit=function(){var e=this;this.closable=!1!==this.closable,this.modal_=this.$element_.children(),this.closable||(this.modal_.attr("data-keyboard",!1),this.modal_.attr("data-backdrop","static")),this.resizable=!!this.resizable;var t=this.modal_.find(".modal-dialog");t.draggable(),this.resizable&&t.resizable(),this.ngModel.$render=function(){e.modal_.modal(e.ngModel.$viewValue?"show":"hide")},this.modal_.on("shown.bs.modal hidden.bs.modal",function(t){var r=t.type;i.a.assert("shown"==r||"hidden"==r),e.ngModel.$setViewValue("shown"==r)})},e.prototype.$onDestroy=function(){this.modal_.modal("hide"),this.modal_.modal("removeBackdrop");var e=this.modal_.find(".modal-dialog");e.draggable("destroy"),this.resizable&&e.resizable("destroy")},e}(),s.controller("ngeoModalController",s.Controller_);var l=s;var u=angular.module("gmfAuthentication",[a.a.module.name,o.a.module.name,l.name]);function c(e,t,r){return r(e,t)}u.gmfAuthenticationTemplateUrl_=function(e,t){var r=t.gmfAuthenticationTemplateurl;return void 0!==r?r:"gmf/authentication"},u.run(["$templateCache",function(e){e.put("gmf/authentication",r(349))}]),c.$inject=["$element","$attrs","gmfAuthenticationTemplateUrl"],u.component_={bindings:{allowPasswordReset:"<?gmfAuthenticationAllowPasswordReset",allowPasswordChange:"<?gmfAuthenticationAllowPasswordChange",passwordValidator:"<?gmfAuthenticationPasswordValidator",forcePasswordChange:"<?gmfAuthenticationForcePasswordChange"},controller:"GmfAuthenticationController",templateUrl:c},u.value("gmfAuthenticationTemplateUrl",u.gmfAuthenticationTemplateUrl_),u.component("gmfAuthentication",u.component_),u.AuthenticationController_=function(){function e(t,r,a,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$element_=t,this.gmfUser=n,this.gettextCatalog=r,this.gmfAuthenticationService_=a,this.notification_=o,this.allowPasswordReset,this.allowPasswordChange,this.passwordValidator=null,this.forcePasswordChange,this.changingPassword=!1,this.changePasswordModalShown=!1,this.resetPasswordModalShown=!1,this.error=!1,this.loginVal="",this.pwdVal="",this.oldPwdVal="",this.newPwdVal="",this.newPwdConfVal=""}return e.$inject=["$element","gettextCatalog","gmfAuthenticationService","gmfUser","ngeoNotification"],e.prototype.$onInit=function(){this.allowPasswordReset=!1!==this.allowPasswordReset,this.allowPasswordChange=!1!==this.allowPasswordChange,this.forcePasswordChange=!0===this.forcePasswordChange,this.forcePasswordChange&&(this.changingPassword=!0)},e.prototype.changePassword=function(){var e=this,t=this.gettextCatalog,r=this.oldPwdVal,a=this.newPwdVal,n=this.newPwdConfVal,o=[];if(""===r&&o.push(t.getString("The old password is required.")),""===a&&o.push(t.getString("The new password is required.")),""===n&&o.push(t.getString("The password confirmation is required.")),o.length)this.setError_(o);else if(r===a&&o.push(t.getString("The old and new passwords are the same.")),a!==n&&o.push(t.getString("The passwords don't match.")),this.passwordValidator&&(this.passwordValidator.isPasswordValid(r)||o.push(t.getString(this.passwordValidator.notValidMessage))),o.length)this.setError_(o);else{var i=t.getString("Incorrect old password.");this.gmfAuthenticationService_.changePassword(r,a,n).then(function(){e.changePasswordModalShown=!0,e.changePasswordReset()},this.setError_.bind(this,i))}},e.prototype.login=function(){var e=this.gettextCatalog,t=[];if(""===this.loginVal&&t.push(e.getString("The username is required.")),""===this.pwdVal&&t.push(e.getString("The password is required.")),t.length)this.setError_(t);else{var r=e.getString("Incorrect credentials or disabled account.");this.gmfAuthenticationService_.login(this.loginVal,this.pwdVal).then(this.resetError_.bind(this),this.setError_.bind(this,r))}},e.prototype.logout=function(){var e=this.gettextCatalog.getString("Could not log out.");this.gmfAuthenticationService_.logout().then(this.resetError_.bind(this),this.setError_.bind(this,e))},e.prototype.resetPassword=function(){var e=this.gettextCatalog;if(this.loginVal){var t=e.getString("An error occurred while resetting the password."),r=function(e){this.resetPasswordModalShown=!0,this.resetError_()}.bind(this);this.gmfAuthenticationService_.resetPassword(this.loginVal).then(r,this.setError_.bind(this,t))}else this.setError_(e.getString("Please, input a login..."))},e.prototype.changePasswordReset=function(){this.resetError_(),this.changingPassword=!1,this.oldPwdVal="",this.newPwdVal="",this.newPwdConfVal=""},e.prototype.userMustChangeItsPassword=function(){return!1===this.gmfUser.is_password_changed&&this.forcePasswordChange},e.prototype.setError_=function(e){this.error&&this.resetError_(),this.error=!0;var t=this.$element_.find(".gmf-authentication-error");Array.isArray(e)||(e=[e]),e.forEach(function(e){this.notification_.notify({msg:e,target:t,type:n.a.Type.ERROR})},this)},e.prototype.resetError_=function(){this.notification_.clear(),this.error=!1},e}(),u.controller("GmfAuthenticationController",u.AuthenticationController_);var h=u,p=angular.module("gmfAuthenticationModule",[h.name,a.a.module.name]),g=r(38),d=r(56),f=r(2),m=r(179),y=r(92),v=r(84),_=r(149),S=r(222),b=r(169),w=r(100),C=function(e){m.a.call(this),this.mapUids_={},this.ngeoLayerHelper_=e};C.$inject=["ngeoLayerHelper"],C.$inject=["ngeoLayerHelper"],f.d(C,m.a),C.prototype.get=function(e){return f.c(e).toString()in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME).getLayers().item(0):null},C.prototype.set=function(e,t){var r=f.c(e).toString(),a=this.get(e);null!==t&&(t.setZIndex(-200),this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,-200));var n=this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME);null!==a?(i.a.assert(r in this.mapUids_),null!==t?n.getLayers().setAt(0,t):(n.getLayers().removeAt(0),delete this.mapUids_[r])):null!==t&&(n.getLayers().insertAt(0,t),this.mapUids_[r]=!0);var o=new d.a("change",{current:t,previous:a});return this.dispatchEvent(o),a},C.prototype.getOpacityBgLayer=function(e){return f.c(e).toString()in this.mapUids_?this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME).getLayers().item(1):null},C.prototype.setOpacityBgLayer=function(e,t){t.setOpacity(0),t.setVisible(!0),t.setZIndex(-100),this.ngeoLayerHelper_.setZIndexToFirstLevelChildren(t,-100);var r=this.ngeoLayerHelper_.getGroupFromMap(e,C.BACKGROUNDLAYERGROUP_NAME);-1===r.getLayers().getArray().indexOf(t)&&r.getLayers().push(t)},C.prototype.updateDimensions=function(e,t){var r=this.get(e);if(r){var a=[r];r instanceof y.a&&(a=r.getLayers().getArray()),a.forEach(function(e){if(i.a.assertInstanceof(e,v.a),e){var r=!1,a={};for(var n in e.get("dimensions")){var o=t[n];void 0!==o&&(a[n]=o,r=!0)}if(r){var s=e.getSource();s instanceof b.a?(s.updateDimensions(a),s.refresh()):(s instanceof S.a||s instanceof _.a)&&(s.updateParams(a),s.refresh())}}})}},(C.module=angular.module("ngeoBackgroundLayerMgr",[w.a.module.name])).service("ngeoBackgroundLayerMgr",C),C.BACKGROUNDLAYERGROUP_NAME="background";var T=C,E=r(3),L=angular.module("gmfBackgroundlayerselector",[g.a.module.name,T.module.name]);function M(e,t,r){return r(e,t)}L.value("gmfBackgroundlayerselectorTemplateUrl",function(e,t){var r=t.gmfBackgroundlayerselectorTemplateurl;return void 0!==r?r:"gmf/backgroundlayerselector"}),L.run(["$templateCache",function(e){e.put("gmf/backgroundlayerselector",r(348))}]),M.$inject=["$element","$attrs","gmfBackgroundlayerselectorTemplateUrl"],L.component_={controller:"GmfBackgroundlayerselectorController as ctrl",bindings:{map:"=gmfBackgroundlayerselectorMap",opacityOptions:"=gmfBackgroundlayerOpacityOptions",select:"&?gmfBackgroundlayerselectorSelect"},templateUrl:M},L.component("gmfBackgroundlayerselector",L.component_),L.Controller_=function(e,t,r){var a=this;this.map,this.opacityOptions,this.select,this.bgLayer,this.bgLayers,this.opacityLayer,this.gmfThemes_=r,this.listenerKeys_=[],this.listenerKeys_.push(E.a(r,"change",this.handleThemesChange_,this)),this.backgroundLayerMgr_=t,this.listenerKeys_.push(E.a(this.backgroundLayerMgr_,"change",function(e){a.bgLayer=e.detail.current})),e.$on("$destroy",this.handleDestroy_.bind(this))},L.Controller_.$inject=["$scope","ngeoBackgroundLayerMgr","gmfThemes"],L.Controller_.prototype.$onInit=function(){this.handleThemesChange_()},L.Controller_.prototype.handleThemesChange_=function(){var e=this;this.gmfThemes_.getBgLayers().then(function(t){if(e.bgLayers=t,void 0!==e.opacityOptions){var r=t.find(function(t){return t.get("label")===e.opacityOptions});if(void 0!==r){e.setOpacityBgLayer(r),e.opacityLayer=r,e.bgLayers=e.bgLayers.slice();var a=e.bgLayers.findIndex(function(t){return t===e.opacityLayer});e.bgLayers.splice(a,1),e.bgLayers.push(r)}}})},L.Controller_.prototype.getSetBgLayerOpacity=function(e){return e&&this.opacityLayer.setOpacity(e),this.opacityLayer.getOpacity()},L.Controller_.prototype.setLayer=function(e,t){this.bgLayer=e,this.backgroundLayerMgr_.set(this.map,e),!t&&this.select&&this.select()},L.Controller_.prototype.setOpacityBgLayer=function(e){this.backgroundLayerMgr_.setOpacityBgLayer(this.map,e)},L.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(E.e),this.listenerKeys_.length=0},L.controller("GmfBackgroundlayerselectorController",L.Controller_);var A=L,F=r(163),P=r(198);var R=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.http_=t,this.baseUrl_=r,this.promises_={}}return e.$inject=["$http","gmfLayersUrl"],e.prototype.getAttributeValues=function(e,t){var r=e.id+"_"+t,a=e.name;if(!this.promises_[r]){var n=this.baseUrl_+"/"+a+"/values/"+t;this.promises_[r]=this.http_.get(n).then(this.handleGetAttributeValues_.bind(this))}return this.promises_[r]},e.prototype.handleGetAttributeValues_=function(e){return e.data.items},e}();R.module=angular.module("gmfEnumerateAttribute",[]),R.module.service("gmfEnumerateAttribute",R);var k=R,x=r(122),D=r(113),O=r(24),$={setGeometryType:function(e,t){return/gml:((Multi)?(Point|Line|Polygon|Curve|Surface|Geometry)).*/.exec(t)&&(e.type=O.a.GEOMETRY,/^gml:Point/.exec(t)?e.geomType="Point":/^gml:LineString|^gml:Curve/.exec(t)?e.geomType="LineString":/^gml:Polygon|^gml:Surface/.exec(t)?e.geomType="Polygon":/^gml:MultiPoint/.exec(t)?e.geomType="MultiPoint":/^gml:MultiLineString|^gml:MultiCurve/.exec(t)?e.geomType="MultiLineString":/^gml:MultiPolygon|^gml:MultiSurface/.exec(t)&&(e.geomType="MultiPolygon")),!!e.type&&!!e.geomType}},I=$,N=r(111),G=function(){N.a.call(this)};f.d(G,N.a),G.prototype.read=function(e){return N.a.prototype.read.call(this,e)},G.prototype.readFromDocument=function(e){i.a.assert(e.nodeType==Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},G.prototype.readFromNode=function(e){i.a.assert(e.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT"),i.a.assert("schema"==e.localName,"localName should be schema");var t=e.getElementsByTagName("element");t.length||(t=e.getElementsByTagName("xsd:element"));for(var r=[],a=void 0,n=0,o=t.length;n<o;n++)(a=this.readFromElementNode_(t[n]))&&r.push(a);return r},G.prototype.readFromElementNode_=function(e){var t=e.getAttribute("name");i.a.assertString(t,"name should be defined in element node.");var r=e.getAttribute("alias"),a=e.getAttribute("nillable"),n={name:t,alias:r,required:!(!0===a||"true"===a)},o=e.getAttribute("type");if(o)I.setGeometryType(n,o)||this.setAttributeByXsdType_(n,o);else{var s=e.getElementsByTagName("enumeration");if(s.length||(s=e.getElementsByTagName("xsd:enumeration")),s.length){n.type=O.a.SELECT;for(var l=[],u=0,c=s.length;u<c;u++)l.push(s[u].getAttribute("value"));n.choices=l}else{var h=e.getElementsByTagName("restriction");if(h.length||(h=e.getElementsByTagName("xsd:restriction")),h.length&&h[0]){var p=h[0];this.setAttributeByXsdType_(n,p.getAttribute("base"));var g=e.getElementsByTagName("maxLength");g.length||(g=e.getElementsByTagName("xsd:maxLength")),g.length&&g[0]&&(n.maxLength=Number(g[0].getAttribute("value")))}}}return n.type?(i.a.assert(n.type),n):null},G.prototype.setAttributeByXsdType_=function(e,t){"xsd:boolean"===t?e.type=O.a.BOOLEAN:"xsd:date"===t?e.type=O.a.DATE:"xsd:dateTime"===t?e.type=O.a.DATETIME:"xsd:time"===t?e.type=O.a.TIME:"xsd:decimal"===t||"xsd:double"===t?(e.type=O.a.NUMBER,e.numType=G.NumberType.FLOAT):"xsd:integer"===t?(e.type=O.a.NUMBER,e.numType=G.NumberType.INTEGER):"xsd:string"===t&&(e.type=O.a.TEXT)},G.getGeometryAttribute=function(e){for(var t=null,r=0,a=e.length;r<a;r++)if(e[r].type===O.a.GEOMETRY){t=e[r];break}return t},G.NumberType={FLOAT:"float",INTEGER:"integer"};var U=G;var j=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return e.prototype.read=function(e){return e.map(this.readFromComplexTypeElement_)},e.prototype.readFromComplexTypeElement_=function(e){var t={name:i.a.assertString(e.name),alias:"alias"in e?i.a.assertString(e.alias):null,required:"0"!=e.minOccurs},r=i.a.assertString(e.type);return I.setGeometryType(t,r)||("gml:TimeInstantType"===r||"dateTime"===r?t.type=O.a.DATETIME:"date"===r?t.type=O.a.DATE:"time"===r?t.type=O.a.TIME:"decimal"===r||"double"===r?(t.type=O.a.NUMBER,t.numType=U.NumberType.FLOAT):"integer"===r||"long"===r?(t.type=O.a.NUMBER,t.numType=U.NumberType.INTEGER):t.type="boolean"===r?O.a.BOOLEAN:O.a.TEXT),t},e}(),V=r(39),B=r(108),W=r(20),H=r(112),q=angular.module("ngeoAngularFilters",[]);q.Scalify=function(e){var t=e("number"),r=function(e){var r=t(e,0);return r?"1 : "+r:""};return r.$stateful=!0,r},q.Scalify.$inject=["$filter"],q.filter("ngeoScalify",q.Scalify),q.Number=function(e){var t=e.NUMBER_FORMATS;return function(e,r){var a=t.GROUP_SEP,n=t.DECIMAL_SEP;if(void 0===r&&(r=3),e===1/0)return"∞";if(e===-1/0)return"-∞";if(0===e)return"0";var o=e<0;e=Math.abs(e);var i=r-Math.floor(Math.log(e)/Math.log(10))-1,s=Math.pow(10,i);e=Math.round(e*s);var l="",u=Math.floor(e/s);if(i>0){for(var c=""+e;c.length<i;)c="0"+c;for(l=c.substring(c.length-i);"0"===l[l.length-1];)l=l.substring(0,l.length-1)}for(var h=[],p=""+u;p.length>3;){var g=p.length-3;h.unshift(p.substring(g)),p=p.substring(0,g)}return h.unshift(p),(o?"-":"")+h.join(a)+(0===l.length?"":n+l)}},q.Number.$inject=["$locale"],q.filter("ngeoNumber",q.Number),q.UnitPrefix=function(e){var t=e("ngeoNumber"),r=["","k","M","G","T","P"],a=["","Ki","Mi","Gi","Ti","Pi"];return function(e,n,o,i){void 0===n&&(n="");var s=1e3,l=r;"square"===o?s=1e6:"binary"===o&&(s=1024,l=a);for(var u=0,c=l.length-1;e>=s&&u<c;)e/=s,u++;var h=l[u]+n,p=0==h.length?"":" ";return t(e,i)+p+h}},q.UnitPrefix.$inject=["$filter"],q.filter("ngeoUnitPrefix",q.UnitPrefix),q.NumberCoordinates=function(e){return function(t,r,a){var n=a||"{x} {y}",o=t[0],i=t[1],s=0|parseInt(r,10);return o=e("number")(o,s),i=e("number")(i,s),n.replace("{x}",o).replace("{y}",i)}},q.NumberCoordinates.$inject=["$filter"],q.filter("ngeoNumberCoordinates",q.NumberCoordinates),q.DMSCoordinates=function(){var e=function(e,t,r){var a=W.d(e+180,360)-180,n=Math.abs(3600*a),o=Math.floor(n/3600),i=Math.floor(n/60%60),s=n%60;return o+"° "+H.b(i,2)+"′ "+H.b(s,2,r)+"″ "+t.charAt(a<0?1:0)};return function(t,r,a){var n=0|parseInt(r,10),o=a||"{x} {y}",i=e(t[0],"EW",n),s=e(t[1],"NS",n);return o.replace("{x}",i).replace("{y}",s)}},q.filter("ngeoDMSCoordinates",q.DMSCoordinates),q.trustHtmlFilter=function(e){return function(t){return void 0!==t&&null!==t?e.trustAsHtml(""+t):e.trustAsHtml("&nbsp;")}},q.trustHtmlFilter.$inject=["$sce"],q.filter("ngeoTrustHtml",q.trustHtmlFilter),q.Duration=function(e){var t=Object.freeze({SECONDS:Symbol("seconds"),MINUTES:Symbol("minutes"),HOURS:Symbol("hours"),DAYS:Symbol("days")}),r=function(r,a){var n="";switch(a){case t.SECONDS:n=e.getPlural(r,"second","seconds");break;case t.MINUTES:n=e.getPlural(r,"minute","minutes");break;case t.HOURS:n=e.getPlural(r,"hour","hours");break;case t.DAYS:n=e.getPlural(r,"day","days")}return r+" "+n};return function(e){var a=void 0;if((e=Math.round(e))<60)return r(e,t.SECONDS);var n=e%60;return(e=Math.floor(e/60))<60?(a=r(e,t.MINUTES),n>0&&(a+=" "+r(n,t.SECONDS)),a):(n=e%60,(e=Math.floor(e/60))<24?(a=r(e,t.HOURS),n>0&&(a+=" "+r(n,t.MINUTES)),a):(n=e%24,e=Math.floor(e/24),a=r(e,t.DAYS),n>0&&(a+=" "+r(n,t.HOURS)),a))}},q.Duration.$inject=["gettextCatalog"],q.filter("ngeoDuration",q.Duration);var K=q,Y=r(78),z=r(271),Q=angular.module("ngeoDownload",[]);Q.factory_=function(){return function(e,t,r){var a=void 0===r||Y.a.isSafari()?"text/plain;charset=utf-8":r,n=new Blob([e],{type:a});Object(z.saveAs)(n,t)}},Q.factory("ngeoDownload",Q.factory_);var X=Q,Z=r(26),J={CIRCLE:"Circle",LINE_STRING:"LineString",MULTI_LINE_STRING:"MultiLineString",MULTI_POINT:"MultiPoint",MULTI_POLYGON:"MultiPolygon",POINT:"Point",POLYGON:"Polygon",RECTANGLE:"Rectangle",TEXT:"Text"},ee=r(51),te=r(10),re=r(124),ae=r(194),ne=r(35),oe=r(91),ie=r(82),se=r(55),le=r(46),ue=r(16),ce=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ne.a.call(this,{handleEvent:e.handleEvent_}),this.helpTooltipElement_=null,this.helpTooltipOverlay_=null,this.measureTooltipElement_=null,this.measureTooltipOverlay_=null,this.measureTooltipOverlayCoord_=null,this.sketchFeature=null,this.continueMsg=null,this.decimals=t.decimals,this.precision=t.precision,this.displayHelpTooltip_=void 0===t.displayHelpTooltip||t.displayHelpTooltip,this.startMsg,void 0!==t.startMsg?this.startMsg=t.startMsg:(this.startMsg=document.createElement("span"),this.startMsg.textContent="Click to start drawing."),this.changeEventKey_=null,this.postcomposeEventKey_=null;var r=void 0!==t.style?t.style:[new ue.c({fill:new se.a({color:"rgba(255, 255, 255, 0.2)"})}),new ue.c({stroke:new le.a({color:"white",width:5})}),new ue.c({stroke:new le.a({color:"#ffcc33",width:3})})];this.vectorLayer_=new oe.a({source:new ie.b,style:r}),this.drawInteraction_=this.createDrawInteraction(t.sketchStyle,this.vectorLayer_.getSource()),this.shouldHandleDrawInteractionActiveChange_=!0,E.a(this.drawInteraction_,"change:active",this.handleDrawInteractionActiveChange_,this),E.a(this.drawInteraction_,"drawstart",this.onDrawStart_,this),E.a(this.drawInteraction_,"drawend",this.onDrawEnd_,this),E.a(this,"change:active",this.updateState_,this)};f.d(ce,ne.a),ce.getFormattedArea=function(e,t,r,a){var n=e.clone().transform(t,"EPSG:4326");return a(Math.abs(ae.a(n,{projection:"EPSG:4326"})),"m²","square",r)},ce.getFormattedCircleArea=function(e,t,r){return r(Math.PI*Math.pow(e.getRadius(),2),"m²","square",t)},ce.getFormattedLength=function(e,t,r,a){for(var n=0,o=e.getCoordinates(),i=0,s=o.length-1;i<s;++i){var l=te.k(o[i],t,"EPSG:4326"),u=te.k(o[i+1],t,"EPSG:4326");n+=ae.b(l,u)}return a(n,"m","unit",r)},ce.getFormattedPoint=function(e,t,r,a){return r(e.getCoordinates(),t,a)},ce.handleEvent_=function(e){if("pointermove"!=e.type||e.dragging)return!0;var t=null===this.sketchFeature?this.startMsg:this.continueMsg;return this.displayHelpTooltip_&&(ee.d(this.helpTooltipElement_),this.helpTooltipElement_.appendChild(t),this.helpTooltipOverlay_.setPosition(e.coordinate)),!0},ce.prototype.getDrawInteraction=function(){return this.drawInteraction_},ce.prototype.createDrawInteraction=function(e,t){},ce.prototype.setMap=function(e){ne.a.prototype.setMap.call(this,e),this.vectorLayer_.setMap(e);var t=this.drawInteraction_.getMap();null!==t&&t.removeInteraction(this.drawInteraction_),null!==e&&e.addInteraction(this.drawInteraction_)},ce.prototype.onDrawStart_=function(e){var t=this;this.sketchFeature=e.feature||e.detail.feature,this.vectorLayer_.getSource().clear(!0),this.createMeasureTooltip_();var r=this.sketchFeature.getGeometry();i.a.assert(void 0!==r),this.changeEventKey_=E.a(r,"change",function(){t.handleMeasure(function(e,r){null!==r&&(t.measureTooltipElement_.innerHTML=e,t.measureTooltipOverlayCoord_=r)})}),this.postcomposeEventKey_=E.a(this.getMap(),"postcompose",function(){t.measureTooltipOverlay_.setPosition(t.measureTooltipOverlayCoord_)})},ce.prototype.onDrawEnd_=function(e){this.measureTooltipElement_.classList.add("ngeo-tooltip-static"),this.measureTooltipOverlay_.setOffset([0,-7]);var t=new d.a("measureend",{feature:this.sketchFeature});this.dispatchEvent(t),this.sketchFeature=null,this.unlistenerEvent_()},ce.prototype.unlistenerEvent_=function(){null!==this.changeEventKey_&&null!==this.postcomposeEventKey_&&(E.e(this.changeEventKey_),E.e(this.postcomposeEventKey_),this.changeEventKey_=null,this.postcomposeEventKey_=null)},ce.prototype.createHelpTooltip_=function(){this.removeHelpTooltip_(),this.displayHelpTooltip_&&(this.helpTooltipElement_=document.createElement("div"),this.helpTooltipElement_.classList.add("tooltip"),this.helpTooltipOverlay_=new re.a({element:this.helpTooltipElement_,offset:[15,0],positioning:"center-left"}),this.getMap().addOverlay(this.helpTooltipOverlay_))},ce.prototype.removeHelpTooltip_=function(){this.displayHelpTooltip_&&(this.getMap().removeOverlay(this.helpTooltipOverlay_),null!==this.helpTooltipElement_&&this.helpTooltipElement_.parentNode.removeChild(this.helpTooltipElement_),this.helpTooltipElement_=null,this.helpTooltipOverlay_=null)},ce.prototype.createMeasureTooltip_=function(){this.removeMeasureTooltip_(),this.measureTooltipElement_=document.createElement("div"),this.measureTooltipElement_.classList.add("tooltip"),this.measureTooltipElement_.classList.add("ngeo-tooltip-measure"),this.measureTooltipOverlay_=new re.a({element:this.measureTooltipElement_,offset:[0,-15],positioning:"bottom-center",stopEvent:!1}),this.getMap().addOverlay(this.measureTooltipOverlay_)},ce.prototype.removeMeasureTooltip_=function(){null!==this.measureTooltipElement_&&(this.measureTooltipElement_.parentNode.removeChild(this.measureTooltipElement_),this.measureTooltipElement_=null,this.measureTooltipOverlay_=null,this.measureTooltipOverlayCoord_=null)},ce.prototype.updateState_=function(){var e=this.getActive();this.shouldHandleDrawInteractionActiveChange_=!1,this.drawInteraction_.setActive(e),this.shouldHandleDrawInteractionActiveChange_=!0,this.getMap()&&(e?this.measureTooltipOverlay_||(this.createMeasureTooltip_(),this.createHelpTooltip_()):(this.vectorLayer_.getSource().clear(!0),this.getMap().removeOverlay(this.measureTooltipOverlay_),this.removeMeasureTooltip_(),this.removeHelpTooltip_(),this.unlistenerEvent_()))},ce.prototype.handleMeasure=function(e){},ce.prototype.getTooltipElement=function(){return this.measureTooltipElement_},ce.prototype.handleDrawInteractionActiveChange_=function(){this.shouldHandleDrawInteractionActiveChange_&&this.setActive(this.drawInteraction_.getActive())};var he=ce,pe={getDefaultDrawStyleFunction:function(){var e=Object(ue.b)();return function(t,r){return e[t.getGeometry().getType()]}},getDefaultModifyStyleFunction:function(){var e=Object(ue.b)();return function(t,r){return e.Point}}},ge=pe,de=r(30),fe=r(32),me=r(190),ye=r(151),ve=r(53),_e=r(41),Se=r(22),be=function e(t){Se.b.call(this,{handleDownEvent:e.handleDownEvent_,handleEvent:e.handleEvent_,handleUpEvent:e.handleUpEvent_}),this.downPx_=null,this.source_=void 0!==t.source?t.source:null,this.started_=!1,this.sketchFeature_=null,this.sketchPoint_=null,this.squaredClickTolerance_=4,this.sketchLayer_=new oe.a({source:new ie.b({useSpatialIndex:!1,wrapX:!1}),style:t.style||ge.getDefaultDrawStyleFunction()}),E.a(this,"change:active",this.updateState_,this)};f.d(be,Se.b),be.handleDownEvent_=function(e){return this.downPx_=e.pixel,!0},be.handleUpEvent_=function(e){var t=this.downPx_,r=e.pixel,a=t[0]-r[0],n=t[1]-r[1],o=!0;return a*a+n*n<=this.squaredClickTolerance_&&(this.handlePointerMove_(e),this.started_?this.finishDrawing_():this.startDrawing_(e),o=!1),o},be.handleEvent_=function(e){var t=!0;return"pointermove"===e.type?t=this.handlePointerMove_(e):"dblclick"===e.type&&(t=!1),Se.c.call(this,e)&&t},be.prototype.handlePointerMove_=function(e){return this.started_?this.modifyDrawing_(e):this.createOrUpdateSketchPoint_(e),!0},be.prototype.createOrUpdateSketchPoint_=function(e){var t=e.coordinate.slice();if(null===this.sketchPoint_)this.sketchPoint_=new de.a(new _e.a(t)),this.updateSketchFeatures_();else{var r=this.sketchPoint_.getGeometry();i.a.assertInstanceof(r,_e.a),r.setCoordinates(t)}},be.prototype.updateSketchFeatures_=function(){var e=[];null!==this.sketchFeature_&&e.push(this.sketchFeature_),null!==this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.sketchLayer_.getSource();t.clear(!0),t.addFeatures(e)},be.prototype.startDrawing_=function(e){var t=e.coordinate;this.started_=!0;var r=new ve.a([t.slice(),t.slice()]),a=new me.a(t,0),n=new ye.a([r,a]);i.a.assert(void 0!==n),this.sketchFeature_=new de.a,this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_();var o=new d.a("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(o)},be.prototype.modifyDrawing_=function(e){var t=e.coordinate,r=i.a.assertInstanceof(this.sketchFeature_.getGeometry(),ye.a).getGeometriesArray(),a=r[0];i.a.assertInstanceof(a,ve.a);var n=a.getCoordinates(),o=this.sketchPoint_.getGeometry();i.a.assertInstanceof(o,_e.a),o.setCoordinates(t);var s=n[n.length-1];s[0]=t[0],s[1]=t[1],i.a.assertInstanceof(a,ve.a),a.setCoordinates(n),i.a.assertInstanceof(r[1],me.a).setRadius(a.getLength()),this.updateSketchFeatures_()},be.prototype.abortDrawing_=function(){this.started_=!1;var e=this.sketchFeature_;return null!==e&&(this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLayer_.getSource().clear(!0)),e},be.prototype.shouldStopEvent=fe.a,be.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();null!==e&&t||this.abortDrawing_(),this.sketchLayer_.setMap(t?e:null)},be.prototype.finishDrawing_=function(){var e=this.abortDrawing_();i.a.assert(null!==e),null!==this.source_&&this.source_.addFeature(e);var t=new d.a("drawend",{feature:this.sketchFeature_});this.dispatchEvent(t)},be.prototype.setMap=function(e){Se.b.prototype.setMap.call(this,e),this.updateState_()};var we=be,Ce=r(155),Te=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};he.call(this,r),this.continueMsg,void 0!==r.continueMsg?this.continueMsg=r.continueMsg:(this.continueMsg=document.createElement("span"),this.continueMsg.textContent="Click to finish."),this.numberFormat=i.a.assert(t),this.unitPrefixFormat=i.a.assert(e)};f.d(Te,he),Te.prototype.createDrawInteraction=function(e,t){return new we({source:t,style:e})},Te.prototype.handleMeasure=function(e){var t=i.a.assertInstanceof(this.sketchFeature.getGeometry(),ye.a),r=i.a.assertInstanceof(t.getGeometries()[0],ve.a);e(Te.getFormattedAzimutRadius(r,i.a.assertInstanceof(this.getMap().getView().getProjection(),Ce.a),this.decimals,this.precision,this.unitPrefixFormat,this.numberFormat),r.getLastCoordinate())},Te.getFormattedAzimutRadius=function(e,t,r,a,n,o){var i=Te.getFormattedAzimut(e,r,o);return i+=", "+he.getFormattedLength(e,t,a,n)},Te.getFormattedAzimut=function(e,t,r){return r(Te.getAzimut(e),t)+"°"},Te.getAzimut=function(e){var t=e.getCoordinates(),r=t[1][0]-t[0][0],a=t[1][1]-t[0][1],n=Math.acos(a/Math.sqrt(r*r+a*a));return(r>0?1:-1)*n*180/Math.PI%360};var Ee=Te,Le=r(8),Me=r(107),Ae=r(5),Fe=r(105),Pe=r(116),Re=r(45),ke=r(115),xe=r(277),De=r(273),Oe=r(106),$e=r(136),Ie=r(171),Ne=function(e,t){if(this.$filter_=t,this.decimals_=void 0,e.has("ngeoMeasureDecimals")&&(this.decimals_=e.get("ngeoMeasureDecimals")),this.precision_=void 0,e.has("ngeoMeasurePrecision")&&(this.precision_=e.get("ngeoMeasurePrecision")),this.numberFormat_=t("number"),this.unitPrefixFormat_=t("ngeoUnitPrefix"),this.ngeoNumberCoordinates_=t("ngeoNumberCoordinates"),this.pointFilterFn_=null,this.pointFilterArgs_=[],e.has("ngeoPointfilter")){var r=e.get("ngeoPointfilter").split(":"),a=r.shift(),n=this.$filter_(a);i.a.assertFunction(n),this.pointFilterFn_=n,this.pointFilterArgs_=r}else this.pointFilterFn_=null;this.projection_,this.download_=e.get("ngeoDownload")};Ne.$inject=["$injector","$filter"],Ne.$inject=["$injector","$filter"],Ne.prototype.setProjection=function(e){this.projection_=e},Ne.prototype.setStyle=function(e,t){var r=this.getStyle(e);t&&(this.supportsVertex_(e)&&r.push(this.getVertexStyle()),r.unshift(this.getHaloStyle_(e))),e.setStyle(r)},Ne.prototype.getStyle=function(e){var t=void 0;switch(this.getType(e)){case J.LINE_STRING:t=this.getLineStringStyle_(e);break;case J.POINT:t=this.getPointStyle_(e);break;case J.CIRCLE:case J.POLYGON:case J.RECTANGLE:t=this.getPolygonStyle_(e);break;case J.TEXT:t=this.getTextStyle_(e)}i.a.assert(t,"Style should be thruthy");return t.constructor===Array?t:[t]},Ne.prototype.getLineStringStyle_=function(e){var t=this.getStrokeProperty(e),r=this.getShowLabelProperty(e),a=this.getShowMeasureProperty(e),n=this.getRGBAColorProperty(e),o=[new ue.c({stroke:new le.a({color:n,width:t})})],i=[];if(a&&i.push(this.getMeasure(e)),r&&i.push(this.getNameProperty(e)),r||a){var s=i.join("\n");o.push(new ue.c({text:this.createTextStyle_({text:s})}))}return o},Ne.prototype.getPointStyle_=function(e){var t=this.getSizeProperty(e),r=this.getRGBAColorProperty(e),a=this.getShowLabelProperty(e),n=this.getShowMeasureProperty(e),o=[new ue.c({image:new Oe.a({radius:t,fill:new se.a({color:r})})})],i=[];if(n&&i.push(this.getMeasure(e)),a&&i.push(this.getNameProperty(e)),a||n){var s=i.join("\n");o.push(new ue.c({text:this.createTextStyle_({text:s,size:10,offsetY:-(t+5*i.length*1.3+4)})}))}return o},Ne.prototype.optNumber=function(e,t){var r=e.get(t);return void 0!==r?"string"==typeof r?+r:i.a.assertNumber(r):void 0},Ne.prototype.getNumber=function(e,t){var r=e.get(t);return"string"==typeof r?+r:i.a.assertNumber(r)},Ne.prototype.getPolygonStyle_=function(e){var t=this.getStrokeProperty(e),r=this.getOpacityProperty(e),a=this.getRGBAColorProperty(e),n=this.getShowLabelProperty(e),o=this.getShowMeasureProperty(e),i=a.slice();i[3]=r;var s=this.optNumber(e,Z.a.AZIMUT),l=[new ue.c({fill:new se.a({color:i}),stroke:new le.a({color:a,width:t})})];if(o||n)if(o&&void 0!==s){var u=this.getRadiusLine(e,s),c=he.getFormattedLength(u,this.projection_,this.precision_,this.unitPrefixFormat_);l.push(new ue.c({geometry:u,fill:new se.a({color:i}),stroke:new le.a({color:a,width:t}),text:this.createTextStyle_({text:c,angle:(s%180+180)%180-90})})),l.push(new ue.c({geometry:new _e.a(u.getLastCoordinate()),text:this.createTextStyle_({text:this.numberFormat_(s,this.decimals_)+"°",size:10,offsetX:20*Math.cos((s-90)*Math.PI/180),offsetY:20*Math.sin((s-90)*Math.PI/180)})})),n&&l.push(new ue.c({text:this.createTextStyle_({text:this.getNameProperty(e),offsetY:-8,exceedLength:!0})}))}else{var h=[];if(o&&h.push(this.getMeasure(e)),n&&h.push(this.getNameProperty(e)),n||o){var p=h.join("\n");l.push(new ue.c({text:this.createTextStyle_({text:p,exceedLength:!0})}))}}return l},Ne.prototype.getTextStyle_=function(e){return new ue.c({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),color:this.getRGBAColorProperty(e),width:this.getStrokeProperty(e)})})},Ne.prototype.createEditingStyles=function(e){var t=[255,255,255,1],r=[0,153,255,1],a=[],n=e.getGeometry();console.assert(n);var o=n.getType();return"Point"===o?a.push(new ue.c({image:new Oe.a({radius:6,fill:new se.a({color:r}),stroke:new le.a({color:t,width:1.5})}),zIndex:1/0})):("LineString"===o?(a.push(new ue.c({stroke:new le.a({color:t,width:5})})),a.push(new ue.c({stroke:new le.a({color:r,width:3})}))):a.push(new ue.c({stroke:new le.a({color:r,width:1.5}),fill:new se.a({color:[255,255,255,.5]})})),a.push(this.getVertexStyle(!0))),a},Ne.prototype.getVertexStyle=function(e){var t=void 0===e||e,r={image:new $e.a({radius:6,points:4,angle:Math.PI/4,fill:new se.a({color:[255,255,255,.5]}),stroke:new le.a({color:[0,0,0,1]})})};return t&&(r.geometry=function(e){var t=e.getGeometry();if("Point"!=t.getType()){var r=void 0,a=[],n=[],o=void 0,i=void 0;if(t instanceof ve.a?n=t.getCoordinates():t instanceof Fe.a?a=t.getCoordinates():t instanceof Re.b?n=t.getCoordinates()[0]:t instanceof ke.a&&(r=t.getCoordinates()),r)for(o=0,i=r.length;o<i;o++)a=a.concat(r[o]);for(o=0,i=a.length;o<i;o++)n=n.concat(a[o]);return n.length?new Pe.a(n):t}}),new ue.c(r)},Ne.prototype.supportsVertex_=function(e){var t=[J.LINE_STRING,J.POLYGON,J.RECTANGLE],r=this.getType(e);return Le.f(t,r)},Ne.prototype.getHaloStyle_=function(e){var t=void 0;switch(this.getType(e)){case J.POINT:var r=this.getSizeProperty(e);t=new ue.c({image:new Oe.a({radius:r+3,fill:new se.a({color:[255,255,255,1]})})});break;case J.LINE_STRING:case J.CIRCLE:case J.POLYGON:case J.RECTANGLE:var a=this.getStrokeProperty(e);t=new ue.c({stroke:new le.a({color:[255,255,255,1],width:a+6})});break;case J.TEXT:t=new ue.c({text:this.createTextStyle_({text:this.getNameProperty(e),size:this.getSizeProperty(e),angle:this.getAngleProperty(e),width:9})})}return i.a.assert(t,"Style should be thruthy"),t},Ne.getFilteredFeatureValues=function(e){var t=e.getProperties();return delete t.boundedBy,delete t[e.getGeometryName()],delete t.ngeo_feature_type_,t},Ne.prototype.getAngleProperty=function(e){var t=+e.get(Z.a.ANGLE);return i.a.assertNumber(t),t},Ne.prototype.getColorProperty=function(e){var t=i.a.assertString(e.get(Z.a.COLOR));return i.a.assertString(t),t},Ne.prototype.getRGBAColorProperty=function(e){return Me.c(this.getColorProperty(e))},Ne.prototype.getNameProperty=function(e){var t=i.a.assertString(e.get(Z.a.NAME));return i.a.assertString(t),t},Ne.prototype.getOpacityProperty=function(e){return this.getNumber(e,Z.a.OPACITY)},Ne.prototype.getShowMeasureProperty=function(e){var t=e.get(Z.a.SHOW_MEASURE);return void 0===t?t=!1:"string"==typeof t&&(t="true"===t),i.a.assertBoolean(t)},Ne.prototype.getShowLabelProperty=function(e){var t=e.get(Z.a.SHOW_LABEL);return void 0===t?t=!1:"string"==typeof t&&(t="true"===t),i.a.assertBoolean(t)},Ne.prototype.getSizeProperty=function(e){return this.getNumber(e,Z.a.SIZE)},Ne.prototype.getStrokeProperty=function(e){return this.getNumber(e,Z.a.STROKE)},Ne.prototype.export=function(e,t){switch(t){case Ne.FormatType.GPX:this.exportGPX(e);break;case Ne.FormatType.KML:this.exportKML(e)}},Ne.prototype.exportGPX=function(e){var t=new xe.a;this.export_(e,t,"export.gpx","application/gpx+xml")},Ne.prototype.exportKML=function(e){var t=new De.a;this.export_(e,t,"export.kml","application/vnd.google-earth.kml+xml")},Ne.prototype.export_=function(e,t,r,a){var n=this,o=void 0!==a?a:"text/plain",i=[],s=void 0;e.forEach(function(e){s=new de.a(e.getProperties()),n.setStyle(s,!1),i.push(s)});var l=this.projection_?{dataProjection:"EPSG:4326",featureProjection:this.projection_}:{},u=t.writeFeatures(i,l);this.download_(u,r,o+";charset=utf-8")},Ne.prototype.createTextStyle_=function(e){if(e.angle){var t=(void 0!==e.angle?e.angle:0)*Math.PI/180;e.rotation=t,delete e.angle}return e.font=["normal",(e.size||10)+"pt","Arial"].join(" "),e.color&&(e.fill=new se.a({color:e.color||[0,0,0,1]}),delete e.color),e.stroke=new le.a({color:[255,255,255,1],width:e.width||3}),delete e.width,new Ie.a(e)},Ne.prototype.getMeasure=function(e){var t=e.getGeometry();i.a.assert(t,"Geometry should be truthy");var r="";if(t instanceof Re.b)if(this.getType(e)===J.CIRCLE){var a=this.optNumber(e,Z.a.AZIMUT);i.a.assertNumber(a);var n=this.getRadiusLine(e,a);r=Ee.getFormattedAzimutRadius(n,this.projection_,this.decimals_,this.precision_,this.unitPrefixFormat_,this.numberFormat_)}else r=he.getFormattedArea(t,this.projection_,this.precision_,this.unitPrefixFormat_);else if(t instanceof ve.a)r=he.getFormattedLength(t,this.projection_,this.precision_,this.unitPrefixFormat_);else if(t instanceof _e.a)if(null===this.pointFilterFn_)r=he.getFormattedPoint(t,this.decimals_,this.ngeoNumberCoordinates_);else{var o=t.getCoordinates(),s=this.pointFilterArgs_.slice(0);s.unshift(o),r=this.pointFilterFn_.apply(this,s)}return r},Ne.prototype.getType=function(e){var t=e.getGeometry();i.a.assert(t,"Geometry should be thruthy");var r=void 0;return t instanceof _e.a?r=e.get(Z.a.IS_TEXT)?J.TEXT:J.POINT:t instanceof Pe.a?r=J.MULTI_POINT:t instanceof Re.b?r=e.get(Z.a.IS_CIRCLE)?J.CIRCLE:e.get(Z.a.IS_RECTANGLE)?J.RECTANGLE:J.POLYGON:t instanceof ke.a?r=J.MULTI_POLYGON:t instanceof ve.a?r=J.LINE_STRING:t instanceof Fe.a&&(r=J.MULTI_LINE_STRING),i.a.assert(r,"Type should be thruthy"),r},Ne.prototype.panMapToFeature=function(e,t,r){var a=void 0!==r?r:250,n=t.getSize();i.a.assertArray(n);var o=t.getView(),s=o.calculateExtent(n),l=e.getGeometry();if(!l.intersectsExtent(s)){var u=o.getCenter();i.a.assertArray(u);var c=void 0;c=l instanceof ve.a?l.getCoordinateAt(.5):l instanceof Re.b?l.getInteriorPoint().getCoordinates():l instanceof _e.a?l.getCoordinates():Ae.x(l.getExtent()),o.animate({center:u,duration:a},{center:c,duration:a})}},Ne.prototype.getRadiusLine=function(e,t){var r=e.getGeometry(),a=r.getExtent(),n=(a[3]-a[1])/2,o=Ae.x(r.getExtent()),i=Math.cos((t-90)*Math.PI/180)*n,s=-Math.sin((t-90)*Math.PI/180)*n,l=[i+o[0],s+o[1]];return new ve.a([o,l])},Ne.prototype.getNonSpatialProperties=function(e){var t=e.getGeometryName(),r={},a=e.getProperties();for(var n in a)n!==t&&(r[n]=a[n]);return r},Ne.prototype.clearNonSpatialProperties=function(e){var t=e.getGeometryName(),r=e.getProperties();for(var a in r)a!==t&&e.set(a,void 0)},Ne.FormatType={GPX:"GPX",KML:"KML"},(Ne.module=angular.module("ngeoFeatureHelper",[X.name,K.name])).service("ngeoFeatureHelper",Ne);var Ge=Ne,Ue=r(89),je=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var Ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active_=!0===t.active,this.expression=void 0!==t.expression?t.expression:null,this.lowerBoundary_=void 0!==t.lowerBoundary?t.lowerBoundary:null,this.operator_=t.operator||null,this.upperBoundary_=void 0!==t.upperBoundary?t.upperBoundary:null,this.isCustom_=!1!==t.isCustom,this.name_=t.name,this.operators_=t.operators||null,this.propertyName_=t.propertyName,this.type_=i.a.assert(t.type),this.listenerKeys=[]}return e.prototype.getExpression=function(){return this.expression},e.prototype.setExpression=function(e){this.expression=e},e.prototype.reset=function(){null!==this.getExpression()&&this.setExpression(null),null!==this.lowerBoundary&&(this.lowerBoundary=null),null!==this.upperBoundary&&(this.upperBoundary=null)},e.prototype.destroy=function(){this.listenerKeys.forEach(E.e),this.listenerKeys.length=0},je(e,[{key:"active",get:function(){return this.active_},set:function(e){this.active_=e}},{key:"lowerBoundary",get:function(){return this.lowerBoundary_},set:function(e){this.lowerBoundary_=e}},{key:"operator",get:function(){return this.operator_},set:function(e){this.operator_=e}},{key:"upperBoundary",get:function(){return this.upperBoundary_},set:function(e){this.upperBoundary_=e}},{key:"isCustom",get:function(){return this.isCustom_}},{key:"name",get:function(){return this.name_}},{key:"operators",get:function(){return this.operators_}},{key:"propertyName",get:function(){return this.propertyName_}},{key:"type",get:function(){return this.type_}},{key:"value",get:function(){var t=null,r=this.getExpression(),a=this.lowerBoundary,n=this.operator,o=this.propertyName,i=this.upperBoundary;return n&&(n===e.OperatorType.BETWEEN||n===e.TemporalOperatorType.DURING?null!==a&&null!==i&&(t={operator:n,lowerBoundary:a,propertyName:o,upperBoundary:i}):null!==r&&(t={expression:r,operator:n,propertyName:o})),t}}]),e}();Ve.OperatorType={BETWEEN:"..",EQUAL_TO:"=",GREATER_THAN:">",GREATER_THAN_OR_EQUAL_TO:">=",LESSER_THAN:"<",LESSER_THAN_OR_EQUAL_TO:"<=",LIKE:"~",NOT_EQUAL_TO:"!="},Ve.SpatialOperatorType={CONTAINS:"contains",INTERSECTS:"intersects",WITHIN:"within"},Ve.TemporalOperatorType={BEGINS:"time_start",DURING:"time_during",ENDS:"time_end",EQUALS:"time_equal"};var Be=Ve;var We=function(e){function t(r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.type=r.type||O.a.DATE,function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(Be),He=r(231),qe=r(83),Ke=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var Ye=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.type=O.a.GEOMETRY;var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r)),n=r.featureProperties||{};return a.feature_=new de.a(n),a.format_=new He.a,a.updatingExpression_=!1,a.updatingGeometry_=!1,a.geometryChangeListenerKey_=null,a.listenerKeys.push(E.a(a.feature_,"change:"+a.feature.getGeometryName(),a.handleFeatureGeometryChange_,a)),a.setGeometryFromExpression_(),a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.setExpression=function(t){this.updatingExpression_=!0,e.prototype.setExpression.call(this,t),this.updatingGeometry_||this.setGeometryFromExpression_(),this.registerGeometryChange_(),this.updatingExpression_=!1},t.prototype.handleFeatureGeometryChange_=function(){if(!this.updatingExpression_){this.updatingGeometry_=!0;var e=this.feature_.getGeometry();this.expression=e?this.format_.writeGeometry(e):null,this.registerGeometryChange_(),this.updatingGeometry_=!1}},t.prototype.handleGeometryChange_=function(e){var t=i.a.assertInstanceof(e.target,qe.a);this.updatingGeometry_=!0,this.expression=this.format_.writeGeometry(t),this.updatingGeometry_=!1},t.prototype.setGeometryFromExpression_=function(){var e=null;if(this.expression){var t=i.a.assertString(this.expression);e=this.format_.readGeometry(t)}this.geometry=e},t.prototype.registerGeometryChange_=function(){null!==this.geometryChangeListenerKey_&&(E.e(this.geometryChangeListenerKey_),this.geometryChangeListenerKey_=null);var e=this.feature_.getGeometry();e&&(this.geometryChangeListenerKey_=E.a(e,"change",this.handleGeometryChange_,this))},Ke(t,[{key:"feature",get:function(){return this.feature_}},{key:"geometry",get:function(){return this.feature_.getGeometry()||null},set:function(e){this.feature_.setGeometry(e)}}]),t}(Be),ze=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var Qe=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.operator=Be.OperatorType.EQUAL_TO,r.type=O.a.SELECT;var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return a.choices_=r.choices,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),ze(t,[{key:"choices",get:function(){return this.choices_}},{key:"selectedChoices",get:function(){var e=void 0;this.expression?e=String(this.expression).split(","):e=[];return e}}]),t}(Be);var Xe=function(e){function t(r){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r.operator=r.operator||Be.OperatorType.LIKE,r.type=O.a.TEXT,function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(Be),Ze=r(172),Je=r(52),et=r(103);var tt=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gettextCatalog_=t,this.ngeoFeatureHelper_=r,this.ngeoWMSTime_=a}return e.$inject=["gettextCatalog","ngeoFeatureHelper","ngeoWMSTime"],e.prototype.createRulesFromAttributes=function(e,t){var r=[],a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;r.push(this.createRuleFromAttribute(s,t))}return r},e.prototype.createRuleFromAttribute=function(e,t){var r=void 0,a=!0===t,n=this.gettextCatalog_.getString(e.name);switch(e.type){case O.a.DATE:case O.a.DATETIME:r=new We(a?{name:n,operator:Be.TemporalOperatorType.EQUALS,operators:[Be.TemporalOperatorType.EQUALS,Be.TemporalOperatorType.BEGINS,Be.TemporalOperatorType.ENDS],propertyName:e.name,type:e.type}:{name:n,operator:Be.TemporalOperatorType.DURING,propertyName:e.name,type:e.type});break;case O.a.GEOMETRY:r=new Ye({name:n,operator:Be.SpatialOperatorType.WITHIN,operators:[Be.SpatialOperatorType.CONTAINS,Be.SpatialOperatorType.INTERSECTS,Be.SpatialOperatorType.WITHIN],propertyName:e.name,type:e.type});break;case O.a.NUMBER:r=new Be(a?{name:n,operator:Be.OperatorType.EQUAL_TO,operators:[Be.OperatorType.EQUAL_TO,Be.OperatorType.GREATER_THAN,Be.OperatorType.GREATER_THAN_OR_EQUAL_TO,Be.OperatorType.LESSER_THAN,Be.OperatorType.LESSER_THAN_OR_EQUAL_TO,Be.OperatorType.NOT_EQUAL_TO],propertyName:e.name,type:O.a.NUMBER}:{name:n,operator:Be.OperatorType.BETWEEN,propertyName:e.name,type:O.a.NUMBER});break;case O.a.SELECT:r=new Qe({choices:i.a.assert(e.choices),name:n,propertyName:e.name});break;default:r=new Xe(a?{name:n,operator:Be.OperatorType.LIKE,operators:[Be.OperatorType.LIKE,Be.OperatorType.EQUAL_TO,Be.OperatorType.NOT_EQUAL_TO],propertyName:e.name}:{name:n,operator:Be.OperatorType.LIKE,propertyName:e.name})}return r},e.prototype.createRules=function(e){var t=[],r=e,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;t.push(this.createRule(i))}return t},e.prototype.createRule=function(e){var t=void 0;switch(e.type){case O.a.DATE:case O.a.DATETIME:t=new We(e);break;case O.a.GEOMETRY:t=new Ye(e);break;case O.a.SELECT:var r=e;i.a.assert(r.choices),t=new Qe(r);break;default:t=new Xe(e)}return t},e.prototype.cloneRule=function(e){var t=void 0,r=e.getExpression();null===r&&(r=void 0);var a={expression:r,isCustom:e.isCustom,lowerBoundary:null!==e.lowerBoundary?e.lowerBoundary:void 0,name:e.name,operator:null!==e.operator?e.operator:void 0,operators:e.operators?e.operators.slice(0):void 0,propertyName:e.propertyName,type:null!==e.type?e.type:void 0,upperBoundary:null!==e.upperBoundary?e.upperBoundary:void 0};return e instanceof We?t=new We(a):e instanceof Ye?(t=new Ye(a)).feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(e.feature)):e instanceof Qe?(a.choices=e.choices.slice(0),t=new Qe(a)):t=e instanceof Xe?new Xe(a):new Be(a),t},e.prototype.extendRule=function(e,t){t.getExpression()!==e.getExpression()&&t.setExpression(e.getExpression()),t.lowerBoundary!==e.lowerBoundary&&(t.lowerBoundary=e.lowerBoundary),t.operator!==e.operator&&(t.operator=e.operator),t.upperBoundary!==e.upperBoundary&&(t.upperBoundary=e.upperBoundary),e instanceof Ye&&t instanceof Ye&&(this.ngeoFeatureHelper_.clearNonSpatialProperties(t.feature),t.feature.setProperties(this.ngeoFeatureHelper_.getNonSpatialProperties(e.feature)))},e.prototype.serializeRules=function(e){var t=this;return e.map(function(e){return t.serializeRule(e)})},e.prototype.serializeRule=function(e){var t={name:e.name,propertyName:e.propertyName,type:e.type};return null!==e.expression&&(t.expression=e.expression),null!==e.lowerBoundary&&(t.lowerBoundary=e.lowerBoundary),null!==e.operator&&(t.operator=e.operator),null!==e.operators&&(t.operators=e.operators.slice(0)),null!==e.upperBoundary&&(t.upperBoundary=e.upperBoundary),e instanceof Ye&&(t.featureProperties=this.ngeoFeatureHelper_.getNonSpatialProperties(e.feature)),e instanceof Qe&&(t.choices=e.choices),t},e.prototype.createFilter=function(e){var t=e.dataSource,r=null;if(e.filter)r=e.filter;else{var a=e.filterRules||t.filterRules,n=[];if(a&&a.length){var o=a,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var u=l,c=this.createFilterFromRule_(u,t,e.srsName);c&&n.push(c)}}var h=t.filterCondition;1===n.length?r=n[0]:n.length>=2&&(h===B.a.AND?r=Je.and.apply(null,n):h!==B.a.OR&&h!==B.a.NOT||(r=Je.or.apply(null,n))),r&&h===B.a.NOT&&(r=Je.not(r))}if(e.incTime){var p=this.createTimeFilterFromDataSource_(t);p&&(r=r?Je.and.apply(null,[r,p]):p)}if(e.incDimensions){var g=this.createDimensionsFilterFromDataSource_(t);g&&(r=r?Je.and.apply(null,[r,g]):g)}return r},e.prototype.createFilterString=function(e){var t=null,r=this.createFilter(e);if(r){var a=Object(Ze.b)(r);t=(new XMLSerializer).serializeToString(a)}return t},e.prototype.createFilterFromRule_=function(e,t,r){var a=null,n=e.value;if(!n)return null;var o=n.expression,s=n.lowerBoundary,l=n.operator,u=n.propertyName,c=n.upperBoundary,h=Be.OperatorType,p=Be.SpatialOperatorType,g=Be.TemporalOperatorType,d=[p.CONTAINS,p.INTERSECTS,p.WITHIN],f=[h.GREATER_THAN,h.GREATER_THAN_OR_EQUAL_TO,h.LESSER_THAN,h.LESSER_THAN_OR_EQUAL_TO];if(e instanceof We){var m=void 0,y=void 0;l===g.DURING?(m=Object(et.a)(s).format("YYYY-MM-DD"),y=Object(et.a)(c).format("YYYY-MM-DD")):l===g.EQUALS?(m=Object(et.a)(o).format("YYYY-MM-DD HH:mm:ss"),y=Object(et.a)(o).add(1,"days").subtract(1,"seconds").format("YYYY-MM-DD HH:mm:ss")):l===g.BEGINS?(m=Object(et.a)(o).format("YYYY-MM-DD"),y=Object(et.a)(o).add(30,"years").format("YYYY-MM-DD")):l===g.ENDS&&(m="1970-01-01",y=Object(et.a)(o).format("YYYY-MM-DD")),m&&y&&(a=Je.during(u,m,y))}else if(e instanceof Qe){var v=e.selectedChoices;if(1===v.length)a=Je.equalTo(u,v[0]);else if(v.length>=2){var _=[],S=v,b=Array.isArray(S),w=0;for(S=b?S:S[Symbol.iterator]();;){var C;if(b){if(w>=S.length)break;C=S[w++]}else{if((w=S.next()).done)break;C=w.value}var T=C;_.push(Je.equalTo(u,T))}a=Je.or.apply(null,_)}}else if(Le.f(d,l)){var E=t.geometryName;i.a.assertInstanceof(e,Ye);var L=i.a.assert(e.geometry);l===p.CONTAINS?a=Je.contains(E,L,r):l===p.INTERSECTS?a=Je.intersects(E,L,r):l===p.WITHIN&&(a=Je.within(E,L,r))}else if(Le.f(f,l)){var M=i.a.assertNumber(o);l===h.GREATER_THAN?a=Je.greaterThan(u,M):l===h.GREATER_THAN_OR_EQUAL_TO?a=Je.greaterThanOrEqualTo(u,M):l===h.LESSER_THAN?a=Je.lessThan(u,M):l===h.LESSER_THAN_OR_EQUAL_TO&&(a=Je.lessThanOrEqualTo(u,M))}else if(l===h.BETWEEN)a=Je.between(u,s,c);else if(l===h.EQUAL_TO)a=Je.equalTo(u,o);else if(l===h.LIKE){var A=String(o).replace(/!/g,"!!").replace(/\./g,"!.").replace(/\*/g,"!*");a=Je.like(u,"*"+A+"*","*",".","!",!1)}else l===h.NOT_EQUAL_TO&&(a=Je.notEqualTo(u,o));return a},e.prototype.createDimensionsFilterFromDataSource_=function(e){var t=e.dimensionsFiltersConfig,r=e.dimensions,a=[];for(var n in t){var o=t[n].value;null===o&&void 0!==r[n]&&null!==r[n]&&(o=r[n]),null!==o&&a.push(Je.equalTo(t[n].field,o,!0))}return 1===a.length?a[0]:a.length>=2?Je.and.apply(null,a):null},e.prototype.createTimeFilterFromDataSource_=function(e){var t=null,r=e.timeRangeValue,a=e.timeProperty,n=e.timeAttributeName;if(r&&a&&n)if(void 0!==r.end){var o=this.ngeoWMSTime_.formatWMSTimeParam(a,r).split("/");t=Je.during(n,o[0],o[1])}else{var i=a.resolution||"seconds",s=this.ngeoWMSTime_.formatWMSTimeParam(a,r),l=void 0;switch(i){case"year":l=Object(et.a)(s).add(1,"years").subtract(1,"seconds");break;case"month":l=Object(et.a)(s).add(1,"months").subtract(1,"seconds");break;case"day":l=Object(et.a)(s).add(1,"days").subtract(1,"seconds")}if(l){var u=Object(et.a)(s).format("YYYY-MM-DD HH:mm:ss"),c=l.format("YYYY-MM-DD HH:mm:ss");t=Je.during(n,u,c)}}return t},e}();tt.module=angular.module("ngeoRuleHelper",[Ge.module.name,Ue.a.module.name]),tt.module.service("ngeoRuleHelper",tt);var rt=tt,at=r(0),nt=function(){N.a.call(this)};f.d(nt,N.a),nt.prototype.read,nt.prototype.readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null},nt.prototype.readFromNode=function(e){var t={};return t=at.u(t,nt.PARSERS_,e,[])},nt.readElement_=function(e,t){for(var r={},a=0,n=e.attributes.length;a<n;a++){var o=e.attributes.item(a);r[o.name]=o.value}return 1===t.length&&(r.type=r.type.split(":").pop()),r},nt.readComplexType_=function(e,t){var r=e.getAttribute("name"),a=at.u({name:r},nt.COMPLEX_TYPE_PARSERS_,e,t);return a.complexContent=a.complexContent.extension.sequence.element,a},nt.readComplexContent_=function(e,t){return at.u({},nt.COMPLEX_CONTENT_PARSERS_,e,t)},nt.readExtension_=function(e,t){return at.u({},nt.EXTENSION_PARSERS_,e,t)},nt.readSequence_=function(e,t){return at.u({},nt.SEQUENCE_PARSERS_,e,t)},nt.NAMESPACE_URIS_=[null,"http://www.w3.org/2001/XMLSchema"],nt.PARSERS_=i.a.assert(at.r(nt.NAMESPACE_URIS_,{element:at.m(nt.readElement_),complexType:at.m(nt.readComplexType_)})),nt.COMPLEX_TYPE_PARSERS_=i.a.assert(at.r(nt.NAMESPACE_URIS_,{complexContent:at.n(nt.readComplexContent_)})),nt.COMPLEX_CONTENT_PARSERS_=i.a.assert(at.r(nt.NAMESPACE_URIS_,{extension:at.n(nt.readExtension_)})),nt.EXTENSION_PARSERS_=i.a.assert(at.r(nt.NAMESPACE_URIS_,{sequence:at.n(nt.readSequence_)})),nt.SEQUENCE_PARSERS_=i.a.assert(at.r(nt.NAMESPACE_URIS_,{element:at.m(nt.readElement_)}));var ot=nt,it=r(360),st=r(272),lt=r(11),ut=r(142);var ct=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.http_=t,this.q_=r,this.ngeoRuleHelper_=a,this.ngeoWMSTime_=n,this.requestCancelers_=[],this.wmsGetCapabilitiesPromises_={},this.wmtsGetCapabilitiesPromises_={}}return e.$inject=["$http","$q","ngeoRuleHelper","ngeoWMSTime"],e.prototype.issue=function(e){var t=[],r=e.map;this.cancelStillRunningRequests_();var a=void 0;if(e.queryableDataSources)a=e.queryableDataSources;else{var n=e.dataSources;i.a.assert(n,"DataSources should be set"),a=this.getQueryableDataSources(n,r)}var o=this.getCombinableWFSDataSources_(a.wfs);if(t.push(this.issueCombinedWFS_(o,e)),e.coordinate){var s=this.getCombinableWMSDataSources_(a.wms);t.push(this.issueCombinedWMS_(s,e))}return this.q_.all(t).then(this.handleCombinedQueryResult_.bind(this))},e.prototype.getQueryableDataSources=function(e,t){var r={wfs:[],wms:[]},a=i.a.assertNumber(t.getView().getResolution()),n=e,o=Array.isArray(n),s=0;for(n=o?n:n[Symbol.iterator]();;){var l;if(o){if(s>=n.length)break;l=n[s++]}else{if((s=n.next()).done)break;l=s.value}var u=l;this.isDataSourceQueryable_(u,a)&&(u instanceof V.a&&(u.supportsWFS?r.wfs.push(u):r.wms.push(u)))}return r},e.prototype.wfsDescribeFeatureType=function(e){i.a.assert(e.supportsAttributes,"The data source must support WFS, have a single OGCLayer that\n      is queryable in order to issue WFS DescribeFeatureType requests");var t=e.getOGCLayerNames(),r=ut.a(i.a.assertString(e.wfsUrl),{REQUEST:"DescribeFeatureType",SERVICE:"WFS",VERSION:"2.0.0",TYPENAME:t});return this.http_.get(r).then(function(e){return(new ot).read(e.data)})},e.prototype.wmsFindLayerCapability=function(e,t){var r=null,a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.Name===t){r=s;break}if(s.Layer&&(r=this.wmsFindLayerCapability(s.Layer,t)))break}return r},e.prototype.wmsGetCapabilities=function(e,t){var r=!1!==t,a=ut.a(e,{REQUEST:"GetCapabilities",SERVICE:"WMS",VERSION:"1.3.0"}),n=void 0;return r&&this.wmsGetCapabilitiesPromises_[e]?r&&this.wmsGetCapabilitiesPromises_[e]&&(n=this.wmsGetCapabilitiesPromises_[e]):n=this.http_.get(a).then(function(e){return(new it.a).read(e.data)}),i.a.assert(n),r&&!this.wmsGetCapabilitiesPromises_[e]&&(this.wmsGetCapabilitiesPromises_[e]=n),n},e.prototype.wmtsFindLayerCapability=function(e,t){var r=null,a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.Identifier===t){r=s;break}}return r},e.prototype.wmtsGetCapabilities=function(e,t){var r=!1!==t,a=void 0;return r&&this.wmtsGetCapabilitiesPromises_[e]?r&&this.wmtsGetCapabilitiesPromises_[e]&&(a=this.wmtsGetCapabilitiesPromises_[e]):a=this.http_.get(e).then(function(e){return(new st.a).read(e.data)}),i.a.assert(a),r&&!this.wmtsGetCapabilitiesPromises_[e]&&(this.wmtsGetCapabilitiesPromises_[e]=a),a},e.prototype.handleCombinedQueryResult_=function(e){var t={},r=e,a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;for(var s in i){var l=Number(s);t[l]=i[l]}}return t},e.prototype.handleQueryResult_=function(e,t,r,a){var n={},o=e,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var u=l,c=void 0,h=void 0,p=void 0;"number"==typeof a?(c=[],h=!0,p=a):c=u instanceof V.a?this.readAndTypeFeatures_(u,a.data,r):[];var g=u.id;this.setUniqueIds_(c,u.id),n[g]={features:c,limit:t,tooManyFeatures:h,totalFeatureCount:p}}return n},e.prototype.readAndTypeFeatures_=function(e,t,r){var a=this,n=[],o=void 0,i=this.getSetOlFormatTypes_(e,r).slice();return i.forEach(function(i){a.getSetOlFormatTypes_(e,r,[i]),(o=r?e.wfsFormat.readFeatures(t):e.wmsFormat.readFeatures(t)).length>0&&o.forEach(function(e){e.set("ngeo_feature_type_",i),n.push(e)})}),this.getSetOlFormatTypes_(e,r,i),n},e.prototype.getSetOlFormatTypes_=function(e,t,r){var a=void 0;return t?(r&&e.wfsFormat.setFeatureType(r),a=e.wfsFormat.getFeatureType()):(r&&e.wmsFormat.setLayers(r),a=e.wmsFormat.getLayers()),a?Array.isArray(a)?a:[a]:[]},e.prototype.issueCombinedWFS_=function(e,t){var r=this,a=[],n=i.a.assertNumber(t.limit),o=t.map.getView(),s=i.a.assertNumber(o.getResolution()),l=o.getProjection().getCode(),u=!0===t.wfsCount,c=void 0,h=t.coordinate;if(h){var p=t.tolerancePx;i.a.assert(p);var g=p*s;c=Ae.c(Ae.m(h),g)}else c=t.extent;var d=new Ze.a,f=new XMLSerializer,m=function(e){var o=void 0,h=void 0,p=[],g=void 0,m={},y=e,v=Array.isArray(y),_=0;for(y=v?y:y[Symbol.iterator]();;){var S;if(v){if(_>=y.length)break;S=y[_++]}else{if((_=y.next()).done)break;S=_.value}var b=S;if(!o){h=b.wfsFeatureNS;var w=b.wfsFeaturePrefix,C=b.geometryName,T=b.wfsOutputFormat;o={bbox:c,featureNS:h,featurePrefix:w,geometryName:C,outputFormat:T,srsName:l},g=b.wfsUrl,lt.a(m,b.activeDimensions)}p=p.concat(b.getInRangeOGCLayerNames(s,!0));var E=void 0;t.filter?E=r.ngeoRuleHelper_.createFilter({dataSource:b,filter:t.filter,incDimensions:!0,incTime:!0}):(b.filterRules&&b.filterRules.length||b.timeRangeValue||b.dimensionsFiltersConfig&&Object.keys(b.dimensionsFiltersConfig).length>0)&&(i.a.assert(1===e.length,"A data source having filterRules or timeRangeValue should issue\n            a single query, alone."),E=r.ngeoRuleHelper_.createFilter({dataSource:b,incDimensions:!0,incTime:!0,srsName:l})),E&&(o.filter=E)}i.a.assert(o),o.featureTypes=p,i.a.assert(g);var L=r.q_.defer();a.push(L.promise.then(r.handleQueryResult_.bind(r,e,n,!0)));var M=void 0;if(u){var A=lt.a({resultType:"hits"},o),F=d.writeGetFeature(A),P=f.serializeToString(F),R=r.registerCanceler_();M=r.http_.post(g,P,{params:m,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:R.promise}).then(function(t){return e[0].wfsFormat.readFeatureCollectionMetadata(t.data).numberOfFeatures}.bind(r))}else M=r.q_.resolve();M.then(function(e){if(void 0===e||e<n){var t=lt.a({maxFeatures:n},o),a=d.writeGetFeature(t),s=f.serializeToString(a);i.a.assertString(g);var l=r.registerCanceler_();r.http_.post(g,s,{params:m,headers:{"Content-Type":"text/xml; charset=UTF-8"},timeout:l.promise}).then(function(e){L.resolve(e)})}else L.resolve(e)})},y=e,v=Array.isArray(y),_=0;for(y=v?y:y[Symbol.iterator]();;){var S;if(v){if(_>=y.length)break;S=y[_++]}else{if((_=y.next()).done)break;S=_.value}m(S)}return this.q_.all(a).then(this.handleCombinedQueryResult_.bind(this))},e.prototype.issueCombinedWMS_=function(e,t){var r=[],a=i.a.assertNumber(t.limit),n=t.map.getView(),o=i.a.assertNumber(n.getResolution()),s=n.getProjection().getCode(),l=t.coordinate;i.a.assert(l);var u=e,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}var g=p,d=void 0,f=[],m=void 0,y=!1,v={},S=null,b=null,w=g,C=Array.isArray(w),T=0;for(w=C?w:w[Symbol.iterator]();;){var E;if(C){if(T>=w.length)break;E=w[T++]}else{if((T=w.next()).done)break;E=T.value}var L=E;m||(m=L.wmsInfoFormat,d=L.wmsUrl),f=f.concat(L.getInRangeOGCLayerNames(o,!0)),y||(lt.a(v,L.activeDimensions),y=!0),L.filterRules&&L.filterRules.length&&(i.a.assert(1===g.length),b=L.getFiltrableOGCLayerName(),S=this.ngeoRuleHelper_.createFilterString({dataSource:L,srsName:s})),null!==L.timeRangeValue&&L.timeProperty&&(i.a.assert(1===g.length),v.TIME=this.ngeoWMSTime_.formatWMSTimeParam(L.timeProperty,L.timeRangeValue))}if(v.LAYERS=f,v.QUERY_LAYERS=f,S&&b){var M=null;if(1===f.length)M=S;else{for(var A=[],F=0,P=f.length;F<P;F++)f[F]===b?A.push("("+S+")"):A.push("()");M=A.join("")}v.FILTER=M}i.a.assert(d);var R=new _.a({params:v,url:d}),k=i.a.assertString(R.getGetFeatureInfoUrl(l,o,s,{FEATURE_COUNT:a,INFO_FORMAT:m})),x=this.registerCanceler_();r.push(this.http_.get(k,{timeout:x.promise}).then(this.handleQueryResult_.bind(this,g,a,!1)))}return this.q_.all(r).then(this.handleCombinedQueryResult_.bind(this))},e.prototype.getCombinableWFSDataSources_=function(e){var t=[],r=[],a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.combinableForWFS){var l=!1,u=t,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}var g=p;s.combinableWithDataSourceForWFS(g[0])&&(g.push(s),l=!0)}l||t.push([s])}else r.push([s])}return t.concat(r)},e.prototype.getCombinableWMSDataSources_=function(e){var t=[],r=[],a=e,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;if(s.combinableForWMS){var l=!1,u=t,c=Array.isArray(u),h=0;for(u=c?u:u[Symbol.iterator]();;){var p;if(c){if(h>=u.length)break;p=u[h++]}else{if((h=u.next()).done)break;p=h.value}var g=p;s.combinableWithDataSourceForWMS(g[0])&&(g.push(s),l=!0)}l||t.push([s])}else r.push([s])}return t.concat(r)},e.prototype.isDataSourceQueryable_=function(e,t){var r=e.visible&&e.inRange&&e.queryable;r&&e instanceof V.a&&(r=e.isAnyOGCLayerInRange(t,!0));return r},e.prototype.setUniqueIds_=function(e,t){e.forEach(function(e){if(void 0!==e.getId()){var r=t+"_"+e.getId();e.setId(r)}})},e.prototype.registerCanceler_=function(){var e=this.q_.defer();return this.requestCancelers_.push(e),e},e.prototype.cancelStillRunningRequests_=function(){var e=this.requestCancelers_,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}a.resolve()}this.requestCancelers_.length=0},e}();ct.CombinedDataSources,ct.module=angular.module("ngeoQuerent",[rt.module.name,Ue.a.module.name]),ct.module.service("ngeoQuerent",ct);var ht=ct,pt=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var gt=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.q_=t,this.collection_=r.collection,this.ngeoQuerent_=a,this.cache_={},E.a(this.collection_,"add",this.handleDataSourcesAdd_,this),E.a(this.collection_,"remove",this.handleDataSourcesRemove_,this)}return e.$inject=["$q","ngeoDataSources","ngeoQuerent"],e.prototype.getDataSource=function(e){return this.cache_[e]||null},e.prototype.getDataSourceAttributes=function(e){var t=this.q_.defer();return e.attributes?t.resolve(e.attributes):this.ngeoQuerent_.wfsDescribeFeatureType(e).then(function(r){var a=e.getOGCLayerNames()[0];i.a.assertString(a,"The data source should have only one ogcLayer.");var n=r.element,o=Array.isArray(n),s=0;for(n=o?n:n[Symbol.iterator]();;){var l;if(o){if(s>=n.length)break;l=n[s++]}else{if((s=n.next()).done)break;l=s.value}var u=l;if(u.name===a){var c=r.complexType,h=Array.isArray(c),p=0;for(c=h?c:c[Symbol.iterator]();;){var g;if(h){if(p>=c.length)break;g=c[p++]}else{if((p=c.next()).done)break;g=p.value}var d=g;if(d.name==u.type){var f=d.complexContent,m=(new j).read(f);e.setAttributes(m),t.resolve(m);break}}}}}),t.promise},e.prototype.handleDataSourcesAdd_=function(e){var t=i.a.assertInstanceof(e.element,x.a);this.cache_[t.id]=t},e.prototype.handleDataSourcesRemove_=function(e){var t=i.a.assertInstanceof(e.element,x.a);delete this.cache_[t.id]},pt(e,[{key:"collection",get:function(){return this.collection_}}]),e}();gt.module=angular.module("ngeoDataSourcesHelper",[D.a.module.name,ht.module.name]),gt.module.service("ngeoDataSourcesHelper",gt);var dt=gt,ft=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var mt=function(){function e(t,r,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.q_=t,this.gmfEnumerateAttribute_=r,this.ngeoDataSourcesHelper_=a,this.collection_,this.cache_}return e.$inject=["$q","gmfEnumerateAttribute","ngeoDataSourcesHelper"],e.prototype.getDataSource=function(e){return this.ngeoDataSourcesHelper_.getDataSource(e)},e.prototype.prepareFiltrableDataSource=function(e){var t=this,r=this.q_.defer();return this.ngeoDataSourcesHelper_.getDataSourceAttributes(e).then(function(a){var n=(e.gmfLayer.metadata||{}).enumeratedAttributes;if(n&&n.length){var o=[],i=function(r){!Le.f(n,r.name)||r.type===O.a.SELECT||r.choices&&r.choices.length||o.push(t.gmfEnumerateAttribute_.getAttributeValues(e,r.name).then(function(e){var t=e.map(function(e){return e.value});r.type=O.a.SELECT,r.choices=t}))},s=a,l=Array.isArray(s),u=0;for(s=l?s:s[Symbol.iterator]();;){var c;if(l){if(u>=s.length)break;c=s[u++]}else{if((u=s.next()).done)break;c=u.value}i(c)}return t.q_.all(o).then(r.resolve(e))}r.resolve(e)}),r.promise},ft(e,[{key:"collection",get:function(){return this.ngeoDataSourcesHelper_.collection}}]),e}();mt.module=angular.module("gmfDataSourcesHelper",[dt.module.name,k.module.name]),mt.module.service("gmfDataSourcesHelper",mt);var yt=mt,vt=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var _t=function(e){function t(r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this,r));return a.gmfLayer_=r.gmfLayer,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),vt(t,[{key:"gmfLayer",get:function(){return this.gmfLayer_}}]),t}(V.a);var St=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.ngeoDataSourcesHelper_=t}return e.$inject=["ngeoDataSourcesHelper"],e.prototype.describe=function(e){"qgisserver"===e.ogcServerType&&e.wfsUrl_&&1==e.getOGCLayerNames().length&&!e.attributes&&this.ngeoDataSourcesHelper_.getDataSourceAttributes(e)},e}();St.module=angular.module("gmfDatasourceWFSAliases",[dt.module.name]),St.module.service("gmfWFSAliases",St);var bt=St,wt=r(132),Ct=r(98),Tt=r(168),Et=r(175);var Lt=function(){function e(t,r,a,n,o,i,s,l,u,c,h){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.q_=t,this.rootScope_=r,this.timeout_=a,this.gmfThemes_=n,this.gmfTreeManager_=o,this.ngeoBackgroundLayerMgr_=i,this.ngeoDataSources_=s,this.dataSources_=s.collection,this.ngeoLayerHelper_=l,this.ngeoRuleHelper_=u,this.ngeoWMSTime_=c,this.gmfWFSAliases_=h,this.dataSourcesCache_={},this.dimensions_,this.dimensionsWatcherUnregister=null,this.treeCtrlCache_={},this.treeCtrlsUnregister_=null,E.a(this.ngeoBackgroundLayerMgr_,"change",this.handleNgeoBackgroundLayerChange_,this),E.a(this.gmfThemes_,"change",this.handleThemesChange_,this)}return e.$inject=["$q","$rootScope","$timeout","gmfThemes","gmfTreeManager","ngeoBackgroundLayerMgr","ngeoDataSources","ngeoLayerHelper","ngeoRuleHelper","ngeoWMSTime","gmfWFSAliases"],e.prototype.setDatasourceMap=function(e){this.ngeoDataSources_.map=e},e.prototype.setDimensions=function(e){var t=this;this.dimensionsWatcherUnregister&&this.dimensionsWatcherUnregister(),this.dimensions_=e,this.dimensionsWatcherUnregister=this.rootScope_.$watch(function(){return t.dimensions_},this.handleDimensionsChange_.bind(this),!0),this.handleDimensionsChange_()},e.prototype.handleDimensionsChange_=function(){var e=[],t=[],r=this.dataSources_.getArray(),a=Array.isArray(r),n=0;for(r=a?r:r[Symbol.iterator]();;){var o;if(a){if(n>=r.length)break;o=r[n++]}else{if((n=r.next()).done)break;o=n.value}var i=o;if(i.dimensionsFiltersConfig)for(var s in i.dimensionsFiltersConfig)if(null===i.dimensionsFiltersConfig[s].value){var l=this.getDataSourceLayer_(i);if(void 0==l)return;var u=f.c(l);-1==t.indexOf(u)&&(e.push(l),t.push(u))}}e.forEach(this.updateLayerFilter_.bind(this))},e.prototype.handleThemesChange_=function(){var e=this;this.clearDataSources_(),this.treeCtrlsUnregister_&&this.treeCtrlsUnregister_(),this.clearTreeCtrlCache_(),this.gmfThemes_.getOgcServersObject().then(function(t){var r=e.gmfThemes_.getThemesObject().then(function(r){var a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var s;if(n){if(o>=a.length)break;s=a[o++]}else{if((o=a.next()).done)break;s=o.value}var l=s.children,u=Array.isArray(l),c=0;for(l=u?l:l[Symbol.iterator]();;){var h;if(u){if(c>=l.length)break;h=l[c++]}else{if((c=l.next()).done)break;h=c.value}var p=h;i.a.assert(p),e.createDataSource_(p,p,t)}}}),a=e.gmfThemes_.getBackgroundLayersObject().then(function(r){var a=r,n=Array.isArray(a),o=0;for(a=n?a:a[Symbol.iterator]();;){var i;if(n){if(o>=a.length)break;i=a[o++]}else{if((o=a.next()).done)break;i=o.value}var s=i;e.createDataSource_(null,s,t)}});e.q_.all([r,a]).then(function(){e.treeCtrlsUnregister_=e.rootScope_.$watchCollection(function(){if(e.gmfTreeManager_.rootCtrl)return e.gmfTreeManager_.rootCtrl.children},e.handleTreeManagerRootChildrenChange_.bind(e))})})},e.prototype.handleTreeManagerRootChildrenChange_=function(e){var t=this;this.timeout_(function(){if(e){for(var r=[],a=function(e,t){t.node.children||e.push(t)},n=0,o=e.length;n<o;n++)e[n].traverseDepthFirst(a.bind(t,r));for(var i=0,s=r.length;i<s;i++){var l=r[i];t.getTreeCtrlCacheItem_(l)||t.addTreeCtrlToCache_(l)}var u=t.treeCtrlCache_;for(var c in t.treeCtrlCache_){var h=u[c];r.includes(h.treeCtrl)||t.removeTreeCtrlCacheItem_(h)}}})},e.prototype.clearDataSources_=function(){for(var e=this.dataSources_.getArray(),t=e.length-1;t>=0;t--)this.dataSourcesCache_[e[t].id]&&this.dataSources_.remove(e[t]);lt.b(this.dataSourcesCache_)},e.prototype.createDataSource_=function(e,t,r){var a=t.children;if(a){var n=a,o=Array.isArray(n),s=0;for(n=o?n:n[Symbol.iterator]();;){var l;if(o){if(s>=n.length)break;l=n[s++]}else{if((s=n.next()).done)break;l=s.value}var u=l;i.a.assert(u),this.createDataSource_(e,u,r)}}else{var c=t,h=f.c(c);if(!this.dataSourcesCache_[h]){var p=c.metadata,d=c.type,m=void 0,y=void 0,v=void 0,_=void 0,S=void 0,b=void 0,w=void 0,C=void 0;if(d===g.a.NodeType.WMTS){var T=c;S=T.layer,b=T.url,m=p.maxResolution,y=p.minResolution;var E=p.queryLayers||p.wmsLayers;E&&(v=E.split(",").map(function(e){return{maxResolution:m,minResolution:y,name:e,queryable:!0}})),p.ogcServer&&r[p.ogcServer]&&(_=r[p.ogcServer]),w=T.imageType}else if(d===g.a.NodeType.WMS){var L=c;m=L.maxResolutionHint,y=L.minResolutionHint,v=L.childLayers.map(function(e){return{maxResolution:e.maxResolutionHint,minResolution:e.minResolutionHint,name:e.name,queryable:e.queryable}});var M=!e||e.mixed?L.ogcServer:e.ogcServer;i.a.assert(M),w=(_=r[M]).imageType,L.time?C=L.time:e&&e.time&&(C=e.time)}var A=_?_.type:void 0,F=_?_.isSingleTile:void 0,P=_&&_.wfsSupport?_.urlWfs:void 0,R=_?_.url:void 0,k=V.a.WFSOutputFormat.GML3;A===V.a.ServerType.QGISSERVER&&(k=V.a.WFSOutputFormat.GML2);var x=!!p.snappingConfig,D=p.snappingConfig?p.snappingConfig.tolerance:void 0,O=p.snappingConfig?p.snappingConfig.edge:void 0,$=p.snappingConfig?p.snappingConfig.vertex:void 0,I=this.dimensions_,N=t.dimensions||e.dimensions,G=t.dimensions_filters,U=void 0,j=void 0;if(C){var B=this.ngeoWMSTime_.getOptions(C).values;Array.isArray(B)?(U=B[0],j=B[1]):U=B}var W=p.copyable,H=p.identifierAttributeField,q=c.name,K=p.timeAttribute,Y=!0===p.isChecked;this.dataSourcesCache_[h]=new _t({copyable:W,dimensions:I,dimensionsConfig:N,dimensionsFiltersConfig:G,gmfLayer:c,id:h,identifierAttribute:H,maxResolution:m,minResolution:y,name:q,ogcImageType:w,ogcLayers:v,ogcServerType:A,ogcType:d,snappable:x,snappingTolerance:D,snappingToEdges:O,snappingToVertice:$,timeAttributeName:K,timeLowerValue:U,timeProperty:C,timeUpperValue:j,visible:Y,wfsOutputFormat:k,wfsUrl:P,wmsIsSingleTile:F,wmsUrl:R,wmtsLayer:S,wmtsUrl:b})}}},e.prototype.addTreeCtrlToCache_=function(e){var t=f.c(e.node),r=this.dataSourcesCache_[t];i.a.assert(r,"DataSource should be set"),e.setDataSource(r);var a=this.rootScope_.$watch(function(){return e.getState()},this.handleTreeCtrlStateChange_.bind(this,e)),n=this.rootScope_.$watch(function(){var e=null!==r.filterRules,t=r.visible;return e&&t},this.handleDataSourceFilterRulesChange_.bind(this,r)),o=void 0,s=void 0,l=void 0;r.timeProperty&&r.ogcType===V.a.Type.WMS&&(o=this.rootScope_.$watch(function(){return r.timeLowerValue},this.handleDataSourceTimeValueChange_.bind(this,r)),"range"===r.timeProperty.mode&&(s=this.rootScope_.$watch(function(){return r.timeUpperValue},this.handleDataSourceTimeValueChange_.bind(this,r))),l=i.a.assertInstanceof(wt.a.getLayer(e),Et.a)),this.treeCtrlCache_[t]={filterRulesWatcherUnregister:n,stateWatcherUnregister:a,timeLowerValueWatcherUnregister:o,timeUpperValueWatcherUnregister:s,treeCtrl:e,wmsLayer:l},this.dataSources_.push(r),this.gmfWFSAliases_.describe(r)},e.prototype.removeTreeCtrlCacheItem_=function(e){var t=e.treeCtrl.getDataSource();i.a.assert(t,"DataSource should be set"),this.dataSources_.remove(t),e.treeCtrl.setDataSource(null),e.filterRulesWatcherUnregister(),e.stateWatcherUnregister(),e.timeLowerValueWatcherUnregister&&e.timeLowerValueWatcherUnregister(),e.timeUpperValueWatcherUnregister&&e.timeUpperValueWatcherUnregister(),delete this.treeCtrlCache_[f.c(e.treeCtrl.node)]},e.prototype.clearTreeCtrlCache_=function(){for(var e in this.treeCtrlCache_)this.removeTreeCtrlCacheItem_(this.treeCtrlCache_[e])},e.prototype.handleTreeCtrlStateChange_=function(e,t){var r=e.getDataSource();i.a.assert(r,"DataSource should be set");var a="on"===t;r.visible=a;var n=this.getDataSourceLayer_(r);void 0!=n&&this.updateLayerFilter_(n)},e.prototype.getTreeCtrlCacheItem_=function(e){return this.treeCtrlCache_[f.c(e.node)]||null},e.prototype.getDataSourceLayer_=function(e){e=e;var t=f.c(e.gmfLayer),r=this.treeCtrlCache_[t];if(void 0!=r){var a=r.treeCtrl;return wt.a.getLayer(a)}},e.prototype.updateLayerFilter_=function(e){var t;i.a.assert(e instanceof Et.a||e instanceof Tt.a);var r=e.getSource();if(r instanceof _.a||r instanceof S.a){var a=r.getParams().LAYERS.split(",");i.a.assert(a.length>=1);for(var n=[],o=!1,s=0,l=a.length;s<l;s++){var u="()",c=this.dataSources_.getArray(),h=Array.isArray(c),p=0;for(c=h?c:c[Symbol.iterator]();;){var g;if(h){if(p>=c.length)break;g=c[p++]}else{if((p=c.next()).done)break;g=p.value}var d=g,m=this.getDataSourceLayer_(d);if(void 0!=m&&(f.c(m)==f.c(e)&&a[s]===d.name)){var y=f.c(d.gmfLayer),v=this.treeCtrlCache_[y];i.a.assert(v);var b=v.treeCtrl.map.getView().getProjection().getCode(),w=d.visible?this.ngeoRuleHelper_.createFilterString({dataSource:d,projCode:b,incDimensions:!0}):null;w&&(u="("+w+")",o=!0)}}n.push(u)}r.updateParams(((t={}).FILTER=o?n.join(""):null,t))}},e.prototype.handleDataSourceFilterRulesChange_=function(e,t){if(!0===e.filtrable&&e.ogcType===V.a.Type.WMS){var r=this.getDataSourceLayer_(e);void 0!=r&&this.updateLayerFilter_(r)}},e.prototype.handleDataSourceTimeValueChange_=function(e){var t=f.c(e.gmfLayer),r=this.treeCtrlCache_[t];i.a.assert(r);var a=i.a.assert(r.wmsLayer),n=i.a.assertInstanceof(a.getSource(),_.a),o=i.a.assert(e.timeProperty),s=void 0,l=e.timeRangeValue;l&&(s=this.ngeoWMSTime_.formatWMSTimeParam(o,l)),n.getParams().TIME!==s&&this.ngeoLayerHelper_.updateWMSLayerState(a,n.getParams().LAYERS,s)},e.prototype.handleNgeoBackgroundLayerChange_=function(e){var t=e.detail.previous,r=e.detail.current,a=this.dataSourcesCache_;if(t){var n=t.get("querySourceIds");if(Array.isArray(n)){var o=n,i=Array.isArray(o),s=0;for(o=i?o:o[Symbol.iterator]();;){var l;if(i){if(s>=o.length)break;l=o[s++]}else{if((s=o.next()).done)break;l=s.value}var u=a[l];u&&(u.visible=!1,this.dataSources_.remove(u))}}}if(r){var c=r.get("querySourceIds");if(Array.isArray(c)){var h=c,p=Array.isArray(h),g=0;for(h=p?h:h[Symbol.iterator]();;){var d;if(p){if(g>=h.length)break;d=h[g++]}else{if((g=h.next()).done)break;d=g.value}var f=a[d];f&&(f.visible=!0,this.dataSources_.push(f))}}}},e}();Lt.module=angular.module("gmfDataSourcesManager",[bt.module.name,wt.a.module.name,Ct.a.module.name,g.a.module.name,rt.module.name,D.a.module.name,T.module.name,w.a.module.name,Ue.a.module.name]),Lt.module.service("gmfDataSourcesManager",Lt);var Mt=Lt,At=angular.module("gmfDatasourceModule",[F.a.module.name,P.a.module.name,yt.module.name,Mt.module.name,bt.module.name]),Ft=r(153),Pt=r(40),Rt=(r(249),r(227),angular.module("ngeoPopup",["ngSanitize"]));Rt.value("ngeoPopupTemplateUrl",function(e,t){var r=t.ngeoPopupTemplateurl;return void 0!==r?r:"ngeo/message/popupcomponent"}),Rt.run(["$templateCache",function(e){e.put("ngeo/message/popupcomponent",r(342))}]),Rt.directive_=function(e){return{restrict:"A",templateUrl:e,link:function(e,t,r){t.addClass("popover"),e.close=function(e){e&&(e.stopPropagation(),e.preventDefault()),t.addClass("hidden")},e.$watch("open",function(e,r){t.css("display",e?"block":"none")})}}},Rt.directive_.$inject=["ngeoPopupTemplateUrl"],Rt.directive("ngeoPopup",Rt.directive_);var kt=Rt,xt=function(e,t,r,a){var n=this;this.scope=t.$new(!0),this.scope.$watch(function(){return n.scope.open},function(e){!e&&n.autoDestroy_&&n.timeout_(function(){n.destroy()})}),this.sce_=r,this.timeout_=a,this.element_=angular.element("<div ngeo-popup></div>"),this.autoDestroy_=!1,e(this.element_)(this.scope),angular.element(document.body).append(this.element_)};xt.prototype.getOpen=function(){return this.scope.open},xt.prototype.setOpen=function(e){this.scope.open=e},xt.prototype.destroy=function(){this.scope.$destroy(),this.element_.remove()},xt.prototype.setTitle=function(e){var t=this.sce_.trustAsHtml(e);this.scope.title=t},xt.prototype.setContent=function(e,t){this.scope.content=t?this.sce_.trustAsHtml(e):e},xt.prototype.setUrl=function(e){var t=this.sce_.trustAsHtml('<iframe src="'+e+'" width="100%" height="100%"></iframe>');this.setContent(t)},xt.prototype.setWidth=function(e){this.element_.width(e)},xt.prototype.setHeight=function(e){this.element_.height(e)},xt.prototype.setSize=function(e,t){this.setWidth(e),this.setHeight(t)},xt.prototype.setAutoDestroy=function(e){this.autoDestroy_=e},xt.prototype.addClass=function(e){this.element_.addClass(e)},xt.prototype.open=function(e){e.url?this.setUrl(e.url):e.content?this.setContent(e.content):i.a.fail('ngeo.message.Popup options requirest "url" or "content".'),void 0!==e.autoDestroy&&this.setAutoDestroy(e.autoDestroy),void 0!==e.cls&&this.addClass(e.cls),void 0!==e.height&&this.setHeight(e.height),void 0!==e.title&&this.setTitle(e.title),void 0!==e.width&&this.setWidth(e.width),this.setOpen(!0)},(xt.Factory=function(e,t,r,a){return function(){return new xt(e,t,r,a)}}).$inject=["$compile","$rootScope","$sce","$timeout"],(xt.module=angular.module("ngeoCreatePopup",[kt.name])).factory("ngeoCreatePopup",xt.Factory);var Dt=xt,Ot=(r(414),function(e,t,r){this.sce_=e,this.gettextCatalog_=t,this.createPopup_=r,n.a.call(this);var a=angular.element('<div class="ngeo-disclaimer"></div>');angular.element(document.body).append(a),this.container_=a,this.messages_={}});Ot.$inject=["$sce","gettextCatalog","ngeoCreatePopup"],Ot.$inject=["$sce","gettextCatalog","ngeoCreatePopup"],f.d(Ot,n.a),Ot.prototype.alert=function(e){this.show(e)},Ot.prototype.close=function(e){this.getMessageObjects(e).forEach(this.closeMessage_,this)},Ot.prototype.showMessage=function(e){var t=this,r=this.gettextCatalog_,a=e.type;i.a.assertString(a,"Type should be set.");var o=this.getMessageUid_(e);if(void 0===this.messages_[o])if(!0===e.popup){var s=this.createPopup_(),l=this.sce_.trustAsHtml(e.msg);s.open({autoDestroy:!0,content:l,title:"&nbsp;"}),s.scope.$watch("open",function(r,a){r||t.closeMessage_(e)}),this.messages_[o]=s}else{var u=["alert","fade","alert-dismissible"];switch(a){case n.a.Type.ERROR:u.push("alert-danger");break;case n.a.Type.INFORMATION:u.push("alert-info");break;case n.a.Type.SUCCESS:u.push("alert-success");break;case n.a.Type.WARNING:u.push("alert-warning")}var c=angular.element('<div role="alert" class="'+u.join(" ")+'"></div>'),h=angular.element('<button type="button" class="close" data-dismiss="alert" aria-label="'+r.getString("Close")+'"><span aria-hidden="true" class="fa fa-times"></span></button>'),p=angular.element("<span />").html(e.msg);c.append(h).append(p);(e.target?angular.element(e.target):this.container_).append(c),c.addClass("in"),c.on("closed.bs.alert",function(){t.closeMessage_(e)}),this.messages_[o]=c}},Ot.prototype.getMessageUid_=function(e){return e.msg+"-"+e.type},Ot.prototype.closeMessage_=function(e){var t=this.getMessageUid_(e),r=this.messages_[t];void 0!==r&&(r instanceof Dt?r.getOpen()&&r.setOpen(!1):r.hasClass("in")&&r.alert("close"),delete this.messages_[t])},(Ot.module=angular.module("ngeoDisclaimer",[Dt.module.name])).service("ngeoDisclaimer",Ot);var $t=Ot,It=r(160),Nt=angular.module("gmfDisclaimer",["ngSanitize",w.a.module.name,$t.module.name,It.a.module.name]);Nt.Controller_=function(e,t,r,a,n,o,i,s,l){this.map,this.external,this.popup,this.visibility=!1,this.msg,this.msgs_=[],this.sce_=r,this.timeout_=a,this.gettextCatalog_=n,this.element_=e,this.createPopup_=o,this.disclaimer_=i,this.eventHelper_=s,this.ngeoLayerHelper_=l,this.dataLayerGroup_=null},Nt.Controller_.$inject=["$element","$scope","$sce","$timeout","gettextCatalog","ngeoCreatePopup","ngeoDisclaimer","ngeoEventHelper","ngeoLayerHelper"],Nt.Controller_.prototype.$onInit=function(){this.dataLayerGroup_=this.ngeoLayerHelper_.getGroupFromMap(this.map,Pt.a.DATALAYERGROUP_NAME),this.registerLayer_(this.dataLayerGroup_)},Nt.Controller_.prototype.handleLayersAdd_=function(e){var t=this;this.timeout_(function(){var r=e.element;i.a.assertInstanceof(r,Ft.a),t.registerLayer_(r)})},Nt.Controller_.prototype.handleLayersRemove_=function(e){var t=e.element;i.a.assertInstanceof(t,Ft.a),this.unregisterLayer_(t)},Nt.Controller_.prototype.registerLayer_=function(e){var t=this,r=f.c(e);if(e instanceof y.a)this.eventHelper_.addListenerKey(r,E.a(e.getLayers(),"add",this.handleLayersAdd_,this)),this.eventHelper_.addListenerKey(r,E.a(e.getLayers(),"remove",this.handleLayersRemove_,this)),e.getLayers().forEach(function(e){t.registerLayer_(e)});else{var a=e.get("disclaimers");a&&Array.isArray(a)&&a.forEach(function(e){t.showDisclaimerMessage_(e)})}},Nt.Controller_.prototype.unregisterLayer_=function(e){var t=this,r=f.c(e);if(e instanceof y.a)this.eventHelper_.clearListenerKey(r),e.getLayers().forEach(function(e){return t.unregisterLayer_(e)});else{var a=e.get("disclaimers");a&&Array.isArray(a)&&a.forEach(function(e){t.closeDisclaimerMessage_(e)})}},Nt.Controller_.prototype.$onDestroy=function(){this.unregisterLayer_(this.dataLayerGroup_)},Nt.Controller_.prototype.showDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e),this.external?(this.msgs_.indexOf(e)<0&&this.msgs_.push(e),this.msg=""+this.sce_.trustAsHtml(this.msgs_.join("<br />")),this.visibility=!0):this.disclaimer_.alert({popup:this.popup,msg:e,target:this.element_,type:n.a.Type.WARNING})},Nt.Controller_.prototype.closeDisclaimerMessage_=function(e){e=this.gettextCatalog_.getString(e),this.external?(this.visibility=!1,this.msgs_.length=0,this.msg=""):this.disclaimer_.close({popup:this.popup,msg:e,target:this.element_,type:n.a.Type.WARNING})},Nt.component_={controller:Nt.Controller_,bindings:{popup:"<?gmfDisclaimerPopup",map:"=gmfDisclaimerMap",external:"<?gmfDisclaimerExternal",visibility:"=?gmfDisclaimerExternalVisibility",msg:"=?gmfDisclaimerExternalMsg"}},Nt.component("gmfDisclaimer",Nt.component_);var Gt=Nt,Ut=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var jt=function(){function e(t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.rootScope_=t,this.currentDataSourceId_=null,this.currentDataSourceItems_=[],this.localStorageKey_="gmf_savedfilters",this.useLocalStorage_=!0;try{"localStorage"in window?(window.localStorage.test="",delete window.localStorage.test):this.useLocalStorage_=!1}catch(e){console.error(e),this.useLocalStorage_=!1}this.items_=[],this.rootScope_.$watchCollection(function(){return r.items},function(){r.rePopulateCurrentDataSourceItems_()}),this.useLocalStorage_&&this.loadItemsFromLocalStorage_()}return e.$inject=["$rootScope"],e.prototype.loadItemsFromLocalStorage_=function(){if(window.localStorage[this.localStorageKey_]){var e=JSON.parse(window.localStorage[this.localStorageKey_]);i.a.assertArray(e),this.items_=e}},e.prototype.indexOfItem=function(e,t){for(var r=void 0,a=-1,n=0,o=this.items_.length;n<o;n++)if((r=this.items[n]).dataSourceId===t&&r.name===e){a=n;break}return a},e.prototype.save=function(e){var t=this.indexOfItem(e.name,e.dataSourceId);-1!==t?this.items[t]=e:this.items.push(e),this.useLocalStorage_&&this.saveItemsInLocalStorage_()},e.prototype.remove=function(e){Le.j(this.items,e)&&this.useLocalStorage_&&this.saveItemsInLocalStorage_()},e.prototype.saveItemsInLocalStorage_=function(){window.localStorage[this.localStorageKey_]=JSON.stringify(this.items)},e.prototype.rePopulateCurrentDataSourceItems_=function(){if(this.currentDataSourceItems_.length=0,null!==this.currentDataSourceId_){var e=this.items,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;n.dataSourceId===this.currentDataSourceId_&&this.currentDataSourceItems_.push(n)}}},Ut(e,[{key:"currentDataSourceItems",get:function(){return this.currentDataSourceItems_}},{key:"currentDataSourceId",set:function(e){this.currentDataSourceId_=e,this.rePopulateCurrentDataSourceItems_()}},{key:"items",get:function(){return this.items_}}]),e}();jt.module=angular.module("gmfSavedFilters",[]),jt.module.service("gmfSavedFilters",jt),jt.Item=function(){},jt.Item.prototype.condition,jt.Item.prototype.customRules,jt.Item.prototype.dataSourceId,jt.Item.prototype.directedRules,jt.Item.prototype.name;var Vt=jt;var Bt=function(){function e(t,r,a,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{};this.dataSources_=r.collection,this.ngeoDataSourcesHelper_=a,this.ngeoQuerent_=n,this.result_=o,this.limit_=void 0!==i.limit?i.limit:50,this.queryCountFirst_=void 0!==i.queryCountFirst&&i.queryCountFirst,this.tolerancePx_=void 0!==i.tolerance?i.tolerance:3,this.dataSourceNames_={}}return e.$inject=["$injector","ngeoDataSources","ngeoDataSourcesHelper","ngeoQuerent","ngeoQueryResult"],e.prototype.issue=function(e){this.clear();var t=void 0;void 0===e.dataSources&&void 0===e.queryableDataSources&&(t=this.ngeoQuerent_.getQueryableDataSources(this.dataSources_.getArray(),e.map));var r=void 0!==e.limit?e.limit:this.limit_;lt.a(e,{queryableDataSources:t,limit:r,tolerancePx:this.tolerancePx_,wfsCount:this.queryCountFirst_}),this.result_.pending=!0,this.ngeoQuerent_.issue(e).then(this.handleResult_.bind(this))},e.prototype.clear=function(){this.result_.total=0;var e=this.result_.sources,t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;n.features.length=0,n.pending=!1,n.queried=!1,n.tooManyResults=!1,n.totalFeatureCount=void 0}this.result_.sources.length=0,this.result_.pending=!1},e.prototype.handleResult_=function(e){var t=this,r=0,a=function(a){var n=Number(a),o=t.ngeoDataSourcesHelper_.getDataSource(n),s=o.name;i.a.assert(o);var l=e[n],u=l.features,c=l.limit,h=!0===l.tooManyFeatures,p=l.totalFeatureCount,g={};for(var d in u.forEach(function(e){var t=i.a.assertString(e.get("ngeo_feature_type_"));if(g[t]||(g[t]=[]),o.attributes&&o.attributes.length){var r=e.getProperties(),a={};o.attributes.forEach(function(t){t.alias?(a[t.alias]=r[t.name],e.unset(t.name,!0)):a[t.name]=r[t.name]}),e.setProperties(a,!0)}g[t].push(e)}),g){s=d||s;var f=g[d];t.result_.sources.push({features:f,id:n,label:s,limit:c,pending:!1,queried:!0,tooManyResults:h,totalFeatureCount:p}),r+=u.length}};for(var n in e)a(n);this.result_.total=r,this.result_.pending=!1},e}();Bt.module=angular.module("ngeoMapQuerent",[D.a.module.name,dt.module.name,ht.module.name]),Bt.module.service("ngeoMapQuerent",Bt),Bt.module.value("ngeoQueryResult",{sources:[],total:0,pending:!1});var Wt=Bt,Ht=r(269),qt=r(209),Kt=angular.module("ngeoBtnComponent",[]);Kt.btnGroupComponent_=function(e){return{restrict:"A",controller:"ngeoBtnGroupController",link:function(t,r,a,n){var o=e(a.ngeoBtnGroupActive).assign;o&&t.$watch(function(){return n.buttons_.some(function(e){return!0===e(t)})},function(e){o(t,e)})}}},Kt.btnGroupComponent_.$inject=["$parse"],Kt.directive("ngeoBtnGroup",Kt.btnGroupComponent_),Kt.BtnGroupController=function(e){this.buttons_=[],this.scope_=e},Kt.BtnGroupController.$inject=["$scope"],Kt.BtnGroupController.prototype.activate=function(e){var t=this;this.buttons_.forEach(function(r,a){a!=e&&r.assign(t.scope_,!1)})},Kt.BtnGroupController.prototype.addButton=function(e){return this.buttons_.push(e),this.buttons_.length-1},Kt.controller("ngeoBtnGroupController",Kt.BtnGroupController),Kt.btnComponent_=function(e){return{require:["?^ngeoBtnGroup","ngModel"],restrict:"A",link:function(t,r,a,n){var o=n[0],i=n[1],s=-1,l=e(a.ngModel),u=l.assign;void 0===l(t)&&u(t,!1),null!==o&&(s=o.addButton(l)),r.on("click",function(){t.$apply(function(){i.$setViewValue(!i.$viewValue),i.$render()})}),i.$render=function(){i.$viewValue&&null!==o&&o.activate(s),r.toggleClass("active",i.$viewValue)}}}},Kt.btnComponent_.$inject=["$parse"],Kt.directive("ngeoBtn",Kt.btnComponent_);var Yt=Kt,zt=r(95),Qt=function(e,t,r,a,n){var o=this;this.active,void 0===this.active&&(this.active=!1),this.features,this.map,this.showMeasure,this.gettextCatalog_=r,r.getString("Point"),r.getString("LineString"),r.getString("Polygon"),r.getString("Circle"),r.getString("Rectangle"),r.getString("Text"),this.featureHelper_=a,this.ngeoFeatures_=n,this.interactions_=[],this.drawPoint,this.measureLength,this.measureArea,this.measureAzimut,this.drawRectangle,this.drawText,e.$watch(function(){return o.active},function(e){!1===e&&o.interactions_.forEach(function(e){e.setActive(!1)})})};Qt.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoFeatures"],Qt.$inject=["$scope","$sce","gettextCatalog","ngeoFeatureHelper","ngeoFeatures"],Qt.prototype.registerInteraction=function(e){this.interactions_.push(e),e.setActive(!1),zt.a.interaction(e),this.map.addInteraction(e)},Qt.prototype.handleActiveChange=function(e){this.active=this.interactions_.some(function(e){return e.getActive()},this)},Qt.prototype.handleDrawEnd=function(e,t){var r=void 0;r=t.feature?t.feature:t.detail.feature,i.a.assert(r);var a=r.get("azimut"),n=this.features||this.ngeoFeatures_,o=new de.a(r.getGeometry()),s=Z.a;switch(e){case J.CIRCLE:o.set(s.IS_CIRCLE,!0),void 0!==a&&o.set(s.AZIMUT,a);break;case J.TEXT:o.set(s.IS_TEXT,!0);break;case J.RECTANGLE:o.set(s.IS_RECTANGLE,!0)}var l=this.gettextCatalog_.getString(e);o.set(s.NAME,l+" "+(n.getLength()+1));var u=e!==J.TEXT?"#DB4436":"#000000";o.set(s.COLOR,u),o.set(s.ANGLE,0),o.set(s.OPACITY,.2),o.set(s.SHOW_MEASURE,!!this.showMeasure),o.set(s.SHOW_LABEL,!1),o.set(s.SIZE,10),o.set(s.STROKE,2),this.featureHelper_.setStyle(o),n.push(o)},(Qt.module=angular.module("ngeoDrawfeatureController",[qt.a.name,Yt.name,Ge.module.name])).controller("ngeoDrawfeatureController",Qt);var Xt=Qt,Zt=r(166),Jt=angular.module("ngeoDrawpoint",[]);Jt.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(e,t,r,a){var n=new Zt.a({type:"Point"});a.registerInteraction(n),a.drawPoint=n,E.a(n,"drawend",a.handleDrawEnd.bind(a,J.POINT),a),E.a(n,"change:active",a.handleActiveChange,a)}}},Jt.directive("ngeoDrawpoint",Jt.directive_);var er=Jt,tr=angular.module("ngeoDrawrectangle",[]);tr.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(e,t,r,a){var n=new Zt.a({type:"LineString",geometryFunction:function(e,t){t||(t=new Re.b(null));var r=e[0],a=e[1];return t.setCoordinates([[r,[r[0],a[1]],a,[a[0],r[1]],r]]),t},maxPoints:2});a.registerInteraction(n),a.drawRectangle=n,E.a(n,"drawend",a.handleDrawEnd.bind(a,J.RECTANGLE),a),E.a(n,"change:active",a.handleActiveChange,a)}}},tr.directive("ngeoDrawrectangle",tr.directive_);var rr=tr,ar=angular.module("ngeoDrawtext",[]);ar.directive_=function(){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(e,t,r,a){var n=new Zt.a({type:"Point"});a.registerInteraction(n),a.drawText=n,E.a(n,"drawend",a.handleDrawEnd.bind(a,J.TEXT),a),E.a(n,"change:active",a.handleActiveChange,a)}}},ar.directive("ngeoDrawtext",ar.directive_);var nr=ar,or=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(he.call(this,r),this.continueMsg,void 0!==r.continueMsg)this.continueMsg=r.continueMsg;else{this.continueMsg=document.createElement("span"),this.continueMsg.textContent=t.getString("Click to continue drawing the polygon.");var a=document.createElement("br");a.textContent=t.getString("Double-click or click starting point to finish."),this.continueMsg.appendChild(a)}this.format=e};f.d(or,he),or.prototype.createDrawInteraction=function(e,t){return new Zt.a({type:"Polygon",source:t,style:e})},or.prototype.handleMeasure=function(e){var t=i.a.assertInstanceof(this.sketchFeature.getGeometry(),Re.b),r=this.getMap().getView().getProjection();i.a.assert(r);var a=he.getFormattedArea(t,r,this.precision,this.format),n=null;t.getCoordinates()[0].length>3&&(n=t.getInteriorPoint().getCoordinates()),e(a,n)};var ir=or,sr=angular.module("ngeoMeasurearea",[Xt.module.name]);sr.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(n,o,i,s){var l=t.getString("Click to start drawing polygon"),u=t.getString("Click to continue drawing<br>Double-click or click starting point to finish"),c=new ir(r("ngeoUnitPrefix"),t,{style:new ue.c,startMsg:e("<div translate>"+l+"</div>")(n)[0],continueMsg:e("<div translate>"+u+"</div>")(n)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):void 0});s.registerInteraction(c),s.measureArea=c,E.a(c,"measureend",s.handleDrawEnd.bind(s,J.POLYGON),s),E.a(c,"change:active",s.handleActiveChange,s)}}},sr.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"],sr.directive("ngeoMeasurearea",sr.directive_);var lr=sr,ur=angular.module("ngeoMeasureazimut",[Xt.module.name,K.name]);ur.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(n,o,i,s){var l=t.getString("Click to start drawing circle"),u=t.getString("Click to finish"),c=new Ee(r("ngeoUnitPrefix"),r("number"),{style:new ue.c,startMsg:e("<div translate>"+l+"</div>")(n)[0],continueMsg:e("<div translate>"+u+"</div>")(n)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):void 0,decimals:a.has("ngeoMeasureDecimals")?a.get("ngeoMeasureDecimals"):void 0});s.registerInteraction(c),s.measureAzimut=c,E.a(c,"measureend",function(e){var t=e.detail.feature.getGeometry(),r=t.getGeometries()[1],a=Object(Re.c)(r,64);e.detail.feature=new de.a(a);var n=Ee.getAzimut(t.getGeometries()[0]);e.detail.feature.set("azimut",n),s.handleDrawEnd(J.CIRCLE,e)},s),E.a(c,"change:active",s.handleActiveChange,s)}}},ur.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"],ur.directive("ngeoMeasureazimut",ur.directive_);var cr=ur,hr=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(he.call(this,r),void 0!==r.continueMsg)this.continueMsg=r.continueMsg;else{this.continueMsg=document.createElement("span"),this.continueMsg.textContent=t.getString("Click to continue drawing the line.");var a=document.createElement("br");a.textContent=t.getString("Double-click or click last point to finish."),this.continueMsg.appendChild(a)}this.format=e};f.d(hr,he),hr.prototype.createDrawInteraction=function(e,t){return new Zt.a({type:"LineString",source:t,style:e})},hr.prototype.handleMeasure=function(e){var t=i.a.assertInstanceof(this.sketchFeature.getGeometry(),ve.a),r=this.getMap().getView().getProjection();i.a.assert(r),e(he.getFormattedLength(t,r,this.precision,this.format),t.getLastCoordinate())};var pr=hr,gr=angular.module("ngeoMeasurelength",[Xt.module.name,K.name]);gr.directive_=function(e,t,r,a){return{restrict:"A",require:"^^ngeoDrawfeature",link:function(n,o,i,s){var l=t.getString("Click to start drawing line"),u=t.getString("Click to continue drawing<br>Double-click or click last point to finish"),c=new pr(r("ngeoUnitPrefix"),t,{style:new ue.c,startMsg:e("<div translate>"+l+"</div>")(n)[0],continueMsg:e("<div translate>"+u+"</div>")(n)[0],precision:a.has("ngeoMeasurePrecision")?a.get("ngeoMeasurePrecision"):void 0});s.registerInteraction(c),s.measureLength=c,E.a(c,"measureend",s.handleDrawEnd.bind(s,J.LINE_STRING),s),E.a(c,"change:active",s.handleActiveChange,s)}}},gr.directive_.$inject=["$compile","gettextCatalog","$filter","$injector"],gr.directive("ngeoMeasurelength",gr.directive_);var dr=gr,fr=angular.module("ngeoDrawfeature",[Xt.module.name,er.name,rr.name,nr.name,lr.name,cr.name,dr.name]);fr.directive_=function(){return{controller:"ngeoDrawfeatureController as dfCtrl",scope:!0,bindToController:{active:"=ngeoDrawfeatureActive",features:"=?ngeoDrawfeatureFeatures",map:"=ngeoDrawfeatureMap",showMeasure:"=?ngeoDrawfeatureShowmeasure"}}},fr.directive("ngeoDrawfeature",fr.directive_);var mr=fr,yr=r(104),vr=r(21),_r=r(191),Sr=function e(t){var r=this;i.a.assert(t.features),Se.b.call(this,{handleDownEvent:e.handleDownEvent_,handleDragEvent:e.handleDragEvent_,handleEvent:e.handleEvent,handleUpEvent:e.handleUpEvent_}),this.vertexFeature_=null,this.lastPixel_=[0,0],this.modified_=!1,this.rBush_=new _r.a,this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=null,this.overlay_=new oe.a({source:new ie.b({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style||ge.getDefaultModifyStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=t.features,this.features_.forEach(function(e){return r.addFeature_(e)}),E.a(this.features_,"add",this.handleFeatureAdd_,this),E.a(this.features_,"remove",this.handleFeatureRemove_,this)};f.d(Sr,Se.b),Sr.prototype.addFeature_=function(e){if("Polygon"===e.getGeometry().getType()&&e.get(Z.a.IS_CIRCLE)){var t=e.getGeometry();this.writeCircleGeometry_(e,t);var r=this.getMap();r&&this.handlePointerAtPixel_(this.lastPixel_,r)}},Sr.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=!0;var t=new d.a("modifystart",{features:this.features_});this.dispatchEvent(t)}},Sr.prototype.removeFeature_=function(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&0===this.features_.getLength()&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},Sr.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,r=[];t.forEach(function(t){e===t.feature&&r.push(t)});for(var a=r.length-1;a>=0;--a)t.remove(r[a])},Sr.prototype.setMap=function(e){this.overlay_.setMap(e),Se.b.prototype.setMap.call(this,e)},Sr.prototype.handleFeatureAdd_=function(e){var t=e.element;i.a.assertInstanceof(t,de.a,"feature should be an ol.Feature"),this.addFeature_(t)},Sr.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},Sr.prototype.writeCircleGeometry_=function(e,t){var r,a=t.getCoordinates(),n=void 0,o=void 0,i=void 0,s=void 0,l=void 0,u=void 0;for(s=0,r=a.length;s<r;++s)for(o=0,i=(n=a[s]).length-1;o<i;++o)u={feature:e,geometry:t,depth:[s],index:o,segment:l=n.slice(o,o+2)},this.rBush_.insert(Ae.b(l),u)},Sr.prototype.createOrUpdateVertexFeature_=function(e){var t=this.vertexFeature_;t?t.getGeometry().setCoordinates(e):(t=new de.a(new _e.a(e)),this.vertexFeature_=t,this.overlay_.getSource().addFeature(t));return t},Sr.compareIndexes_=function(e,t){return e.index-t.index},Sr.handleDownEvent_=function(e){this.handlePointerAtPixel_(e.pixel,e.map),this.dragSegments_=[],this.modified_=!1;var t=this.vertexFeature_;if(t){var r=t.getGeometry().getCoordinates(),a=Ae.b([r]),n=this.rBush_.getInExtent(a),o={};n.sort(Sr.compareIndexes_);for(var i=0,s=n.length;i<s;++i){var l=n[i],u=l.segment,c=f.c(l.feature),h=l.depth;h&&(c+="-"+h.join("-")),o[c]||(o[c]=new Array(2)),vr.e(u[0],r)&&!o[c][0]?(this.dragSegments_.push([l,0]),o[c][0]=l):vr.e(u[1],r)&&!o[c][1]&&(this.dragSegments_.push([l,1]),o[c][1]=l)}}return!!this.vertexFeature_},Sr.handleDragEvent_=function(e){this.willModifyFeatures_(e);var t=e.coordinate,r=this.dragSegments_[0][0].geometry,a=Ae.x(r.getExtent()),n=new ve.a([a,t]),o=new me.a(a,n.getLength()),i=Object(Re.c)(o,64).getCoordinates();this.setGeometryCoordinates_(r,i);var s=Ee.getAzimut(n);this.features_.getArray()[0].set(Z.a.AZIMUT,s),this.createOrUpdateVertexFeature_(t)},Sr.handleUpEvent_=function(e){if(this.rBush_.clear(),this.writeCircleGeometry_(this.dragSegments_[0][0].feature,this.dragSegments_[0][0].geometry),this.modified_){var t=new d.a("modifyend",{features:this.features_});this.dispatchEvent(t),this.modified_=!1}return!1},Sr.handleEvent=function(e){if(!(e instanceof yr.a))return!0;return e.map.getView().getInteracting()||"pointermove"!=e.type||this.handlingDownUpSequence||this.handlePointerMove_(e),Se.c.call(this,e)&&!0},Sr.prototype.handlePointerMove_=function(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.pixel,e.map)},Sr.prototype.handlePointerAtPixel_=function(e,t){var r=t.getCoordinateFromPixel(e),a=t.getCoordinateFromPixel([e[0]-this.pixelTolerance_,e[1]+this.pixelTolerance_]),n=t.getCoordinateFromPixel([e[0]+this.pixelTolerance_,e[1]-this.pixelTolerance_]),o=Ae.b([a,n]),i=this.rBush_.getInExtent(o);if(i.length>0){i.sort(function(e,t){return vr.i(r,e.segment)-vr.i(r,t.segment)});var s=i[0].segment,l=vr.c(r,s),u=t.getPixelFromCoordinate(l);if(Math.sqrt(vr.h(e,u))<=this.pixelTolerance_){var c=t.getPixelFromCoordinate(s[0]),h=t.getPixelFromCoordinate(s[1]),p=vr.h(u,c),g=vr.h(u,h),d=Math.sqrt(Math.min(p,g));if(this.snappedToVertex_=d<=this.pixelTolerance_,this.snappedToVertex_){l=p>g?s[1]:s[0],this.createOrUpdateVertexFeature_(l);var m={};m[f.c(s)]=!0;for(var y=void 0,v=1,_=i.length;v<_&&(y=i[v].segment,vr.e(s[0],y[0])&&vr.e(s[1],y[1])||vr.e(s[0],y[1])&&vr.e(s[1],y[0]));++v)m[f.c(y)]=!0;return}}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)},Sr.prototype.setGeometryCoordinates_=function(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1};var br=Sr,wr=function(e){var t=this;i.a.assert(e.features),Se.b.call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_}),this.modified_=!1,this.vectorPoints_=new oe.a({source:new ie.b({wrapX:!!e.wrapX}),visible:this.getActive(),style:e.style||ge.getDefaultModifyStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.features_=e.features,this.feature_=null,this.cache_={},this.params_=null,E.a(this.features_,"add",this.handleFeatureAdd_,this),E.a(this.features_,"remove",this.handleFeatureRemove_,this),this.features_.forEach(function(e){t.addFeature_(e)})};f.d(wr,Se.b),wr.prototype.setActive=function(e){Se.b.prototype.setActive.call(this,e),this.vectorPoints_&&this.vectorPoints_.setVisible(e)},wr.prototype.addFeature_=function(e){var t=e.getGeometry();if(t instanceof Re.b){var r=f.c(e),a=this.cache_[r];if(a)return;for(var n=this.vectorPoints_.getSource(),o=t.getCoordinates()[0];o.length>4;)o[0][0]<o[1][0]&&o[0][1]<=o[1][1]?o.pop():o.shift();var i=[],s=void 0,l=void 0;o.forEach(function(t){s=new _e.a(t),l=new de.a({corner:!0,geometry:s,siblingX:null,siblingY:null,boxFeature:e}),i.push(l)},this),a={corners:i},this.cache_[r]=a;var u=void 0,c=void 0;i.forEach(function(e,t){(u=i[t-1])||(u=i[i.length-1]),(c=i[t+1])||(c=i[0]),t%2==0?(e.set("siblingX",c),e.set("siblingY",u)):(e.set("siblingX",u),e.set("siblingY",c))},this),n.addFeatures(i)}},wr.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=!0;var t=new d.a("modifystart",{features:this.features_});this.dispatchEvent(t),this.params_=this.initializeParams_()}},wr.prototype.initializeParams_=function(){var e=this.feature_.get("siblingX");i.a.assertInstanceof(e,de.a);var t=e.get("siblingY");i.a.assertInstanceof(t,de.a);var r=t.getGeometry();i.a.assertInstanceof(r,_e.a);var a=r.getCoordinates(),n=this.getMap().getPixelFromCoordinate(a),o=t.get("siblingX");i.a.assertInstanceof(o,de.a);var s=o.getGeometry();i.a.assertInstanceof(s,_e.a);var l=s.getCoordinates(),u=this.getMap().getPixelFromCoordinate(l),c=[u[0]-n[0],u[1]-n[1]],h=Math.sqrt(c[0]*c[0]+c[1]*c[1]);c[0]/=h,c[1]/=h;var p=e.getGeometry();i.a.assertInstanceof(p,_e.a);var g=p.getCoordinates(),d=this.getMap().getPixelFromCoordinate(g),f=[d[0]-n[0],d[1]-n[1]],m=Math.sqrt(f[0]*f[0]+f[1]*f[1]);return f[0]/=m,f[1]/=m,isNaN(c[0])&&isNaN(f[0])?(c=[0,1],f=[1,0]):isNaN(c[0])?c=[f[1],-f[0]]:isNaN(f[0])&&(f=[c[1],-c[0]]),{originCoordinate:a,originPixel:n,siblingXPoint:s,siblingYPoint:p,vectorX:c,vectorY:f}},wr.prototype.removeFeature_=function(e){for(var t=f.c(e),r=this.cache_[t].corners,a=0;a<r.length;a++)this.vectorPoints_.getSource().removeFeature(r[a]);this.feature_=null,r.length=0,delete this.cache_[t]},wr.prototype.setMap=function(e){this.vectorPoints_.setMap(e),Se.b.prototype.setMap.call(this,e)},wr.prototype.handleFeatureAdd_=function(e){var t=e.element;i.a.assertInstanceof(t,de.a,"feature should be an ol.Feature"),this.addFeature_(t)},wr.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},wr.prototype.handleDown_=function(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e.get("siblingX")&&e.get("siblingY")?e:void 0});return!!t&&(this.feature_=t,!0)},wr.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_,r=t.getGeometry();if(r instanceof _e.a){r.setCoordinates(e.coordinate);var a=e.pixel,n=this.params_.originPixel,o=this.params_.siblingXPoint,s=this.params_.siblingYPoint,l=this.params_.vectorX,u=this.params_.vectorY,c=this.params_.originCoordinate,h=this.calculateNewPixel_(n,a,l),p=this.getMap().getCoordinateFromPixel(h);o.setCoordinates(p);var g=this.calculateNewPixel_(n,a,u),d=this.getMap().getCoordinateFromPixel(g);s.setCoordinates(d);var f=t.get("boxFeature").getGeometry();i.a.assertInstanceof(f,Re.b),f.setCoordinates([[e.coordinate,p,c,d,e.coordinate]])}},wr.prototype.calculateNewPixel_=function(e,t,r){var a=[t[0]-e[0],t[1]-e[1]],n=a[0]*r[0]+a[1]*r[1],o=[r[0]*n,r[1]*n];return[o[0]+e[0],o[1]+e[1]]},wr.prototype.handleUp_=function(e){if(this.modified_){var t=new d.a("modifyend",{features:this.features_});this.dispatchEvent(t),this.params_=null,this.modified_=!1}return!1};var Cr=wr,Tr=r(36),Er=r(268),Lr=function(e){i.a.assert(e.features),this.features_=e.features,this.listenerKeys_=[],this.interactions_=[],this.otherFeatures_=new Tr.b,this.interactions_.push(new Er.a({deleteCondition:Y.a.deleteCondition,features:this.otherFeatures_,pixelTolerance:e.pixelTolerance,style:e.style,wrapX:e.wrapX})),this.circleFeatures_=new Tr.b,this.interactions_.push(new br({features:this.circleFeatures_,pixelTolerance:e.pixelTolerance,style:e.style,wrapX:e.wrapX})),this.rectangleFeatures_=new Tr.b,this.interactions_.push(new Cr({features:this.rectangleFeatures_,pixelTolerance:e.pixelTolerance,style:e.style,wrapX:e.wrapX})),ne.a.call(this,{handleEvent:fe.b})};f.d(Lr,ne.a),Lr.prototype.setActive=function(e){ne.a.prototype.setActive.call(this,e),this.setState_()},Lr.prototype.setMap=function(e){var t=this.interactions_,r=this.getMap();r&&t.forEach(function(e){r.removeInteraction(e)}),ne.a.prototype.setMap.call(this,e),e&&t.forEach(function(t){e.addInteraction(t)}),this.setState_()},Lr.prototype.setState_=function(){var e=this,t=this.getMap(),r=this.getActive(),a=this.interactions_,n=this.listenerKeys_;a.forEach(function(e){e.setActive(r&&!!t)}),r&&t?(this.features_.forEach(function(t){return e.addFeature_(t)}),n.push(E.a(this.features_,"add",this.handleFeaturesAdd_,this),E.a(this.features_,"remove",this.handleFeaturesRemove_,this))):(n.forEach(E.e),n.length=0,this.features_.forEach(function(t){return e.removeFeature_(t)}))},Lr.prototype.handleFeaturesAdd_=function(e){var t=e.element;i.a.assertInstanceof(t,de.a,"feature should be an ol.Feature"),this.addFeature_(t)},Lr.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)},Lr.prototype.addFeature_=function(e){this.getFeatureCollection_(e).push(e)},Lr.prototype.removeFeature_=function(e){this.getFeatureCollection_(e).remove(e)},Lr.prototype.getFeatureCollection_=function(e){var t=e.get(Z.a.IS_CIRCLE),r=e.get(Z.a.IS_RECTANGLE);return!0===t||"true"===t?this.circleFeatures_:!0===r||"true"===r?this.rectangleFeatures_:this.otherFeatures_};var Mr=Lr,Ar=function(e){i.a.assert(e.features),this.listenerKeys_=[],this.modified_=!1,this.keyPressListenerKey_=null,this.changingFeature_=!1,this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,this.features_=e.features,this.feature_=null,this.coordinate_=null,this.centerCoordinate_=null,this.overlay_=new oe.a({source:new ie.b({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style||ge.getDefaultModifyStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.centerFeatures_={},Se.b.call(this,{handleDownEvent:this.handleDown_,handleDragEvent:this.handleDrag_,handleUpEvent:this.handleUp_})};f.d(Ar,Se.b),Ar.prototype.setActive=function(e){var t=this;this.keyPressListenerKey_&&(E.e(this.keyPressListenerKey_),this.keyPressListenerKey_=null),Se.b.prototype.setActive.call(this,e),e?(this.keyPressListenerKey_=E.a(document,"keyup",this.handleKeyUp_,this),this.features_.forEach(function(e){return t.addFeature_(e)}),this.listenerKeys_.push(E.a(this.features_,"add",this.handleFeatureAdd_,this),E.a(this.features_,"remove",this.handleFeatureRemove_,this))):(this.listenerKeys_.forEach(E.e),this.listenerKeys_.length=0,this.features_.forEach(function(e){return t.removeFeature_(e)}))},Ar.prototype.addFeature_=function(e){var t=e.getGeometry();i.a.assertInstanceof(t,qe.a),e.set("angle",0);var r=f.c(e),a=new _e.a(this.getCenterCoordinate_(t)),n=new de.a(a);this.centerFeatures_[r]=n,this.overlay_.getSource().addFeature(n)},Ar.prototype.willModifyFeatures_=function(e){if(!this.modified_){this.modified_=!0;var t=new d.a("modifystart",{features:this.features_});this.dispatchEvent(t)}},Ar.prototype.removeFeature_=function(e){if(this.feature_=null,e){var t=f.c(e);this.centerFeatures_[t]&&(this.overlay_.getSource().removeFeature(this.centerFeatures_[t]),delete this.centerFeatures_[t])}},Ar.prototype.setMap=function(e){this.overlay_.setMap(e),Se.b.prototype.setMap.call(this,e)},Ar.prototype.handleFeatureAdd_=function(e){var t=e.element;i.a.assertInstanceof(t,de.a,"feature should be an ol.Feature"),this.addFeature_(t)},Ar.prototype.handleFeatureRemove_=function(e){var t=e.element;this.removeFeature_(t)},Ar.prototype.handleDown_=function(e){var t=e.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e},void 0);if(t){var r=!1;this.features_.forEach(function(e){f.c(e)==f.c(t)&&(r=!0)}),r||(t=null)}if(t){this.coordinate_=e.coordinate,this.feature_=t;var a=this.feature_.getGeometry();return void 0!==a&&(this.centerCoordinate_=this.getCenterCoordinate_(a)),!0}return!1},Ar.prototype.getCenterCoordinate_=function(e){var t=void 0;if(e instanceof ve.a)t=e.getFlatMidpoint();else if(e instanceof Re.b)t=e.getFlatInteriorPoint();else{var r=e.getExtent();t=Ae.x(r)}return t},Ar.prototype.handleDrag_=function(e){this.willModifyFeatures_(e);var t=this.feature_.getGeometry(),r=this.coordinate_[0],a=this.coordinate_[1],n=this.centerCoordinate_[0],o=this.centerCoordinate_[1],i=r-n,s=a-o,l=e.coordinate[0]-n,u=e.coordinate[1]-o;this.coordinate_[0]=e.coordinate[0],this.coordinate_[1]=e.coordinate[1];var c=Math.atan2(u,l),h=Math.atan2(s,i)-c;t.rotate(-h,[n,o])},Ar.prototype.handleUp_=function(e){if(this.modified_){var t=new d.a("rotateend",{feature:this.feature_});this.dispatchEvent(t),this.modified_=!1,this.setActive(!1)}return!1},Ar.prototype.handleKeyUp_=function(e){27===e.keyCode&&this.setActive(!1)};var Fr=Ar,Pr=r(188),Rr=function(e){this.listenerKeys_=[],this.featureListenerKeys_={},this.keyPressListenerKey_=null,this.myFeatures_=void 0!==e.features?e.features:null,this.vectorSource_=new ie.b({useSpatialIndex:!1}),this.vectorLayer_=new oe.a({source:this.vectorSource_,style:e.style,updateWhileAnimating:!0,updateWhileInteracting:!0}),this.centerFeatures_={},Pr.a.call(this,e)};f.d(Rr,Pr.a),Rr.prototype.setActive=function(e){this.keyPressListenerKey_&&(E.e(this.keyPressListenerKey_),this.keyPressListenerKey_=null),Pr.a.prototype.setActive.call(this,e),e&&(this.keyPressListenerKey_=E.a(document,"keyup",this.handleKeyUp_,this)),this.setState_()},Rr.prototype.setMap=function(e){this.getMap()&&this.vectorLayer_.setMap(null),Pr.a.prototype.setMap.call(this,e),e&&this.vectorLayer_.setMap(e),this.setState_()},Rr.prototype.setState_=function(){var e=this,t=this.getMap(),r=this.getActive(),a=this.myFeatures_,n=this.listenerKeys_;if(t&&r&&a)a.forEach(function(t){return e.addFeature_(t)}),n.push(E.a(a,"add",this.handleFeaturesAdd_,this),E.a(a,"remove",this.handleFeaturesRemove_,this));else{if(t)t.getTargetElement().style.cursor="default";n.forEach(E.e),n.length=0,a.forEach(function(t){return e.removeFeature_(t)})}},Rr.prototype.handleFeaturesAdd_=function(e){var t=e.element;i.a.assertInstanceof(t,de.a,"feature should be an ol.Feature"),this.addFeature_(t)},Rr.prototype.handleFeaturesRemove_=function(e){var t=e.element;this.removeFeature_(t)},Rr.prototype.addFeature_=function(e){var t=f.c(e),r=e.getGeometry();i.a.assertInstanceof(r,qe.a),this.featureListenerKeys_[t]=E.a(r,"change",this.handleGeometryChange_.bind(this,e),this);var a=this.getGeometryCenterPoint_(r),n=new de.a(a);this.centerFeatures_[t]=n,this.vectorSource_.addFeature(n)},Rr.prototype.removeFeature_=function(e){var t=f.c(e);this.featureListenerKeys_[t]&&(E.e(this.featureListenerKeys_[t]),delete this.featureListenerKeys_[t],this.vectorSource_.removeFeature(this.centerFeatures_[t]),delete this.centerFeatures_[t])},Rr.prototype.handleGeometryChange_=function(e,t){var r=t.target;i.a.assertInstanceof(r,qe.a);var a=this.getGeometryCenterPoint_(r),n=f.c(e);this.centerFeatures_[n].setGeometry(a)},Rr.prototype.getGeometryCenterPoint_=function(e){var t=void 0,r=void 0;if(e instanceof Re.b)r=e.getInteriorPoint();else if(e instanceof ve.a)t=e.getCoordinateAt(.5);else{var a=e.getExtent();t=Ae.x(a)}return!r&&t&&(r=new _e.a(t)),i.a.assert(r,"Point should be thruthy"),r},Rr.prototype.handleKeyUp_=function(e){27===e.keyCode&&this.setActive(!1)};var kr=Rr,xr=r(145),Dr=r(208),Or=function(e,t){this.getActive=function(){return e[t]},this.setActive=function(r){e[t]=r}},$r=function(e){this.groups_={},this.scope_=e};$r.$inject=["$rootScope"],$r.$inject=["$rootScope"],$r.prototype.registerTool=function(e,t,r){var a=this,n=this.groups_[e];n||(n=this.groups_[e]=[]);var o=this.scope_.$watch(t.getActive,function(r,n){r!==n&&(r?a.deactivateTools_(e,t):a.activateDefault_(e))});if(n.push({tool:t,defaultTool:r||!1,unlisten:o}),i.a.ENABLE_ASSERTS){var s=0;n.forEach(function(e){e.defaultTool&&s++}),i.a.assert(s<=1,"more than one default tool in group "+e)}},$r.prototype.unregisterTool=function(e,t){var r=this.groups_[e];if(r)for(var a=0;a<r.length;a++)if(r[a].tool==t){r[a].unlisten(),r.splice(a,1);break}},$r.prototype.unregisterGroup=function(e){var t=this.groups_[e];if(t){for(var r=0;r<t.length;r++)t[r].unlisten();delete this.groups_[e]}},$r.prototype.activateTool=function(e){e.setActive(!0)},$r.prototype.deactivateTool=function(e){e.setActive(!1)},$r.prototype.deactivateTools_=function(e,t){for(var r=this.groups_[e],a=0;a<r.length;a++)t!=r[a].tool&&r[a].tool.setActive(!1)},$r.prototype.activateDefault_=function(e){for(var t=this.groups_[e],r=null,a=!1,n=0;n<t.length;n++)a=a||t[n].tool.getActive(),t[n].defaultTool&&(r=t[n].tool);a||null===r||r.setActive(!0)},($r.module=angular.module("ngeoToolActivateMgr",[])).service("ngeoToolActivateMgr",$r);var Ir=$r;var Nr=angular.module("ngeoRule",[mr.name,rt.module.name,xr.a.module.name,Dr.a.name,Ge.module.name,Ir.module.name]);function Gr(e,t){return t(e)}Nr.run(["$templateCache",function(e){e.put("ngeo/filter/rulecomponent",r(335))}]),Nr.value("ngeoRuleTemplateUrl",function(e){var t=e.ngeoRuleTemplateUrl;return void 0!==t?t:"ngeo/filter/rulecomponent"}),Gr.$inject=["$attrs","ngeoRuleTemplateUrl"],Nr.RuleController_=function(){function e(t,r,a,n,o,i){var s,l;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.featureOverlay,this.map,this.rule,this.toolGroup,this.gettextCatalog_=t,this.scope_=r,this.timeout_=a,this.ngeoFeatureHelper_=n,this.ngeoRuleHelper_=o,this.ngeoToolActivateMgr_=i,this.clone;var u=Be.OperatorType,c=Be.SpatialOperatorType,h=Be.TemporalOperatorType;this.operators=((s={})[u.EQUAL_TO]=t.getString("Is equal to"),s[u.GREATER_THAN]=t.getString("Is greater than"),s[u.GREATER_THAN_OR_EQUAL_TO]=t.getString("Is greater than or equal to"),s[u.LESSER_THAN]=t.getString("Is lesser than"),s[u.LESSER_THAN_OR_EQUAL_TO]=t.getString("Is lesser than or equal to"),s[u.NOT_EQUAL_TO]=t.getString("Is not equal to"),s[u.LIKE]=t.getString("Contains"),s[c.CONTAINS]=t.getString("Contains"),s[c.INTERSECTS]=t.getString("Intersects"),s[c.WITHIN]=t.getString("Is inside of"),s[h.BEGINS]=t.getString("Begins at"),s[h.DURING]=t.getString("During"),s[h.ENDS]=t.getString("Ends at"),s[h.EQUALS]=t.getString("Is equal to"),s),this.operatorsShortFormat=((l={})[u.EQUAL_TO]="=",l[u.GREATER_THAN]=">",l[u.GREATER_THAN_OR_EQUAL_TO]=">=",l[u.LESSER_THAN]="<",l[u.LESSER_THAN_OR_EQUAL_TO]="<=",l[u.NOT_EQUAL_TO]="!=",l[u.LIKE]="~",l[h.BEGINS]=">=",l[h.ENDS]="<=",l[h.EQUALS]="=",l),this.timeRangeMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createWeekAgoDate_(),mode:"range",interval:[0,1,0,0]},this.timeValueMode={widget:"datepicker",maxValue:null,minValue:null,maxDefValue:this.createDate_(),minDefValue:this.createDate_(),mode:"value",interval:[0,1,0,0]},this.toolActivate_,this.unlisteners_=[],this.drawActive=!1,this.drawToolActivate=new Or(this,"drawActive"),this.drawnFeatures=new Tr.b,this.menu_=null,this.selectedFeatures=new Tr.b,this.interactions_=new Tr.b,this.modify_=new Mr({features:this.selectedFeatures,style:n.getVertexStyle(!1)}),this.interactions_.push(this.modify_),this.rotate_=new Fr({features:this.selectedFeatures,style:new ue.c({text:new Ie.a({text:"",font:"normal 18px FontAwesome",fill:new se.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.rotate_),this.translate_=new kr({features:this.selectedFeatures,style:new ue.c({text:new Ie.a({text:"",font:"normal 18px FontAwesome",fill:new se.a({color:"#7a7a7a"})})})}),this.interactions_.push(this.translate_),this.listenerKeys_=[],this.initializeInteractions_(),this.modifyToolActivate=new Or(this.modify_,"active"),this.rotateToolActivate=new Or(this.rotate_,"active"),this.translateToolActivate=new Or(this.translate_,"active"),this.geomType=null}return e.$inject=["gettextCatalog","$scope","$timeout","ngeoFeatureHelper","ngeoRuleHelper","ngeoToolActivateMgr"],e.prototype.$onInit=function(){var e=this;this.clone=this.ngeoRuleHelper_.cloneRule(this.rule),this.toolActivate_=new Or(this.rule,"active"),this.ngeoToolActivateMgr_.registerTool(this.toolGroup,this.toolActivate_),this.scope_.$watch(function(){return e.rule.active},this.handleActiveChange_.bind(this)),this.clone.type===O.a.DATE||this.clone.type===O.a.DATETIME?(this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.getExpression()},function(t){e.timeValueMode.minValue=t})),this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.lowerBoundary},function(t){e.timeRangeMode.minValue=t})),this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.upperBoundary},function(t){e.timeRangeMode.maxValue=t}))):this.clone.type===O.a.GEOMETRY&&(this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.operator},function(t){if(t&&t===Be.SpatialOperatorType.CONTAINS){var r=i.a.assertInstanceof(e.clone,Ye);if(r.feature.getGeometry()){var a=e.ngeoFeatureHelper_.getType(r.feature),n=[J.CIRCLE,J.POLYGON,J.RECTANGLE];Le.f(n,a)||e.clone.setExpression(null)}}})),this.unlisteners_.push(this.scope_.$watch(function(){return e.clone.expression},function(t){if(t){var r=i.a.assertInstanceof(e.clone,Ye);e.geomType=e.ngeoFeatureHelper_.getType(r.feature)}else e.geomType=null})),this.unlisteners_.push(this.scope_.$watch(function(){var t=null!==e.clone.getExpression(),r=!0===e.rule.active,a=e.modify_.getActive()||e.rotate_.getActive()||e.translate_.getActive();return t&&r&&a},function(t){if(t){var r=i.a.assertInstanceof(e.clone,Ye);e.selectedFeatures.push(r.feature)}else e.selectedFeatures.clear()})))},e.prototype.$onDestroy=function(){this.rule.active&&(this.rule.active=!1,this.handleActiveChange_(!1,!0)),this.ngeoToolActivateMgr_.unregisterTool(this.toolGroup,this.toolActivate_);for(var e=0,t=this.unlisteners_.length;e<t;e++)this.unlisteners_[e]();this.unlisteners_.length=0,this.clone.destroy()},e.prototype.toggle=function(){this.rule.active?this.cancel():this.rule.active=!0},e.prototype.apply=function(){this.ngeoRuleHelper_.extendRule(this.clone,this.rule),this.rule.active=!1},e.prototype.cancel=function(){this.ngeoRuleHelper_.extendRule(this.rule,this.clone),this.rule.active=!1},e.prototype.reset=function(){this.clone.reset(),this.rule.reset()},e.prototype.toggleChoiceSelection=function(e){var t=i.a.assertInstanceof(this.clone,Qe),r=t.getExpression()?t.getExpression().split(","):[],a=r.indexOf(e);a>-1?r.splice(a,1):r.push(e),t.setExpression(r.length?r.join(","):null)},e.prototype.onDateSelected=function(e){this.clone.setExpression(e.start)},e.prototype.onDateRangeSelected=function(e){this.clone.lowerBoundary=e.start,this.clone.upperBoundary=e.end},e.prototype.createDate_=function(e){var t=new Date;if(void 0!==e){var r=t.getTime()-e;t.setTime(r)}return t.toISOString()},e.prototype.createWeekAgoDate_=function(){return this.createDate_(6048e5)},e.prototype.timeToDate=function(e){return new Date(e).toLocaleDateString()},e.prototype.handleActiveChange_=function(e,t){if(this.rule instanceof Ye&&this.clone instanceof Ye&&e!==t){var r=this.listenerKeys_,a=["ngeo-rule-",f.c(this)].join("-"),n=this.ngeoToolActivateMgr_,o=this.rule.feature,s=this.clone.feature,l=this.map.getViewport();i.a.assertElement(l),e?(r.push(E.a(this.drawnFeatures,"add",this.handleFeaturesAdd_,this)),r.push(E.a(l,"contextmenu",this.handleMapContextMenu_,this)),r.push(E.a(this.translate_,"translateend",this.handleTranslateEnd_,this)),r.push(E.a(this.rotate_,"rotateend",this.handleRotateEnd_,this)),this.featureOverlay.removeFeature(o),this.featureOverlay.addFeature(s),this.registerInteractions_(),n.registerTool(a,this.drawToolActivate,!1),n.registerTool(a,this.modifyToolActivate,!0),n.registerTool(a,this.rotateToolActivate,!1),n.registerTool(a,this.translateToolActivate,!1),this.modify_.setActive(!0),s.getGeometry()&&this.ngeoFeatureHelper_.setStyle(s,!0)):(s.setStyle(null),r.forEach(E.e),r.length=0,this.drawActive=!1,n.unregisterTool(a,this.drawToolActivate),n.unregisterTool(a,this.modifyToolActivate),n.unregisterTool(a,this.rotateToolActivate),n.unregisterTool(a,this.translateToolActivate),this.modify_.setActive(!1),this.unregisterInteractions_(),this.selectedFeatures.getLength()&&this.featureOverlay.removeFeature(s),this.featureOverlay.addFeature(o),this.selectedFeatures.clear())}},e.prototype.initializeInteractions_=function(){this.interactions_.forEach(function(e){e.setActive(!1),zt.a.interaction(e)})},e.prototype.registerInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.addInteraction(t)})},e.prototype.unregisterInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.removeInteraction(t)})},e.prototype.handleFeaturesAdd_=function(e){var t=this;this.timeout_(function(){var r=i.a.assertInstanceof(t.clone,Ye),a=r.feature,n=i.a.assertInstanceof(e.element,de.a),o=i.a.assertInstanceof(n.getGeometry(),qe.a);r.geometry=o,t.drawActive=!1;var s=t.ngeoFeatureHelper_.getNonSpatialProperties(n);t.ngeoFeatureHelper_.clearNonSpatialProperties(a),a.setProperties(s),t.ngeoFeatureHelper_.setStyle(a,!0),t.scope_.$apply()})},e.prototype.getRuleGeometryType=function(){var e=i.a.assertInstanceof(this.rule,Ye);return this.ngeoFeatureHelper_.getType(e.feature)},e.prototype.handleMapContextMenu_=function(e){var t=this;this.removeMenu_();var r=this.map.getEventPixel(e),a=this.map.getCoordinateFromPixel(r),n=this.map.forEachFeatureAtPixel(r,function(e){var r=!1;return Le.f(t.selectedFeatures.getArray(),e)&&(r=e),r}),o=[];if(n=n||null){var i=this.ngeoFeatureHelper_.getType(n),s=this.gettextCatalog_;i!=J.CIRCLE&&i!=J.LINE_STRING&&i!=J.POLYGON&&i!=J.RECTANGLE||o.push({cls:"fa fa-arrows",label:s.getString("Move"),name:"move"}),i!=J.LINE_STRING&&i!=J.POLYGON&&i!=J.RECTANGLE||o.push({cls:"fa fa-rotate-right",label:s.getString("Rotate"),name:"rotate"})}o.length&&(this.menu_=new Ht.a({actions:o}),E.a(this.menu_,"actionclick",this.handleMenuActionClick_,this),this.map.addOverlay(this.menu_),this.menu_.open(a),e.preventDefault(),e.stopPropagation(),this.scope_.$apply())},e.prototype.removeMenu_=function(){this.menu_&&(E.c(this.menu_,"actionclick",this.handleMenuActionClick_,this),this.map.removeOverlay(this.menu_),this.menu_=null)},e.prototype.handleMenuActionClick_=function(e){var t=e.detail.action;switch(t){case"move":this.translate_.setActive(!0),this.scope_.$apply();break;case"rotate":this.rotate_.setActive(!0),this.scope_.$apply();break;default:console.log("FIXME - support: "+t)}},e.prototype.handleRotateEnd_=function(e){this.rotate_.setActive(!1),this.scope_.$apply()},e.prototype.handleTranslateEnd_=function(e){this.translate_.setActive(!1),this.scope_.$apply()},e}(),Nr.component("ngeoRule",{bindings:{featureOverlay:"<",map:"<",rule:"<",toolGroup:"<"},controller:Nr.RuleController_,templateUrl:Gr});var Ur=Nr;var jr=angular.module("ngeoFilter",[rt.module.name,Ur.name,xr.a.module.name,Wt.module.name]);function Vr(e,t){return t(e)}jr.run(["$templateCache",function(e){e.put("ngeo/filter",r(334))}]),jr.value("ngeoFilterTemplateUrl",function(e){var t=e.ngeoFilterTemplateUrl;return void 0!==t?t:"ngeo/filter"}),Vr.$inject=["$attrs","ngeoFilterTemplateUrl"],jr.component("ngeoFilter",{bindings:{aRuleIsActive:"=",customRules:"<",datasource:"<",directedRules:"<",featureOverlay:"<",map:"<",toolGroup:"<"},controller:"ngeoFilterController",templateUrl:Vr}),jr.FilterController_=function(){function e(t,r,a,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.aRuleIsActive,this.customRules,this.datasource,this.directedRules,this.featureOverlay,this.map,this.toolGroup,this.gettextCatalog_=t,this.scope_=r,this.timeout_=a,this.ngeoMapQuerent_=n,this.ngeoRuleHelper_=o,this.conditions=[{text:t.getString("All"),value:B.a.AND},{text:t.getString("At least one"),value:B.a.OR},{text:t.getString("None"),value:B.a.NOT}],this.geometryAttributes=[],this.otherAttributes=[],this.ruleUnlisteners_={}}return e.$inject=["gettextCatalog","$scope","$timeout","ngeoMapQuerent","ngeoRuleHelper"],e.prototype.$onInit=function(){var e=this;this.scope_.$watch(function(){return e.aRuleIsActive},this.handleARuleIsActiveChange_.bind(this));var t=i.a.assert(this.datasource.attributes),r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}var o=n;o.type===O.a.GEOMETRY?this.geometryAttributes.push(o):this.otherAttributes.push(o)}var s=[].concat(this.customRules,this.directedRules),l=Array.isArray(s),u=0;for(s=l?s:s[Symbol.iterator]();;){var c;if(l){if(u>=s.length)break;c=s[u++]}else{if((u=s.next()).done)break;c=u.value}var h=c;this.registerRule_(h)}this.apply()},e.prototype.$onDestroy=function(){null!==this.datasource.filterRules&&(this.datasource.filterRules=null),this.featureOverlay.clear()},e.prototype.hasARule=function(){return[].concat(this.customRules,this.directedRules).length>0},e.prototype.apply=function(){var e=this;this.datasource.filterRules=null,this.timeout_(function(){var t=e.getRulesWithValue_();t.length&&(e.datasource.filterRules=t,e.ngeoMapQuerent_.clear())})},e.prototype.getData=function(){var e=this.getRulesWithValue_();if(e.length){var t=this.datasource,r=this.map,a=r.getView().getProjection().getCode(),n=this.ngeoRuleHelper_.createFilter({dataSource:t,filterRules:e,srsName:a});i.a.assert(n),this.ngeoMapQuerent_.issue({dataSources:[t],filter:n,limit:1e3,map:r})}},e.prototype.getRulesWithValue_=function(){var e=[],t=[].concat(this.customRules,this.directedRules),r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}var o=n;o.value&&e.push(o)}return e},e.prototype.createAndAddCustomRule=function(e){var t=this.ngeoRuleHelper_.createRuleFromAttribute(e,!0);this.registerRule_(t),this.customRules.push(t),this.timeout_(function(){t.active=!0},1)},e.prototype.setCondition=function(e){this.datasource.filterCondition!==e.value&&(this.datasource.filterCondition=e.value)},e.prototype.removeCustomRule=function(e){var t=this;e.active=!1,this.timeout_(function(){Le.j(t.customRules,e),t.unregisterRule_(e),e.destroy()})},e.prototype.registerRule_=function(e){var t=f.c(e);this.ruleUnlisteners_[t]=this.scope_.$watch(function(){return e.active},this.handleRuleActiveChange_.bind(this)),e instanceof Ye&&this.featureOverlay.addFeature(e.feature)},e.prototype.unregisterRule_=function(e){var t=f.c(e),r=this.ruleUnlisteners_[t];i.a.assert(r),r(),delete this.ruleUnlisteners_[t],e instanceof Ye&&this.featureOverlay.removeFeature(e.feature)},e.prototype.handleRuleActiveChange_=function(){var e=!1,t=[].concat(this.customRules,this.directedRules),r=Array.isArray(t),a=0;for(t=r?t:t[Symbol.iterator]();;){var n;if(r){if(a>=t.length)break;n=t[a++]}else{if((a=t.next()).done)break;n=a.value}if(n.active){e=!0;break}}this.aRuleIsActive=e},e.prototype.handleARuleIsActiveChange_=function(){if(!this.aRuleIsActive){var e=[].concat(this.customRules,this.directedRules),t=Array.isArray(e),r=0;for(e=t?e:e[Symbol.iterator]();;){var a;if(t){if(r>=e.length)break;a=e[r++]}else{if((r=e.next()).done)break;a=r.value}var n=a;if(n.active){n.active=!1;break}}}},e}(),jr.controller("ngeoFilterController",jr.FilterController_);var Br=jr,Wr=r(88);r(157);var Hr=angular.module("gmfFilterselector",[a.a.module.name,F.a.module.name,yt.module.name,Wr.a.module.name,o.a.module.name,l.name,rt.module.name,Br.name,Vt.module.name]);function qr(e,t){return t(e)}Hr.run(["$templateCache",function(e){e.put("gmf/filters/filterselectorcomponent",r(333))}]),Hr.value("gmfFilterselectorTemplateUrl",function(e){var t=e.gmfFilterselectorTemplateUrl;return void 0!==t?t:"gmf/filters/filterselectorcomponent"}),qr.$inject=["$attrs","gmfFilterselectorTemplateUrl"],Hr.Controller_=function(){function e(t,r,a,n,o,s,l,u,c,h){var p=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.active,t.$watch(function(){return p.active},this.handleActiveChange_.bind(this)),this.map,this.toolGroup,this.timeout_=r,this.gettextCatalog_=a,this.gmfDataSourceBeingFiltered=n,t.$watch(function(){return p.gmfDataSourceBeingFiltered.dataSource},this.handleSelectedDataSourceChange_.bind(this)),this.gmfDataSourcesHelper_=o,this.gmfSavedFilters=s,t.$watchCollection(function(){return p.gmfSavedFilters.currentDataSourceItems},function(){0===p.gmfSavedFilters.currentDataSourceItems.length&&p.saveFilterManageModalShown&&(p.saveFilterManageModalShown=!1)}),this.gmfUser_=l,t.$watch(function(){return p.gmfUser_.functionalities},this.handleGmfUserFunctionalitiesChange_.bind(this)),this.ngeoNotification_=u,this.featureOverlay=i.a.assert(c.getFeatureOverlay()),this.ngeoRuleHelper_=h,this.aRuleIsActive=!1,this.customRules=null,this.directedRules=null,this.filtrableDataSources=[],this.filtrableLayerNodeNames_=null,this.gmfDataSources_=o.collection,this.listenerKeys_=[],this.readyDataSource=null,this.ruleCache_={},this.saveFilterSaveModalShown=!1,t.$watch(function(){return p.saveFilterSaveModalShown},function(){p.saveFilterName=""}),this.saveFilterName="",this.saveFilterManageModalShown=!1,this.enableDataSourceRegistration_=!1,t.$watch(function(){return p.enableDataSourceRegistration_},this.handleEnableDataSourceRegistrationChange_.bind(this)),this.defaultFiltrableDataSourceName_,this.toggleDataSourceRegistration_()}return e.$inject=["$scope","$timeout","gettextCatalog","gmfDataSourceBeingFiltered","gmfDataSourcesHelper","gmfSavedFilters","gmfUser","ngeoNotification","ngeoFeatureOverlayMgr","ngeoRuleHelper"],e.prototype.handleGmfUserFunctionalitiesChange_=function(){var e=this.gmfUser_.functionalities;e&&e.filterable_layers?this.filtrableLayerNodeNames_=e.filterable_layers:this.filtrableLayerNodeNames_=null,e&&e.preset_layer_filter&&e.preset_layer_filter[0]?this.defaultFiltrableDataSourceName_=e.preset_layer_filter[0]:this.defaultFiltrableDataSourceName_=void 0,this.toggleDataSourceRegistration_()},e.prototype.toggleDataSourceRegistration_=function(){var e=!!this.filtrableLayerNodeNames_;this.enableDataSourceRegistration_!==e&&(this.enableDataSourceRegistration_=e)},e.prototype.handleActiveChange_=function(e){var t=this;e||(this.aRuleIsActive=!1,this.timeout_(function(){t.gmfDataSourceBeingFiltered.dataSource=null}))},e.prototype.handleEnableDataSourceRegistrationChange_=function(e){var t=this.listenerKeys_;e?(t.push(E.a(this.gmfDataSources_,"add",this.handleDataSourcesAdd_,this),E.a(this.gmfDataSources_,"remove",this.handleDataSourcesRemove_,this)),this.gmfDataSources_.forEach(this.registerDataSource_,this)):(t.forEach(E.e),t.length=0,this.filtrableDataSources.length=0)},e.prototype.handleDataSourcesAdd_=function(e){var t=e.element;t instanceof _t&&this.registerDataSource_(t)},e.prototype.handleDataSourcesRemove_=function(e){var t=e.element;t instanceof _t&&this.unregisterDataSource_(t)},e.prototype.registerDataSource_=function(e){null===e.filtrable&&(e.filtrable=this.isDataSourceFiltrable_(e)),e.filtrable&&(this.filtrableDataSources.push(e),void 0!==this.defaultFiltrableDataSourceName_&&e.name===this.defaultFiltrableDataSourceName_&&(this.gmfDataSourceBeingFiltered.dataSource=e))},e.prototype.unregisterDataSource_=function(e){e.filtrable&&(Le.j(this.filtrableDataSources,e),this.gmfDataSourceBeingFiltered.dataSource===e&&(this.gmfDataSourceBeingFiltered.dataSource=null))},e.prototype.isDataSourceFiltrable_=function(e,t){var r=!0,a=this.gettextCatalog_,o=!1!==t,s=i.a.assert(this.filtrableLayerNodeNames_),l=[];if(Le.f(s,e.name)){if(e.supportsWFS||l.push(a.getString("The data source doesn't support WFS, which is required to fetch the attributes to build the filter rules.")),e.ogcLayers&&e.ogcLayers.length?e.ogcLayers[0].queryable||l.push(a.getString("The ogcLayer within the data source must be queryable.")):l.push(a.getString("The data source must have only 1 ogcLayer defined.")),r=!l.length,o&&!r){var u=a.getString("The following data source is marked as being filtrable,\n          but is missing some requirements: "),c=e.name+" ("+e.id+").",h=a.getString("Please, contact your administrator about this.\n          Here are the reasons: ");l.unshift(u+" "+c+" "+h),console.warn(l.join(" ")),this.ngeoNotification_.notify({msg:l.join(" "),type:n.a.Type.WARNING})}}else r=!1;return r},e.prototype.handleSelectedDataSourceChange_=function(e){var t=this;this.aRuleIsActive=!1,this.customRules=null,this.directedRules=null,this.readyDataSource=null,this.gmfSavedFilters.currentDataSourceId=null,e&&(this.active||(this.active=!0),this.gmfDataSourcesHelper_.prepareFiltrableDataSource(e).then(function(e){var r=t.getRuleCacheItem_(e);if(!r&&(r={customRules:[],directedRules:[]},t.setRuleCacheItem_(e,r),e.gmfLayer.metadata&&e.gmfLayer.metadata.directedFilterAttributes&&e.gmfLayer.metadata.directedFilterAttributes.length)){var a=e.gmfLayer.metadata.directedFilterAttributes,n=i.a.assert(e.attributes),o=Array.isArray(n),s=0;for(n=o?n:n[Symbol.iterator]();;){var l;if(o){if(s>=n.length)break;l=n[s++]}else{if((s=n.next()).done)break;l=s.value}var u=l;Le.f(a,u.name)&&r.directedRules.push(t.ngeoRuleHelper_.createRuleFromAttribute(u))}}t.customRules=r.customRules,t.directedRules=r.directedRules,t.readyDataSource=e,t.gmfSavedFilters.currentDataSourceId=e.id}))},e.prototype.getRuleCacheItem_=function(e){return this.ruleCache_[e.id]||null},e.prototype.setRuleCacheItem_=function(e,t){this.ruleCache_[e.id]=t},e.prototype.saveFilterShowModal=function(){this.saveFilterSaveModalShown=!0},e.prototype.saveFilterSave=function(){var e=this.saveFilterName,t=i.a.assert(this.readyDataSource),r=t.id,a=-1!==this.gmfSavedFilters.indexOfItem(e,r),n=t.filterCondition,o=this.gettextCatalog_.getString("A filter with the same name already exists.\n      Do you want to overwrite it?");if(!a||confirm(o)){var s={condition:n,customRules:this.customRules?this.ngeoRuleHelper_.serializeRules(this.customRules):[],dataSourceId:r,directedRules:this.directedRules?this.ngeoRuleHelper_.serializeRules(this.directedRules):[],name:e};this.gmfSavedFilters.save(s),this.saveFilterSaveModalShown=!1}},e.prototype.saveFilterLoadItem=function(e){var t=this,r=i.a.assert(this.readyDataSource);this.customRules=null,this.directedRules=null;var a=this.ngeoRuleHelper_.createRules(e.customRules),n=this.ngeoRuleHelper_.createRules(e.directedRules);this.timeout_(function(){t.customRules=a,t.directedRules=n,r.filterCondition=e.condition;var o=i.a.assert(t.getRuleCacheItem_(r));o.customRules=a,o.directedRules=n})},e.prototype.saveFilterManage=function(){this.saveFilterManageModalShown=!0},e.prototype.saveFilterRemoveItem=function(e){this.gmfSavedFilters.remove(e)},e}(),Hr.Controller_.RuleCache,Hr.Controller_.RuleCacheItem,Hr.component("gmfFilterselector",{bindings:{active:"=",map:"<",toolGroup:"<"},controller:Hr.Controller_,templateUrl:qr});var Kr=Hr,Yr=angular.module("gmfFiltersModule",[Kr.name,Vt.module.name]),zr=r(267),Qr=r(205),Xr=(r(329),r(328),r(377),angular.module("gmfLayertreeTimeSliderComponent",[Ue.a.module.name,"ui.slider"]));Xr.run(["$templateCache",function(e){e.put("gmf/layertree/timesliderComponent",r(326))}]),Xr.directive_=function(e,t){return{scope:{onDateSelected:"&gmfTimeSliderOnDateSelected",time:"=gmfTimeSliderTime"},bindToController:!0,controller:"gmfTimeSliderController as sliderCtrl",restrict:"AE",templateUrl:"gmf/layertree/timesliderComponent",link:{pre:function(e,t,r,a){function n(t,r){var n=void 0,o=void 0,i=void 0;return r.values?(n=new Date(a.getClosestValue_(r.values[0])),o=new Date(a.getClosestValue_(r.values[1])),a.dates=[n,o],i={start:n.getTime(),end:o.getTime()}):(n=new Date(a.getClosestValue_(r.value)),a.dates=n,i={start:n.getTime()}),e.$apply(),i}a.init(),a.sliderOptions.stop=function(t,r){a.onDateSelected({time:n(t,r)}),e.$apply()},a.sliderOptions.slide=n}}}},Xr.directive_.$inject=["$timeout","$filter"],Xr.directive("gmfTimeSlider",Xr.directive_),Xr.Controller_=function(e,t){this.ngeoWMSTime_=t,this.onDateSelected,this.time,this.isModeRange,this.minValue,this.maxValue,this.timeValueList,this.sliderOptions,this.dates},Xr.Controller_.$inject=["$scope","ngeoWMSTime"],Xr.Controller_.prototype.init=function(){this.timeValueList=this.getTimeValueList_();var e=this.ngeoWMSTime_.getOptions(this.time);this.isModeRange="range"===this.time.mode,this.minValue=e.minDate,this.maxValue=e.maxDate,this.dates=this.isModeRange?[e.values[0],e.values[1]]:e.values,this.sliderOptions={range:this.isModeRange,min:this.minValue,max:this.maxValue}},Xr.Controller_.prototype.getTimeValueList_=function(){var e=this.time,t=null,r=new Date(this.minValue),a=new Date(this.maxValue);if(e.values)t=[],e.values.forEach(function(e){t.push(new Date(e).getTime())});else{var n=new Date(r.getTime());if(n.setFullYear(r.getFullYear()+1024*e.interval[0]),n.setMonth(r.getMonth()+1024*e.interval[1],r.getDate()+1024*e.interval[2]),n.setSeconds(r.getSeconds()+1024*e.interval[3]),n>a){t=[];for(var o=0;;o++){var i=new Date(r.getTime());if(i.setFullYear(r.getFullYear()+o*e.interval[0]),i.setMonth(r.getMonth()+o*e.interval[1],r.getDate()+o*e.interval[2]),i.setSeconds(r.getSeconds()+o*e.interval[3]),!(i<=a))break;t.push(i.getTime())}}}return t},Xr.Controller_.prototype.getClosestValue_=function(e){if(e<=this.minValue)return this.minValue;if(e>=this.maxValue)return this.maxValue;if(this.timeValueList){for(var t=void 0,r=0,a=this.timeValueList.length-1;a-r>1;)t=Math.floor((r+a)/2),this.timeValueList[t]>=e?a=t:r=t;var n=Math.abs(this.timeValueList[r]-e),o=Math.abs(this.timeValueList[a]-e);return this.timeValueList[n<o?r:a]}for(var i=new Date(e),s=new Date(this.minValue),l=new Date(this.minValue),u=new Date(this.maxValue),c=Math.abs(i-l),h=1;;h++){var p=new Date(s.getTime());if(p.setFullYear(s.getFullYear()+h*this.time.interval[0]),p.setMonth(s.getMonth()+h*this.time.interval[1],s.getDate()+h*this.time.interval[2]),p.setSeconds(s.getSeconds()+h*this.time.interval[3]),p>u)break;var g=Math.abs(i-p);if(!(g<=c))break;l=p,c=g}return l.getTime()},Xr.Controller_.prototype.getLocalizedDate=function(e){return this.ngeoWMSTime_.formatTimeValue(e,this.time.resolution)},Xr.controller("gmfTimeSliderController",Xr.Controller_);var Zr=Xr,Jr=(r(376),angular.module("gmfLayertreeModule",[zr.a.name,Qr.a.name,wt.a.module.name,Zr.name,Ct.a.module.name])),ea=r(207),ta=r(165),ra=r(161);var aa=angular.module("gmfPermalinkShareComponent",[ta.a.module.name,ra.a.module.name]);function na(e,t){return t(e)}aa.run(["$templateCache",function(e){e.put("gmf/permalink/shareComponent",r(325))}]),aa.value("gmfPermalinkShareTemplateUrl",function(e){var t=e.gmfPermalinkShareTemplateUrl;return void 0!==t?t:"gmf/permalink/shareComponent"}),na.$inject=["$attrs","gmfPermalinkShareTemplateUrl"],aa.component_={bindings:{enableEmail:"<gmfShareEmail"},controller:"GmfShareController",templateUrl:na},aa.component("gmfShare",aa.component_);var oa=function(){function e(t,r,a,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$scope_=t,this.gmfShareService_=a,this.$q_=n,this.ngeoLocation_=r,this.enableEmail,this.shortLink,this.email,this.message,this.permalink_=this.ngeoLocation_.getUriString(),this.showLengthWarning=this.permalink_.length>ta.a.URL_MAX_LEN||r.getPath()>ta.a.URL_PATH_MAX_LEN,this.successfullySent=!1,this.errorOnsend=!1,this.errorOnGetShortUrl=!1,this.getShortUrl()}return e.$inject=["$scope","ngeoLocation","gmfShareService","$q","$attrs"],e.prototype.getShortUrl=function(){var e=this;this.$q_.when(this.gmfShareService_.getShortUrl(this.permalink_)).then(function(t){e.shortLink=t.data.short_url,e.errorOnGetShortUrl=!1},function(t){e.shortLink=e.permalink,e.errorOnGetShortUrl=!0})},e.prototype.sendShortUrl=function(){var e=this;this.$scope_.gmfShareForm.$valid&&this.$q_.when(this.gmfShareService_.sendShortUrl(this.permalink_,this.email,this.message)).then(function(t){e.successfullySent=!0},function(t){e.errorOnsend=!0})},e}();aa.controller("GmfShareController",oa);var ia=aa,sa=(r(375),angular.module("gmfPermalinkModule",[ea.a.module.name,ta.a.module.name,ia.name])),la=r(75),ua=r(262),ca=function(e,t,r,a,n,o){this.http_=e,this.q_=t,this.rootScope_=r,this.timeout_=a,this.gmfThemes_=n,this.gmfTreeManager_=o,this.cache_={},this.listenerKeys_=[],this.map_=null,this.mapViewChangePromise_=null,this.ogcServers_=null};ca.$inject=["$http","$q","$rootScope","$timeout","gmfThemes","gmfTreeManager"],ca.$inject=["$http","$q","$rootScope","$timeout","gmfThemes","gmfTreeManager"],ca.prototype.ensureSnapInteractionsOnTop=function(){var e=this.map_;i.a.assert(e);var t=void 0;for(var r in this.cache_)(t=this.cache_[+r]).active&&(i.a.assert(t.interaction),e.removeInteraction(t.interaction),e.addInteraction(t.interaction))},ca.prototype.setMap=function(e){var t=this,r=this.listenerKeys_;this.map_&&(this.treeCtrlsUnregister_(),this.unregisterAllTreeCtrl_(),r.forEach(E.e),r.length=0),this.map_=e,e&&(this.treeCtrlsUnregister_=this.rootScope_.$watchCollection(function(){if(t.gmfTreeManager_.rootCtrl)return t.gmfTreeManager_.rootCtrl.children},function(e){t.timeout_(function(){e&&(t.unregisterAllTreeCtrl_(),t.gmfTreeManager_.rootCtrl.traverseDepthFirst(t.registerTreeCtrl_.bind(t)))},0)}),r.push(E.a(this.gmfThemes_,"change",this.handleThemesChange_,this),E.a(e,"moveend",this.handleMapMoveEnd_,this)))},ca.prototype.handleThemesChange_=function(){var e=this;this.ogcServers_=null,this.gmfThemes_.getOgcServersObject().then(function(t){e.ogcServers_=t})},ca.prototype.registerTreeCtrl_=function(e){var t=e.node;if(!t.children){t=e.node;var r=g.a.getSnappingConfig(t);if(r){var a=this.getWFSConfig_(e);if(a){var n=f.c(e),o=this.rootScope_.$watch(function(){return e.getState()},this.handleTreeCtrlStateChange_.bind(this,e));this.cache_[n]={active:!1,featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",features:new Tr.b,geometryName:"geom",interaction:null,maxFeatures:50,requestDeferred:null,snappingConfig:r,treeCtrl:e,wfsConfig:a,stateWatcherUnregister:o},this.handleTreeCtrlStateChange_(e,e.getState())}}}},ca.prototype.unregisterAllTreeCtrl_=function(){for(var e in this.cache_){var t=this.cache_[+e];t&&(t.stateWatcherUnregister(),this.deactivateItem_(t),delete this.cache_[+e])}},ca.prototype.getWFSConfig_=function(e){if(null===this.ogcServers_)return null;var t=e.node;if(t.type!==g.a.NodeType.WMS)return null;for(var r=t,a=[],n=0,o=r.childLayers.length;n<o;n++)r.childLayers[n].queryable&&a.push(r.childLayers[n].name);if(!a.length)return null;var s=void 0;e.parent.node.mixed?s=r.ogcServer:s=la.a.getFirstParentTree(e).node.ogcServer;if(!s)return null;var l=this.ogcServers_[s];if(!l.wfsSupport)return null;var u=l.urlWfs;return i.a.assert(u,"urlWfs should be defined."),{featureTypes:a.join(","),url:u}},ca.prototype.handleTreeCtrlStateChange_=function(e,t){var r=f.c(e),a=this.cache_[r];"on"===t?this.activateItem_(a):this.deactivateItem_(a)},ca.prototype.activateItem_=function(e){if(!e.active){var t=this.map_;i.a.assert(t);var r=new ua.a({edge:e.snappingConfig.edge,features:e.features,pixelTolerance:e.snappingConfig.tolerance,vertex:e.snappingConfig.vertex});t.addInteraction(r),e.interaction=r,e.active=!0,this.loadItemFeatures_(e)}},ca.prototype.deactivateItem_=function(e){if(e.active){var t=this.map_;i.a.assert(t);var r=e.interaction;t.removeInteraction(r),e.interaction=null,e.features.clear(),e.requestDeferred&&(e.requestDeferred.resolve(),e.requestDeferred=null),e.active=!1}},ca.prototype.loadAllItems_=function(){this.mapViewChangePromise_=null;var e=void 0;for(var t in this.cache_)(e=this.cache_[+t]).active&&this.loadItemFeatures_(e)},ca.prototype.refresh=function(){this.loadAllItems_()},ca.prototype.loadItemFeatures_=function(e){e.requestDeferred&&e.requestDeferred.resolve();var t=this.map_;i.a.assert(t);var r=t.getView(),a=t.getSize();i.a.assert(a);var n=r.calculateExtent(a),o=r.getProjection().getCode(),s=e.wfsConfig.featureTypes.split(","),l={srsName:o,featureNS:e.featureNS,featurePrefix:e.featurePrefix,featureTypes:s,outputFormat:"GML3",bbox:n,geometryName:e.geometryName,maxFeatures:e.maxFeatures},u=new Ze.a,c=new XMLSerializer,h=u.writeGetFeature(l),p=c.serializeToString(h),g=e.wfsConfig.url;e.requestDeferred=this.q_.defer(),this.http_.post(g,p,{timeout:e.requestDeferred.promise}).then(function(t){e.requestDeferred=null,e.features.clear();var r=(new Ze.a).readFeatures(t.data);r&&e.features.extend(r)})},ca.prototype.handleMapMoveEnd_=function(){this.mapViewChangePromise_&&this.timeout_.cancel(this.mapViewChangePromise_),this.mapViewChangePromise_=this.timeout_(this.loadAllItems_.bind(this),400)},(ca.module=angular.module("gmfSnapping",[Ct.a.module.name,g.a.module.name,la.a.module.name])).service("gmfSnapping",ca);var ha=ca,pa=r(123),ga=angular.module("ngeoMap",[]);ga.directive_=function(e){return{restrict:"A",link:function(t,r,a){var n=a.ngeoMap,o=t.$eval(n);i.a.assertInstanceof(o,pa.a),o.setTarget(r[0]);var s=a.ngeoMapManageResize;if(t.$eval(s)){var l=a.ngeoMapResizeTransition,u=t.$eval(l);E.a(e,"resize",function(){if(u){var t=Date.now(),r=!0;!function a(){o.updateSize(),o.renderSync(),r&&e.requestAnimationFrame(a),Date.now()-t>u&&(r=!1)}()}else o.updateSize()})}}}},ga.directive_.$inject=["$window"],ga.directive("ngeoMap",ga.directive_);var da=ga,fa=r(260),ma=angular.module("ngeoResizemap",[]);ma.directive_=function(e){return{restrict:"A",link:function(t,r,a){var n=a.ngeoResizemap,o=t.$eval(n);i.a.assertInstanceof(o,pa.a);var s=a.ngeoResizemapState;i.a.assert(void 0!==s);var l=void 0,u=void 0,c=function t(){o.updateSize(),o.renderSync(),Date.now()-l<1e3&&(u=e.requestAnimationFrame(t))};r.on("transitionend",function(){o.updateSize(),o.renderSync()}),t.$watch(s,function(t,r){t!=r&&(l=Date.now(),e.cancelAnimationFrame(u),u=e.requestAnimationFrame(c))})}}},ma.directive_.$inject=["$window"],ma.directive("ngeoResizemap",ma.directive_);var ya=ma,va=angular.module("ngeoScaleselector",[]);va.value("ngeoScaleselectorTemplateUrl",function(e,t){var r=t.ngeoScaleselectorTemplateurl;return void 0!==r?r:"ngeo/map/scaleselector"}),va.run(["$templateCache",function(e){e.put("ngeo/map/scaleselector",r(316))}]);var _a=function(e){return{restrict:"A",scope:!0,controller:"NgeoScaleselectorController",templateUrl:e}};_a.$inject=["ngeoScaleselectorTemplateUrl"],_a.$inject=["ngeoScaleselectorTemplateUrl"],va.directive("ngeoScaleselector",_a);var Sa=function e(t,r,a){var n=this,o=a.ngeoScaleselector;this.scales=t.$eval(o),i.a.assert(void 0!==this.scales),this.zoomLevels,t.$watch(function(){return Object.keys(n.scales).length},function(e){n.zoomLevels=Object.keys(n.scales).map(Number),n.zoomLevels.sort(Le.i)});var s=a.ngeoScaleselectorMap;this.map_=t.$eval(s),i.a.assertInstanceof(this.map_,pa.a);var l=a.ngeoScaleselectorOptions,u=t.$eval(l);if(this.options=e.getOptions_(u),this.$scope_=t,this.resolutionChangeKey_=null,this.currentScale=void 0,null!==this.map_.getView()){var c=this.map_.getView().getZoom();void 0!==c&&(this.currentScale=this.getScale(c))}E.a(this.map_,"change:view",this.handleViewChange_,this),this.registerResolutionChangeListener_(),t.scaleselectorCtrl=this};Sa.$inject=["$scope","$element","$attrs"],Sa.$inject=["$scope","$element","$attrs"],Sa.getOptions_=function(e){var t=!1;return void 0!==e&&(t=1==e.dropup),{dropup:t}},Sa.prototype.getScale=function(e){return this.scales[e]},Sa.prototype.changeZoom=function(e){this.map_.getView().setZoom(e)},Sa.prototype.handleResolutionChange_=function(e){var t=this,r=this.map_.getView(),a=this.scales[r.getZoom()];void 0!==a&&this.$scope_.$applyAsync(function(){t.currentScale=a})},Sa.prototype.handleViewChange_=function(e){this.registerResolutionChangeListener_(),this.handleResolutionChange_(null)},Sa.prototype.registerResolutionChangeListener_=function(){null!==this.resolutionChangeKey_&&E.e(this.resolutionChangeKey_);var e=this.map_.getView();this.resolutionChangeKey_=E.a(e,"change:resolution",this.handleResolutionChange_,this)},va.controller("NgeoScaleselectorController",Sa);var ba=va,wa=angular.module("ngeoMapModule",[T.module.name,da.name,Wr.a.module.name,fa.a.name,ya.name,ba.name]),Ca=angular.module("gmfMapComponent",[sa.name,ha.module.name,wa.name,Wr.a.module.name]);Ca.run(["$templateCache",function(e){e.put("gmf/map",r(315))}]),Ca.directive_=function(){return{scope:{map:"<gmfMapMap",manageResize:"<gmfMapManageResize",resizeTransition:"<gmfMapResizeTransition"},controller:"GmfMapController as ctrl",bindToController:!0,templateUrl:"gmf/map"}},Ca.directive("gmfMap",Ca.directive_),Ca.Controller_=function(e,t,r){this.map,this.manageResize,this.resizeTransition,this.ngeoFeatureOverlayMgr_=e,this.gmfPermalink_=t,this.gmfSnapping_=r},Ca.Controller_.$inject=["ngeoFeatureOverlayMgr","gmfPermalink","gmfSnapping"],Ca.Controller_.prototype.$onInit=function(){this.ngeoFeatureOverlayMgr_.init(this.map),this.gmfPermalink_.setMap(this.map),this.gmfSnapping_.setMap(this.map)},Ca.controller("GmfMapController",Ca.Controller_);var Ta=Ca,Ea=r(359),La=angular.module("gmfMapMouseposition",[K.name]);function Ma(e,t){return t(e)}La.run(["$templateCache",function(e){e.put("gmf/map/mousepositionComponent",r(314))}]),La.value("gmfMapMousepositionTemplateUrl",function(e){var t=e.gmfMapMousepositionTemplateUrl;return void 0!==t?t:"gmf/map/mousepositionComponent"}),Ma.$inject=["$attrs","gmfMapMousepositionTemplateUrl"],La.component_={controller:"gmfMousepositionController as ctrl",bindings:{map:"<gmfMousepositionMap",projections:"<gmfMousepositionProjections"},templateUrl:Ma},La.component("gmfMouseposition",La.component_),La.Controller_=function(e,t,r,a){this.map,this.projections,this.projection,this.$scope_=r,this.gettextCatalog_=a,this.$element_=e,this.$filter_=t,this.control_=null},La.Controller_.$inject=["$element","$filter","$scope","gettextCatalog"],La.Controller_.prototype.$onInit=function(){var e=this;this.$scope_.$on("gettextLanguageChanged",function(){e.initOlControl_()}),this.initOlControl_()},La.Controller_.prototype.initOlControl_=function(){null!==this.control_&&this.map.removeControl(this.control_);var e=this.gettextCatalog_;this.control_=new Ea.a({className:"gmf-mouseposition-control",coordinateFormat:function(e){var t=this.projection.filter.split(":"),r=this.$filter_(t.shift());i.a.assertFunction(r);var a=t;return a.unshift(e),r.apply(this,a)}.bind(this),target:angular.element(".gmf-mouseposition-control-target",this.$element_)[0],undefinedHTML:e.getString("Coordinates")}),this.setProjection(this.projections[0]),this.map.addControl(this.control_)},La.Controller_.prototype.setProjection=function(e){this.control_.setProjection(te.f(e.code)),this.projection=e},La.controller("gmfMousepositionController",La.Controller_);var Aa=La,Fa=angular.module("gmfMapModule",[Ta.name,Aa.name]),Pa=function(e,t){this.gettextCatalog_=t,this.encoding_=e.has("ngeoCsvEncoding")?e.get("ngeoCsvEncoding"):"utf-8",this.extension_=e.has("ngeoCsvExtension")?e.get("ngeoCsvExtension"):".csv",this.includeHeader_=!e.has("ngeoCsvIncludeHeader")||e.get("ngeoCsvIncludeHeader"),this.quote_=e.has("ngeoCsvQuote")?e.get("ngeoCsvQuote"):'"',this.separator_=e.has("ngeoCsvSeparator")?e.get("ngeoCsvSeparator"):",",this.download_=e.get("ngeoDownload")};Pa.$inject=["$injector","gettextCatalog"],Pa.$inject=["$injector","gettextCatalog"],Pa.prototype.generateCsv=function(e,t){var r=this;if(0==e.length||0==t.length)return"";var a=t.map(function(e){return r.gettextCatalog_.getString(e.name)}),n=this.getRow_(a),o=e.map(function(e){var a=t.map(function(t){return e[t.name]});return r.getRow_(a)});return this.includeHeader_?n+o.join(""):o.join("")},Pa.prototype.getRow_=function(e){var t=this,r=new RegExp(this.quote_,"g"),a=this.quote_+this.quote_;return e.map(function(e){return void 0!==e&&null!==e?(e=""+e,t.quote_+e.replace(r,a)+t.quote_):""}).join(this.separator_)+"\n"},Pa.prototype.startDownload=function(e,t,r){var a=this.generateCsv(e,t);this.download_(a,r,"text/csv;charset="+this.encoding_)},(Pa.module=angular.module("ngeoCsvDownload",[X.name])).service("ngeoCsvDownload",Pa);var Ra=Pa,ka=function(e,t){this.data=e,this.columnDefs=t,this.selectedRows={}};ka.getRowUid=function(e){return""+f.c(e)},ka.prototype.isRowSelected=function(e){return!!this.selectedRows[ka.getRowUid(e)]},ka.prototype.getSelectedCount=function(){return Object.keys(this.selectedRows).length},ka.prototype.getSelectedRows=function(){var e=this;return this.data.filter(function(t){return e.isRowSelected(t)})},ka.prototype.selectRow=function(e){var t=ka.getRowUid(e);this.selectedRows[t]=e},ka.prototype.toggleRow=function(e){var t=ka.getRowUid(e);this.isRowSelected(e)?delete this.selectedRows[t]:this.selectedRows[t]=e},ka.prototype.selectAll=function(){var e=this;this.data.forEach(function(t){e.selectRow(t)})},ka.prototype.unselectAll=function(){for(var e in this.selectedRows)delete this.selectedRows[e]},ka.prototype.invertSelection=function(){var e=this;this.data.forEach(function(t){e.toggleRow(t)})},ka.module=angular.module("ngeoGridConfig",[]);var xa=ka,Da=r(65),Oa=(r(313),r(312),angular.module("ngeoGrid",[xa.module.name,K.name,"floatThead"]));function $a(e,t){return t(e)}Oa.run(["$templateCache",function(e){e.put("ngeo/grid",r(311))}]),Oa.value("ngeoGridTemplateUrl",function(e){var t=e.ngeoGridTemplateurl;return void 0!==t?t:"ngeo/grid"}),$a.$inject=["$attrs","ngeoGridTemplateUrl"],Oa.component_={controller:"ngeoGridController as ctrl",bindings:{configuration:"=ngeoGridConfiguration"},templateUrl:$a},Oa.component("ngeoGrid",Oa.component_),Oa.Controller_=function(e){this.scope_=e,this.configuration,this.selectedRows,this.sortedBy,this.sortAscending=!0,this.floatTheadConfig={scrollContainer:function(e){return e.closest(".ngeo-grid-table-container")}}},Oa.Controller_.$inject=["$scope"],Oa.Controller_.prototype.$onInit=function(){this.selectedRows=this.configuration.selectedRows},Oa.Controller_.prototype.sort=function(e){this.sortAscending=this.sortedBy!==e||!this.sortAscending,this.sortedBy=e;var t=this.sortAscending?1:-1;this.configuration.data.sort(function(r,a){return r[e]?a[e]?r[e]>a[e]?t:-t:-1:1})},Oa.Controller_.prototype.clickRow=function(e,t){var r=this.isShiftKeyOnly_(t),a=this.isPlatformModifierKeyOnly_(t);this.clickRow_(e,r,a)},Oa.Controller_.prototype.clickRow_=function(e,t,r){if(t&&!r)this.selectRange_(e);else if(!t&&r)this.configuration.toggleRow(e);else{var a=this.configuration.isRowSelected(e);this.configuration.unselectAll(),a||this.configuration.selectRow(e)}},Oa.Controller_.prototype.selectRange_=function(e){var t=xa.getRowUid(e),r=this.configuration.data;if(!this.configuration.isRowSelected(e)){for(var a=void 0,n=[],o=0;o<r.length;o++){var s=r[o];t===xa.getRowUid(s)?a=o:this.configuration.isRowSelected(s)&&n.push(o)}i.a.assert(void 0!==a),0==n.length&&this.configuration.selectRow(e);for(var l=1/0,u=n[0],c=0;c<n.length;c++){var h=n[c],p=Math.abs(h-a);l>p&&(l=p,u=h)}for(var g=a>u?a:u,d=a<u?a:u;d<=g;d++)this.configuration.selectRow(r[d])}},Oa.Controller_.prototype.preventTextSelection=function(e){var t=this.isShiftKeyOnly_(e),r=this.isPlatformModifierKeyOnly_(e);(t||r)&&e.preventDefault()},Oa.Controller_.prototype.isPlatformModifierKeyOnly_=function(e){return!e.altKey&&(Da.e?e.metaKey:e.ctrlKey)&&!e.shiftKey},Oa.Controller_.prototype.isShiftKeyOnly_=function(e){return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Oa.controller("ngeoGridController",Oa.Controller_);var Ia=Oa,Na=angular.module("gmfQueryGridComponent",[Ra.module.name,X.name,Ia.name,xa.module.name,Wr.a.module.name,Wt.module.name]);function Ga(e,t,r){return r(e,t)}Na.value("gmfDisplayquerygridTemplateUrl",function(e,t){var r=t.gmfDisplayquerygridTemplateurl;return void 0!==r?r:"gmf/query/gridComponent"}),Na.run(["$templateCache",function(e){e.put("gmf/query/gridComponent",r(310))}]),Ga.$inject=["$element","$attrs","gmfDisplayquerygridTemplateUrl"],Na.component_={controller:"GmfDisplayquerygridController as ctrl",bindings:{active:"=?gmfDisplayquerygridActive",featuresStyleFn:"&gmfDisplayquerygridFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerygridSelectedfeaturestyle",getMapFn:"&gmfDisplayquerygridMap",removeEmptyColumnsFn:"&?gmfDisplayquerygridRemoveemptycolumns",maxResultsFn:"&?gmfDisplayquerygridMaxresults",maxRecenterZoomFn:"&?gmfDisplayquerygridMaxrecenterzoom",mergeTabs:"<?gmfDisplayquerygridMergetabs"},templateUrl:Ga},Na.component("gmfDisplayquerygrid",Na.component_),Na.Controller_=function(e,t,r,a,n,o,i,s){var l=this,u=e.has("ngeoQueryOptions")?e.get("ngeoQueryOptions"):{};this.$scope_=t,this.$timeout_=o,this.ngeoQueryResult=r,this.ngeoMapQuerent_=a,this.ngeoCsvDownload_=i,this.$element_=s,this.maxResults=void 0!==u.limit?u.limit:50,this.active=!1,this.pending=!1,this.gridSources={},this.loadedGridSources=[],this.selectedTab=null,this.removeEmptyColumns_=!1,this.maxRecenterZoom,this.mergeTabs={},this.featuresForSources_={},this.features_=new Tr.b,this.ngeoFeatureOverlayMgr_=n,this.highlightFeatures_=new Tr.b,this.filename_=e.has("gmfCsvFilename")?e.get("gmfCsvFilename"):"query-results.csv",this.map_=null,this.$scope_.$watchCollection(function(){return r},function(e,t){e!==t&&l.updateData_()}),this.unregisterSelectWatcher_=null},Na.Controller_.$inject=["$injector","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr","$timeout","ngeoCsvDownload","$element"],Na.Controller_.prototype.$onInit=function(){this.removeEmptyColumns_=!!this.removeEmptyColumnsFn&&!0===this.removeEmptyColumnsFn(),this.maxRecenterZoom=this.maxRecenterZoomFn?this.maxRecenterZoomFn():void 0;var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this.featuresStyleFn();void 0!==t&&(i.a.assertInstanceof(t,ue.c),e.setStyle(t));var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this.selectedFeatureStyleFn();if(void 0!==a)i.a.assertInstanceof(a,ue.c);else{var n=new se.a({color:[255,0,0,.6]}),o=new le.a({color:[255,0,0,1],width:2});a=new ue.c({fill:n,image:new Oe.a({fill:n,radius:5,stroke:o}),stroke:o,zIndex:10})}r.setStyle(a);var s=this.getMapFn;if(s){var l=s();i.a.assertInstanceof(l,pa.a),this.map_=l}},Na.Controller_.prototype.getGridSources=function(){var e=this;return this.loadedGridSources.map(function(t){return e.gridSources[t]})},Na.Controller_.prototype.updateData_=function(){var e=this;if(0===this.ngeoQueryResult.total&&!this.hasOneWithTooManyResults_()){var t=this.active;return this.clear(),void(t&&(this.active=this.ngeoQueryResult.pending,this.pending=this.ngeoQueryResult.pending))}this.active=!0,this.pending=!1;var r=this.ngeoQueryResult.sources;Object.keys(this.mergeTabs).length>0&&(r=this.getMergedSources_(r)),r.forEach(function(t){t.tooManyResults?e.makeGrid_(null,t):(t.id=e.escapeValue(t.id),t.features.length>0&&e.collectData_(t))}),0!==this.loadedGridSources.length?null!==this.selectedTab&&""+this.selectedTab in this.gridSources||this.$timeout_(function(){var t=e.loadedGridSources[0];e.selectTab(e.gridSources[t])},0):this.active=!1},Na.Controller_.prototype.hasOneWithTooManyResults_=function(){return this.ngeoQueryResult.sources.some(function(e){return e.tooManyResults})},Na.Controller_.prototype.escapeValue=function(e){if(Number.isInteger(e))return e;var t=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\ |]/g;return null!==e.match(t)?e.replace(t,"_"):e},Na.Controller_.prototype.isSelected=function(e){return this.selectedTab===e.source.label},Na.Controller_.prototype.getMergedSources_=function(e){var t=this,r=[],a={};for(var n in e.forEach(function(e){null===t.getMergedSource_(e,a)&&r.push(e)}),a)r.push(a[n]);return r},Na.Controller_.prototype.getMergedSource_=function(e,t){var r=null;for(var a in this.mergeTabs){if(this.mergeTabs[a].some(function(t){return t==e.label})){r=a;break}}if(null===r)return null;var n=void 0;return r in t?n=t[r]:(n={features:[],id:r,label:r,limit:this.maxResults,pending:!1,queried:!0,tooManyResults:!1,totalFeatureCount:void 0},t[r]=n),e.features.forEach(function(e){n.features.push(e)}),n.tooManyResults=n.tooManyResults||e.tooManyResults,n.tooManyResults&&(n.totalFeatureCount=void 0!==n.totalFeatureCount?n.totalFeatureCount+n.features.length:n.features.length,n.features=[]),void 0!==e.totalFeatureCount&&(n.totalFeatureCount=void 0!==n.totalFeatureCount?n.totalFeatureCount+e.totalFeatureCount:e.totalFeatureCount),n},Na.Controller_.prototype.collectData_=function(e){var t=[],r=[],a={},n=void 0,o=void 0;(e.features.forEach(function(e){void 0!==(n=e.getProperties())&&(o=e.getGeometryName(),-1===r.indexOf(o)&&r.push(o),t.push(n),a[xa.getRowUid(n)]=e)}),this.cleanProperties_(t,r),t.length>0)&&(this.makeGrid_(t,e)&&(this.featuresForSources_[""+e.label]=a))},Na.Controller_.prototype.cleanProperties_=function(e,t){e.forEach(function(e){t.forEach(function(t){delete e[t]}),delete e.boundedBy,delete e.ngeo_feature_type_}),!0===this.removeEmptyColumns_&&this.removeEmptyColumnsFn_(e)},Na.Controller_.prototype.removeEmptyColumnsFn_=function(e){var t=[],r=void 0,a=void 0;for(a in e[0])for(r=0;r<e.length;r++)if(void 0!==e[r][a]){t.push(a);break}var n=void 0;e.forEach(function(e){for(a in n=[],e)-1===t.indexOf(a)&&n.push(a);n.forEach(function(t){delete e[t]})})},Na.Controller_.prototype.makeGrid_=function(e,t){var r=""+t.label,a=null;return(null===e||null!==(a=this.getGridConfiguration_(e)))&&(-1==this.loadedGridSources.indexOf(r)&&this.loadedGridSources.push(r),this.gridSources[r]={configuration:a,source:t},!0)},Na.Controller_.prototype.getGridConfiguration_=function(e){i.a.assert(e.length>0);var t={};Object.assign(t,e[0]),delete t.ol_uid;var r=[];return Object.keys(t).forEach(function(e){r.push({name:e})}),r.length>0?new xa(e,r):null},Na.Controller_.prototype.clear=function(){this.active=!1,this.pending=!1,this.gridSources={},this.loadedGridSources=[],this.selectedTab=null,this.tooManyResults=!1,this.features_.clear(),this.highlightFeatures_.clear(),this.ngeoMapQuerent_.clear(),this.featuresForSources_={},this.unregisterSelectWatcher_&&this.unregisterSelectWatcher_()},Na.Controller_.prototype.selectTab=function(e){var t=this,r=e.source;this.selectedTab=r.label,this.unregisterSelectWatcher_&&(this.unregisterSelectWatcher_(),this.unregisterSelectWatcher_=null),null!==e.configuration&&(this.unregisterSelectWatcher_=this.$scope_.$watchCollection(function(){return e.configuration.selectedRows},function(e,r){Object.keys(e)!==Object.keys(r)&&t.onSelectionChanged_()})),this.updateFeatures_(e),this.reflowGrid_()},Na.Controller_.prototype.reflowGrid_=function(){var e=this.escapeValue(this.selectedTab||""),t=this.$element_.find("div.tab-pane#"+e);t.removeClass("active").addClass("active"),this.$timeout_(function(){t.find("div.ngeo-grid-table-container table").trigger("reflow")})},Na.Controller_.prototype.onSelectionChanged_=function(){if(null!==this.selectedTab){var e=this.gridSources[""+this.selectedTab];this.updateFeatures_(e)}},Na.Controller_.prototype.updateFeatures_=function(e){if(this.features_.clear(),this.highlightFeatures_.clear(),null!==e.configuration){var t=""+e.source.label,r=this.featuresForSources_[t],a=e.configuration.selectedRows;for(var n in r){var o=r[n];n in a?this.highlightFeatures_.push(o):this.features_.push(o)}}},Na.Controller_.prototype.getActiveGridSource=function(){return null===this.selectedTab?null:this.gridSources[""+this.selectedTab]},Na.Controller_.prototype.isOneSelected=function(){var e=this.getActiveGridSource();return null!==e&&null!==e.configuration&&e.configuration.getSelectedCount()>0},Na.Controller_.prototype.getSelectedRowCount=function(){var e=this.getActiveGridSource();return null===e||null===e.configuration?0:e.configuration.getSelectedCount()},Na.Controller_.prototype.selectAll=function(){var e=this.getActiveGridSource();null!==e&&e.configuration.selectAll()},Na.Controller_.prototype.unselectAll=function(){var e=this.getActiveGridSource();null!==e&&e.configuration.unselectAll()},Na.Controller_.prototype.invertSelection=function(){var e=this.getActiveGridSource();null!==e&&e.configuration.invertSelection()},Na.Controller_.prototype.zoomToSelection=function(){if(null!==this.getActiveGridSource()){var e=Ae.j();this.highlightFeatures_.forEach(function(t){Ae.q(e,t.getGeometry().getExtent())});var t=this.map_.getSize();i.a.assert(void 0!==t);var r=this.maxRecenterZoom;this.map_.getView().fit(e,{size:t,maxZoom:r})}},Na.Controller_.prototype.downloadCsv=function(){var e=this.getActiveGridSource();if(null!==e){var t=e.configuration.columnDefs;i.a.assert(void 0!==t);var r=e.configuration.getSelectedRows();this.ngeoCsvDownload_.startDownload(r,t,this.filename_)}},Na.controller("GmfDisplayquerygridController",Na.Controller_);var Ua=Na,ja=angular.module("ngeoMiscSwipe",[]);ja.factory("$verticalSwipe",[function(){var e={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend",cancel:"touchcancel"},pointer:{start:"pointerdown",move:"pointermove",end:"pointerup",cancel:"pointercancel"}};function t(e){var t=e.originalEvent||e,r=t.touches&&t.touches.length?t.touches:[t],a=t.changedTouches&&t.changedTouches[0]||r[0];return{x:a.clientX,y:a.clientY}}function r(t,r){var a=[];return angular.forEach(t,function(t){var n=e[t][r];n&&a.push(n)}),a.join(" ")}return{bind:function(e,a,n){var o=void 0,i=void 0,s=void 0,l=void 0,u=!1;n=n||["mouse","touch","pointer"],e.on(r(n,"start"),function(e){s=t(e),u=!0,o=0,i=0,l=s,a.start&&a.start(s,e)});var c=r(n,"cancel");c&&e.on(c,function(e){u=!1,a.cancel&&a.cancel(e)}),e.on(r(n,"move"),function(e){if(u&&s){var r=t(e);if(o+=Math.abs(r.x-l.x),i+=Math.abs(r.y-l.y),l=r,!(o<10&&i<10))return o>i?(u=!1,void(a.cancel&&a.cancel(e))):(e.preventDefault(),void(a.move&&a.move(r,e)))}}),e.on(r(n,"end"),function(e){u&&(u=!1,a.end&&a.end(t(e),e))})}}}]),ja.makeSwipeDirective_=function(e,t,r){ja.directive(e,["$parse","$verticalSwipe",function(a,n){var o=75,i=.3,s=30;return function(l,u,c){var h=a(c[e]),p=void 0,g=void 0;var d=["touch"];angular.isDefined(c.ngeoSwipeDisableMouse)||d.push("mouse"),n.bind(u,{start:function(e,t){p=e,g=!0},cancel:function(e){g=!1},end:function(e,a){(function(e){if(!p)return!1;var r=(e.y-p.y)*t,a=Math.abs(e.x-p.x);return g&&a<o&&r>0&&r>s&&a/r<i})(e)&&l.$apply(function(){u.triggerHandler(r),h(l,{$event:a})})}},d)}}])},ja.makeSwipeDirective_("ngeoSwipeDown",1,"swipedown"),ja.makeSwipeDirective_("ngeoSwipeUp",-1,"swipeup");var Va=ja,Ba=(r(242),r(308),r(306),r(226),angular.module("gmfQueryWindowComponent",[Wr.a.module.name,Ge.module.name,Va.name,Wt.module.name,"ngAnimate","ngTouch"]));function Wa(e,t,r){return r(e,t)}Ba.config(["$animateProvider",function(e){e.classNameFilter(/gmf-animatable/)}]),Ba.value("gmfDisplayquerywindowTemplateUrl",function(e,t){var r=t.gmfDisplayquerywindowTemplateurl;return void 0!==r?r:"gmf/query/windowComponent"}),Ba.run(["$templateCache",function(e){e.put("gmf/query/windowComponent",r(304))}]),Wa.$inject=["$element","$attrs","gmfDisplayquerywindowTemplateUrl"],Ba.component_={controller:"GmfDisplayquerywindowController as ctrl",bindings:{draggableContainment:"<?gmfDisplayquerywindowDraggableContainment",featuresStyleFn:"&gmfDisplayquerywindowFeaturesstyle",selectedFeatureStyleFn:"&gmfDisplayquerywindowSelectedfeaturestyle",defaultCollapsedFn:"&?gmfDisplayquerywindowDefaultcollapsed",desktop:"=gmfDisplayquerywindowDesktop",showUnqueriedLayers:"=gmfDisplayquerywindowShowunqueriedlayers"},templateUrl:Wa},Ba.component("gmfDisplayquerywindow",Ba.component_),Ba.Controller_=function(e,t,r,a,n){var o=this;this.draggableContainment,this.desktop=!1,this.collapsed=!this.desktop,this.showUnqueriedLayers_=!1,this.sourcesFilter={queried:!0},this.ngeoQueryResult={sources:[],total:0,pending:!1},this.ngeoMapQuerent_=a,this.selectedSource=null,this.features_=new Tr.b,this.ngeoFeatureOverlayMgr_=n,this.highlightFeatures_=new Tr.b,this.source=null,this.feature=null,this.currentResult=-1,this.isNext=!0,this.animate=0,this.open=!1,this.element_=e,t.$watchCollection(function(){return r},function(e,t){o.updateQueryResult_(e),e.total>0?o.show():t!==e&&o.close()})},Ba.Controller_.$inject=["$element","$scope","ngeoQueryResult","ngeoMapQuerent","ngeoFeatureOverlayMgr"],Ba.Controller_.prototype.$onInit=function(){this.draggableContainment=this.draggableContainment||"document",this.desktop=this.desktop,this.collapsed=this.defaultCollapsedFn?!0===this.defaultCollapsedFn():!this.desktop,this.showUnqueriedLayers_=!!this.showUnqueriedLayers&&!0===this.showUnqueriedLayers,this.sourcesFilter=this.showUnqueriedLayers_?{}:{queried:!0};var e=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();e.setFeatures(this.features_);var t=this.featuresStyleFn();void 0!==t&&(i.a.assertInstanceof(t,ue.c),e.setStyle(t));var r=this.ngeoFeatureOverlayMgr_.getFeatureOverlay();r.setFeatures(this.highlightFeatures_);var a=this.selectedFeatureStyleFn();if(void 0!==a)i.a.assertInstanceof(a,ue.c);else{var n=new se.a({color:[255,0,0,.6]}),o=new le.a({color:[255,0,0,1],width:2});a=new ue.c({fill:n,image:new Oe.a({fill:n,radius:5,stroke:o}),stroke:o})}r.setStyle(a),this.desktop&&(this.element_.find(".gmf-displayquerywindow .windowcontainer").draggable({cancel:"input,textarea,button,select,option,tr",containment:this.draggableContainment}),this.element_.find(".gmf-displayquerywindow .windowcontainer").resizable({minHeight:240,minWidth:240}))},Ba.Controller_.prototype.show=function(){this.clear(),this.updateFeatures_()},Ba.Controller_.prototype.updateFeatures_=function(){this.setCurrentResult_(0,!1),null!==this.source&&(this.collectFeatures_(),this.highlightCurrentFeature_(),this.open=!0)},Ba.Controller_.prototype.setCurrentResult_=function(e,t){var r=!1;if(e!==this.currentResult){var a=void 0,n=void 0,o=void 0,i=this.feature,s=this.ngeoQueryResult.sources;for(this.currentResult=e,a=0;a<s.length;a++)if(n=s[a],null===this.selectedSource||this.selectedSource===n){if(!(e>=(o=n.features).length)){this.source=n,this.feature=n.features[e],r=!0;break}e-=o.length}t&&this.highlightCurrentFeature_(i)}return r},Ba.Controller_.prototype.previous=function(){var e=this.currentResult-1;e<0&&(e=this.getResultLength()-1),this.setCurrentResult_(e,!0)&&this.animate_(!1)},Ba.Controller_.prototype.next=function(){var e=this.currentResult+1;e>this.getResultLength()-1&&(e=0),this.setCurrentResult_(e,!0)&&this.animate_(!0)},Ba.Controller_.prototype.updateQueryResult_=function(e){this.ngeoQueryResult.total=0,this.ngeoQueryResult.sources.length=0;for(var t=0;t<e.sources.length;t++){var r=e.sources[t];r.features=r.features.filter(function(e){return i.a.assert(e),!lt.d(Ge.getFilteredFeatureValues(e))}),this.ngeoQueryResult.sources.push(r),this.ngeoQueryResult.total+=r.features.length}},Ba.Controller_.prototype.getResultLength=function(){return null===this.selectedSource?this.ngeoQueryResult.total:this.selectedSource.features.length},Ba.Controller_.prototype.isFirst=function(){return 0==this.currentResult},Ba.Controller_.prototype.isLast=function(){return this.currentResult==this.getResultLength()-1},Ba.Controller_.prototype.getFeatureValues=function(){return this.feature?Ge.getFilteredFeatureValues(this.feature):null},Ba.Controller_.prototype.animate_=function(e){this.isNext=e,this.animate++},Ba.Controller_.prototype.collectFeatures_=function(){var e=this.ngeoQueryResult.sources;this.features_.clear();for(var t=0;t<e.length;t++){var r=e[t];if(null===this.selectedSource||this.selectedSource===r)for(var a=r.features,n=0;n<a.length;n++)this.features_.push(a[n])}},Ba.Controller_.prototype.highlightCurrentFeature_=function(e){this.highlightFeatures_.clear(),this.features_.remove(this.feature),this.highlightFeatures_.push(this.feature),void 0!==e&&this.features_.push(e)},Ba.Controller_.prototype.close=function(){this.open=!1,this.clear(),this.ngeoMapQuerent_.clear()},Ba.Controller_.prototype.clear=function(){this.feature=null,this.source=null,this.currentResult=-1,this.features_.clear(),this.highlightFeatures_.clear(),this.selectedSource=null},Ba.Controller_.prototype.setSelectedSource=function(e){null!==e&&e.features.length<=0||(this.clear(),this.selectedSource=e,this.updateFeatures_())},Ba.controller("GmfDisplayquerywindowController",Ba.Controller_);var Ha=Ba,qa=(r(374),r(373),angular.module("gmfQueryExtraModule",[Ua.name,Ha.name])),Ka=r(259),Ya=r(204),za=(r(372),angular.module("gmfSearchModule",[Ka.a.name,Ya.a.module.name])),Qa=r(121),Xa=angular.module("gmfThemeSelectorComponent",[Qa.a.module.name,g.a.module.name]);function Za(e,t){return t(e)}Xa.run(["$templateCache",function(e){e.put("gmf/theme/selectorComponent",r(295))}]),Xa.value("gmfThemeSelectorTemplateUrl",function(e){var t=e.gmfThemeSelectorTemplateUrl;return void 0!==t?t:"gmf/theme/selectorComponent"}),Za.$inject=["$attrs","gmfThemeSelectorTemplateUrl"],Xa.component_={bindings:{filter:"<gmfThemeselectorFilter"},controller:"gmfThemeselectorController",templateUrl:Za},Xa.component("gmfThemeselector",Xa.component_),Xa.Controller_=function(e,t,r){this.gmfThemeManager=t,this.gmfThemes_=r,this.themes,this.filter,this.listenerKeys_=[],this.listenerKeys_.push(E.a(this.gmfThemes_,"change",this.setThemes_,this)),e.$on("$destroy",this.handleDestroy_.bind(this))},Xa.Controller_.$inject=["$scope","gmfThemeManager","gmfThemes"],Xa.Controller_.prototype.setThemes_=function(){var e=this;this.gmfThemes_.getThemesObject().then(function(t){e.themes=e.filter?t.filter(e.filter):t})},Xa.Controller_.prototype.setTheme=function(e,t){e&&this.gmfThemeManager.addTheme(e,t)},Xa.Controller_.prototype.handleDestroy_=function(){this.listenerKeys_.forEach(E.e),this.listenerKeys_.length=0},Xa.controller("gmfThemeselectorController",Xa.Controller_);var Ja=Xa,en=angular.module("gmfThemeModule",[Ja.name,Qa.a.module.name,g.a.module.name]),tn=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}();var rn=angular.module("ngeoMessageDisplaywindowComponent",["ngSanitize"]);function an(e,t){return t(e)}rn.run(["$templateCache",function(e){e.put("ngeo/message/displaywindowComponent",r(294))}]),rn.value("ngeoMessageDisplaywindowTemplateUrl",function(e){var t=e.ngeoMessageDisplaywindowTemplateUrl;return void 0!==t?t:"ngeo/message/displaywindowComponent"}),an.$inject=["$attrs","ngeoMessageDisplaywindowTemplateUrl"],rn.Controller_=function(){function e(t,r,a,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.clearOnClose,this.content=null,this.contentTemplate=null,this.contentScope=null,this.draggable,this.draggableContainment,this.desktop,this.height=null,this.open,this.resizable,this.title=null,this.url=null,this.width=null,this.element_=t,this.sce_=r,this.scope_=a,this.compile_=n}return e.$inject=["$element","$sce","$scope","$compile"],e.prototype.$onInit=function(){if(this.clearOnClose=!1!==this.clearOnClose,this.content=this.content||null,this.contentTemplate=this.contentTemplate||null,this.contentScope=this.contentScope||null,this.desktop=!1!==this.desktop,this.draggableContainment=this.draggableContainment||"document",this.open=!0===this.open,this.height=this.height||"240px",this.width=this.width||"240px",this.draggable=void 0!==this.draggable?this.draggable:this.desktop,this.resizable=void 0!==this.resizable?this.resizable:this.desktop,this.draggable&&this.element_.find(".ngeo-displaywindow .windowcontainer").draggable({containment:this.draggableContainment,handle:"div.header"}),this.resizable&&this.element_.find(".ngeo-displaywindow .windowcontainer").resizable({minHeight:240,minWidth:240}),this.contentTemplate){var e=i.a.assert(this.contentScope||this.scope_),t=this.compile_(this.contentTemplate)(e);this.element_.find(".ngeo-displaywindow .windowcontainer .animation-container").append(t)}},e.prototype.close=function(){this.open=!1,this.clearOnClose&&this.clear_()},e.prototype.clear_=function(){this.content=null,this.title=null,this.url=null},tn(e,[{key:"style",get:function(){return{height:this.height,width:this.width}}},{key:"urlTrusted",get:function(){if(this.url)return this.sce_.trustAsResourceUrl(this.url)}}]),e}(),rn.component("ngeoDisplaywindow",{bindings:{clearOnClose:"<?",content:"=?",contentTemplate:"<?",contentScope:"<?",desktop:"<?",draggable:"<?",draggableContainment:"<?",height:"=?",open:"=?",resizable:"<?",title:"=?",url:"=?",width:"=?"},controller:rn.Controller_,templateUrl:an});var nn=rn,on=r(203),sn=r(57),ln=angular.module("ngeoControl",[]);ln.component_=function(){return{restrict:"A",link:function(e,t,r){var a=e.$eval(r.ngeoControl);i.a.assertInstanceof(a,sn.a);var n=e.$eval(r.ngeoControlMap);i.a.assertInstanceof(n,pa.a),a.setTarget(t[0]),n.addControl(a)}}},ln.directive("ngeoControl",ln.component_);var un=ln,cn=r(159),hn=r(214),pn=angular.module("ngeoFilereader",[]);pn.component_=function(e){return{restrict:"A",scope:{fileContent:"=ngeoFilereader",supported:"=?ngeoFilereaderSupported"},link:function(t,r,a){var n="FileReader"in e;t.supported=n,n&&r.on("change",function(r){var a=new e.FileReader;a.onload=function(e){t.$apply(function(){t.fileContent=e.target.result})},a.readAsText(r.target.files[0])})}}},pn.component_.$inject=["$window"],pn.directive("ngeoFilereader",pn.component_);var gn=pn,dn=angular.module("ngeoGetBrowserLanguage",[]);dn.factory_=function(e){return function(t){var r=e.navigator,a=r.languages||r.language||r.browserLanguage||r.systemLanguage||r.userLanguage;return Array.isArray(a)||(a=[a]),(a=(a=a.map(function(e){return e.substring(0,2)})).filter(function(e,t,r){return r.indexOf(e)==t})).filter(function(e){return-1!=t.indexOf(e)})[0]}},dn.factory_.$inject=["$window"],dn.factory("ngeoGetBrowserLanguage",dn.factory_);var fn=dn,mn=r(256),yn=r(133),vn=angular.module("ngeoMiscExtraModule",[on.a.module.name,Yt.name,un.name,Dr.a.name,cn.a.name,It.a.module.name,Ge.module.name,hn.a.module.name,gn.name,K.name,fn.name,mn.a.name,yn.a.module.name,Ir.module.name,Ue.a.module.name]),_n=angular.module("ngeoMapQuery",[Wt.module.name]);_n.directive_=function(e,t){return{restrict:"A",scope:!1,link:function(r,a,n){var o=r.$eval(n.ngeoMapQueryMap),i=null,s=null,l=function(t){var r=t.coordinate;e.issue({coordinate:r,map:o})},u=function(e){if(!e.dragging){var t=o.getEventPixel(e.originalEvent),r=o.forEachLayerAtPixel(t,function(){return!0},void 0,function(e){var t=e.get("visible"),r=e.get("querySourceIds");return t&&!!r});o.getTargetElement().style.cursor=r?"pointer":""}};r.$watch(n.ngeoMapQueryActive,function(a,c){a?(i=E.a(o,"singleclick",l),(t.has("ngeoQueryOptions")?t.get("ngeoQueryOptions"):{}).cursorHover&&(s=E.a(o,"pointermove",u))):(null!==i&&(E.e(i),i=null),null!==s&&(E.e(s),s=null),!1!==r.$eval(n.ngeoMapQueryAutoclear)&&e.clear())})}}},_n.directive_.$inject=["ngeoMapQuerent","$injector"],_n.directive("ngeoMapQuery",_n.directive_);var Sn=_n,bn=r(206),wn=function(e,t,r){var a=this,n=r;this.url_=n.url,this.maxFeatures_=void 0!==n.maxFeatures?n.maxFeatures:50,this.wfsTypes_={},i.a.assertArray(n.wfsTypes,"wfsTypes is not correctly set"),n.wfsTypes.forEach(function(e){a.wfsTypes_[e.featureType]=e}),this.defaultFeatureNS_=n.defaultFeatureNS,this.defaultFeaturePrefix_=n.defaultFeaturePrefix,this.pointRecenterZoom_=n.pointRecenterZoom,this.$http_=e,this.result_=t};wn.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"],wn.$inject=["$http","ngeoQueryResult","ngeoWfsPermalinkOptions"],wn.prototype.clear=function(){this.clearResult_()},wn.prototype.issue=function(e,t){i.a.assert(this.url_,"url is not set. to use the wfs permalink service, set the value `ngeoWfsPermalinkOptions`"),this.clearResult_();var r=e.wfsType;if(this.wfsTypes_.hasOwnProperty(r)){var a=this.wfsTypes_[r],n=this.createFilters_(e.filterGroups);null!==n&&this.issueRequest_(a,n,t,e.showFeatures)}},wn.prototype.issueRequest_=function(e,t,r,a){var n=this,o=new Ze.a,i=o.writeGetFeature({srsName:r.getView().getProjection().getCode(),featureNS:void 0!==e.featureNS?e.featureNS:this.defaultFeatureNS_,featurePrefix:void 0!==e.featurePrefix?e.featurePrefix:this.defaultFeaturePrefix_,featureTypes:[e.featureType],outputFormat:"GML3",filter:t,maxFeatures:this.maxFeatures_}),s=(new XMLSerializer).serializeToString(i);this.$http_.post(this.url_,s,{headers:{"Content-Type":"text/xml; charset=UTF-8"}}).then(function(t){var i=o.readFeatures(t.data);if(0!=i.length){var s=r.getSize();if(void 0!==s){var l=n.pointRecenterZoom_;r.getView().fit(n.getExtent_(i),{size:s,maxZoom:l,padding:[10,10,10,10]})}if(a){var u={features:i,id:e.featureType,identifierAttributeField:e.label,label:e.featureType,pending:!1};n.result_.sources.push(u),n.result_.total=i.length}}})},wn.prototype.getExtent_=function(e){return e.reduce(function(e,t){return Ae.q(e,t.getGeometry().getExtent())},Ae.j())},wn.prototype.createFilters_=function(e){if(0==e.length)return null;var t=Je;return wn.or_(e.map(function(e){var r=e.filters.map(function(e){var r=e.condition;return Array.isArray(r)?wn.or_(r.map(function(r){return t.equalTo(e.property,r)})):t.equalTo(e.property,e.condition)});return wn.and_(r)}))},wn.and_=function(e){return wn.joinFilters_(e,Je.and)},wn.or_=function(e){return wn.joinFilters_(e,Je.or)},wn.joinFilters_=function(e,t){return e.reduce(function(e,r){return null===e?r:(i.a.assert(null!==r),t(e,r))},null)},wn.prototype.clearResult_=function(){this.result_.total=0,this.result_.sources.forEach(function(e){e.features.length=0})},(wn.module=angular.module("ngeoWfsPermalink",[])).value("ngeoWfsPermalinkOptions",{url:"",wfsTypes:[],defaultFeatureNS:"",defaultFeaturePrefix:""}),wn.module.service("ngeoWfsPermalink",wn);var Cn=wn,Tn=function(e,t,r){var a=this;this.ngeoLocation=r.get("ngeoLocation"),this.ngeoLocation.hasParam("debug")&&(window.injector=r),i.a.assertInstanceof(this.map,pa.a),r.get("ngeoFeatureHelper").setProjection(i.a.assert(this.map.getView().getProjection())),this.gmfThemeManager=r.get("gmfThemeManager"),this.gmfTreeManager_=r.get("gmfTreeManager"),this.gmfThemes_=r.get("gmfThemes"),this.permalink_=r.get("gmfPermalink");var n=r.get("gmfAuthenticationService");this.hasEditableLayers=!1,this.updateHasEditableLayers_=function(){var e=this;this.gmfThemes_.hasEditableLayers().then(function(t){e.hasEditableLayers=t})};var o=function(e){var t=e.detail.user,r=null!==t.username?t.role_id:void 0;a.gmfThemes_.getThemesObject().then(function(e){var t=a.gmfUser.functionalities;t&&t.open_panel&&"layer_filter"===t.open_panel[0]&&(a.filterSelectorActive=!0)});var n=a.gmfThemeManager.getThemeName();a.gmfThemeManager.setThemeName("",!0),"ready"!==e.type&&a.updateCurrentTheme_(n),a.gmfThemes_.loadThemes(r),a.updateHasEditableLayers_()};E.a(n,"ready",o),E.a(n,"login",o),E.a(n,"logout",o),this.searchDatasources=[{labelKey:"label",groupValues:r.get("gmfSearchGroups"),groupActions:r.get("gmfSearchActions"),projection:"EPSG:"+(e.srid||21781),url:r.get("fulltextsearchUrl")}],this.dimensions={},this.permalink_.setDimensions(this.dimensions);var s=r.get("gmfDataSourcesManager");if(s.setDatasourceMap(this.map),s.setDimensions(this.dimensions),r.has("gmfDefaultDimensions")){var l=r.get("gmfDefaultDimensions");for(var u in l)void 0===this.dimensions[u]&&(this.dimensions[u]=l[u])}this.backgroundLayerMgr_=r.get("ngeoBackgroundLayerMgr"),t.$watchCollection(function(){return a.dimensions},function(){a.backgroundLayerMgr_.updateDimensions(a.map,a.dimensions)}),this.backgroundLayerMgr_.on("change",function(){a.backgroundLayerMgr_.updateDimensions(a.map,a.dimensions)}),this.leftNavVisible=!1,this.rightNavVisible=!1;var c=new se.a({color:[255,170,0,.6]}),h=new le.a({color:[255,170,0,1],width:2});this.queryFeatureStyle=new ue.c({fill:c,image:new Oe.a({fill:c,radius:5,stroke:h}),stroke:h}),this.filterSelectorActive=!1,this.queryActive=!0,this.queryAutoClear=!0,this.printPanelActive=!1,this.printActive=!1,this.ngeoMapQuerent_=r.get("ngeoMapQuerent"),t.$watch(function(){return a.printPanelActive},function(e){e||a.queryActive||a.ngeoMapQuerent_.clear(),a.queryAutoClear=!e,a.printActive=e}),this.measurePointActive=!1,this.measureLengthActive=!1,this.drawFeatureActive=!1,this.drawProfilePanelActive=!1,this.gmfUser=r.get("gmfUser"),this.getBrowserLanguage=r.get("ngeoGetBrowserLanguage"),this.stateManager=r.get("ngeoStateManager"),this.tmhDynamicLocale=r.get("tmhDynamicLocale"),this.$scope=t,this.lang,this.defaultLang=r.get("defaultLang"),this.langUrls=r.get("langUrls"),this.gettextCatalog=r.get("gettextCatalog"),this.initLanguage();this.mapToolsGroup="mapTools",r.get("ngeoFeatureOverlayMgr").init(this.map);var p=r.get("ngeoToolActivateMgr"),g=new Or(this,"queryActive");p.registerTool("mapTools",g,!0);var d=new Or(this,"measurePointActive");p.registerTool("mapTools",d,!1);var f=new Or(this,"measureLengthActive");p.registerTool("mapTools",f,!1);var m=new Or(this,"drawFeatureActive");p.registerTool("mapTools",m,!1);var y=new Or(this,"drawProfilePanelActive");p.registerTool("mapTools",y,!1);var v=new Or(this,"printPanelActive");p.registerTool("mapTools",v,!1),t.$root.$on(Qa.a.EventType.THEME_NAME_SET,function(e,t){a.gmfThemes_.getThemeObject(t).then(function(e){a.setDefaultBackground_(e)})}),this.updateCurrentBackgroundLayer_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;if(e||(a=t.permalink_.getBackgroundLayer(r)),!a){var n=t.gmfUser.functionalities;if(n){var o=n.default_basemap;if(o.length>0){var i=o[0];a=Le.d(r,function(e){return e.get("label")===i})}}}!a&&r[1]&&(a=r[1]),a&&t.backgroundLayerMgr_.set(t.map,a)})}.bind(this),this.updateCurrentBackgroundLayer_(!1);var _=window.gmfx||{};window.gmfx=_,_.openIframePopup=function(e,t,r,n,o){a.displaywindowUrl=e,_.openPopup_(t,r,n,o)},_.openTextPopup=function(e,t,r,n,o){a.displaywindowContent=e,_.openPopup_(t,r,n,o)},_.openPopup_=function(e,t,r,n){a.displaywindowTitle=e,a.displaywindowOpen=!0,t&&(a.displaywindowWidth=t+"px"),r&&(a.displaywindowHeight=r+"px"),!1!==n&&a.$scope.$apply()},this.manageResize=!1,this.resizeTransition;var S=window.cgxp||{};window.cgxp=S,S.tools=window.cgxp.tools||{},S.tools.openInfoWindow=function(e,t,r,a,n){_.openIframePopup(e,t,r,a,n)},this.displaywindowContent=null,this.displaywindowDraggableContainment=".gmf-map",this.displaywindowHeight="50vh",this.displaywindowOpen=!1,this.displaywindowTitle=null,this.displaywindowUrl=null,this.displaywindowWidth="50vw"};Tn.$inject=["config","$scope","$injector"],Tn.$inject=["config","$scope","$injector"],Tn.prototype.userMustChangeItsPassword=function(){return!1===this.gmfUser.is_password_changed},Tn.getLayerByLabels=function(e,t){return t&&t.length>0?Le.d(e,function(e){return e.get("label")===t[0]}):null},Tn.prototype.switchLanguage=function(e){i.a.assert(e in this.langUrls),this.gettextCatalog.setCurrentLanguage(e),this.gettextCatalog.loadRemote(this.langUrls[e]),this.tmhDynamicLocale.set(e),this.lang=e},Tn.prototype.initLanguage=function(){var e=this;this.$scope.$watch(function(){return e.lang},function(t){e.stateManager.updateState({lang:t})});var t=this.getBrowserLanguage(Object.keys(this.langUrls)),r=this.stateManager.getInitialValue("lang");return void 0!==r&&r in this.langUrls?void this.switchLanguage(r):void 0!==t&&t in this.langUrls?void this.switchLanguage(t):void this.switchLanguage(this.defaultLang)},Tn.prototype.setDefaultBackground_=function(e){var t=this;this.gmfThemes_.getBgLayers().then(function(r){var a=void 0;!(a=t.permalink_.getBackgroundLayer(r))&&t.gmfUser.functionalities&&(a=Tn.getLayerByLabels(r,t.gmfUser.functionalities.default_basemap)),!a&&e&&(a=Tn.getLayerByLabels(r,e.functionalities.default_basemap)),a||(a=r[r.length>1?1:0]),i.a.assert(a),t.backgroundLayerMgr_.set(t.map,a)})},Tn.prototype.updateCurrentTheme_=function(e){var t=this;this.gmfThemes_.getThemesObject().then(function(r){var a=t.permalink_.defaultThemeNameFromFunctionalities();if(a){var n=g.a.findThemeByName(r,a);n&&t.gmfThemeManager.addTheme(n,!0)}else t.gmfThemeManager.setThemeName(e)})},Tn.prototype.getLocationIcon=function(){var e=document.createElement("span");e.className="fa fa-location-arrow",e.style.transform="rotate(-0.82rad)";var t=document.createElement("span");return t.appendChild(e),t},(Tn.module=angular.module("GmfAbstractAppControllerModule",["gettext","tmh.dynamicLocale",p.name,A.name,At.name,Gt.name,Yr.name,Jr.name,Fa.name,qa.name,za.name,en.name,nn.name,vn.name,Ge.module.name,Wt.module.name,Sn.name,bn.a.name,Cn.module.name])).controller("AbstractController",Tn),Tn.module.value("ngeoExportFeatureFormats",[Ge.FormatType.KML,Ge.FormatType.GPX]),Tn.module.config(["tmhDynamicLocaleProvider","angularLocaleScript",function(e,t){e.localeLocationPattern(t)}]);var En=Tn,Ln=r(66),Mn=function(e){ne.a.call(this,{handleEvent:fe.b}),this.changeEventKey_=null,this.type_=e.type,this.minPoints_=e.minPoints?e.minPoints:"Polygon"===this.type_?3:2,this.sketchFeature_=null,this.sketchPoints_=[],this.sketchPoint_=null,this.overlay_=new oe.a({source:new ie.b({useSpatialIndex:!1,wrapX:!!e.wrapX&&e.wrapX}),style:e.style||ge.getDefaultDrawStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),E.a(this,"change:active",this.updateState_,this),this.set("dirty",!1),this.set("drawing",!1),this.set("valid",!1)};f.d(Mn,ne.a),Mn.prototype.setMap=function(e){this.getMap()&&this.changeEventKey_&&E.e(this.changeEventKey_),ne.a.prototype.setMap.call(this,e),e&&(this.changeEventKey_=E.a(e.getView(),"change:center",this.handleViewCenterChange_,this)),this.updateState_()},Mn.prototype.getDirty=function(){return this.get("dirty")},Mn.prototype.getDrawing=function(){return this.get("drawing")},Mn.prototype.getValid=function(){return this.get("valid")},Mn.prototype.getFeature=function(){return this.sketchFeature_},Mn.prototype.addToDrawing=function(){var e=this.getActive(),t=this.getDrawing();if(e&&t){var r=void 0,a=this.getSketchPointGeometry_().getCoordinates(),n=void 0;if("Point"===this.type_){if(!this.sketchFeature_){this.sketchFeature_=new de.a(new _e.a(a));var o=new d.a("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(o)}return r=this.sketchFeature_.getGeometry(),i.a.assertInstanceof(r,Ln.a),void r.setCoordinates(a)}if("LineString"===this.type_)if(this.sketchPoints_.push(this.sketchPoint_),this.sketchFeature_)r=this.sketchFeature_.getGeometry(),i.a.assertInstanceof(r,Ln.a),(n=r.getCoordinates()).push(a.slice()),r.setCoordinates(n);else{n=[a.slice(),a.slice()],this.sketchFeature_=new de.a(new ve.a(n));var s=new d.a("drawstart",{feature:this.sketchFeature_});this.dispatchEvent(s)}this.getDirty()&&this.set("dirty",!1);var l=this.getValid();"LineString"===this.type_&&(n.length>=this.minPoints_?l||this.set("valid",!0):l&&this.set("valid",!1)),this.sketchPoint_=null,this.updateSketchFeatures_()}},Mn.prototype.clearDrawing=function(){this.setActive(!1),this.setActive(!0)},Mn.prototype.finishDrawing=function(){var e=this.getActive(),t=this.getDrawing();if(e&&t){this.sketchPoint_&&this.addToDrawing(),this.set("drawing",!1);var r=new d.a("drawend",{feature:this.sketchFeature_});this.dispatchEvent(r)}},Mn.prototype.startDrawing_=function(){this.set("drawing",!0),this.createOrUpdateSketchPoint_(),this.updateSketchFeatures_(),"Point"===this.type_&&this.addToDrawing()},Mn.prototype.modifyDrawing_=function(){if(this.sketchFeature_){var e=this.getCenter_();if("LineString"===this.type_){var t=this.sketchFeature_.getGeometry();i.a.assertInstanceof(t,Ln.a);var r=t.getCoordinates();r.pop(),r.push(e),t.setCoordinates(r)}this.getDirty()||this.set("dirty",!0)}},Mn.prototype.abortDrawing_=function(){var e=this.sketchFeature_;return(e||this.sketchPoints_.length>0)&&(this.sketchFeature_=null,this.sketchPoint_=null,this.overlay_.getSource().clear(!0)),this.sketchPoints_=[],this.set("dirty",!1),this.set("drawing",!1),this.set("valid",!1),e},Mn.prototype.updateState_=function(){var e=this.getMap(),t=this.getActive();e&&t?this.startDrawing_():this.abortDrawing_(),this.overlay_.setMap(t?e:null)},Mn.prototype.handleViewCenterChange_=function(e){var t=this.getActive(),r=this.getDrawing();t&&r&&(this.createOrUpdateSketchPoint_(),"Point"===this.type_?this.addToDrawing():(this.modifyDrawing_(),this.updateSketchFeatures_()))},Mn.prototype.createOrUpdateSketchPoint_=function(){var e=this.getCenter_();this.sketchPoint_?this.getSketchPointGeometry_().setCoordinates(e):this.sketchPoint_=new de.a(new _e.a(e))},Mn.prototype.updateSketchFeatures_=function(){var e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchPoint_&&e.push(this.sketchPoint_);var t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e),t.addFeatures(this.sketchPoints_)},Mn.prototype.getSketchPointGeometry_=function(){i.a.assert(this.sketchPoint_,"sketch point should be thruty");var e=this.sketchPoint_.getGeometry();return i.a.assertInstanceof(e,_e.a),e},Mn.prototype.getCenter_=function(){var e=this.getMap().getView().getCenter();return i.a.assertArray(e),e};var An=Mn,Fn=function(e,t,r){var a=void 0!==r?r:{};lt.a(a,{displayHelpTooltip:!1}),pr.call(this,e,t,a)};f.d(Fn,pr),Fn.prototype.createDrawInteraction=function(e,t){return new An({type:"LineString",style:e,source:t})};var Pn=Fn,Rn=angular.module("gmfMobileMeasureLength",[K.name]);Rn.value("gmfMobileMeasureLengthTemplateUrl",function(e,t){var r=t.gmfMobileMeasureLengthTemplateurl;return void 0!==r?r:"gmf/measure/lengthComponent"}),Rn.run(["$templateCache",function(e){e.put("gmf/measure/lengthComponent",r(292))}]),Rn.component_=function(e){return{restrict:"A",scope:{active:"=gmfMobileMeasurelengthActive",precision:"<?gmfMobileMeasurelengthPrecision",map:"=gmfMobileMeasurelengthMap",sketchStyle:"=?gmfMobileMeasurelengthSketchstyle"},controller:"GmfMobileMeasureLengthController as ctrl",bindToController:!0,templateUrl:e,link:function(e,t,r,a){a.init()}}},Rn.component_.$inject=["gmfMobileMeasureLengthTemplateUrl"],Rn.directive("gmfMobileMeasurelength",Rn.component_),Rn.Controller_=function(e,t,r){var a=this;this.scope_=e,this.filter_=t,this.gettextCatalog_=r,this.map,this.active,this.scope_.$watch(function(){return a.active},function(e){a.measure.setActive(e)}),this.precision,this.sketchStyle=new ue.c({fill:new se.a({color:"rgba(255, 255, 255, 0.2)"}),stroke:new le.a({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new $e.a({stroke:new le.a({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})}),this.measure,this.drawInteraction,this.dirty=!1,this.drawing=!1,this.valid=!1},Rn.Controller_.$inject=["$scope","$filter","gettextCatalog"],Rn.Controller_.prototype.init=function(){this.measure=new Pn(this.filter_("ngeoUnitPrefix"),this.gettextCatalog_,{precision:this.precision,sketchStyle:this.sketchStyle}),this.measure.setActive(this.active),zt.a.interaction(this.measure),this.drawInteraction=this.measure.getDrawInteraction();var e=this.drawInteraction;zt.a.interaction(e),Object.defineProperty(this,"hasPoints",{get:function(){return null!==this.drawInteraction.getFeature()}}),E.a(e,"change:dirty",function(){this.dirty=e.getDirty(),this.dirty&&this.scope_.$apply()},this),E.a(e,"change:drawing",function(){this.drawing=e.getDrawing()},this),E.a(e,"change:valid",function(){this.valid=e.getValid()},this),this.map.addInteraction(this.measure)},Rn.Controller_.prototype.addPoint=function(){this.drawInteraction.addToDrawing()},Rn.Controller_.prototype.clear=function(){this.drawInteraction.clearDrawing()},Rn.Controller_.prototype.finish=function(){this.drawInteraction.finishDrawing()},Rn.Controller_.prototype.deactivate=function(){this.active=!1},Rn.controller("GmfMobileMeasureLengthController",Rn.Controller_);var kn=Rn,xn=function(e,t){this.$http_=e,this.url_=t};xn.$inject=["$http","gmfRasterUrl"],xn.$inject=["$http","gmfRasterUrl"],xn.prototype.getRaster=function(e,t){var r=t||{};return r[xn.Param.X]=e[0],r[xn.Param.Y]=e[1],this.$http_.get(this.url_,{params:r}).then(this.handleGetRaster_.bind(this))},xn.prototype.handleGetRaster_=function(e){return e.data},xn.Param={X:"lon",Y:"lat"},(xn.module=angular.module("gmfRaster",[])).service("gmfRaster",xn);var Dn=xn,On=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};lt.a(r,{displayHelpTooltip:!1}),he.call(this,r),this.format_=e,this.coordFormat_=t};f.d(On,he),On.prototype.createDrawInteraction=function(e,t){return new An({type:"Point",style:e,source:t})},On.prototype.handleMeasure=function(e){var t=i.a.assertInstanceof(this.sketchFeature.getGeometry(),_e.a),r=this.decimals;e(he.getFormattedPoint(t,r,this.format_,this.coordFormat_),t.getLastCoordinate())};var $n=On,In=angular.module("gmfMobileMeasurePoint",[Dn.module.name,cn.a.name]);In.value("gmfMobileMeasurePointTemplateUrl",function(e,t){var r=t.gmfMobileMeasurePointTemplateurl;return void 0!==r?r:"gmf/measure/pointComponent"}),In.run(["$templateCache",function(e){e.put("gmf/measure/pointComponent",r(291))}]),In.component_=function(e){return{restrict:"A",scope:{active:"=gmfMobileMeasurepointActive",getCoordinateDecimalsFn:"&?gmfMobileMeasurepointCoordinatedecimals",getLayersConfigFn:"&gmfMobileMeasurepointLayersconfig",map:"=gmfMobileMeasurepointMap",sketchStyle:"=?gmfMobileMeasurepointSketchstyle",format:"<gmfMobileMeasurepointFormat"},controller:"GmfMobileMeasurePointController as ctrl",bindToController:!0,templateUrl:e,link:function(e,t,r,a){a.init()}}},In.component_.$inject=["gmfMobileMeasurePointTemplateUrl"],In.directive("gmfMobileMeasurepoint",In.component_),In.Controller_=function(e,t,r,a,n){var o=this;this.gmfRaster_=a,this.ngeoDebounce_=n,this.gettextCatalog_=e,this.$filter_=r,this.map,this.active,t.$watch(function(){return o.active},function(e){o.measure.setActive(e),o.handleMeasureActiveChange_()});var i=this.getCoordinateDecimalsFn;this.coordinateDecimals=i?i():0,this.layersConfig,this.sketchStyle,void 0===this.sketchStyle&&(this.sketchStyle=new ue.c({fill:new se.a({color:"rgba(255, 255, 255, 0.2)"}),stroke:new le.a({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:2}),image:new $e.a({stroke:new le.a({color:"rgba(0, 0, 0, 0.7)",width:2}),points:4,radius:8,radius2:0,angle:0})})),this.format,this.measure,this.drawInteraction,this.mapViewPropertyChangeEventKey_=null},In.Controller_.$inject=["gettextCatalog","$scope","$filter","gmfRaster","ngeoDebounce"],In.Controller_.prototype.init=function(){this.measure=new $n(this.$filter_("ngeoNumberCoordinates"),this.format||"{x}, {y}",{decimals:this.coordinateDecimals,sketchStyle:this.sketchStyle}),this.measure.setActive(this.active),zt.a.interaction(this.measure),this.drawInteraction=this.measure.getDrawInteraction(),zt.a.interaction(this.drawInteraction);var e=this.getLayersConfigFn();i.a.assert(Array.isArray(e)),this.layersConfig=e,this.map.addInteraction(this.measure)},In.Controller_.prototype.deactivate=function(){this.active=!1},In.Controller_.prototype.translate=function(e){return this.gettextCatalog_.getString(e)},In.Controller_.prototype.handleMeasureActiveChange_=function(){if(this.measure.getActive()){var e=this.map.getView();this.mapViewPropertyChangeEventKey_=E.a(e,"propertychange",this.ngeoDebounce_(this.getMeasure_.bind(this),300,!0),this),this.getMeasure_()}else this.mapViewPropertyChangeEventKey_&&(E.e(this.mapViewPropertyChangeEventKey_),this.mapViewPropertyChangeEventKey_=null)},In.Controller_.prototype.getMeasure_=function(){var e=this,t=this.map.getView().getCenter();i.a.assertArray(t);var r={layers:this.layersConfig.map(function(e){return e.name}).join(",")};this.gmfRaster_.getRaster(t,r).then(function(t){var r=e.measure.getTooltipElement(),a=document.createElement("div");a.className="gmf-mobile-measure-point";var n=e.layersConfig,o=Array.isArray(n),i=0;for(n=o?n:n[Symbol.iterator]();;){var s;if(o){if(i>=n.length)break;s=n[i++]}else{if((i=n.next()).done)break;s=i.value}var l=s,u=l.name;if(u in t){var c=t[u],h=document.createElement("div");h.className="gmf-mobile-measure-point-"+u;var p=l.unit||"",g=l.decimals&&l.decimals>0||0;c=e.$filter_("number")(c,g),h.innerHTML=[e.translate(u),": ",c," ",p].join(""),a.appendChild(h)}}var d=r.getElementsByClassName("gmf-mobile-measure-point");d[0]&&d[0].remove(),r.appendChild(a)})},In.controller("GmfMobileMeasurePointController",In.Controller_),In.LayerConfig;var Nn=In,Gn=angular.module("gmfMobileMeasureModule",[kn.name,Nn.name]),Un=r(255),jn=angular.module("gmfMobileNavigationModule",[Un.a.name]),Vn=r(87),Bn=r(358),Wn=angular.module("ngeoMobileGeolocation",[Wr.a.module.name,o.a.module.name]);Wn.GeolocationEventType={ERROR:"mobile-geolocation-error"},Wn.directive_=function(){return{restrict:"A",scope:{getMobileMapFn:"&ngeoMobileGeolocationMap",getMobileGeolocationOptionsFn:"&ngeoMobileGeolocationOptions"},controller:"ngeoGeolocationMobileController"}},Wn.directive("ngeoMobileGeolocation",Wn.directive_),Wn.Controller_=function(e,t,r,a,n){var o=this;t.on("click",this.toggleTracking.bind(this));var s=e.getMobileMapFn();i.a.assertInstanceof(s,pa.a),this.$scope_=e,this.map_=s;var l=e.getMobileGeolocationOptionsFn()||{};i.a.assertObject(l),this.notification_=n,this.featureOverlay_=a.getFeatureOverlay(),this.geolocation_=new Bn.a({projection:s.getView().getProjection(),trackingOptions:{enableHighAccuracy:!0}}),l.autorotate&&this.autorotateListener(),this.geolocation_.on("error",function(t){this.untrack_();var a=void 0;switch(t.code){case 1:a=r.getString("User denied the request for Geolocation.");break;case 2:a=r.getString("Location information is unavailable.");break;case 3:a=r.getString("The request to get user location timed out.");break;default:a=r.getString("Geolocation: An unknown error occurred.")}this.notification_.error(a),e.$emit(Wn.GeolocationEventType.ERROR,t)},this),this.positionFeature_=new de.a,l.positionFeatureStyle&&this.positionFeature_.setStyle(l.positionFeatureStyle),this.accuracyFeature_=new de.a,l.accuracyFeatureStyle&&this.accuracyFeature_.setStyle(l.accuracyFeatureStyle),this.zoom_=l.zoom,this.follow_=!1,this.viewChangedByMe_=!1,E.a(this.geolocation_,"change:accuracyGeometry",function(){o.accuracyFeature_.setGeometry(o.geolocation_.getAccuracyGeometry()),o.setPosition_()}),E.a(this.geolocation_,"change:position",function(){o.setPosition_()});var u=s.getView();E.a(u,"change:center",this.handleViewChange_,this),E.a(u,"change:resolution",this.handleViewChange_,this)},Wn.Controller_.$inject=["$scope","$element","gettextCatalog","ngeoFeatureOverlayMgr","ngeoNotification"],Wn.Controller_.prototype.toggleTracking=function(){if(this.geolocation_.getTracking()){var e=this.geolocation_.getPosition();if(void 0===e)return this.untrack_(),void this.$scope_.$emit(Wn.GeolocationEventType.ERROR,null);i.a.assert(void 0!==e);var t=this.map_.getView().getCenter();Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])<2?this.untrack_():(this.untrack_(),this.track_())}else this.track_()},Wn.Controller_.prototype.track_=function(){this.featureOverlay_.addFeature(this.positionFeature_),this.featureOverlay_.addFeature(this.accuracyFeature_),this.follow_=!0,this.geolocation_.setTracking(!0)},Wn.Controller_.prototype.untrack_=function(){this.featureOverlay_.clear(),this.follow_=!1,this.geolocation_.setTracking(!1),this.notification_.clear()},Wn.Controller_.prototype.setPosition_=function(){var e=this.geolocation_.getPosition(),t=new _e.a(e);this.positionFeature_.setGeometry(t);var r=this.accuracyFeature_.getGeometry();if(this.follow_){if(this.viewChangedByMe_=!0,void 0!==this.zoom_)this.map_.getView().setCenter(e),this.map_.getView().setZoom(this.zoom_);else if(r){var a=this.map_.getSize();this.map_.getView().fit(r,a)}this.viewChangedByMe_=!1}},Wn.Controller_.prototype.handleViewChange_=function(e){this.follow_&&!this.viewChangedByMe_&&(this.follow_=!1)},Wn.Controller_.prototype.autorotateListener=function(){var e=this,t=0;window.hasOwnProperty("ondeviceorientationabsolute")?window.addEventListener("deviceorientationabsolute",function(r){t=e.handleRotate_(r.alpha,t)},!0):window.hasOwnProperty("ondeviceorientation")?window.addEventListener("deviceorientation",function(r){t=r.webkitCompassHeading?e.handleRotate_(-r.webkitCompassHeading,t):e.handleRotate_(r.alpha-270,t)},!0):console.error("Orientation is not supported on this device")},Wn.Controller_.prototype.handleRotate_=function(e,t){if(this.geolocation_.getTracking()&&Math.abs(e-t)>.2){var r=(t=e)*Math.PI/180;this.map_.getView().animate({rotation:r,duration:350,easing:Vn.d})}return t},Wn.controller("ngeoGeolocationMobileController",Wn.Controller_);var Hn=Wn,qn=r(232),Kn=r(261),Yn=r(228),zn=r(229),Qn=r(274),Xn=function(e,t,r){var a=this;this.leftNavVisible=!1,this.rightNavVisible=!1,this.searchOverlayVisible=!1,this.searchListeners={open:function(){this.searchOverlayVisible=!0}.bind(this),close:function(){this.searchOverlayVisible=!1}.bind(this)};var n=e.positionFeatureStyle||new ue.c({image:new Oe.a({radius:6,fill:new se.a({color:"rgba(230, 100, 100, 1)"}),stroke:new le.a({color:"rgba(230, 40, 40, 1)",width:2})})}),o=e.accuracyFeatureStyle||new ue.c({fill:new se.a({color:"rgba(100, 100, 230, 0.3)"}),stroke:new le.a({color:"rgba(40, 40, 230, 1)",width:2})});this.mobileGeolocationOptions={positionFeatureStyle:n,accuracyFeatureStyle:o,zoom:e.geolocationZoom,autorotate:e.autorotate};var i={projection:te.f("EPSG:"+(e.srid||21781))};lt.a(i,e.mapViewConfig||{});var s=En.prototype.getLocationIcon();this.map=new pa.a({pixelRatio:e.mapPixelRatio,layers:[],view:new qn.a(i),controls:e.mapControls||[new Kn.a,new Yn.a({zoomInTipLabel:"",zoomOutTipLabel:""}),new zn.a({label:s,tipLabel:""})],interactions:e.mapInteractions||Qn.a({pinchRotate:!0})}),En.call(this,e,t,r),this.manageResize=!0,this.resizeTransition=500,t.$watch(function(){return a.gmfUser.username},function(e){null!==e&&a.navIsVisible()&&(a.rightNavVisible=!1)}),this.redirectUrl=r.get("redirectUrl")};Xn.$inject=["config","$scope","$injector"],Xn.$inject=["config","$scope","$injector"],f.d(Xn,En),Xn.prototype.toggleLeftNavVisibility=function(){this.leftNavVisible=!this.leftNavVisible},Xn.prototype.toggleRightNavVisibility=function(){this.rightNavVisible=!this.rightNavVisible},Xn.prototype.hideNav=function(){this.leftNavVisible=this.rightNavVisible=!1},Xn.prototype.navIsVisible=function(){return this.leftNavVisible||this.rightNavVisible},Xn.prototype.hideSearchOverlay=function(){this.searchOverlayVisible=!1},Xn.prototype.leftNavIsVisible=function(){return this.leftNavVisible},Xn.prototype.rightNavIsVisible=function(){return this.rightNavVisible},Xn.prototype.openNavMenu=function(e){for(var t=document.getElementsByClassName("gmf-mobile-nav-button"),r=0;r<t.length;r++){var a=t[r];a.dataset&&a.dataset.target===e&&a.click()}},(Xn.module=angular.module("GmfAbstractMobileControllerModule",[En.module.name,Gn.name,jn.name,Ha.name,Hn.name])).controller("AbstractMobileController",Xn),Xn.module.value("isMobile",!0),Xn.module.value("ngeoQueryOptions",{tolerance:10});var Zn=Xn,Jn=(r(371),{});Jn.module=angular.module("app",[]),Jn.module.config(["$compileProvider",function(e){"debug"in Y.a.decodeQueryString(window.location.search)||e.debugInfoEnabled(!1)}]);var eo=Jn,to=r(275),ro=r(201),ao=r(131),no=["+proj="+ro.a,"+lat_0=46.95240555555556","+lon_0=7.439583333333333","+k_0=1","+x_0=2600000","+y_0=1200000","+ellps=bessel","+towgs84=674.374,15.056,405.346,0,0,0,0","+units=m","+no_defs"].join(" ");ao.a.defs("EPSG:2056",no),to.a(ao.a),te.f("EPSG:2056").setExtent([242e4,103e4,29e5,135e4]);var oo=r(202),io=r(254),so=r.n(io),lo=r(253),uo=r.n(lo);window.requestAnimationFrame||(alert("Your browser is not supported, please update it or use another one. You will be redirected.\n\nVotre navigateur n'est pas supporté, veuillez le mettre à jour ou en utiliser un autre. Vous allez être redirigé.\n\nIhr Browser wird nicht unterstützt, bitte aktualisieren Sie ihn oder verwenden Sie einen anderen. Sie werden weitergeleitet."),window.location="http://geomapfish.org/");var co=function(e,t){if(Zn.call(this,{autorotate:!1,srid:21781,mapViewConfig:{center:[632464,185457],zoom:3,resolutions:[250,100,50,20,10,5,2,1,.5,.25,.1,.05]}},e,t),this.elevationLayersConfig=[{name:"aster",unit:"m"},{name:"srtm",unit:"m"}],this.searchCoordinatesProjections=[oo.a,"EPSG:2056","EPSG:4326"],t.has("sentryUrl")){var r=t.has("sentryOptions")?t.get("sentryOptions"):void 0;(new so.a).config(t.get("sentryUrl"),r).addPlugin(uo.a).install()}};co.$inject=["$scope","$injector"],co.$inject=["$scope","$injector"],f.d(co,Zn),(co.module=angular.module("Appmobile",[eo.module.name,Zn.module.name])).controller("MobileController",co);t.default=co},,,,,function(e,t){e.exports='<a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},function(e,t){e.exports='<a class="btn btn-default" ng-if="ctrl.drawing && (!ctrl.valid)" ng-click=ctrl.addPoint()> <span class="fa fa-check"></span> {{\'Set as starting point\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.dirty ng-click=ctrl.addPoint()> <span class="fa fa-plus"></span> {{\'Add new point\' | translate}} </a> <a class="btn btn-default" ng-if="ctrl.drawing && ctrl.valid && !ctrl.dirty" ng-click=ctrl.finish()> <span class="fa fa-check"></span> {{\'Terminate\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.valid ng-click=ctrl.clear()> <span class="fa fa-repeat"></span> {{\'Clear\' | translate}} </a> <a class="btn btn-default" ng-if=ctrl.active ng-click=ctrl.deactivate()> <span class="fa fa-times"></span> {{\'Close\' | translate}} </a> '},,function(e,t){e.exports='<div class=ngeo-displaywindow ng-show=$ctrl.open ng-style=$ctrl.style> <div class=windowcontainer> <button type=button class="btn fa-close close" ng-click=$ctrl.close()> </button> <div class=animation-container> <div class=slide-animation> <div class="header ui-draggable-handle" ng-if="$ctrl.title !== null"> <p class=title>{{$ctrl.title | translate}}</p> </div> <div class="details content" ng-if=$ctrl.content ng-bind-html=$ctrl.content> </div> <div class="details iframe" ng-if="$ctrl.url !== null"> <iframe frameborder=0 type=text/html height=100% width=100% ng-src="{{ $ctrl.urlTrusted }}"></iframe> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<ul class=gmf-theme-selector> <li ng-repeat="theme in $ctrl.themes" ng-click=$ctrl.setTheme(theme) ng-class="{\'gmf-theme-selector-active\': $ctrl.gmfThemeManager.getThemeName() == theme.name}"> <img class=gmf-thumb ng-src={{::theme.icon}} /> <span class=gmf-text>{{theme.name | translate}}</span> </li> </ul> '},function(e,t){e.exports='<div class=gmf-search> <input type=text ng-attr-placeholder={{$ctrl.placeholder|translate}} class=form-control ng-model=$ctrl.inputValue ngeo-search=$ctrl.options ngeo-search-datasets=$ctrl.datasets ngeo-search-listeners=$ctrl.listeners> <span class="gmf-clear-button ng-hide" ng-hide="!$ctrl.clearButton || $ctrl.inputValue == \'\'" ng-click=$ctrl.onClearButton()> </span> </div> <span ng-if=$ctrl.colorChooser> <span ng-show=$ctrl.displayColorPicker ngeo-popover ngeo-popover-placement=bottom> <button class="gmf-color-button fa fa-tint" ngeo-popover-anchor data-original-title="{{\'Change the color of the search result\'|translate}}"></button> <div ngeo-popover-content> <div ngeo-colorpicker ngeo-colorpicker-color=$ctrl.color></div> </div> </span> </span> '},,,,,,,function(e,t){e.exports='<table class=ngeo-colorpicker-palette> <tr ng-repeat="colors in ::ctrl.colors"> <td ng-repeat="color in ::colors" ng-click=ctrl.setColor(color) ng-class="{\'ngeo-colorpicker-selected\': color == ctrl.color}"> <div ng-style="::{\'background-color\': color}"></div> </td> </tr> </table> '},function(e,t){e.exports='<div class=gmf-displayquerywindow ng-class="{\'desktop\': ctrl.desktop, \'mobile\': !ctrl.desktop}" ng-show=ctrl.open ngeo-swipe-up="ctrl.collapsed = false" ngeo-swipe-down="ctrl.collapsed = true" ngeo-swipe-disable-mouse ng-swipe-disable-mouse ng-swipe-left=ctrl.next() ng-swipe-right=ctrl.previous()> <button class=collapse-button type=button ng-show=::!ctrl.desktop ng-click="ctrl.collapsed = !ctrl.collapsed" ng-class="[ctrl.collapsed ? \'collapse-button-up\' : \'collapse-button-down\']"> </button> <div class=windowcontainer> <button type=button class="btn fa-close close" ng-click=ctrl.close()> </button> <div class=animation-container ng-class="[ctrl.collapsed ? \'\' : \'animation-container-detailed\', ctrl.isNext ? \'next\' : \'previous\']"> <div ng-animate-swap=ctrl.animate class="slide-animation gmf-animatable"> <div class=header> <p class=title>{{ctrl.source.label | translate}}</p> <p class=subtitle>{{ctrl.getFeatureValues()[ctrl.source.identifierAttributeField]}}</p> </div> <div class=details> <table> <tr ng-repeat="(key, value) in ctrl.getFeatureValues()" ng-if="value !== undefined"> <td class=details-key ng-bind-html="key | translate | ngeoTrustHtml"></td> <td class=details-value ng-bind-html="value | ngeoTrustHtml"></td> </tr> </table> </div> </div> </div> <div class=navigate> <div class=placeholder> <button type=button class="previous btn" ng-disabled=ctrl.isFirst() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.previous()> <span ng-show=::ctrl.desktop>{{\'Prev.\' | translate}}</span> </button> </div> <div class=results> <span ng-show=::!ctrl.desktop>{{\'Result\' | translate}}</span> <span>{{ctrl.currentResult + 1}}</span> <span>/</span> <span>{{ctrl.getResultLength()}}</span> <div ng-show=::ctrl.desktop class=dropup> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class="fa fa-filter"></span> <span class="fa fa-caret-up"></span> </button> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li> <a href=# ng-click=ctrl.setSelectedSource(null)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === null}"> </i> <span>{{\'All layers\' | translate}} ({{ctrl.ngeoQueryResult.total}})</span> </a> </li> <li role=separator class=divider> </li> <li ng-repeat-start="source in ctrl.ngeoQueryResult.sources | filter: ctrl.sourcesFilter" ng-repeat-end ng-class="{\'disabled\': source.features.length <= 0}"> <a href=# ng-click=ctrl.setSelectedSource(source)> <i class="fa fa-fw" ng-class="{\'fa-check\': ctrl.selectedSource === source}"> </i> <span>{{source.label | translate}} ({{source.features.length}})</span> </a> </li> </ul> </div> </div> <div class=placeholder> <button type=button class="next btn" ng-disabled=ctrl.isLast() ng-show="ctrl.getResultLength() > 1" ng-click=ctrl.next()> <span ng-show=::ctrl.desktop>{{\'Next\' | translate}}</span> </button> </div> </div> </div> </div> '},,,,,,function(e,t){e.exports='<div class="gmf-displayquerygrid panel" ng-show=ctrl.active> <div class=close ng-click=ctrl.clear()> &times; </div> <ul class="nav nav-pills" role=tablist> <li ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=presentation ng-class="{\'active\' : ctrl.isSelected(gridSource)}" ng-click=ctrl.selectTab(gridSource)> <a href=#{{ctrl.escapeValue(gridSource.source.label)}} data-target=#{{ctrl.escapeValue(gridSource.source.label)}} aria-controls={{ctrl.escapeValue(gridSource.source.label)}} role=tab data-toggle=tab> <span ng-if="gridSource.source.tooManyResults !== true"> {{gridSource.source.label | translate}} ({{gridSource.source.features.length}}) </span> <span ng-if="gridSource.source.tooManyResults === true"> {{gridSource.source.label | translate}} ({{gridSource.source.totalFeatureCount}}*) </span> </a> </li> </ul> <div class=tab-content> <div ng-repeat="gridSource in ctrl.getGridSources() track by gridSource.source.label" role=tabpanel class=tab-pane ng-class="{\'active\' : ctrl.isSelected(gridSource)}" id={{ctrl.escapeValue(gridSource.source.label)}}> <ngeo-grid ngeo-grid-configuration=gridSource.configuration ng-if="gridSource.source.tooManyResults !== true"> </ngeo-grid> <div ng-if="gridSource.source.tooManyResults === true"> <div class="gmf-displayquerygrid-message alert alert-warning"> <p><span translate>The results can not be displayed because the maximum number has been reached</span> ({{gridSource.source.limit}}).</p> <p translate>Please refine your query.</p> </div> </div> </div> </div> <div class=navbar ng-show="!ctrl.pending && ctrl.getActiveGridSource() && ctrl.getActiveGridSource().configuration !== null"> <ul class="nav navbar-nav navbar-right"> <li class=ng-hide ng-show=ctrl.isOneSelected()> <p class="navbar-text ng-binding"> {{ctrl.getSelectedRowCount()}} <span translate>selected element(s)</span> </p> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Zoom to selection\' | translate}}" ng-click=ctrl.zoomToSelection()> <i class="fa fa-search-plus"></i> <span translate>Zoom to</span> </button> </li> <li ng-show=ctrl.isOneSelected() class=ng-hide> <button class="btn btn-link btn-xs" title="{{\'Export selection as CSV\' | translate}}" ng-click=ctrl.downloadCsv()> <i class="fa fa-download"></i> <span translate>Export as CSV</span> </button> </li> <li class="dropdown navbar-link dropup"> <button type=button class="dropup btn btn-default btn-xs" data-toggle=dropdown aria-haspopup=true aria-expanded=false> <span translate>Select</span> <span class=caret></span> </button> <ul class=dropdown-menu aria-labelledby=dLabel> <li> <a href="" ng-click=ctrl.selectAll() translate>All</a> </li> <li> <a href="" ng-click=ctrl.unselectAll() translate>None</a> </li> <li> <a href="" ng-click=ctrl.invertSelection() translate>Reverse selection</a> </li> </ul> </li> </ul> </div> <div ng-show=ctrl.pending class=gmf-displayquerygrid-pending> <span class="fa fa-spinner fa-spin"></span> </div> </div> '},function(e,t){e.exports='<div class=ngeo-grid-table-container> <table float-thead=ctrl.floatTheadConfig ng-model=ctrl.configuration.data class="table table-bordered table-striped table-hover"> <thead class=table-header> <tr> <th ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-click=ctrl.sort(columnDefs.name) ng-bind-html="columnDefs.name | ngeoTrustHtml | translate"> <i ng-show="ctrl.sortedBy !== columnDefs.name" class="fa fa-fw"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === true" class="fa fa-caret-up"></i> <i ng-show="ctrl.sortedBy === columnDefs.name && ctrl.sortAscending === false" class="fa fa-caret-down"></i> </th> </tr> </thead> <tbody> <tr ng-repeat="attributes in ctrl.configuration.data" ng-class="[\'row-\' + ctrl.configuration.getRowUid(attributes), ctrl.configuration.isRowSelected(attributes) ? \'ngeo-grid-active\': \'\']" ng-click="ctrl.clickRow(attributes, $event)" ng-mousedown=ctrl.preventTextSelection($event)> <td ng-repeat="columnDefs in ctrl.configuration.columnDefs" ng-bind-html="attributes[columnDefs.name] | ngeoTrustHtml"></td> </tr> </tbody> </table> </div> '},,,function(e,t){e.exports='<div class="btn-group dropup"> <a type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span class=gmf-mouseposition-control-target></span> <span class=caret></span> </a> <ul class="dropdown-menu dropdown-menu-right" role=menu> <li class=dropdown-header translate>Coordinate systems</li> <li ng-repeat="projitem in ::ctrl.projections"> <a href ng-click=ctrl.setProjection(projitem)> <span class="fa fa-fw" ng-class="{\'fa-check\': ctrl.projection == projitem}"></span> {{::projitem.label}} </a> </li> </ul> </div> '},function(e,t){e.exports="<div ngeo-map=ctrl.map ngeo-map-manage-resize=ctrl.manageResize ngeo-map-resize-transition=ctrl.resizeTransition> </div> "},function(e,t){e.exports='<div class="btn-group btn-block" ng-class="::{\'dropup\': scaleselectorCtrl.options.dropup}"> <button type=button class="btn btn-default dropdown-toggle" data-toggle=dropdown aria-expanded=false> <span ng-bind-html="scaleselectorCtrl.currentScale | ngeoScalify | ngeoTrustHtml"></span>&nbsp;<i class=caret></i> </button> <ul class="dropdown-menu btn-block" role=menu> <li ng-repeat="zoomLevel in ::scaleselectorCtrl.zoomLevels"> <a href ng-click=scaleselectorCtrl.changeZoom(zoomLevel) ng-bind-html="scaleselectorCtrl.getScale(zoomLevel) | ngeoScalify | ngeoTrustHtml"> </a> </li> </ul> </div> '},,,,,,,,,function(e,t){e.exports='<div class=modal-header> <button type=button class=close data-dismiss=modal aria-label=Close><span aria-hidden=true>&times;</span></button> <h4 class=modal-title translate>Share this map</h4> </div> <div class=modal-body> <form role=form name=gmfShareForm novalidate> <div class=form-group> <label for=gmfShareInputShortLink translate>Permalink</label> <input type=text class=form-control id=gmfShareInputShortLink onclick=this.select() ng-model=$ctrl.shortLink readonly=True> <p class=help-block translate>Copy this link to share it.</p> <p class=text-danger ng-if=$ctrl.showLengthWarning> <span class="fa fa-exclamation-triangle"></span> {{\'You have a lot of drawn elements in this map. The above link may not be correctly supported by some browsers.\' | translate}} </p> <p class=text-danger ng-if=$ctrl.errorOnGetShortUrl> <span class="fa fa-exclamation"></span> {{\'Error, cannot get the shortened URL.\' | translate}} </p> </div> <hr> <div class=gmf-share-email ng-if=::$ctrl.enableEmail> <div class=form-group> <label for=gmfShareInputEmail translate>Send this link to</label> <input type=email class=form-control name=inputEmail id=gmfShareInputEmail placeholder=E-mail ng-model=$ctrl.email required> <span ng-show="gmfShareForm.$submitted || gmfShareForm.inputEmail.$touched"> <span class=text-danger ng-show="gmfShareForm.inputEmail.$error.email || gmfShareForm.inputEmail.$error.required"> <i class="fa fa-exclamation-triangle" aria-hidden=true></i> {{\'Invalid email.\' | translate}}</span> </span> </div> <div class=form-group> <textarea class=form-control ng-attr-placeholder="{{\'Message (optional)\' | translate }}" ng-model=$ctrl.message></textarea> </div> <span class=text-success ng-if=$ctrl.successfullySent> <i class="fa fa-check" aria-hidden=true></i> {{ \'Link successfully sent.\' | translate }} </span> <span class=text-danger ng-if=$ctrl.errorOnsend> <i class="fa fa-exclamation" aria-hidden=true></i> {{ \'Error, the link has not been sent.\' | translate }} </span> </div> <div class=text-right> <button type=button class="btn btn-default" data-dismiss=modal translate>Close</button> <button ng-if=::$ctrl.enableEmail type=submit class="btn btn-default btn-primary" ng-click=$ctrl.sendShortUrl() ng-disabled=!gmfShareForm.$valid translate>Send </button> </div> </form> </div> '},function(e,t){e.exports='<div class=gmf-time-slider> <div ui-slider=sliderCtrl.sliderOptions ng-model=sliderCtrl.dates> <span class="ui-slider-handle ui-state-default ui-corner-all" tabindex=0 data-toggle=tooltip title=""> </span> </div> <div class=gmf-time-slider-displayed-dates> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[0])}}</span> </div> <div class=gmf-time-slider-start-date ng-if="::sliderCtrl.time.mode === \'value\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates)}}</span> </div> <div class=gmf-time-slider-end-date ng-if="::sliderCtrl.time.mode === \'range\'"> <span>{{sliderCtrl.getLocalizedDate(sliderCtrl.dates[1])}}</span> </div> </div> </div> '},,,,function(e,t){e.exports='<div class=gmf-layertree-root-tools ng-if=layertreeCtrl.isRoot> <a href ng-if="gmfLayertreeCtrl.nodesCount() > 0" ng-click=gmfLayertreeCtrl.removeAllNodes()> <span class="fa fa-trash"></span> {{\'Clear all\' | translate}} </a> </div> <div ng-if=::!layertreeCtrl.isRoot id=gmf-layertree-node-{{::layertreeCtrl.uid}} ng-class="[layertreeCtrl.node.children ? \'gmf-layertree-group\' : \'gmf-layertree-leaf\', \'gmf-layertree-depth-\' + layertreeCtrl.depth, gmfLayertreeCtrl.getResolutionStyle(layertreeCtrl.node), gmfLayertreeCtrl.getNodeState(layertreeCtrl)]"> <div class=ngeo-sortable-handle ng-show="layertreeCtrl.depth === 1 && layertreeCtrl.parent.children.length > 1"> <i class="gmf-layertree-sortable-handle-icon fa fa-ellipsis-v"></i> </div> <a ng-if=::layertreeCtrl.node.children data-toggle=collapse href=#gmf-layertree-layer-group-{{::layertreeCtrl.uid}} aria-expanded={{::layertreeCtrl.node.metadata.isExpanded}} class="fa gmf-layertree-expand-node fa-fw"> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::!layertreeCtrl.node.children ng-class="::{\'gmf-layertree-no-layer-icon\' : !gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl)}" class=gmf-layertree-layer-icon> <img ng-if="::(legendIconUrl=gmfLayertreeCtrl.getLegendIconURL(layertreeCtrl))" ng-src={{::legendIconUrl}}>  </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) ng-if=::layertreeCtrl.node.children ng-class="[\'fa fa-fw\', layertreeCtrl.node.children && !layertreeCtrl.layer.loading ? \'gmf-layertree-state\' : \'fa-refresh fa-spin\']"> </a> <a href ng-click=::gmfLayertreeCtrl.toggleActive(layertreeCtrl) class=gmf-layertree-name data-toggle=tooltip data-placement=top title="{{layertreeCtrl.node.name | translate}}"> {{layertreeCtrl.node.name | translate}} <i class="gmf-icon gmf-icon-search-go gmf-layertree-zoom" data-toggle=tooltip data-placement=bottom data-title="{{\'Not visible at current scale. Click to zoom.\'|translate}}" ng-click="::gmfLayertreeCtrl.zoomToResolution(layertreeCtrl); $event.preventDefault(); $event.stopPropagation();" ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) == \'on\'"> </i> <span ngeo-popover ngeo-popover-dismiss=.content ng-if="gmfLayertreeCtrl.getNodeState(layertreeCtrl) !== \'off\' && layertreeCtrl.node.time && layertreeCtrl.node.time.mode !== \'disabled\'"> <span ngeo-popover-anchor class="fa fa-clock-o" ng-click="$event.preventDefault(); $event.stopPropagation()"> </span> <div ngeo-popover-content> <ngeo-date-picker ng-if="::layertreeCtrl.node.time.widget === \'datepicker\'" time=layertreeCtrl.node.time on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </ngeo-date-picker> <gmf-time-slider ng-if="::layertreeCtrl.node.time.widget === \'slider\'" gmf-time-slider-time=layertreeCtrl.node.time gmf-time-slider-on-date-selected="gmfLayertreeCtrl.updateWMSTimeLayerState(layertreeCtrl, time)"> </gmf-time-slider> </div> </span> <span class="fa fa-pencil" data-toggle=tooltip data-placement=right title="{{\'Currently editing this layer\'|translate}}" ng-if=layertreeCtrl.properties.editing> </span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-if="::layertreeCtrl.depth == 1" ng-click=gmfLayertreeCtrl.removeNode(layertreeCtrl.node)> <span class="fa fa-trash"></span> </a> <a class=gmf-layertree-node-menu-btn href="" ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl) ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-menu-\' + layertreeCtrl.uid)"> <span class="fa fa-cog"></span> </a> <span ngeo-popover ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed && !layertreeCtrl.node.children) || (gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend) || layertreeCtrl.getDataSource().filtrable" ngeo-popover-dismiss=.content> <span ngeo-popover-anchor class="extra-actions fa fa-cog"> </span> <div ngeo-popover-content> <ul> <li ng-if="::(layertreeCtrl.depth === 1 && !layertreeCtrl.node.mixed) || (layertreeCtrl.depth > 1 && layertreeCtrl.parent.node.mixed)"> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </li> <li ng-if="::gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend"> <i class="fa fa-th-list fa-fw"></i> <a ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\'); popoverCtrl.dismissPopover()" data-toggle=collapse href=""> {{\'Show/hide legend\'|translate}} </a> </li> <li ng-if="layertreeCtrl.getDataSource() && layertreeCtrl.getDataSource().filtrable"> <i class="fa fa-filter fa-fw"></i> <a ng-click=gmfLayertreeCtrl.toggleFiltrableDataSource(layertreeCtrl.getDataSource()) href=""> {{\'Filter\'|translate}} </a> </li> </ul> </div> </span> <span class=gmf-layertree-metadata ng-if=::layertreeCtrl.node.metadata.metadataUrl> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow === true"> <a title="{{\'More informations\'|translate}}" href={{::layertreeCtrl.node.metadata.metadataUrl}} target=blank_> </a> </span> <span ng-if="::gmfLayertreeCtrl.openLinksInNewWindow !== true"> <a title="{{\'More informations\'|translate}}" href="" ng-click=gmfLayertreeCtrl.displayMetadata(layertreeCtrl)> </a> </span> </span> </span> </div> <div class=gmf-layertree-node-menu id=gmf-layertree-node-menu-{{::layertreeCtrl.uid}} style=display:none ng-if=::gmfLayertreeCtrl.supportsCustomization(layertreeCtrl)> <div ng-if=::gmfLayertreeCtrl.supportsOpacityChange(layertreeCtrl)> <i class="fa fa-tint fa-fw"></i> <span for=layer-opactity>{{\'Opacity\'|translate}}</span> <input class=input-action name=layer-opactity type=range min=0 max=1 step=0.01 ng-model=layertreeCtrl.layer.opacity /> </div> <a class=gmf-layertree-node-menu-togglelegend ng-if=::gmfLayertreeCtrl.supportsLegend(layertreeCtrl) data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> <span class="fa fa-th-list"> </span> {{\'Show/hide legend\'|translate}} </a> </div> <div ng-if="::!layertreeCtrl.isRoot && gmfLayertreeCtrl.getLegendsObject(layertreeCtrl) && layertreeCtrl.node.metadata.legend" id=gmf-layertree-node-{{::layertreeCtrl.uid}}-legend class="collapse gmf-layertree-legend" ng-class="::[layertreeCtrl.node.metadata.isLegendExpanded ? \'in\' : \'\']"> <a title="{{\'Hide legend\'|translate}}" data-toggle=collapse ng-click="::gmfLayertreeCtrl.toggleNodeLegend(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')" href=""> {{\'Hide legend\'|translate}} </a> <div ng-if="gmfLayertreeCtrl.isNodeLegendVisible(\'#gmf-layertree-node-\' + layertreeCtrl.uid + \'-legend\')"> <div ng-repeat="(title, url) in gmfLayertreeCtrl.getLegendsObject(layertreeCtrl)"> <p ng-if="gmfLayertreeCtrl.getNumberOfLegendsObject(layertreeCtrl) > 1">{{title|translate}}</p> <img ng-src={{url}}> </div> </div> </div> <ul class=gmf-layertree-root-external-datasources ng-if="layertreeCtrl.isRoot && (gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups.length || gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length)"> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmtsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmtsGroups" group=wmtsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-repeat="wmsGroup in gmfLayertreeCtrl.gmfExternalDataSourcesManager.wmsGroups" group=wmsGroup> </gmf-datasourcegrouptree> <gmf-datasourcegrouptree class="gmf-layertree-node gmf-layertree-depth-1" ng-if=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup.dataSources.length group=gmfLayertreeCtrl.gmfExternalDataSourcesManager.fileGroup> </gmf-datasourcegrouptree> </ul> <ul id=gmf-layertree-layer-group-{{::layertreeCtrl.uid}} ng-if=::layertreeCtrl.node.children ng-class="{collapse: !layertreeCtrl.isRoot, in : layertreeCtrl.node.metadata.isExpanded}" ngeo-sortable="::layertreeCtrl.isRoot && layertreeCtrl.node.children" ngeo-sortable-options="{handleClassName: \'ngeo-sortable-handle\', draggerClassName: \'gmf-layertree-dragger\', placeholderClassName : \'gmf-layertree-curr-drag-item\'}" ngeo-sortable-callback=::gmfLayertreeCtrl.afterReorder ngeo-sortable-callback-ctx=::gmfLayertreeCtrl> <li class=gmf-layertree-node ng-repeat="node in layertreeCtrl.node.children" ng-class="\'gmf-layertree-depth-\' + layertreeCtrl.depth" ngeo-layertree=node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<span ng-if=::!layertreeCtrl.isRoot>{{::layertreeCtrl.node.name}}</span> <input type=checkbox ng-if="::layertreeCtrl.node && !layertreeCtrl.node.children" ng-model=layertreeCtrl.getSetActive ng-model-options="{getterSetter: true}"/> <ul ng-if=::layertreeCtrl.node.children> <li ng-repeat="node in ::layertreeCtrl.node.children" ngeo-layertree=::node ngeo-layertree-notroot ngeo-layertree-map=layertreeCtrl.map ngeo-layertree-nodelayerexpr=layertreeCtrl.nodelayerExpr ngeo-layertree-listenersexpr=layertreeCtrl.listenersExpr> </li> </ul> '},function(e,t){e.exports='<div class="gmf-layertree-group gmf-layertree-depth-1 {{$ctrl.group.visibilityState}}"> <a data-toggle=collapse href=#gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} aria-expanded=true class="fa gmf-layertree-expand-node fa-fw"> </a> <a class="fa fa-fw gmf-layertree-state" href ng-click=$ctrl.toggle()> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggle()> <span>{{$ctrl.group.title | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.remove()> <span class="fa fa-trash"></span> </a> </span> </div> <ul id=gmf-layertree-layer-group-{{::$ctrl.getGroupUid()}} class="collapse in"> <li class="gmf-layertree-node gmf-layertree-depth-2" ng-class="[dataSource.visible ? \'on\' : \'off\']" ng-repeat="dataSource in $ctrl.group.dataSources"> <div class=gmf-layertree-leaf> <a href ng-click=$ctrl.toggleDataSource(dataSource) class="gmf-layertree-layer-icon gmf-layertree-no-layer-icon"> </a> <a class=gmf-layertree-name href ng-click=$ctrl.toggleDataSource(dataSource)> <span>{{dataSource.name | translate}}</span> </a> <span class=gmf-layertree-right-buttons> <a href="" ng-click=$ctrl.removeDataSource(dataSource)> <span class="fa fa-trash"></span> </a> </span> </div> </li> </ul> '},function(e,t){e.exports='<div class=form-group ng-switch=$ctrl.filtrableDataSources.length> <span ng-switch-when=0 translate>No filtrable layer available!</span> <select class=form-control ng-disabled=$ctrl.aRuleIsActive ng-switch-default ng-model=$ctrl.gmfDataSourceBeingFiltered.dataSource ng-options="dataSource.name | translate for dataSource in $ctrl.filtrableDataSources"> <option value="" translate>-- Layer to filter --</option> </select> <div ng-if="$ctrl.customRules && $ctrl.directedRules && $ctrl.readyDataSource"> <hr class=gmf-filterselector-separator /> <div class="dropdown gmf-filterselector-savedfilters"> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0}" type=button data-toggle=dropdown ng-disabled="$ctrl.aRuleIsActive || $ctrl.gmfSavedFilters.currentDataSourceItems.length === 0"> <span translate>Saved</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <a href ng-click=$ctrl.saveFilterLoadItem(item)> <span>{{::item.name}}</span> </a> </li> <li role=separator class=divider></li> <li> <a href ng-click=$ctrl.saveFilterManage()> <span translate>Manage saved filters</span> </a> </li> </ul> </div> <ngeo-filter a-rule-is-active=$ctrl.aRuleIsActive custom-rules=$ctrl.customRules datasource=$ctrl.readyDataSource directed-rules=$ctrl.directedRules feature-overlay=$ctrl.featureOverlay map=$ctrl.map tool-group=$ctrl.toolGroup> </ngeo-filter> <div> <a class="btn btn-link gmf-filterselector-savebtn" type=button data-toggle=dropdown ng-click="!$ctrl.aRuleIsActive && $ctrl.saveFilterShowModal()" ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-save"></span> <span translate>Save</span> </a> </div> </div> <ngeo-modal ng-model=$ctrl.saveFilterSaveModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Save filter\' | translate}}</h4> </div> <div class=modal-body> <p class=gmf-filterselector-savefilter-desc translate> You can save the filter that you created to re-load it later. </p> <input type=text class=form-control name=name ng-model=$ctrl.saveFilterName placeholder="{{\'Filter name\' | translate}}"/> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Cancel\' | translate}}</button> <button type=button ng-click=$ctrl.saveFilterSave() ng-disabled="$ctrl.saveFilterName === \'\'" class="btn btn-primary">{{\'Save\' | translate}}</button> </div> </ngeo-modal> <ngeo-modal ng-model=$ctrl.saveFilterManageModalShown> <div class=gmf-filterselector-managefilter-modal> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title>{{\'Manage filters\' | translate}}</h4> </div> <div class=modal-body> <ul> <li ng-repeat="item in $ctrl.gmfSavedFilters.currentDataSourceItems"> <span>{{::item.name}}</span> <a href ng-click=$ctrl.saveFilterRemoveItem(item)> {{ \'Delete\' | translate }} </a> <div class=gmf-eol></div> </li> </ul> </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'Close\' | translate}}</button> </div> </div> </ngeo-modal> </div> '},function(e,t){e.exports='<div class=dropdown> <a class="btn btn-link dropdown-toggle ngeo-filter-condition-button" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span class="fa fa-cog"></span> <span class=caret></span> </a> <ul class=dropdown-menu> <li class=ngeo-filter-condition-criteria-header translate>Criteria taken into account</li> <li ng-repeat="condition in ::$ctrl.conditions"> <a href ng-click=$ctrl.setCondition(condition)> <span ng-class="{\'ngeo-filter-condition-criteria-active\': condition.value == $ctrl.datasource.filterCondition}" class="fa fa-check ngeo-filter-condition-criteria"> </span> <span>{{::condition.text | translate}}</span> </a> </li> </ul> </div> <ngeo-rule ng-repeat="rule in $ctrl.directedRules" feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-directed map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> <hr class=ngeo-filter-separator-rules /> <div ng-repeat="rule in $ctrl.customRules"> <a class="btn btn-xs btn-link ngeo-filter-rule-custom-rm-btn" ng-click="!$ctrl.aRuleIsActive && $ctrl.removeCustomRule(rule)" ng-disabled=$ctrl.aRuleIsActive href> <span class="fa fa-remove"></span> </a> <ngeo-rule feature-overlay=::$ctrl.featureOverlay class=ngeo-filter-rule-custom map=$ctrl.map rule=rule tool-group=$ctrl.toolGroup> </ngeo-rule> </div> <div class=dropdown> <a class="btn btn-link dropdown-toggle" ng-class="{disabled: $ctrl.aRuleIsActive}" type=button data-toggle=dropdown ng-disabled=$ctrl.aRuleIsActive> <span translate>+ Add a new criteria</span> <span class=caret></span> </a> <ul class=dropdown-menu> <li ng-repeat="attribute in ::$ctrl.geometryAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span translate>Spatial filter</span> </a> </li> <li role=presentation class=divider></li> <li ng-repeat="attribute in ::$ctrl.otherAttributes"> <a href ng-click=$ctrl.createAndAddCustomRule(attribute)> <span>{{::attribute.name | translate}}</span> </a> </li> </ul> </div> <hr class=ngeo-filter-separator-criteria /> <a class="btn btn-link" type=button ng-click=$ctrl.apply() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-check"></span> <span translate>Apply filter</span> </a> <a class="btn btn-link" type=button ng-click=$ctrl.getData() ng-disabled="$ctrl.hasARule() === false || $ctrl.datasource.visible === false"> <span class="fa fa-chevron-right"></span> <span translate>Get data</span> </a> '},function(e,t){e.exports='<div class=dropdown ng-class="{open: $ctrl.rule.active}"> <a class="btn btn-default btn-sm dropdown-toggle" type=button ng-click=$ctrl.toggle()> <span>{{ ::$ctrl.clone.name | translate }}</span> <span class=caret></span> </a> <div class="dropdown-menu form-group"> <select class="form-control input-sm ngeo-rule-operators-list" ng-disabled=$ctrl.drawActive ng-if=::$ctrl.clone.operators ng-model=$ctrl.clone.operator ng-options="$ctrl.operators[operator] | translate for operator in ::$ctrl.clone.operators track by operator"> </select> <div ng-switch=::$ctrl.clone.type> <div class="ngeo-rule-type-date form-group" ng-if=$ctrl.rule.active ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <ngeo-date-picker time=$ctrl.timeRangeMode on-date-selected=$ctrl.onDateRangeSelected(time)> </ngeo-date-picker> </div> <div ng-switch-default> <ngeo-date-picker time=$ctrl.timeValueMode on-date-selected=$ctrl.onDateSelected(time)> </ngeo-date-picker> </div> </div> </div> <div class="ngeo-rule-type-geometry form-group" ng-switch-when=geometry> <div ng-switch=$ctrl.geomType> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </div> <ngeo-drawfeature ngeo-drawfeature-active=$ctrl.drawActive ngeo-drawfeature-features=$ctrl.drawnFeatures ngeo-drawfeature-map=$ctrl.map> <div ngeo-btn-group class=btn-group> <a data-toggle=tooltip title="{{\'Draw a point on the map\' | translate}}" href ngeo-btn ngeo-drawpoint class="btn btn-sm btn-default ngeo-drawfeature-point" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.drawPoint.active}" ng-model=dfCtrl.drawPoint.active> <span class="gmf-icon gmf-icon-point"></span> </a> <a data-toggle=tooltip title="{{\'Draw a line on the map\' | translate}}" href ngeo-btn ngeo-measurelength class="btn btn-sm btn-default ngeo-drawfeature-linestring" ng-show="[\'intersects\', \'within\'].indexOf($ctrl.clone.operator) !== -1" ng-class="{active: dfCtrl.measureLength.active}" ng-model=dfCtrl.measureLength.active> <span class="gmf-icon gmf-icon-line"></span> </a> <a data-toggle=tooltip title="{{\'Draw a polygon on the map\' | translate}}" href ngeo-btn ngeo-measurearea class="btn btn-sm btn-default ngeo-drawfeature-polygon" ng-class="{active: dfCtrl.measureArea.active}" ng-model=dfCtrl.measureArea.active> <span class="gmf-icon gmf-icon-polygon"></span> </a> <a data-toggle=tooltip title="{{\'Draw a circle on the map\' | translate}}" href ngeo-btn ngeo-measureazimut class="btn btn-sm btn-default ngeo-drawfeature-circle" ng-class="{active: dfCtrl.measureAzimut.active}" ng-model=dfCtrl.measureAzimut.active> <span class="gmf-icon gmf-icon-circle"></span> </a> <a data-toggle=tooltip title="{{\'Draw a rectangle on the map\' | translate}}" href ngeo-btn ngeo-drawrectangle class="btn btn-sm btn-default ngeo-drawfeature-rectangle" ng-class="{active: dfCtrl.drawRectangle.active}" ng-model=dfCtrl.drawRectangle.active> <span class="gmf-icon gmf-icon-rectangle"></span> </a> </div> <div class=ngeo-rule-type-geometry-instructions ng-if=$ctrl.drawActive> <span ng-if=dfCtrl.drawPoint.active> {{ \'Draw a point on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureLength.active> {{ \'Draw a line string on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureArea.active> {{ \'Draw a polygon on the map.\' | translate }} </span> <span ng-if=dfCtrl.measureAzimut.active> {{ \'Draw a circle on the map.\' | translate }} </span> <span ng-if=dfCtrl.drawRectangle.active> {{ \'Draw a rectangle on the map.\' | translate }} </span> </div> </ngeo-drawfeature> </div> <div class="checkbox ngeo-rule-type-select" ng-switch-when=select> <a ng-click=$ctrl.selectAllChoices() href>{{ All | translate}} </a> <label class="form-group ol-unselectable" ng-repeat="choice in ::$ctrl.clone.choices"> <input ng-checked="$ctrl.clone.getExpression() && $ctrl.clone.getExpression().split(\',\').indexOf(choice) > -1" ng-click=$ctrl.toggleChoiceSelection(choice) type=checkbox value=choice /> <span>{{ choice | translate }}</span> </label> </div> <div class="form-group ngeo-rule-type-text" ng-switch-default> <div ng-switch=$ctrl.clone.operator> <div ng-switch-when=..> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.lowerBoundary /> <input type=number class="form-control input-sm" ng-model=$ctrl.clone.upperBoundary /> </div> <div ng-switch-default> <input type=number class="form-control input-sm" ng-if="$ctrl.clone.type === \'number\'" ng-model=$ctrl.clone.expression /> <input type=text class="form-control input-sm" ng-if="$ctrl.clone.type !== \'number\'" ng-model=$ctrl.clone.expression /> </div> </div> </div> <div class=ngeo-rule-btns> <button class="btn btn-xs btn-default" ng-click=$ctrl.apply() type=button>{{\'Apply\' | translate}}</button> <button class="btn btn-xs btn-default" ng-click=$ctrl.cancel() type=button>{{\'Cancel\' | translate}}</button> </div> </div> </div> </div> <div class=ngeo-rule-value ng-if="$ctrl.rule.value !== null"> <a class="btn btn-xs btn-link" ng-click="!$ctrl.rule.active && $ctrl.reset()" ng-disabled=$ctrl.rule.active href> <span class="fa fa-remove"></span> </a> <div ng-switch=::$ctrl.rule.type> <div ng-switch-when=date|datetime ng-switch-when-separator=|> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>From </span> <span>{{ $ctrl.timeToDate($ctrl.rule.lowerBoundary) }}</span> <span translate> to </span> <span>{{ $ctrl.timeToDate($ctrl.rule.upperBoundary) }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.timeToDate($ctrl.rule.getExpression()) }}</span> </div> </div> </div> <div ng-switch-when=geometry> <span>{{ $ctrl.operators[$ctrl.rule.operator] }}</span> <span ng-switch=$ctrl.getRuleGeometryType()> <span class="gmf-icon gmf-icon-point" ng-switch-when=Point> </span> <span class="gmf-icon gmf-icon-line" ng-switch-when=LineString> </span> <span class="gmf-icon gmf-icon-polygon" ng-switch-when=Polygon> </span> <span class="gmf-icon gmf-icon-circle" ng-switch-when=Circle> </span> <span class="gmf-icon gmf-icon-rectangle" ng-switch-when=Rectangle> </span> </span> </div> <div ng-switch-when=select> <span ng-repeat="choice in $ctrl.rule.getExpression().split(\',\')"> {{ choice | translate }}{{ $last ? \'\' : \', \' }} </span> </div> <div ng-switch-default> <div ng-switch=$ctrl.rule.operator> <div ng-switch-when=..|time_during ng-switch-when-separator=|> <span translate>Between </span> <span>{{ $ctrl.rule.lowerBoundary }}</span> <span translate> and </span> <span>{{ $ctrl.rule.upperBoundary }}</span> </div> <div ng-switch-default> <span>{{ $ctrl.operatorsShortFormat[$ctrl.rule.operator] }}</span> <span>{{ $ctrl.rule.getExpression() }}</span> </div> </div> </div> </div> </div> '},function(e,t){e.exports='<div class=ngeo-datepicker> <form name=dateForm class=ngeo-datepicker-form novalidate> <div ng-if="::datepickerCtrl.time.widget === \'datepicker\'"> <div class=ngeo-datepicker-start-date> <span ng-if="::datepickerCtrl.time.mode === \'range\'" translate>From:</span> <span ng-if="::datepickerCtrl.time.mode !== \'range\'" translate>Date:</span> <input name=sdate ui-date=datepickerCtrl.sdateOptions ng-model=datepickerCtrl.sdate required=""/> </div> <div class=ngeo-datepicker-end-date ng-if="::datepickerCtrl.time.mode === \'range\'"> <span translate>To:</span> <input name=edate ui-date=datepickerCtrl.edateOptions ng-model=datepickerCtrl.edate required=""/> </div> </div> </form> </div> '},,,,,,function(e,t){e.exports='<h4 class="popover-title ngeo-popup-title"> <span ng-bind-html=title></span> <button type=button class=close ng-click="open = false"> &times;</button> </h4> <div class=popover-content ng-bind-html=content></div> '},,,,,,function(e,t){e.exports='<ul class=gmf-backgroundlayerselector> <li ng-repeat="layer in ctrl.bgLayers" ng-click=ctrl.setLayer(layer) ng-class="{\'gmf-backgroundlayerselector-active\': ctrl.bgLayer == layer, \'gmf-backgroundlayerselector-disabled\': ctrl.opacityLayer == layer}"> <img class=gmf-thumb ng-src="{{::layer.get(\'metadata\')[\'thumbnail\']}}"/> <span class=gmf-text>{{layer.get("label") | translate}}</span> <span ng-class="{\'gmf-backgroundlayerselector-opacity-check\': ctrl.opacityLayer == layer}"></span> </li> <input ng-if=ctrl.opacityLayer class="input-action gmf-backgroundlayerselector-opacity-slider" name=bg-layer-opacity type=range min=0 max=1 step=0.01 ng-model=ctrl.getSetBgLayerOpacity ng-model-options="{getterSetter: true}"> </ul> '},function(e,t){e.exports='<div ng-if=$ctrl.gmfUser.username> <div class=form-group> <span>{{\'Logged in as\' | translate}}</span> <strong>{{ ::$ctrl.gmfUser.username }}</strong>. </div> <form name=logoutForm role=form ng-submit=$ctrl.logout() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=!$ctrl.changingPassword> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Logout\' | translate}}"/> </div> <div class=form-group> <input ng-show=$ctrl.allowPasswordChange type=button class="form-control btn btn-default" value="{{\'Change password\' | translate}}" ng-click="$ctrl.changingPassword = true"/> </div> </form> <form name=changePasswordForm role=form ng-submit=$ctrl.changePassword() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}" ng-if=$ctrl.changingPassword> <div class=form-group> <input type=password class=form-control name=oldpassword ng-model=$ctrl.oldPwdVal ng-attr-placeholder="{{\'Old password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpassword ng-model=$ctrl.newPwdVal ng-attr-placeholder="{{\'New password\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=newpasswordconfirm ng-model=$ctrl.newPwdConfVal ng-attr-placeholder="{{\'Confirm new password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Change password\' | translate}}"/> </div> <div class=form-group> <input type=button class="form-control btn btn-default" value="{{\'Cancel\' | translate}}" ng-if=!$ctrl.userMustChangeItsPassword() ng-click=$ctrl.changePasswordReset() /> <input type=button class="form-control btn btn-default" value="{{\'Logout\' | translate}}" ng-if=$ctrl.userMustChangeItsPassword() ng-click=$ctrl.logout() /> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> <ngeo-modal ng-model=$ctrl.changePasswordModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Password Changed\' | translate}} </h4> </div> <div class=modal-body> {{\'Your password has successfully been changed.\' | translate}} </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'OK\' | translate}}</button> </div> </ngeo-modal> </div> <div ng-if=!$ctrl.gmfUser.username> <form name=loginForm role=form ng-submit=$ctrl.login() ng-controller=GmfAuthenticationController ng-class="{\'has-error\': $ctrl.error}"> <div class=form-group> <input type=text class=form-control name=login ng-model=$ctrl.loginVal ng-attr-placeholder="{{\'Username\' | translate}}"/> </div> <div class=form-group> <input type=password class=form-control name=password ng-model=$ctrl.pwdVal ng-attr-placeholder="{{\'Password\' | translate}}"/> </div> <div class=form-group> <input type=submit class="form-control btn btn-primary" value="{{\'Connect\' | translate}}"/> </div> <div ng-show=$ctrl.allowPasswordReset class=form-group> <a ng-click=$ctrl.resetPassword() href="">{{\'Password forgotten?\' | translate}}</a> </div> </form> <div ng-show=$ctrl.error class="gmf-authentication-error help-block"></div> <ngeo-modal ng-model=$ctrl.resetPasswordModalShown> <div class=modal-header> <button type=button class=close data-dismiss=modal aria-label="{{\'Close\' | translate}}"> <span aria-hidden=true>&times;</span> </button> <h4 class=modal-title> {{\'Password forgotten?\' | translate}} </h4> </div> <div class=modal-body translate> A new password has just been sent to you by e-mail. </div> <div class=modal-footer> <button type=button class="btn btn-default" data-dismiss=modal>{{\'OK\' | translate}}</button> </div> </ngeo-modal> </div> '},,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){},function(e,t){}]);
//# sourceMappingURL=mobile.ca6f04.js.map