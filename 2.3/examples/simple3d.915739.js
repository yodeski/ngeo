!function(t){function e(e){for(var i,r,l=e[0],s=e[1],c=e[2],m=0,d=[];m<l.length;m++)r=l[m],o[r]&&d.push(o[r][0]),o[r]=0;for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i]);for(u&&u(e);d.length;)d.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,l=1;l<n.length;l++){var s=n[l];0!==o[s]&&(i=!1)}i&&(a.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},o={2:0},a=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var l=window.webpackJsonp=window.webpackJsonp||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=s;a.push([335,0]),n()}({330:function(t,e,n){"use strict";n.r(e);n(471);var i=n(43),o=n(53),a=n(36),r=n(57),l=n(1),s=n(121),c=n(190),u={Permalink3dParam:{ENABLED:"3d_enabled",LON:"3d_lon",LAT:"3d_lat",ELEVATION:"3d_elevation",HEADING:"3d_heading",PITCH:"3d_pitch",PREFIX:"3d_"}},m=u,d=n(237);var h=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.manager_,this.ngeoDebounce_=e,this.ngeoLocation_=n,this.ngeoStateManager_=i}return t.$inject=["ngeoDebounce","ngeoLocation","ngeoStateManager"],t.prototype.initialize=function(t){var e=this;this.manager_=t,this.manager_.on("load",function(){e.cameraToState_()}),this.ngeoStateManager_.getInitialBooleanValue("3d_enabled")&&this.initialStateToCamera_()},t.prototype.getManager=function(){return this.manager_},t.prototype.initialStateToCamera_=function(){var t=this.ngeoStateManager_,e=t.getInitialNumberValue(m.Permalink3dParam.LON),n=t.getInitialNumberValue(m.Permalink3dParam.LAT),i=t.getInitialNumberValue(m.Permalink3dParam.ELEVATION),o=t.getInitialNumberValue(m.Permalink3dParam.HEADING)||0,a=t.getInitialNumberValue(m.Permalink3dParam.PITCH)||0;return l.a.assert(void 0!==e),l.a.assert(void 0!==n),l.a.assert(void 0!==i),this.manager_.set3dWithView(e,n,i,o,a)},t.prototype.cameraToState_=function(){var t=this,e=this.manager_.getOl3d().getCesiumScene().camera;e.moveEnd.addEventListener(this.ngeoDebounce_(function(){var n,i=e.positionCartographic;t.ngeoStateManager_.updateState(((n={})[m.Permalink3dParam.ENABLED]=!0,n[m.Permalink3dParam.LON]=Cesium.Math.toDegrees(i.longitude).toFixed(5),n[m.Permalink3dParam.LAT]=Cesium.Math.toDegrees(i.latitude).toFixed(5),n[m.Permalink3dParam.ELEVATION]=i.height.toFixed(0),n[m.Permalink3dParam.HEADING]=Cesium.Math.toDegrees(e.heading).toFixed(3),n[m.Permalink3dParam.PITCH]=Cesium.Math.toDegrees(e.pitch).toFixed(3),n))},1e3,!0)),this.manager_.on("toggle",function(e){e.target.is3dEnabled()||t.remove3dState_()})},t.prototype.remove3dState_=function(){var t=this;this.ngeoLocation_.getParamKeysWithPrefix(m.Permalink3dParam.PREFIX).forEach(function(e){t.ngeoStateManager_.deleteParam(e)})},t}();h.module=angular.module("ngeoOlcsService",[s.a.name,c.a.module.name,d.a.module.name]).service("ngeoOlcsService",h);var g=h,f=n(98),p=n(61);b.$inject=["$attrs","ngeoOlcsControls3dTemplateUrl"];var v=angular.module("ngeoOlcsControls3d",[]);var _=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.element_=e,this.ol3dm,this.minTilt,this.maxTilt,this.tiltRightEl_,this.tiltLeftEl_,this.rotation3dEl_,this.angle3dEl_,this.previousRotation_,this.previousViewMatrix_,this.animationFrameRequestId_,this.olcsService_=n}return t.$inject=["$element","ngeoOlcsService"],t.prototype.updateWidget_=function(){var t,e,n=this,i=this.ol3dm.getOl3d().getOlView().getRotation();t=this.previousRotation_,e=i,Number.isFinite(e)&&(!Number.isFinite(t)||Math.abs(e-t)>.05)&&(this.rotateElement_(this.rotation3dEl_,i),this.previousRotation_=i);var o=this.ol3dm.getCesiumViewMatrix();if(!Cesium.Matrix4.equalsEpsilon(this.previousViewMatrix_,o,1e-5)){var a=this.ol3dm.getTiltOnGlobe();if(Number.isFinite(a||0)){this.rotateElement_(this.angle3dEl_,a),this.previousViewMatrix_=Cesium.Matrix4.clone(o);a-this.minTilt<.01?this.tiltRightEl_.addClass("ngeo-right-inactive"):this.tiltRightEl_.hasClass("ngeo-right-inactive")&&this.tiltRightEl_.removeClass("ngeo-right-inactive"),this.maxTilt-a<.01?this.tiltLeftEl_.addClass("ngeo-left-inactive"):this.tiltLeftEl_.hasClass("ngeo-left-inactive")&&this.tiltLeftEl_.removeClass("ngeo-left-inactive")}}this.animationFrameRequestId_=requestAnimationFrame(function(){return n.updateWidget_()})},t.prototype.$onDestroy=function(){this.animationFrameRequestId_&&cancelAnimationFrame(this.animationFrameRequestId_)},t.prototype.$onInit=function(){void 0===this.minTilt&&(this.minTilt=0),void 0===this.maxTilt&&(this.maxTilt=7*Math.PI/16),this.ol3dm||(this.ol3dm=l.a.assert(this.olcsService_.getManager())),this.tiltRightEl_=this.element_.find(".ngeo-tilt-right"),this.tiltLeftEl_=this.element_.find(".ngeo-tilt-left"),this.rotation3dEl_=this.element_.find(".ngeo-rotation3d"),this.angle3dEl_=this.element_.find(".ngeo-angle3d"),this.updateWidget_()},t.prototype.rotateElement_=function(t,e){var n="rotate("+e+"rad)";t.css({"-moz-transform":n,"-webkit-transform":n,"-o-transform":n,"-ms-transform":n,transform:n})},t.prototype.rotate=function(t){t=Cesium.Math.toRadians(t),this.ol3dm.setHeading(t)},t.prototype.tilt=function(t){t=Cesium.Math.toRadians(t);var e=this.ol3dm.getTiltOnGlobe();e+t<this.minTilt?t=this.minTilt-e:e+t>this.maxTilt&&(t=this.maxTilt-e);var n=this.ol3dm.getCesiumScene();p.a.rotateAroundBottomCenter(n,t)},t.prototype.zoom=function(t){var e=this.ol3dm.getOlView(),n=e.getResolution(),i=e.constrainResolution(n,t);e.getAnimating()&&e.cancelAnimations(),e.animate({resolution:i,duration:250,easing:f.b})},t}();function b(t,e){if(e)return e;var n=t.ngeoOlcsControls3dTemplateUrl;return n||"ngeo/olsc/controls3d"}v.run(["$templateCache",function(t){t.put("ngeo/olsc/controls3d",n(334))}]);var y={bindings:{minTilt:"<?",maxTilt:"<?",ol3dm:"<?"},controller:_,templateUrl:b};v.component("ngeoOlcsControls3d",y),v.value("ngeoOlcsControls3dTemplateUrl","");var E=v,P=angular.module("ngeoOlcsModule",[E.name,g.module.name]),C=n(17),T=n(299),w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var O=function(t){function e(n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":w(e))&&"function"!=typeof e?t:e}(this,t.call(this,n,o));return a.rootScope_=i,a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":w(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e.prototype.toggle3d=function(){var e=this;return t.prototype.toggle3d.call(this).then(function(){e.rootScope_.$apply()})},e}(T.a),S={};S.module=angular.module("app",["gettext",C.a.name,P.name]),S.MainController=function(t,e){this.map=new i.a({layers:[new a.a({source:new r.b})],view:new o.a({center:[0,0],zoom:4})});this.ol3dm=new O("../node_modules/@camptocamp/cesium/Build/Cesium/Cesium.js",t,{map:this.map}),e.initialize(this.ol3dm)},S.MainController.$inject=["$rootScope","ngeoOlcsService"],S.module.controller("MainController",S.MainController);e.default=S},334:function(t,e){t.exports='<div class=ngeo-tools> <div class=ngeo-angle><div class=ngeo-angle3d></div></div> <button class="ngeo-left ngeo-tilt-left" ng-click=$ctrl.tilt(5)></button> <button class="ngeo-right ngeo-tilt-right" ng-click=$ctrl.tilt(-5)></button> </div> <div class=ngeo-zoom> <button class=ol-zoom-in ng-click=$ctrl.zoom(1)></button> <button class=ol-zoom-out ng-click=$ctrl.zoom(-1)></button> </div> <div class=ngeo-tools> <div class=ngeo-rotation><div class=ngeo-rotation3d></div></div> <button class=ngeo-left ng-click=$ctrl.rotate(-15)></button> <button class=ngeo-right ng-click=$ctrl.rotate(15)></button> </div> '},335:function(t,e,n){n(40),n(39),t.exports=n(330)},471:function(t,e){}});
//# sourceMappingURL=simple3d.915739.js.map