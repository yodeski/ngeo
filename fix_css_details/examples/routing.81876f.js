!function(e){function t(t){for(var o,a,s=t[0],u=t[1],l=t[2],g=0,p=[];g<s.length;g++)a=s[g],r[a]&&p.push(r[a][0]),r[a]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);for(c&&c(t);p.length;)p.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,s=1;s<n.length;s++){var u=n[s];0!==r[u]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var o={},r={37:0},i=[];function a(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=o,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(n,o,function(t){return e[t]}.bind(null,o));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var l=0;l<s.length;l++)t(s[l]);var c=u;i.push([503,0]),n()}({503:function(e,t,n){n(53),n(54),e.exports=n(525)},504:function(e,t){},506:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ngeo-nominatim-input">\n  <input type="text"\n         class="form-control"\n         placeholder="{{$ctrl.placeholder}}"\n         ng-model="$ctrl.inputValue"\n         ngeo-search="$ctrl.options"\n         ngeo-search-datasets="$ctrl.datasets"\n         ngeo-search-listeners="$ctrl.listeners">\n</div>\n';return __p}},507:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ngeo-routing-feature">\n    <div class="input-group">\n      <ngeo-nominatim-input\n        ngeo-nominatim-input-value="$ctrl.featureLabel"\n        ngeo-nominatim-input-placeholder="{{\'Search...\' | translate}}"\n        ngeo-nominatim-input-on-select="$ctrl.onSelect">\n      </ngeo-nominatim-input>\n      <div class="input-group-addon btn" ng-click="$ctrl.set()">\n        <span class="fa fa-map-marker"></span>\n      </div>\n    </div>\n</div>\n';return __p}},508:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="ngeo-routing">\n  <div class="ngeo-routing-start form-group">\n    <ngeo-routing-feature\n      ngeo-routing-feature-map="$ctrl.map"\n      ngeo-routing-feature-feature="$ctrl.startFeature_"\n      ngeo-routing-feature-fill-color="$ctrl.colors[\'start.fill\']"\n      ngeo-routing-feature-stroke-color="$ctrl.colors[\'start.stroke\']"\n      ngeo-routing-feature-on-change="$ctrl.handleChange">\n    </ngeo-routing-feature>\n  </div>\n\n    <div class="ngeo-routing-vias form-group" ng-repeat="(index, via) in $ctrl.viaArray">\n      <div class="form-inline">\n        <div class="form-group">\n          <ngeo-routing-feature\n            ngeo-routing-feature-map="$ctrl.map"\n            ngeo-routing-feature-feature="via.feature"\n            ngeo-routing-feature-fill-color="$ctrl.colors[\'via.fill\']"\n            ngeo-routing-feature-stroke-color="$ctrl.colors[\'via.stroke\']"\n            ngeo-routing-feature-on-change="$ctrl.handleChange">\n          </ngeo-routing-feature>\n        </div>\n        <button type="button" class="btn prime delete-via" ng-click="$ctrl.deleteVia(index)">\n          <span class="fa fa-trash-o"></span>\n        </button>\n      </div>\n    </div>\n\n  <div class="ngeo-routing-destination form-group">\n    <ngeo-routing-feature\n      ngeo-routing-feature-map="$ctrl.map"\n      ngeo-routing-feature-feature="$ctrl.targetFeature_"\n      ngeo-routing-feature-fill-color="$ctrl.colors[\'destination.fill\']"\n      ngeo-routing-feature-stroke-color="$ctrl.colors[\'destination.stroke\']"\n      ngeo-routing-feature-on-change="$ctrl.handleChange">\n    </ngeo-routing-feature>\n  </div>\n\n  <div class="form-group pull-right">\n    <button type="button" class="btn prime" ng-click="$ctrl.clearRoute()">\n      <span class="fa fa-trash-o"></span> <span translate>Clear</span>\n    </button>\n    <button type="button" class="btn prime" ng-click="$ctrl.reverseRoute()">\n      <span class="fa fa-exchange"></span> <span translate>Reverse</span>\n    </button>\n    <button type="button" class="btn prime" ng-click="$ctrl.addVia()">\n      <span class="fa fa-plus"></span> <span translate>Add via</span>\n    </button>\n  </div>\n\n  <div class="clearfix"></div>\n\n  <div ng-if="$ctrl.routingProfiles.length > 1">\n    <div class="form-group">\n      <label class="col-form-label col-md-4" translate>Profile</label>\n      <div class="col-md-8">\n        <select class="form-control" ng-model="$ctrl.selectedRoutingProfile">\n          <option ng-repeat="profile in $ctrl.routingProfiles" ng-value="profile">{{profile.label}}</option>\n        </select>\n      </div>\n    </div>\n  </div>\n\n  <div class="ngeo-routing-error form-group clearfix"\n       ng-hide="$ctrl.errorMessage === \'\'">\n    {{$ctrl.errorMessage}}\n  </div>\n\n  <div class="clearfix"></div>\n\n  <div ng-hide="$ctrl.routeDuration === null && $ctrl.routeDistance <= 0">\n    <div class="row">\n      <div class="col-md-12">\n        <strong translate>Route statistics</strong>\n      </div>\n    </div>\n    <div class="row" ng-hide="$ctrl.routeDuration === null">\n      <div class="col-md-4 text-right" translate>\n        Duration\n      </div>\n      <div class="col-md-8">\n        {{$ctrl.routeDuration | ngeoDuration}}\n      </div>\n    </div>\n\n    <div class="row" ng-hide="$ctrl.routeDistance <= 0">\n      <div class="col-md-4 text-right" translate>\n        Distance\n      </div>\n      <div class="col-md-8">\n        {{$ctrl.routeDistance | ngeoUnitPrefix:\'m\'}}\n      </div>\n    </div>\n  </div>\n</div>\n';return __p}},509:function(e,t){},525:function(e,t,n){"use strict";n.r(t);n(504),n(300),n(301),n(505);var o=n(22),r=n(138),i=n(102),a=function(e,t,n){this.$http_=e,this.ngeoDebounce_=n,this.nominatimUrl_="https://nominatim.openstreetmap.org/",t.has("ngeoNominatimUrl")&&(this.nominatimUrl_=t.get("ngeoNominatimUrl"),"/"!==this.nominatimUrl_.substr(-1)&&(this.nominatimUrl_+="/")),this.searchDefaultParams_={},t.has("ngeoNominatimSearchDefaultParams")&&(this.searchDefaultParams_=t.get("ngeoNominatimSearchDefaultParams")),this.typeaheadDebounceDelay_=500,this.typeaheadSourceDebounced=this.ngeoDebounce_(this.typeaheadSource_.bind(this),this.typeaheadDebounceDelay_,!0)};a.$inject=["$http","$injector","ngeoDebounce"],a.$inject=["$http","$injector","ngeoDebounce"],a.prototype.search=function(e,t){var n=this.nominatimUrl_+"search?q="+e;if(t=t||{},(t=Object.assign({},this.searchDefaultParams_,t)).format="json",t){n+="&";var o=[],r=Object.keys(t),i=Array.isArray(r),a=0;for(r=i?r:r[Symbol.iterator]();;){var s;if(i){if(a>=r.length)break;s=r[a++]}else{if((a=r.next()).done)break;s=a.value}var u=s;o.push(u+"="+t[u])}n+=o.join("&")}return this.$http_.get(n)},a.prototype.reverse=function(e,t){var n=this.nominatimUrl_+"reverse";if((t=Object.assign({},t)).lon=e[0],t.lat=e[1],t.format="json",t){n+="?";var o=[],r=Object.keys(t),i=Array.isArray(r),a=0;for(r=i?r:r[Symbol.iterator]();;){var s;if(i){if(a>=r.length)break;s=r[a++]}else{if((a=r.next()).done)break;s=a.value}var u=s;o.push(u+"="+t[u])}n+=o.join("&")}return this.$http_.get(n)},a.prototype.typeaheadSource_=function(e,t,n){this.search(e,{}).then(function(e){n(e.data.map(function(e){return{coordinate:[e.lon,e.lat],name:e.display_name}}))},function(e){n([])})},(a.module=angular.module("ngeoNominatimService",[r.a.name])).service("ngeoNominatimService",a);var s=a,u=function(e,t){this.$http_=e,this.routingOptions_=t.has("ngeoRoutingOptions")?t.get("ngeoRoutingOptions"):{},this.ngeoOsrmBackendUrl_=this.routingOptions_.backendUrl||"https://router.project-osrm.org/","/"!==this.ngeoOsrmBackendUrl_.substr(-1)&&(this.ngeoOsrmBackendUrl_+="/"),this.protocolVersion_="v1"};u.$inject=["$http","$injector"],u.$inject=["$http","$injector"],u.prototype.getRoute=function(e,t){(t=t||{}).service||(t.service="route"),t.profile||(t.profile="car");var n=this.ngeoOsrmBackendUrl_;if(t.instance&&(n+=t.instance+"/"),n+=t.service+"/"+this.protocolVersion_+"/"+t.profile+"/",n+=e.map(function(e){return e.join(",")}).join(";"),t.options){n+="?";var o=[],r=Object.keys(t.options),i=Array.isArray(r),a=0;for(r=i?r:r[Symbol.iterator]();;){var s;if(i){if(a>=r.length)break;s=r[a++]}else{if((a=r.next()).done)break;s=a.value}var u=s;o.push(u+"="+t.options[u])}n+=o.join("&")}return this.$http_.get(n)},u.prototype.getNearest=function(e,t){(t=t||{}).service="nearest",t.profile||(t.profile="car");var n=this.ngeoOsrmBackendUrl_;if(t.instance&&(n+=t.instance+"/"),n+=t.service+"/"+this.protocolVersion_+"/"+t.profile+"/",n+=e.join(","),t.options){n+="?";var o=[],r=Object.keys(t.options),i=Array.isArray(r),a=0;for(r=i?r:r[Symbol.iterator]();;){var s;if(i){if(a>=r.length)break;s=r[a++]}else{if((a=r.next()).done)break;s=a.value}var u=s;o.push(u+"="+t.options[u])}n+=o.join("&")}return this.$http_.get(n)},(u.module=angular.module("ngeoRoutingService",[])).service("ngeoRoutingService",u);var l=u,c=n(275),g={};function p(e,t){return t(e)}g.module=angular.module("ngeoRoutingNominatimInputComponent",[c.a.module.name,s.module.name]),g.module.run(["$templateCache",function(e){e.put("ngeo/routing/nominatiminput",n(506))}]),g.module.value("ngeoRoutingNominatimInputComponentTemplateUrl",function(e){var t=e.ngeoRoutingNominatimInputComponentTemplateUrl;return void 0!==t?t:"ngeo/routing/nominatiminput"}),p.$inject=["$attrs","ngeoRoutingNominatimInputComponentTemplateUrl"],g.Controller=function(e,t,n,o){this.element_=e,this.$scope_=n,this.ngeoNominatimService=o,this.onSelect,this.inputValue,this.options={},this.datasets=[{name:"nominatim",display:"name",source:this.ngeoNominatimService.typeaheadSourceDebounced}],this.listeners={select:this.select_.bind(this)},this.placeholder=""},g.Controller.$inject=["$element","$injector","$scope","ngeoNominatimService"],g.Controller.prototype.select_=function(e,t,n){this.onSelect&&this.onSelect(t)};var h={controller:g.Controller,bindings:{onSelect:"=?ngeoNominatimInputOnSelect",inputValue:"=?ngeoNominatimInputValue",placeholder:"@?ngeoNominatimInputPlaceholder"},templateUrl:p};g.module.component("ngeoNominatimInput",h);var m=g,d=n(6),f=n(15),v=n(32),_=n(38),y=n(42),b=n(14),$=n(117),C=n(34),w=n(35),F=n(27),j=n(205),S=n(70),R=(n(188),{});function k(e,t){return t(e)}R.module=angular.module("ngeoRoutingFeatureComponent",[s.module.name,m.module.name]),R.module.run(["$templateCache",function(e){e.put("ngeo/routing/routingfeature",n(507))}]),R.module.value("ngeoRoutingFeatureTemplateUrl",function(e){var t=e.ngeoRoutingFeatureTemplateUrl;return void 0!==t?t:"ngeo/routing/routingfeature"}),k.$inject=["$attrs","ngeoRoutingFeatureTemplateUrl"],R.Controller=function(e,t,n,o){this.scope_=e,this.timeout_=t,this.$q_=n,this.ngeoNominatimService_=o,this.map,this.feature,this.featureLabel="",this.fillColor,this.strokeColor,this.onChange,this.vectorFeatures_=new v.a,this.vectorSource_=new _.a({features:this.vectorFeatures_}),this.vectorLayer_=new y.a({source:this.vectorSource_,style:function(e,t){return[new b.c({text:new $.a({fill:new C.a({color:this.fillColor||"#000000"}),font:"normal 30px FontAwesome",offsetY:-15,stroke:new w.a({width:3,color:this.strokeColor||"#000000"}),text:""})})]}.bind(this)}),this.modifyFeature_=new j.a({features:this.vectorFeatures_}),this.draw_=null,this.onSelect=this.onSelect_.bind(this),this.errorMessage=""},R.Controller.$inject=["$scope","$timeout","$q","ngeoNominatimService"],R.Controller.prototype.$onInit=function(){var e=this;this.map.addLayer(this.vectorLayer_),this.modifyFeature_.setActive(!0),this.map.addInteraction(this.modifyFeature_),this.modifyFeature_.on("modifyend",function(t){var n=t.features.getArray()[0];e.vectorSource_.clear(),e.snapFeature_(n)}),this.scope_.$watch(function(){return e.feature},function(t,n){t&&e.onFeatureChange_(),null===t&&(e.vectorSource_.clear(),e.featureLabel="")})},R.Controller.prototype.$onDestroy=function(){this.map.removeLayer(this.vectorLayer_),this.modifyFeature_.setActive(!1),this.map.removeInteraction(this.modifyFeature_)},R.Controller.prototype.set=function(){var e=this;this.draw_&&this.map.removeInteraction(this.draw_),this.draw_=new S.a({features:this.vectorFeatures_,type:"Point"}),this.draw_.on("drawstart",function(){e.feature&&e.vectorSource_.removeFeature(e.feature)}),this.draw_.on("drawend",function(t){e.draw_&&e.map.removeInteraction(e.draw_),e.snapFeature_(t.feature),e.modifyFeature_.setActive(!0)}),this.modifyFeature_.setActive(!1),this.map.addInteraction(this.draw_)},R.Controller.prototype.setFeature_=function(e,t){var n=d.f(e,this.map.getView().getProjection());""===t&&(t=n.join("/")),this.feature=new f.a({geometry:new F.a(n),name:t})},R.Controller.prototype.onFeatureChange_=function(){var e=this;this.featureLabel=this.feature.get("name")||"",this.vectorSource_.clear(),this.vectorSource_.addFeature(this.feature),this.onChange&&this.timeout_(function(){e.onChange(e.feature)})},R.Controller.prototype.onSelect_=function(e){var t=e.coordinate.map(parseFloat),n=e.label;this.setFeature_(t,n);var o=this.feature.getGeometry().getCoordinates();this.map.getView().setCenter(o)},R.Controller.prototype.snapFeature_=function(e){var t=this.getLonLatFromPoint_(e),n=function(e){var t=[parseFloat(e.data.lon),parseFloat(e.data.lat)],n=e.data.display_name;this.setFeature_(t,n)}.bind(this),o=function(e){this.errorMessage="Error: nominatim server not responding.",console.log(e)}.bind(this);this.$q_.when(this.ngeoNominatimService_.reverse(t,{})).then(n.bind(this),o.bind(this))},R.Controller.prototype.getLonLatFromPoint_=function(e){var t=e.getGeometry().getCoordinates(),n=this.map.getView().getProjection();return d.l(t,n)},R.component_={controller:R.Controller,bindings:{map:"<ngeoRoutingFeatureMap",feature:"=ngeoRoutingFeatureFeature",fillColor:"<?ngeoRoutingFeatureFillColor",strokeColor:"<?ngeoRoutingFeatureStrokeColor",onChange:"=?ngeoRoutingFeatureOnChange"},templateUrl:k},R.module.component("ngeoRoutingFeature",R.component_);var P=R,D=n(155),x=n(40),O={};function A(e,t){return t(e)}O.module=angular.module("ngeoRoutingComponent",[r.a.name,i.a.name,s.module.name,l.module.name,P.module.name]),O.module.run(["$templateCache",function(e){e.put("ngeo/routing/routing",n(508))}]),O.module.value("ngeoRoutingTemplateUrl",function(e){var t=e.ngeoRoutingTemplateUrl;return void 0!==t?t:"ngeo/routing/routing"}),A.$inject=["$attrs","ngeoRoutingTemplateUrl"],O.Controller=function(e,t,n,o,r,i){var a=this;this.$scope_=t,this.ngeoRoutingService_=n,this.ngeoNominatimService_=o,this.routingOptions_=e.has("ngeoRoutingOptions")?e.get("ngeoRoutingOptions"):{},this.routingProfiles=this.routingOptions_.profiles||[],this.selectedRoutingProfile=this.routingProfiles.length>0?this.routingProfiles[0]:null,t.$watch(function(){return a.selectedRoutingProfile},this.calculateRoute.bind(this)),this.$q_=r,this.map,this.errorMessage="",this.startFeature_=null,this.targetFeature_=null,this.viaArray=[],this.colors={"start.fill":"#6BE62E","start.stroke":"#4CB01E","destination.fill":"#FF3E13","destination.stroke":"#CD3412","via.fill":"#767676","via.stroke":"#000000"},this.routeSource_=new _.a({features:[]}),this.routeLayer_=new y.a({source:this.routeSource_,style:new b.c({fill:new C.a({color:"rgba(16, 112, 29, 0.6)"}),stroke:new w.a({color:"rgba(16, 112, 29, 0.6)",width:5})})}),this.routeDistance=0,this.routeDuration=null,this.regexIsFormattedCoord=/\d+\.\d+\/\d+\.\d+/,this.draw_=null;this.handleChange=i(this.calculateRoute.bind(this),200,!0)},O.Controller.$inject=["$injector","$scope","ngeoRoutingService","ngeoNominatimService","$q","ngeoDebounce"],O.Controller.prototype.$onInit=function(){this.map.addLayer(this.routeLayer_)},O.Controller.prototype.clearRoute=function(){this.startFeature_=null,this.targetFeature_=null,this.viaArray=[],this.routeDistance=0,this.routeDuration=null,this.routeSource_.clear(),this.errorMessage=""},O.Controller.prototype.getLonLatFromPoint_=function(e){var t=e.getGeometry().getCoordinates(),n=this.map.getView().getProjection();return d.l(t,n)},O.Controller.prototype.reverseRoute=function(){var e=this.startFeature_;this.startFeature_=this.targetFeature_,this.targetFeature_=e,this.viaArray=this.viaArray.reverse()},O.Controller.prototype.parseRoute_=function(e){var t,n=[],o=new D.a,r={dataProjection:"EPSG:4326",featureProjection:this.map.getView().getProjection()};e.legs?(n=e.legs.map(function(e){return e.steps.map(function(e){return new f.a({geometry:o.readGeometry(e.geometry,r)})})}),n=(t=[]).concat.apply(t,n)):e.geometry&&n.push(new f.a({geometry:o.readGeometry(e.geometry,r)}));return n},O.Controller.prototype.calculateRoute=function(){var e=this;if(this.startFeature_&&this.targetFeature_){this.routeSource_.clear();var t=this.getLonLatFromPoint_(this.startFeature_),n=this.getLonLatFromPoint_(this.targetFeature_),o=this.viaArray.filter(function(e){return null!==e.feature}).map(function(t){return e.getLonLatFromPoint_(t.feature)}),r=[t].concat(o,[n]),i=function(e){var t=this.parseRoute_(e.data.routes[0]);if(0!==t.length){this.routeSource_.addFeatures(t),this.map.getView().fit(this.routeSource_.getExtent()),this.routeDistance=parseInt(e.data.routes[0].distance,10),this.routeDuration=e.data.routes[0].duration;var n=t[0].getGeometry().getCoordinateAt(0),o=t[t.length-1].getGeometry().getCoordinateAt(1),r=[this.startFeature_.getGeometry().getCoordinates(),n],i=[o,this.targetFeature_.getGeometry().getCoordinates()],a=[new f.a(new x.a(r)),new f.a(new x.a(i))];this.routeSource_.addFeatures(a)}else console.log("No route or not supported format.")}.bind(this),a=function(e){this.errorMessage="Error: routing server not responding.",console.log(e)}.bind(this),s={steps:!0,overview:!1,geometries:"geojson"},u={};u.options=s,this.selectedRoutingProfile&&(u.instance=this.selectedRoutingProfile.profile),this.$q_.when(this.ngeoRoutingService_.getRoute(r,u)).then(i.bind(this),a.bind(this))}},O.Controller.prototype.addVia=function(){this.viaArray.push({feature:null,onSelect:null})},O.Controller.prototype.deleteVia=function(e){this.viaArray.length>e&&(this.viaArray.splice(e,1),this.calculateRoute())},O.module.component("ngeoRouting",{controller:O.Controller,bindings:{map:"<ngeoRoutingMap"},templateUrl:A});var U=O,L=(n(509),angular.module("ngeoRoutingModule",[U.module.name])),N=n(18),I=n(25),M=n(17),V=n(31),T={};T.module=angular.module("app",["gettext",o.a.name,L.name]),T.MainController=function(){this.map=new N.a({layers:[new M.a({source:new V.b})],view:new I.a({center:[931010.1535989442,5961705.842297254],zoom:9})}),this.routingfeatureActive=!0},T.module.controller("MainController",T.MainController);t.default=T}});
//# sourceMappingURL=routing.81876f.js.map