!function(e){function t(t){for(var o,a,s=t[0],l=t[1],c=t[2],h=0,u=[];h<s.length;h++)a=s[h],n[a]&&u.push(n[a][0]),n[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);for(g&&g(t);u.length;)u.shift()();return i.push.apply(i,c||[]),r()}function r(){for(var e,t=0;t<i.length;t++){for(var r=i[t],o=!0,s=1;s<r.length;s++){var l=r[s];0!==n[l]&&(o=!1)}o&&(i.splice(t--,1),e=a(a.s=r[0]))}return e}var o={},n={5:0},i=[];function a(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=o,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)a.d(r,o,function(t){return e[t]}.bind(null,o));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var g=l;i.push([496,0]),r()}({489:function(e,t){},490:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<div class="btn-group" role="group" aria-label="">\n  <a\n    href\n    ngeo-btn\n    ngeo-createfeature\n    ngeo-createfeature-active="oetCtrl.drawActive"\n    ngeo-createfeature-features="::oetCtrl.sketchFeatures"\n    ngeo-createfeature-geom-type="::oetCtrl.geomType"\n    ngeo-createfeature-map="::oetCtrl.map"\n    class="btn btn-sm btn-default"\n    ng-class="{active: oetCtrl.drawActive}"\n    ng-if="::(oetCtrl.geomType === \'MultiPoint\')"\n    ng-model="oetCtrl.drawActive"\n    title="{{\'Add a point to the geometry\' | translate}}">\n    <span\n      class="fa fa-plus-square-o gmf-icon-oe-draw">\n    </span>\n  </a>\n  <a\n    href\n    ngeo-btn\n    ngeo-createfeature\n    ngeo-createfeature-active="oetCtrl.drawActive"\n    ngeo-createfeature-features="::oetCtrl.sketchFeatures"\n    ngeo-createfeature-geom-type="::oetCtrl.geomType"\n    ngeo-createfeature-map="::oetCtrl.map"\n    class="btn btn-sm btn-default"\n    ng-class="{active: oetCtrl.drawActive}"\n    ng-if="::(oetCtrl.geomType === \'MultiLineString\')"\n    ng-model="oetCtrl.drawActive"\n    title="{{\'Add a linestring to the geometry\' | translate}}">\n    <span\n      class="fa fa-plus-square-o gmf-icon-oe-draw">\n    </span>\n  </a>\n  <a\n    href\n    ngeo-btn\n    ngeo-createfeature\n    ngeo-createfeature-active="oetCtrl.drawActive"\n    ngeo-createfeature-features="::oetCtrl.sketchFeatures"\n    ngeo-createfeature-geom-type="::oetCtrl.geomType"\n    ngeo-createfeature-map="::oetCtrl.map"\n    class="btn btn-sm btn-default"\n    ng-class="{active: oetCtrl.drawActive}"\n    ng-if="::(oetCtrl.geomType === \'MultiPolygon\')"\n    ng-model="oetCtrl.drawActive"\n    title="{{\'Add a polygon to the geometry\' | translate}}">\n    <span\n      class="fa fa-plus-square-o gmf-icon-oe-draw">\n    </span>\n  </a>\n\n  <a\n    href\n    ngeo-btn\n    ngeo-createfeature\n    ngeo-createfeature-active="oetCtrl.eraseActive"\n    ngeo-createfeature-features="::oetCtrl.sketchFeatures"\n    ngeo-createfeature-geom-type="::oetCtrl.geomTypePolygon"\n    ngeo-createfeature-map="::oetCtrl.map"\n    class="btn btn-sm btn-default"\n    ng-class="{active: oetCtrl.eraseActive}"\n    ng-model="oetCtrl.eraseActive"\n    title="{{\'Erase geometry\' | translate}}">\n    <span\n      class="fa fa-minus-square-o gmf-icon-oe-erase">\n    </span>\n  </a>\n\n  <a\n    href\n    ng-if="::oetCtrl.geomType === \'MultiPolygon\'"\n    ngeo-btn\n    ngeo-createregularpolygonfromclick\n    ngeo-createregularpolygonfromclick-active="oetCtrl.drawTriangleActive"\n    ngeo-createregularpolygonfromclick-angle="oetCtrl.triangleAngle"\n    ngeo-createregularpolygonfromclick-features="::oetCtrl.sketchFeatures"\n    ngeo-createregularpolygonfromclick-map="::oetCtrl.map"\n    ngeo-createregularpolygonfromclick-radius="::oetCtrl.triangleRadius"\n    class="btn btn-sm btn-default ngeo-createregularpolygonfromclick"\n    ng-class="{active: oetCtrl.drawTriangleActive}"\n    ng-model="oetCtrl.drawTriangleActive"\n    title="{{\'Draw a triangle\' | translate}}">\n    <span\n      class="fa fa-play fa-rotate-270 gmf-icon-oe-triangle">\n    </span>\n  </a>\n\n  <a\n    href\n    ngeo-btn\n    gmf-objecteditinggetwmsfeature\n    gmf-objecteditinggetwmsfeature-active="oetCtrl.copyFromActive"\n    gmf-objecteditinggetwmsfeature-features="::oetCtrl.sketchFeatures"\n    gmf-objecteditinggetwmsfeature-layerinfo="oetCtrl.queryableLayerInfo"\n    gmf-objecteditinggetwmsfeature-map="::oetCtrl.map"\n    class="btn btn-sm btn-default gmf-objecteditinggetwmsfeature-add"\n    ng-class="{active: oetCtrl.copyFromActive}"\n    ng-model="oetCtrl.copyFromActive"\n    title="{{\'Copy from external WMS feature\' | translate}}">\n    <span\n      class="fa fa-clone gmf-icon-oe-copyfrom">\n    </span>\n  </a>\n\n  <a\n    href\n    ngeo-btn\n    gmf-objecteditinggetwmsfeature\n    gmf-objecteditinggetwmsfeature-active="oetCtrl.deleteFromActive"\n    gmf-objecteditinggetwmsfeature-features="::oetCtrl.sketchFeatures"\n    gmf-objecteditinggetwmsfeature-layerinfo="oetCtrl.queryableLayerInfo"\n    gmf-objecteditinggetwmsfeature-map="::oetCtrl.map"\n    class="btn btn-sm btn-default gmf-objecteditinggetwmsfeature-delete"\n    ng-class="{active: oetCtrl.deleteFromActive}"\n    ng-model="oetCtrl.deleteFromActive"\n    title="{{\'Cut from external WMS feature\' | translate}}">\n    <span\n      class="fa fa-scissors gmf-icon-oe-deletefrom">\n    </span>\n  </a>\n\n</div>\n';return __p}},491:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<gmf-objecteditingtools\n  gmf-objecteditingtools-active="oeCtrl.toolsActive"\n  gmf-objecteditingtools-copyfromactive="oeCtrl.copyFromActive"\n  gmf-objecteditingtools-deletefromactive="oeCtrl.deleteFromActive"\n  gmf-objecteditingtools-feature="oeCtrl.feature"\n  gmf-objecteditingtools-geomtype="::oeCtrl.geomType"\n  gmf-objecteditingtools-map="::oeCtrl.map"\n  gmf-objecteditingtools-process="oeCtrl.process"\n  gmf-objecteditingtools-queryablelayerinfo="oeCtrl.selectedQueryableLayerInfo"\n  gmf-objecteditingtools-requireslayer="oeCtrl.queryableLayerListShown"\n  gmf-objecteditingtools-sketchfeatures="::oeCtrl.sketchFeatures">\n</gmf-objecteditingtools>\n\n<div\n  class="form-group"\n  ng-show="oeCtrl.queryableLayerListShown">\n  <label\n    ng-show="oeCtrl.copyFromActive === true"\n    class="col-form-label">{{\'Copy from:\' | translate}}</label>\n  <label\n    ng-show="oeCtrl.deleteFromActive === true"\n    class="col-form-label">{{\'Cut from:\' | translate}}</label>\n  <select\n    class="form-control"\n    ng-model="oeCtrl.selectedQueryableLayerInfo"\n    ng-options="layerInfo.layerNode.name | translate for layerInfo in oeCtrl.queryableLayersInfo">\n  </select>\n</div>\n\n<form\n  novalidate\n  name="form"\n  class="form gmf-objectediting-form">\n  <input\n    type="submit"\n    value="{{\'Save\' | translate}}"\n    class="btn btn-sm btn-default gmf-objectediting-btn-save"\n    ng-click="form.$valid && oeCtrl.save()"\n    ng-disabled="!oeCtrl.dirty || oeCtrl.pending || !oeCtrl.featureHasGeom"\n    title="{{\'Save modifications\' | translate}}"></input>\n  <a\n    class="btn btn-sm btn-link gmf-objectediting-btn-undo"\n    ng-click="oeCtrl.undo()"\n    ng-disabled="!oeCtrl.dirty || oeCtrl.pending"\n    title="{{\'Undo latest modifications\' | translate}}"\n    href>{{\'Undo\' | translate}}</a>\n  <a\n    class="btn btn-sm btn-link gmf-objectediting-btn-delete"\n    ng-click="oeCtrl.delete()"\n    ng-disabled="oeCtrl.isStateInsert() || oeCtrl.pending"\n    title="{{\'Delete the feature\' | translate}}"\n    href>{{\'Delete\' | translate}}</a>\n</form>\n';return __p}},492:function(module,exports){module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<table>\n  <tr>\n    <td translate>\n      Swiss grid (LV03)\n    </td>\n    <td>\n      {{coord_21781|ngeoNumberCoordinates:0:'{x} / {y}'}}\n    </td>\n  </tr>\n  <tr>\n    <td translate>\n      Wgs Coord.\n    </td>\n    <td>\n      {{coord_4326|ngeoNumberCoordinates:2:'{y} / {x}'}}\n    </td>\n  </tr>\n  <tr>\n    <td translate>\n      Wgs Coord. DMS\n    </td>\n    <td>\n      {{coord_4326|ngeoDMSCoordinates:0:'{y} {x}'}}\n    </td>\n  </tr>\n  <tr>\n    <td translate>\n      Elevation (SRTM)\n    </td>\n    <td>\n      {{srtm | number}} [m]\n    </td>\n  </tr>\n  <tr>\n    <td translate>\n      Elevation (Aster)\n    </td>\n    <td>\n      {{aster | number}} [m]\n    </td>\n  </tr>\n</table>\n<a ng-href=\"https://maps.google.ch/?ie=UTF8&ll={{coord_4326_northern}},{{coord_4326_eastern}}&layer=c&cbll={{coord_4326_northern}},{{coord_4326_eastern}}&cbp=12,57.78,,0,8.1\" target=\"_blank\">Google StreetView</a>\n";return __p}},496:function(e,t,r){"use strict";r.r(t);var o=r(125),n=(r(489),r(148)),i=r(195),a=r(135),s=r(118),l={toXY:function(e,t){if(0===t)e.length>2&&(e=[e[0],e[1]]);else for(var r=0,o=e.length;r<o;r++)e[r]=l.toXY(e[r],t-1);return e}},c=l,g=r(33),h=r(74),u=r(95),d=r(81),f=r(22),m=r(31),p=r(68),y={isEmpty:function(e){var t=!0;return e&&e instanceof p.a&&(t=0===e.getFlatCoordinates().length),t},toXY:function(e){if(e instanceof f.a)e.setCoordinates(c.toXY(e.getCoordinates(),0));else if(e instanceof u.a||e instanceof g.a)e.setCoordinates(c.toXY(e.getCoordinates(),1));else if(e instanceof h.a||e instanceof m.b)e.setCoordinates(c.toXY(e.getCoordinates(),2));else{if(!(e instanceof d.a))throw"gmf.objectediting.geom.toXY - unsupported geometry type";e.setCoordinates(c.toXY(e.getCoordinates(),3))}}},_=y,v=r(41),b=r(46),C=r(282),w=r(114),j=function(e,t,r){this.http_=e,this.q_=t,this.gmfThemes_=r,this.getQueryableLayerNodesDefered_=null};j.$inject=["$http","$q","gmfThemes"],j.$inject=["$http","$q","gmfThemes"],j.prototype.getQueryableLayersInfo=function(){var e=this;return this.getQueryableLayerNodesDefered_||(this.getQueryableLayerNodesDefered_=this.q_.defer(),this.gmfThemes_.getOgcServersObject().then(function(t){e.gmfThemes_.getThemesObject().then(function(r){if(r){for(var o=j.getQueryableLayersInfoFromThemes(r,t),n=[],i=0,a=o.length;i<a;i++)o[i].layerNode.metadata.copyable&&n.push(o[i]);e.getQueryableLayerNodesDefered_.resolve(n)}})})),this.getQueryableLayerNodesDefered_.promise},j.getQueryableLayersInfoFromThemes=function(e,t){for(var r=[],o=void 0,n=void 0,i=void 0,a=void 0,s=0,l=e.length;s<l;s++)for(var c=0,g=(o=e[s]).children.length;c<g;c++)if((n=o.children[c]).ogcServer){i=[],v.a.getFlatNodes(n,i);for(var h=0,u=i.length;h<u;h++)(a=i[h]).children&&a.children.length||a.childLayers&&a.childLayers[0]&&a.childLayers[0].queryable&&r.push({layerNode:a,ogcServer:t[n.ogcServer]})}return r},j.prototype.getFeatureInfo=function(e,t,r){var o=r.getView(),n=o.getProjection().getCode(),i=o.getResolution(),a=b.a.WMSInfoFormat.GML,s=e.layerNode.layers.split(","),l=e.ogcServer,c=new C.a({layers:s}),g=new w.a({url:l.url,params:{layers:s}}).getGetFeatureInfoUrl(t,i,n,{INFO_FORMAT:a,FEATURE_COUNT:1,QUERY_LAYERS:s});return this.http_.get(g).then(function(e){var t=c.readFeatures(e.data);return t&&t[0]?t[0]:null})},(j.module=angular.module("gmfObjectEditingQuery",[v.a.module.name])).service("gmfObjectEditingQuery",j);var A=j,T=r(1),S=angular.module("gmfObjecteditingGetWMSFeatureComponent",[A.module.name]);S.directive_=function(){return{controller:"gmfObjecteditinggetwmsfeatureController",scope:{active:"=gmfObjecteditinggetwmsfeatureActive",features:"<gmfObjecteditinggetwmsfeatureFeatures",layerInfo:"=gmfObjecteditinggetwmsfeatureLayerinfo",map:"<gmfObjecteditinggetwmsfeatureMap"},bindToController:!0}},S.directive("gmfObjecteditinggetwmsfeature",S.directive_),S.Controller_=function(e,t){var r=this;this.active,e.$watch(function(){return r.active},this.handleActiveChange_.bind(this)),this.features,this.layerInfo,this.map,this.gmfObjectEditingQuery_=t},S.Controller_.$inject=["$scope","gmfObjectEditingQuery"],S.Controller_.prototype.handleActiveChange_=function(e){e?T.a(this.map,"click",this.handleMapClick_,this):T.c(this.map,"click",this.handleMapClick_,this)},S.Controller_.prototype.handleMapClick_=function(e){var t=this;this.gmfObjectEditingQuery_.getFeatureInfo(this.layerInfo,e.coordinate,this.map).then(function(e){e&&t.features.push(e)})},S.controller("gmfObjecteditinggetwmsfeatureController",S.Controller_);var L=S,F=r(309),E=r(0),O=r(66),M=r(5),P=r(16),k=r(19),I=r(173),G=r(44),D=function(e){this.angle_=void 0!==e.angle?e.angle:0,this.radius_=e.radius,this.sides_=void 0!==e.sides?e.sides:3,this.listenerKeys_=[],G.a.call(this,{handleEvent:k.b})};M.c(D,G.a),D.prototype.setActive=function(e){G.a.prototype.setActive.call(this,e),this.getMap()&&(e?this.enable_():this.disable_())},D.prototype.setMap=function(e){var t=this.getActive();this.getMap()&&t&&this.disable_(),G.a.prototype.setMap.call(this,e),e&&t&&this.enable_()},D.prototype.enable_=function(){var e=this.getMap();E.a.assert(e,"Map should be set."),this.listenerKeys_.push(T.a(e,"click",this.handleMapClick_,this))},D.prototype.disable_=function(){var e=this.getMap();E.a.assert(e,"Map should be set."),this.listenerKeys_.forEach(T.e),this.listenerKeys_.length=0},D.prototype.handleMapClick_=function(e){var t=e.coordinate,r=m.b.fromCircle(new I.a(t),this.sides_);m.b.makeRegular(r,t,this.radius_,this.angle_);var o=new O.a("drawend",{feature:new P.a(r)});this.dispatchEvent(o)};var $=D,N=angular.module("ngeoCreateregularpolygonfromclick",[]);N.directive_=function(){return{controller:"ngeoCreateregularpolygonfromclickController",bindToController:!0,scope:{active:"=ngeoCreateregularpolygonfromclickActive",angle:"<?ngeoCreateregularpolygonfromclickAngle",features:"=ngeoCreateregularpolygonfromclickFeatures",map:"=ngeoCreateregularpolygonfromclickMap",radius:"<ngeoCreateregularpolygonfromclickRadius",sides:"<?ngeoCreateregularpolygonfromclickSides"}}},N.directive("ngeoCreateregularpolygonfromclick",N.directive_),N.Controller_=function(e){var t=this;this.active=!1,e.$watch(function(){return t.active},function(e){t.interaction_.setActive(e)}),this.angle,this.features,this.map,this.radius,this.sides,this.interaction_,this.interactionListenerKey_,e.$on("$destroy",this.handleDestroy_.bind(this))},N.Controller_.$inject=["$scope"],N.Controller_.prototype.$onInit=function(){this.interaction_=new $({angle:this.angle,radius:this.radius,sides:this.sides}),this.interaction_.setActive(this.active),this.interactionListenerKey_=T.a(this.interaction_,"drawend",this.handleDrawEnd_,this),this.map.addInteraction(this.interaction_)},N.Controller_.prototype.handleDrawEnd_=function(e){var t=new P.a(e.feature.getGeometry());this.features.push(t)},N.Controller_.prototype.handleDestroy_=function(){T.e(this.interactionListenerKey_),this.interaction_.setActive(!1),this.map.removeInteraction(this.interaction_)},N.controller("ngeoCreateregularpolygonfromclickController",N.Controller_);var q=N,x=r(20),R=r(168),Q=r(54),W=r(146),Y=angular.module("gmfObjecteditingToolsComponent",[L.name,F.a.name,q.name,R.a.name,W.a.module.name]);Y.run(["$templateCache",function(e){e.put("gmf/objectediting/toolsComponent",r(490))}]),Y.value("gmfObjectEditingToolsOptions",{}),Y.directive_=function(){return{controller:"GmfObjecteditingtoolsController as oetCtrl",scope:{active:"=gmfObjecteditingtoolsActive",copyFromActive:"=gmfObjecteditingtoolsCopyfromactive",deleteFromActive:"=gmfObjecteditingtoolsDeletefromactive",feature:"<gmfObjecteditingtoolsFeature",geomType:"<gmfObjecteditingtoolsGeomtype",map:"<gmfObjecteditingtoolsMap",process:"=gmfObjecteditingtoolsProcess",queryableLayerInfo:"=gmfObjecteditingtoolsQueryablelayerinfo",requiresLayer:"=gmfObjecteditingtoolsRequireslayer",sketchFeatures:"<gmfObjecteditingtoolsSketchfeatures"},bindToController:!0,templateUrl:"gmf/objectediting/toolsComponent"}},Y.directive("gmfObjecteditingtools",Y.directive_),Y.Controller_=function(e,t,r){this.active,this.copyFromActive,this.deleteFromActive,this.feature,this.geomType,this.map,this.queryableLayerInfo,this.process,this.requiresLayer,this.sketchFeatures,this.scope_=t,this.ngeoToolActivateMgr_=r,this.geomTypePolygon=x.a.POLYGON,this.toolActiveNames_=[],this.drawActive=!1,this.registerTool_("drawActive",Y.ProcessType.ADD),this.eraseActive=!1,this.registerTool_("eraseActive",Y.ProcessType.DELETE),this.drawTriangleActive=!1,this.triangleAngle=Math.PI/180*90;var o=e.get("gmfObjectEditingToolsOptions");this.triangleRadius=void 0!==o.regularPolygonRadius?o.regularPolygonRadius:100,this.registerTool_("drawTriangleActive",Y.ProcessType.ADD),this.registerTool_("copyFromActive",Y.ProcessType.ADD,!0),this.registerTool_("deleteFromActive",Y.ProcessType.DELETE,!0),t.$on("$destroy",this.handleDestroy_.bind(this))},Y.Controller_.$inject=["$injector","$scope","ngeoToolActivateMgr"],Y.Controller_.prototype.registerTool_=function(e,t,r){var o=this,n=!0===r;this.scope_.$watch(function(){return o[e]},this.handleToolActiveChange_.bind(this,t,n));var i=Y.Controller_.NAMESPACE_+"-"+M.b(this),a=new Q.a(this,e);this.ngeoToolActivateMgr_.registerTool(i,a,!1),this.toolActiveNames_.push(e)},Y.Controller_.prototype.handleToolActiveChange_=function(e,t,r){r&&(this.process=e,this.requiresLayer=t);for(var o=!1,n=0,i=this.toolActiveNames_.length;n<i&&!(o=o||this[this.toolActiveNames_[n]]);n++);this.active=o,this.active||(this.requiresLayer=!1)},Y.Controller_.prototype.handleDestroy_=function(){},Y.controller("GmfObjecteditingtoolsController",Y.Controller_),Y.Controller_.NAMESPACE_="oet",Y.ProcessType={ADD:"add",DELETE:"delete"};var V=Y,U=r(94),H=r(90),z=r(61),X=r(63),K=r(18),B=r(106),J=r(102),Z=r(83),ee=r(163),te=r(69),re=r(27),oe=r(26),ne=r(12),ie={io:{OL3Parser:r(356).a}},ae=angular.module("gmfObjectEditingComponent",[i.a.module.name,a.a.module.name,s.a.module.name,A.module.name,V.name,U.a.module.name,z.a.module.name,W.a.module.name]);function se(e,t,r){return r(e,t)}ae.run(["$templateCache",function(e){e.put("gmf/objectediting",r(491))}]),ae.value("gmfObjecteditingTemplateUrl",function(e,t){var r=t.gmfObjecteditingTemplateurl;return void 0!==r?r:"gmf/objectediting"}),se.$inject=["$element","$attrs","gmfObjecteditingTemplateUrl"],ae.component_={controller:"GmfObjecteditingController as oeCtrl",bindings:{active:"=gmfObjecteditingActive",feature:"<gmfObjecteditingFeature",geomType:"<gmfObjecteditingGeomtype",layerNodeId:"<gmfObjecteditingLayernodeid",map:"<gmfObjecteditingMap",sketchFeatures:"<gmfObjecteditingSketchfeatures"},templateUrl:se},ae.component("gmfObjectediting",ae.component_),ae.Controller=function(e,t,r,o,n,i,a,s,l){this.active,this.feature,this.geomType,this.layerNodeId,this.map,this.sketchFeatures,this.scope_=e,this.timeout_=t,this.gettextCatalog_=r,this.gmfEditFeature_=o,this.gmfObjectEditingQuery_=n,this.queryableLayersInfo,this.selectedQueryableLayerInfo,this.queryableLayerListShown=!1,this.copyFromActive=!1,this.deleteFromActive=!1,this.featureHasGeom,this.ngeoLayerHelper_=s,this.gmfTreeManager_=i,this.ngeoFeatureHelper_=a,this.ngeoToolActivateMgr_=l,this.skipGeometryChange_=!1,this.process=V.ProcessType.ADD,this.editableWMSLayer_=null,this.jstsOL3Parser_=new ie.io.OL3Parser,this.state_,this.geometryChanges_=[],this.defaultStyles_={},this.defaultStylesWoVertice_={},this.dirtyStyles_={},this.dirtyStylesWoVertice_={},this.pending=!1,this.dirty=!1,this.listenerKeys_=[],this.features_=new K.b,this.interactions_=new K.b,this.modify_=new ee.a({deleteCondition:X.a.deleteCondition,features:this.features_,style:a.getVertexStyle(!1)}),this.interactions_.push(this.modify_),this.modifyToolActivate_=new Q.a(this.modify_,"active"),this.toolsActive=!1,this.toolsToolActivate_=new Q.a(this,"toolsActive")},ae.Controller.$inject=["$scope","$timeout","gettextCatalog","gmfEditFeature","gmfObjectEditingQuery","gmfTreeManager","ngeoFeatureHelper","ngeoLayerHelper","ngeoToolActivateMgr"],ae.Controller.prototype.$onInit=function(){var e=this;this.gmfObjectEditingQuery_.getQueryableLayersInfo().then(this.handleGetQueryableLayersInfo_.bind(this)),this.scope_.$watchCollection(function(){if(e.gmfTreeManager_.rootCtrl)return e.gmfTreeManager_.rootCtrl.children},function(t){e.timeout_(function(){t&&(e.unregisterAllTreeCtrl_(),e.gmfTreeManager_.rootCtrl.traverseDepthFirst(e.registerTreeCtrl_.bind(e)))})});var t=this.feature.getGeometry();this.state_=t?ae.Controller.State.UPDATE:ae.Controller.State.INSERT,this.scope_.$watchCollection(function(){return e.geometryChanges_},function(t,r){t.length&&(1===t.length?e.dirty=!1:e.dirty=!0)});var r=[39,155,145],o=[153,51,51];this.initializeStyles_(this.defaultStyles_,r),this.initializeStyles_(this.defaultStylesWoVertice_,r,!1),this.initializeStyles_(this.dirtyStyles_,o),this.initializeStyles_(this.dirtyStylesWoVertice_,o,!1),this.scope_.$watch(function(){return e.dirty},this.setFeatureStyle_.bind(this)),this.features_.push(this.feature),this.featureHasGeom=!_.isEmpty(t),this.initializeInteractions_(),this.registerInteractions_(),this.toggle_(!0),this.resetGeometryChanges_(),this.scope_.$on("$destroy",this.handleDestroy_.bind(this))},ae.Controller.prototype.delete=function(){var e=this.gettextCatalog_.getString("Do you really want to delete the feature?");confirm(e)&&(this.dirty=!1,this.pending=!0,this.gmfEditFeature_.deleteFeature(this.layerNodeId,this.feature).then(this.handleDeleteFeature_.bind(this)))},ae.Controller.prototype.save=function(){this.pending=!0;var e=this.feature.clone();e.setId(this.feature.getId());var t=e.getGeometry();t&&_.toXY(t),this.state_===ae.Controller.State.INSERT?this.gmfEditFeature_.insertFeatures(this.layerNodeId,[e]).then(this.handleEditFeature_.bind(this)):this.state_===ae.Controller.State.UPDATE&&this.gmfEditFeature_.updateFeature(this.layerNodeId,e).then(this.handleEditFeature_.bind(this))},ae.Controller.prototype.undo=function(){if(!(this.geometryChanges_.length<=1)){this.skipGeometryChange_=!0,this.geometryChanges_.pop();var e=ae.Controller.cloneGeometry_(this.geometryChanges_[this.geometryChanges_.length-1]);this.feature.setGeometry(e),this.skipGeometryChange_=!1}},ae.Controller.prototype.isStateInsert=function(){return this.state_===ae.Controller.State.INSERT},ae.Controller.prototype.handleDeleteFeature_=function(e){this.feature.setGeometry(null),this.resetGeometryChanges_(),this.state_=ae.Controller.State.INSERT,this.pending=!1,this.refreshWMSLayer_()},ae.Controller.prototype.handleEditFeature_=function(e){var t=(new B.a).readFeatures(e.data);t.length&&this.feature.setId(t[0].getId()),this.resetGeometryChanges_(),this.feature.getGeometry()?this.state_=ae.Controller.State.UPDATE:this.state_=ae.Controller.State.INSERT,this.pending=!1,this.refreshWMSLayer_()},ae.Controller.prototype.initializeInteractions_=function(){this.interactions_.forEach(function(e){e.setActive(!1),H.a.interaction(e)})},ae.Controller.prototype.registerInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.addInteraction(t)})},ae.Controller.prototype.unregisterInteractions_=function(){var e=this;this.interactions_.forEach(function(t){e.map.removeInteraction(t)})},ae.Controller.prototype.toggle_=function(e){var t=this.listenerKeys_,r=ae.Controller.NAMESPACE_+"-"+M.b(this),o=this.ngeoToolActivateMgr_;e?(t.push(T.a(this.feature,"change:"+this.feature.getGeometryName(),this.handleFeatureGeometryChange_,this)),t.push(T.a(this.modify_,"change:active",this.setFeatureStyle_,this)),t.push(T.a(this.modify_,"modifyend",this.handleModifyInteractionModifyEnd_,this)),t.push(T.a(window,"beforeunload",this.handleWindowBeforeUnload_,this)),t.push(T.a(this.sketchFeatures,"add",this.handleSketchFeaturesAdd_,this)),o.registerTool(r,this.modifyToolActivate_,!0),o.registerTool(r,this.toolsToolActivate_,!1)):(this.undoAllChanges_(),t.forEach(T.e),t.length=0,o.unregisterTool(r,this.modifyToolActivate_),o.unregisterTool(r,this.toolsToolActivate_)),this.modify_.setActive(e)},ae.Controller.prototype.undoAllChanges_=function(){var e=ae.Controller.cloneGeometry_(this.geometryChanges_[0]);this.feature.setGeometry(e),this.resetGeometryChanges_(),this.dirty=!1,this.setFeatureStyle_()},ae.Controller.prototype.resetGeometryChanges_=function(){if(this.geometryChanges_.length>1&&(this.geometryChanges_.length=0),0===this.geometryChanges_.length){var e=this.feature.getGeometry(),t=ae.Controller.cloneGeometry_(e);this.geometryChanges_.push(t)}},ae.Controller.prototype.handleModifyInteractionModifyEnd_=function(e){var t=this.feature.getGeometry();if(t instanceof d.a){var r=this.jstsOL3Parser_.read(t).buffer(0);t=X.a.toMulti(this.jstsOL3Parser_.write(r)),this.skipGeometryChange_=!0,this.feature.setGeometry(t.clone()),this.skipGeometryChange_=!1}var o=ae.Controller.cloneGeometry_(t);E.a.assert(o),this.geometryChanges_.push(o),this.scope_.$apply()},ae.Controller.prototype.initializeStyles_=function(e,t,r){var o=!1!==r,n=t.slice();n.push(.3);var i=new te.a({radius:8,stroke:new oe.a({color:t,width:1}),fill:new re.a({color:n})});e.Point=new ne.c({image:i}),e.MultiPoint=new ne.c({image:i}),e.LineString=[new ne.c({stroke:new oe.a({color:t,width:3})})],o&&e.LineString.push(this.ngeoFeatureHelper_.getVertexStyle(!0)),e.MultiLineString=[new ne.c({stroke:new oe.a({color:t,width:3})})],o&&e.MultiLineString.push(this.ngeoFeatureHelper_.getVertexStyle(!0)),e.Polygon=[new ne.c({stroke:new oe.a({color:t,width:2}),fill:new re.a({color:n})})],o&&e.Polygon.push(this.ngeoFeatureHelper_.getVertexStyle(!0)),e.MultiPolygon=[new ne.c({stroke:new oe.a({color:t,width:2}),fill:new re.a({color:n})})],o&&e.MultiPolygon.push(this.ngeoFeatureHelper_.getVertexStyle(!0))},ae.Controller.prototype.setFeatureStyle_=function(){var e=this.feature.getGeometry();if(e){var t=e.getType(),r=this.modify_.getActive(),o=void 0;o=this.dirty?r?this.dirtyStyles_[t]:this.dirtyStylesWoVertice_[t]:r?this.defaultStyles_[t]:this.defaultStylesWoVertice_[t],this.feature.setStyle(o)}},ae.Controller.prototype.registerTreeCtrl_=function(e){var t=e.node;if(!(t.children&&t.children.length||t.id!==this.layerNodeId)){var r=a.a.getLayer(e);E.a.assert(r instanceof J.a||r instanceof Z.a),this.editableWMSLayer_=r}},ae.Controller.prototype.unregisterAllTreeCtrl_=function(){this.editableWMSLayer_=null},ae.Controller.prototype.refreshWMSLayer_=function(){this.editableWMSLayer_&&this.ngeoLayerHelper_.refreshWMSLayer(this.editableWMSLayer_)},ae.Controller.prototype.handleWindowBeforeUnload_=function(e){var t=this.gettextCatalog_;if(this.dirty){var r=t.getString("There are unsaved changes.");return(e||window.event).returnValue=r,r}return""},ae.Controller.prototype.handleSketchFeaturesAdd_=function(e){var t=e.element.getGeometry(),r=this.feature.getGeometry();if(r){var o=this.jstsOL3Parser_.read(r),n=this.jstsOL3Parser_.read(t),i=void 0;if(this.process===V.ProcessType.ADD?i=o.union(n):o.intersects(n)&&(i=o.difference(n)),i){var a=this.jstsOL3Parser_.write(i),s=X.a.toMulti(a);this.feature.setGeometry(s.clone())}}else this.process===V.ProcessType.ADD&&this.feature.setGeometry(X.a.toMulti(t.clone()));this.sketchFeatures.clear()},ae.Controller.prototype.handleFeatureGeometryChange_=function(){var e=this,t=this.feature.getGeometry();this.timeout_(function(){e.featureHasGeom=!_.isEmpty(t)}),this.skipGeometryChange_||t&&this.timeout_(function(){e.geometryChanges_.push(t.clone())})},ae.Controller.prototype.handleGetQueryableLayersInfo_=function(e){this.queryableLayersInfo=e,this.queryableLayersInfo.length&&(this.selectedQueryableLayerInfo=this.queryableLayersInfo[0])},ae.Controller.prototype.handleDestroy_=function(){this.features_.clear(),this.toggle_(!1),this.unregisterInteractions_()},ae.Controller.cloneGeometry_=function(e){var t=null;return e&&(t=e.clone()),t},ae.Controller.NAMESPACE_="oe",ae.Controller.State={INSERT:"insert",UPDATE:"update"},ae.controller("GmfObjecteditingController",ae.Controller);var le=ae,ce=r(193),ge=function(e,t,r){this.q_=e,this.gmfEditFeature_=t,this.ngeoLocation_=r,this.getFeatureDefered_=null};ge.$inject=["$q","gmfEditFeature","ngeoLocation"],ge.$inject=["$q","gmfEditFeature","ngeoLocation"],ge.prototype.getFeature=function(){if(!this.getFeatureDefered_){this.getFeatureDefered_=this.q_.defer();var e=this.ngeoLocation_.getParam(ge.Param.GEOM_TYPE),t=this.ngeoLocation_.getParam(ge.Param.ID),r=this.ngeoLocation_.getParam(ge.Param.LAYER),o=this.ngeoLocation_.getParam(ge.Param.PROPERTY),n=this.ngeoLocation_.getParam(ge.Param.THEME);e&&t&&r&&o&&n?this.gmfEditFeature_.getFeaturesWithComparisonFilters([r],[{operator:"eq",property:o,value:t}]).then(this.handleGetFeatures_.bind(this,o,t)):this.getFeatureDefered_.resolve(null)}return this.getFeatureDefered_.promise},ge.prototype.getGeomType=function(){return this.ngeoLocation_.getParam(ge.Param.GEOM_TYPE)},ge.prototype.getLayerNodeId=function(){return this.ngeoLocation_.getParamAsInt(ge.Param.LAYER)},ge.prototype.handleGetFeatures_=function(e,t,r){var o=void 0;if(r.length)o=r[0];else{var n={};n[e]=t,n.geometry=null,o=new P.a(n)}this.getFeatureDefered_.resolve(o)},ge.Param={GEOM_TYPE:"objectediting_geomtype",ID:"objectediting_id",LAYER:"objectediting_layer",PROPERTY:"objectediting_property",THEME:"objectediting_theme"},(ge.module=angular.module("gmfObjectEditingManager",[i.a.module.name,ce.a.module.name])).service("gmfObjectEditingManager",ge);var he=ge,ue=angular.module("gmfObjecteditingModule",[le.name,L.name,he.module.name,A.module.name,V.name]),de=r(128),fe=r(113),me=r(57),pe=r(52),ye=r(149),_e=r.n(ye),ve=r(150),be=r.n(ve);window.requestAnimationFrame||(alert("Your browser is not supported, please update it or use another one. You will be redirected.\n\nVotre navigateur n'est pas supporté, veuillez le mettre à jour ou en utiliser un autre. Vous allez être redirigé.\n\nIhr Browser wird nicht unterstützt, bitte aktualisieren Sie ihn oder verwenden Sie einen anderen. Sie werden weitergeleitet."),window.location="http://geomapfish.org/");var Ce=function(e,t,r){var n=this;this.oeEditActive=!1,o.a.call(this,{srid:21781,mapViewConfig:{center:[632464,185457],zoom:3,resolutions:[250,100,50,20,10,5,2,1,.5,.25,.1,.05]}},e,t);var i=t.get("ngeoToolActivateMgr");i.unregisterGroup("mapTools");var a=new Q.a(this,"oeEditActive");i.registerTool("mapTools",a,!0);var s=new Q.a(this,"queryActive");i.registerTool("mapTools",s,!1),r(function(){n.oeEditActive=!0}),this.vectorSource_=new pe.b({wrapX:!1}),this.vectorLayer_=new me.a({source:this.vectorSource_}),this.sketchFeatures=new K.b,this.sketchLayer_=new me.a({source:new pe.b({features:this.sketchFeatures,wrapX:!1})}),t.get("gmfThemes").getThemesObject().then(function(e){e&&(n.map.addLayer(n.vectorLayer_),n.map.addLayer(n.sketchLayer_))});var l=t.get("gmfObjectEditingManager");this.oeGeomType=l.getGeomType(),this.oeLayerNodeId=l.getLayerNodeId(),this.oeFeature=null,l.getFeature().then(function(e){n.oeFeature=e,e&&n.vectorSource_.addFeature(e)}),this.searchCoordinatesProjections=[fe.a,de.a,"EPSG:4326"],this.scaleSelectorValues=[25e4,1e5,5e4,2e4,1e4,5e3,2e3,1e3,500,250,100,50],this.elevationLayers=["aster","srtm"],this.selectedElevationLayer=this.elevationLayers[0],this.profileLinesconfiguration={aster:{color:"#0000A0"},srtm:{color:"#00A000"}},this.mousePositionProjections=[{code:de.a,label:"CH1903+ / LV95",filter:"ngeoNumberCoordinates::{x}, {y} m"},{code:fe.a,label:"CH1903 / LV03",filter:"ngeoNumberCoordinates::{x}, {y} m"},{code:"EPSG:4326",label:"WGS84",filter:"ngeoDMSCoordinates:2"}];var c=t.get("gettextCatalog");if(c.getString("Add a theme"),c.getString("Add a sub theme"),c.getString("Add a layer"),t.has("sentryUrl")){var g=t.has("sentryOptions")?t.get("sentryOptions"):void 0;(new _e.a).config(t.get("sentryUrl"),g).addPlugin(be.a).install()}};Ce.$inject=["$scope","$injector","$timeout"],Ce.$inject=["$scope","$injector","$timeout"],M.c(Ce,o.a),(Ce.module=angular.module("Appoeedit",[n.a.module.name,o.a.module.name,ue.name])).value("gmfContextualdatacontentTemplateUrl","gmf/contextualdata"),Ce.module.run(["$templateCache",function(e){e.put("gmf/contextualdata",r(492))}]),Ce.module.controller("OEEditController",Ce);t.default=Ce}});
//# sourceMappingURL=oeedit.0d0dc3.js.map