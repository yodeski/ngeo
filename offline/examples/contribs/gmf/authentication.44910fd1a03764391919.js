webpackJsonp([25],{112:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0)),i=n(108),a=(o=i)&&o.__esModule?o:{default:o};var s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a.default.call(this,e),this.detail=t};r.inherits(s,a.default),t.default=s},238:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=a(n(112)),i=a(n(8));!function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);t.default=e}(n(0));function a(e){return e&&e.__esModule?e:{default:e}}var s=function(t){function n(e,t,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r.$http_=e,r.baseUrl_=t.replace(/\/$/,""),r.user_=o,r.load_(),r}return n.$inject=["$http","authenticationBaseUrl","gmfUser"],function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,t),o(n,[{key:"load_",value:function(){var e=this.baseUrl_+"/"+n.RouteSuffix.IS_LOGGED_IN;this.$http_.get(e,{withCredentials:!0}).then(this.handleLogin_.bind(this,!0))}},{key:"changePassword",value:function(t,o,r){var i=this.baseUrl_+"/"+n.RouteSuffix.CHANGE_PASSWORD;return this.$http_.post(i,e.param({oldPassword:t,newPassword:o,confirmNewPassword:r}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0})}},{key:"login",value:function(t,o){var r=this.baseUrl_+"/"+n.RouteSuffix.LOGIN;return this.$http_.post(r,e.param({login:t,password:o}),{headers:{"Content-Type":"application/x-www-form-urlencoded"},withCredentials:!0}).then(this.handleLogin_.bind(this,!1))}},{key:"logout",value:function(){var e=this.baseUrl_+"/"+n.RouteSuffix.LOGOUT;return this.$http_.get(e,{withCredentials:!0}).then(this.resetUser_.bind(this))}},{key:"resetPassword",value:function(t){var o=this.baseUrl_+"/"+n.RouteSuffix.RESET_PASSWORD,r=function(e){return e.data}.bind(this);return this.$http_.post(o,e.param({login:t}),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(r)}},{key:"getFunctionalities",value:function(){return this.user_.functionalities}},{key:"getRoleId",value:function(){return this.user_.role_id}},{key:"handleLogin_",value:function(e,t){var n=t.data;if(this.setUser_(n,!e),e){var o=new r.default("ready",{user:this.user_});this.dispatchEvent(o)}return t}},{key:"setUser_",value:function(e,t){for(var n in e)this.user_[n]=e[n];if(t&&void 0!==e.username){var o=new r.default("login",{user:this.user_});this.dispatchEvent(o)}}},{key:"resetUser_",value:function(){for(var e in this.user_)this.user_[e]=null;var t=new r.default("logout",{user:this.user_});this.dispatchEvent(t),this.load_()}}]),n}(a(n(145)).default);s.RouteSuffix={CHANGE_PASSWORD:"loginchange",IS_LOGGED_IN:"loginuser",LOGIN:"login",LOGOUT:"logout",RESET_PASSWORD:"loginresetpassword"},s.module=angular.module("gmfAuthenticationService",[]),s.module.service("gmfAuthenticationService",s),i.default.module.requires.push(s.module.name),s.module.value("gmfUser",{functionalities:null,is_password_changed:null,role_id:null,role_name:null,username:null}),t.default=s}).call(t,n(27))},251:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=a(n(2)),i=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}var s=angular.module("ngeoModal",[]);i.default.module.requires.push(s.name),s.component_={template:'<div class="modal fade" tabindex="-1" role="dialog">\n    <div class="modal-dialog">\n      <div class="modal-content">\n        <ng-transclude></ng-transclude>\n      </div>\n    </div>\n  </div>',require:{ngModel:"ngModel"},transclude:!0,controller:"ngeoModalController",bindings:{resizable:"<ngeoModalResizable"}},s.component("ngeoModal",s.component_),s.Controller_=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.$element_=n,this.$scope_=t,this.modal_,this.resizable,this.ngModel}return e.$inject=["$scope","$element"],o(e,[{key:"$onInit",value:function(){var e=this;this.modal_=this.$element_.children(),this.resizable=!!this.resizable;var t=this.modal_.find(".modal-dialog");t.draggable(),this.resizable&&t.resizable(),this.ngModel.$render=function(){e.modal_.modal(e.ngModel.$viewValue?"show":"hide")},this.modal_.on("shown.bs.modal hidden.bs.modal",function(t){var n=t.type;r.default.assert("shown"==n||"hidden"==n),e.$scope_.$apply(function(){e.ngModel.$setViewValue("shown"==n)})})}},{key:"$onDestroy",value:function(){var e=this.modal_.find(".modal-dialog");e.draggable("destroy"),this.resizable&&e.resizable("destroy")}}]),e}(),s.controller("ngeoModalController",s.Controller_),t.default=s},278:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i(n(279)),r=i(n(238));function i(e){return e&&e.__esModule?e:{default:e}}var a=angular.module("gmfAuthenticationModule",[o.default.name,r.default.module.name]);t.default=a},279:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=h(n(8)),i=h(n(238)),a=(h(n(1)),h(n(59))),s=h(n(95)),l=h(n(251)),u=h(n(3));function h(e){return e&&e.__esModule?e:{default:e}}var c=angular.module("gmfAuthentication",[i.default.module.name,s.default.module.name,l.default.name]);function d(e,t,n){return n(e,t)}r.default.module.requires.push(c.name),c.gmfAuthenticationTemplateUrl_=function(e,t){var n=t.gmfAuthenticationTemplateurl;return void 0!==n?n:r.default.baseModuleTemplateUrl+"/authentication/component.html"},d.$inject=["$element","$attrs","gmfAuthenticationTemplateUrl"],c.component_={bindings:{allowPasswordChange:"<?gmfAuthenticationAllowPasswordChange",forcePasswordChange:"<?gmfAuthenticationForcePasswordChange"},controller:"GmfAuthenticationController",templateUrl:d},c.value("gmfAuthenticationTemplateUrl",c.gmfAuthenticationTemplateUrl_),c.component("gmfAuthentication",c.component_),c.AuthenticationController_=function(){function e(t,n,o,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.gmfUser=r,this.$scope_=n,this.gettextCatalog=t,this.gmfAuthenticationService_=o,this.notification_=i,this.allowPasswordReset,this.allowPasswordChange,this.forcePasswordChange,this.changingPassword=!1,this.changePasswordModalShown=!1,this.resetPasswordModalShown=!1,this.error=!1,this.loginVal="",this.pwdVal="",this.oldPwdVal="",this.newPwdVal="",this.newPwdConfVal="",u.default.listen(o,"ready",this.onLoginReady_.bind(this))}return e.$inject=["gettextCatalog","$scope","gmfAuthenticationService","gmfUser","ngeoNotification"],o(e,[{key:"$onInit",value:function(){this.allowPasswordReset=!1!==this.allowPasswordReset,this.allowPasswordChange=!1!==this.allowPasswordChange,this.forcePasswordChange=!0===this.forcePasswordChange}},{key:"changePassword",value:function(){var e=this,t=this.gettextCatalog,n=this.oldPwdVal,o=this.newPwdVal,r=this.newPwdConfVal,i=[];if(""===n&&i.push(t.getString("The old password is required.")),""===o&&i.push(t.getString("The new password is required.")),""===r&&i.push(t.getString("The password confirmation is required.")),i.length)this.setError_(i);else if(n===o&&i.push(t.getString("The old and new passwords are the same.")),o!==r&&i.push(t.getString("The passwords don't match.")),i.length)this.setError_(i);else{var a=t.getString("Incorrect old password.");this.gmfAuthenticationService_.changePassword(n,o,r).then(function(){e.changePasswordModalShown=!0,e.changePasswordReset()},this.setError_.bind(this,a))}}},{key:"login",value:function(){var e=this.gettextCatalog,t=[];if(""===this.loginVal&&t.push(e.getString("The username is required.")),""===this.pwdVal&&t.push(e.getString("The password is required.")),t.length)this.setError_(t);else{var n=e.getString("Incorrect username or password.");this.gmfAuthenticationService_.login(this.loginVal,this.pwdVal).then(this.resetError_.bind(this),this.setError_.bind(this,n))}}},{key:"logout",value:function(){var e=this.gettextCatalog.getString("Could not log out.");this.gmfAuthenticationService_.logout().then(this.resetError_.bind(this),this.setError_.bind(this,e))}},{key:"resetPassword",value:function(){var e=this.gettextCatalog;if(this.loginVal){var t=e.getString("An error occured while reseting the password."),n=function(e){this.resetPasswordModalShown=!0,this.resetError_()}.bind(this);this.gmfAuthenticationService_.resetPassword(this.loginVal).then(n,this.setError_.bind(this,t))}else this.setError_(e.getString("Please, input a login..."))}},{key:"changePasswordReset",value:function(){this.resetError_(),this.changingPassword=!1,this.oldPwdVal="",this.newPwdVal="",this.newPwdConfVal=""}},{key:"onLoginReady_",value:function(e){if(!1===e.detail.user.is_password_changed&&this.forcePasswordChange){var t=this.gettextCatalog.getString("You must change your password.");this.notification_.notify({msg:t,type:a.default.Type.WARNING})}}},{key:"setError_",value:function(e){this.error&&this.resetError_(),this.error=!0;var t=angular.element(".gmf-authentication-error");Array.isArray(e)||(e=[e]),e.forEach(function(e){this.notification_.notify({msg:e,target:t,type:a.default.Type.ERROR})},this)}},{key:"resetError_",value:function(){this.notification_.clear(),this.error=!1}}]),e}(),c.controller("GmfAuthenticationController",c.AuthenticationController_),t.default=c},387:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(388),n(167);var o=i(n(8)),r=i(n(278));function i(e){return e&&e.__esModule?e:{default:e}}var a={};a.module=angular.module("gmfapp",[o.default.module.name,r.default.name]),a.module.value("authenticationBaseUrl","https://geomapfish-demo.camptocamp.net/2.2/wsgi"),a.module.constant("angularLocaleScript","../build/angular-locale_{{locale}}.js"),a.MainController=function(){},a.module.controller("MainController",a.MainController),t.default=a},388:function(e,t){},59:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){};o.prototype.showMessage=function(e){},o.prototype.show=function(e){this.getMessageObjects(e).forEach(this.showMessage,this)},o.prototype.error=function(e){this.show(this.getMessageObjects(e,o.Type.ERROR))},o.prototype.info=function(e){this.show(this.getMessageObjects(e,o.Type.INFORMATION))},o.prototype.success=function(e){this.show(this.getMessageObjects(e,o.Type.SUCCESS))},o.prototype.warn=function(e){this.show(this.getMessageObjects(e,o.Type.WARNING))},o.prototype.getMessageObjects=function(e,t){var n=[],r=null,i=o.Type.INFORMATION;return"string"==typeof e?n.push({msg:e,type:void 0!==t?t:i}):Array.isArray(e)?e.forEach(function(o){"string"==typeof e?r={msg:o,type:void 0!==t?t:i}:(r=o,void 0!==t&&(r.type=t)),n.push(r)},this):(r=e,void 0!==t&&(r.type=t),void 0===r.type&&(r.type=i),n.push(r)),n},o.Type={ERROR:"error",INFORMATION:"information",SUCCESS:"success",WARNING:"warning"},t.default=o},95:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s(n(2)),r=s(n(1)),i=s(n(59)),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n(0));function s(e){return e&&e.__esModule?e:{default:e}}var l=function(e){i.default.call(this),this.timeout_=e;var t=angular.element('<div class="ngeo-notification"></div>');angular.element(document.body).append(t),this.container_=t,this.cache_={}};l.$inject=["$timeout"],l.$inject=["$timeout"],a.inherits(l,i.default),l.DEFAULT_DELAY_=7e3,l.prototype.notify=function(e){this.show(e)},l.prototype.clear=function(){for(var e in this.cache_)this.clearMessageByCacheItem_(this.cache_[parseInt(e,10)])},l.prototype.showMessage=function(e){var t=this,n=e.type;o.default.assertString(n,"Type should be set.");var r=["alert","fade"];switch(n){case i.default.Type.ERROR:r.push("alert-danger");break;case i.default.Type.INFORMATION:r.push("alert-info");break;case i.default.Type.SUCCESS:r.push("alert-success");break;case i.default.Type.WARNING:r.push("alert-warning")}var s=angular.element('<div class="'+r.join(" ")+'"></div>');(e.target?angular.element(e.target):this.container_).append(s),s.html(e.msg).addClass("in");var u=void 0!==e.delay?e.delay:l.DEFAULT_DELAY_,h={el:s},c=a.getUid(s);h.promise=this.timeout_(function(){s.alert("close"),delete t.cache_[c]},u),this.cache_[c]=h},l.prototype.clearMessageByCacheItem_=function(e){var t=e.el,n=e.promise,o=a.getUid(t);t.alert("close"),this.timeout_.cancel(n),delete this.cache_[o]},(l.module=angular.module("ngeoNotification",[])).service("ngeoNotification",l),r.default.module.requires.push(l.module.name),t.default=l}},[387]);
//# sourceMappingURL=authentication.44910fd1a03764391919.js.map